/*
 The buffer module from node.js, for the browser.

 @author   Feross Aboukhadijeh <http://feross.org>
 @license  MIT
 ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[29],{1275:function(w,C,a){(function(b){a.d(C,"a",function(){return E});var c=a(0),h=a(14),k=a(175),d=a(138),f=a(1281),u=a(39),r=a(263),t=a(45),v=a(383),x=a(200),m=a(59),l=a(93),n=a(16),z=a(19),y=a(42),B=a(1282),G=a(1);class E extends u.a{constructor(J,I,R){super();this.xti=f.a.getTypeName();this.fGb=this.tX=this.Bf=null;this.imageHeight=this.imageWidth=0;this.iRa=this.errorMessage=this.tableData=null;this.Fwd=0;
this.v3c=!1;this.qVe=X=>{if(X){var H={};if((()=>{let L=y.d(this.Kwh(X.data));({Mu:H}=L);return L})().returnValue){var M=Object(d.a)(Object,H);if("."===M.DataFromPictureWildcard)if(M.SessionId!==this.iRa)h.ULS.sendTraceTag(523805139,0,10,"DataFromPictureManager.DataFromPictureMessageReceivedEventHandler() - SessionID of received message does not match current Session ID.");else switch(h.ULS.sendTraceTag(523805138,0,50,"DataFromPictureManager.DataFromPictureMessageReceivedEventHandler - Message Received from SDX pane"),
M.CmdType){case "ACK":this.v3c=!0;this.Cpg.stop();h.ULS.sendTraceTag(523805137,0,50,"DataFromPictureManager.DataFromPictureMessageReceivedEventHandler - SDX pane launched.");this.hNj();0<this.errorMessage.length?this.sdg():0<this.tableData.length&&this.Ldg();break;case "insert_html":const L=this.$.qa.ua,S={};var O=z.h(this.$).ha.ra.lf.clone();S.PasteId=k.a.create().toString();S.DestinationRanges=t.s(t.v(O,this.$));O=M.Parameters.split("|",3);G.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RemoveCCforDataFromPictureXLO",
!1)||h.ULS.sendTraceTag(523805136,0,50,`DataFromPictureManager.dataFromPictureMessageReceivedEventHandler - LCC:${O[0]}|${O[1]}|${O[2]}.`);O=M.Parameters.indexOf("|");O=M.Parameters.indexOf("|",O+1);O=M.Parameters.indexOf("|",O+1);S.SourceHtml=M.Parameters.substring(O+1);S.CopyOperationId=null;const T=L.Pa(1,L.ie());T.pasteHtmlParameters=S;v.a(this.$.userOperationManager,(V,la,Z)=>m.g(L,"pasteHtmlContent",T,V,la,Z,null,64),V=>new x.a(204,0,V,1),null);this.Fwd++;h.ULS.sendTraceTag(523805135,0,50,`DataFromPictureManager.dataFromPictureMessageReceivedEventHandler - Number of pastes to workbook per Session ID:${this.Fwd.toString()}`)}}}};
this.wti=(X,H)=>{if(X=H.annotation)if(!H.parentPath||1>=H.parentPath.length||H.parentPath[1]!==this.iRa)h.ULS.sendTraceTag(523805124,0,10,"DataFromPictureManager.ImageToTableAnnotationHandler() - SessionID of received annotation does not match current Session ID.");else{h.ULS.sendTraceTag(523805123,0,50,"DataFromPictureManager.ImageToTableAnnotationHandler() - Annotation Received.");H=X.errorCode;switch(H){case null:case -1:this.errorMessage=n.a.instance.ia(2273);break;case 1:this.errorMessage=n.a.instance.ia(2274);
break;case 2:this.errorMessage=n.a.instance.ia(2275)}0<this.errorMessage.length&&h.ULS.sendTraceTag(523805122,0,10,`DataFromPictureManager.ImageToTableAnnotationHandler() - ErrorCode:${H?H.toString():"null"}.`);this.CEe.stop();this.tableData=X.html;this.v3c&&(0<this.errorMessage.length?this.sdg():0<this.tableData.length&&this.Ldg())}else h.ULS.sendTraceTag(523805125,0,10,"DataFromPictureManager.ImageToTableAnnotationHandler() - Received annotation is null.")};this.$=J;this.Ti=I;this.uploaderCreator=
R;this.initialize()}dispose(){window.removeEventListener("message",this.qVe,!1);this.Ti.unregister("DataFromPicture");super.dispose()}jfj(J,I){h.ULS.sendTraceTag(523805146,0,50,"DataFromPictureManager.onSuccessfulFileLoad - Start function.");let R=new Image;R.onload=()=>{var X=document.createElement("canvas");X.width=R.width;X.height=R.height;const H=X.getContext("2d");try{H.drawImage(R,0,0,R.width,R.height)}catch(L){h.ULS.sendTraceTag(523805145,0,10,`DataFromPictureManager.onSuccessfulFileLoad - Can't draw to canvas. ex.Message: ${L.message}`);
return}let M;try{M=X.toDataURL("image/jpeg")}catch(L){h.ULS.sendTraceTag(523805144,0,10,`DataFromPictureManager.onSuccessfulFileLoad - Can't render to jpeg. ex.Message: ${L.message}`);return}X=M.split(",");if(2>X.length)h.ULS.sendTraceTag(523805143,0,10,"DataFromPictureManager.onSuccessfulFileLoad - Can't render to jpeg.");else{X=X[1];try{var O=window.self.atob(X)}catch(L){h.ULS.sendTraceTag(523805142,0,10,`DataFromPictureManager.onSuccessfulFileLoad - Can't convert image to byte string. ex.Message: ${L.message}`);
return}28E5<O.length?(h.ULS.sendTraceTag(523805141,0,15,"DataFromPictureManager.onSuccessfulFileLoad - Image exceeds max size limit."),I.V_j()):(this.lJj(this.Bf,this.tX,X,R.width,R.height),URL.revokeObjectURL(R.src),R=null,h.ULS.sendTraceTag(523805140,0,50,"DataFromPictureManager.onSuccessfulFileLoad - End function."))}};R.src=J}Rnj(J,I,R,X){this.Bf=J;this.tX=X;this.uploaderCreator.twi(this.$,I,R,X,this)}lJj(J,I,R,X,H){this.iRa=k.a.create().toString();this.Fwd=0;this.fGb=R;this.imageWidth=X;this.imageHeight=
H;this.errorMessage=this.tableData="";this.v3c=!1;this.Cpg=this.$.Sd.fi("LoadResource","DataFromPictureTaskpaneLaunch");this.Cpg.start();this.Lhj(J,I);this.CEe=this.$.Sd.fi("LoadResource","DataFromPictureAnnotation");this.CEe.start();this.Jkk()}Jkk(){if(this.fGb.length){var J=window.self.atob(this.fGb);var I=new Uint8Array(J.length);for(let R=0;R<J.length;R++)I[R]=J.charCodeAt(R);this.Ti.Ikk(I,this.iRa,this.imageWidth,this.imageHeight)}else h.ULS.sendTraceTag(523805134,0,10,"DataFromPictureManager.UploadImageToAugmentationLoop - imageDataBase64 is empty")}Lhj(J,
I){I.SessionID=this.iRa;I.DataFromPictureAssetId="FA000000050";I.LoadDataFromPictureTaskpane=!0;J=new l.a(-859308420,J.method,J.mode,J.Tg,J.tabName);this.$.Ha.Ad(J,I)}Tid(J){try{const I=b.from(J,"utf16le").toString("base64");return B.a.hNa(this.iRa,I)}catch(I){return h.ULS.sendTraceTag(523805133,0,10,"DataFromPictureManager.encodeAndEncrypt - Buffer can't encode message."),""}}Kwh(J){try{const I=B.a.hNa(this.iRa,J);return b.from(I,"base64").toString("utf16le")}catch(I){return h.ULS.sendTraceTag(523805132,
0,50,"DataFromPictureManager.decryptAndDecode - Buffer can't decode message."),""}}hNj(){if(this.fGb.length){var J=r.a(this.$).Nea("FA000000050"),I={["DataFromPictureWildcard"]:"."};I.imageData=this.Tid(this.fGb);OfficeExt.AddinCommandsRuntimeManager.invokeAppCommand(J,"onCustomMessage",I,R=>{R&&h.ULS.sendTraceTag(523805130,0,10,"DataFromPictureManager.sendImageToTaskPane() - Attempted to send image to Pane - Failed .")})}else h.ULS.sendTraceTag(523805131,0,10,"DataFromPictureManager.sendImageToTaskPane() - Attempted to send image to Pane - Failed no image Data.")}Ldg(){if(this.tableData.length){var J=
r.a(this.$).Nea("FA000000050"),I={["DataFromPictureWildcard"]:"."};I.tableHtml=this.Tid(this.tableData);OfficeExt.AddinCommandsRuntimeManager.invokeAppCommand(J,"onCustomMessage",I,R=>{R&&h.ULS.sendTraceTag(523805128,0,10,"DataFromPictureManager.sendTableToTaskPane() - Attempted to send table data to Pane - Failed.")})}else h.ULS.sendTraceTag(523805129,0,10,"DataFromPictureManager.sendTableToTaskPane() - Attempted to send table data to Pane - Failed, No Table Data.")}sdg(){if(this.errorMessage.length){var J=
r.a(this.$).Nea("FA000000050"),I={["DataFromPictureWildcard"]:"."};I.errorMessage=this.Tid(this.errorMessage);OfficeExt.AddinCommandsRuntimeManager.invokeAppCommand(J,"onCustomMessage",I,R=>{R&&h.ULS.sendTraceTag(523805126,0,10,"DataFromPictureManager.sendErrorMessageToTaskPane() - Attempted to send ErrorMessage to Pane - Failed .")})}else h.ULS.sendTraceTag(523805127,0,10,"DataFromPictureManager.sendErrorToTaskPane() - Attempted to send ErrorMessage to Pane - Failed, No valid error message.")}initialize(){window.addEventListener("message",
this.qVe,!1);this.Ti.register(this.Ti.j2().E4("DataFromPicture").C4(()=>{}).activateAnnotation({annotationType:this.xti,iu:!1,JQ:this.wti}).build())}}Object(c.a)(E,"DataFromPictureManager",u.a,[234])}).call(this,a(1276).yAg)},1276:function(w,C,a){(function(b){function c(){try{var H=new Uint8Array(1);H.__proto__={__proto__:Uint8Array.prototype,yrk:function(){return 42}};return"function"===typeof H.subarray&&0===H.subarray(1,1).byteLength}catch(M){return!1}}function h(H,M){if((k.kS?2147483647:1073741823)<
M)throw new RangeError("Invalid typed array length");k.kS?(H=new Uint8Array(M),H.__proto__=k.prototype):(null===H&&(H=new k(M)),H.length=M);return H}function k(H,M,O){if(!(k.kS||this instanceof k))return new k(H,M,O);if("number"===typeof H){if("string"===typeof M)throw Error("If encoding is specified then the first argument must be a string");return u(this,H)}return d(this,H,M,O)}function d(H,M,O,L){if("number"===typeof M)throw new TypeError('"value" argument must not be a number');if("undefined"!==
typeof ArrayBuffer&&M instanceof ArrayBuffer){M.byteLength;if(0>O||M.byteLength<O)throw new RangeError("'offset' is out of bounds");if(M.byteLength<O+(L||0))throw new RangeError("'length' is out of bounds");M=void 0===O&&void 0===L?new Uint8Array(M):void 0===L?new Uint8Array(M,O):new Uint8Array(M,O,L);k.kS?(H=M,H.__proto__=k.prototype):H=r(H,M);M=H}else if("string"===typeof M){L=H;H=O;if("string"!==typeof H||""===H)H="utf8";if(!k.ntf(H))throw new TypeError('"encoding" must be a valid string encoding');
O=x(M,H)|0;L=h(L,O);M=L.write(M,H);M!==O&&(L=L.slice(0,M));M=L}else M=t(H,M);return M}function f(H){if("number"!==typeof H)throw new TypeError('"size" argument must be a number');if(0>H)throw new RangeError('"size" argument must not be negative');}function u(H,M){f(M);H=h(H,0>M?0:v(M)|0);if(!k.kS)for(var O=0;O<M;++O)H[O]=0;return H}function r(H,M){var O=0>M.length?0:v(M.length)|0;H=h(H,O);for(var L=0;L<O;L+=1)H[L]=M[L]&255;return H}function t(H,M){if(k.isBuffer(M)){var O=v(M.length)|0;H=h(H,O);if(0===
H.length)return H;M.copy(H,0,0,O);return H}if(M){if("undefined"!==typeof ArrayBuffer&&M.buffer instanceof ArrayBuffer||"length"in M)return(O="number"!==typeof M.length)||(O=M.length,O=O!==O),O?h(H,0):r(H,M);if("Buffer"===M.type&&I(M.data))return r(H,M.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");}function v(H){if(H>=(k.kS?2147483647:1073741823))throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+(k.kS?2147483647:
1073741823).toString(16)+" bytes");return H|0}function x(H,M){if(k.isBuffer(H))return H.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(H)||H instanceof ArrayBuffer))return H.byteLength;"string"!==typeof H&&(H=""+H);var O=H.length;if(0===O)return 0;for(var L=!1;;)switch(M){case "ascii":case "latin1":case "binary":return O;case "utf8":case "utf-8":case void 0:return y(H).length;case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return 2*
O;case "hex":return O>>>1;case "base64":return G(H).length;default:if(L)return y(H).length;M=(""+M).toLowerCase();L=!0}}function m(H,M,O){var L=!1;if(void 0===M||0>M)M=0;if(M>this.length)return"";if(void 0===O||O>this.length)O=this.length;if(0>=O)return"";O>>>=0;M>>>=0;if(O<=M)return"";for(H||(H="utf8");;)switch(H){case "hex":H=M;M=O;O=this.length;if(!H||0>H)H=0;if(!M||0>M||M>O)M=O;L="";for(O=H;O<M;++O)H=L,L=this[O],L=16>L?"0"+L.toString(16):L.toString(16),L=H+L;return L;case "utf8":case "utf-8":return z(this,
M,O);case "ascii":H="";for(O=Math.min(this.length,O);M<O;++M)H+=String.fromCharCode(this[M]&127);return H;case "latin1":case "binary":H="";for(O=Math.min(this.length,O);M<O;++M)H+=String.fromCharCode(this[M]);return H;case "base64":return 0===M&&O===this.length?J.D9e(this):J.D9e(this.slice(M,O));case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":M=this.slice(M,O);O="";for(H=0;H<M.length;H+=2)O+=String.fromCharCode(M[H]+256*M[H+1]);return O;default:if(L)throw new TypeError("Unknown encoding: "+
H);H=(H+"").toLowerCase();L=!0}}function l(H,M,O,L,S){if(0===H.length)return-1;"string"===typeof O?(L=O,O=0):2147483647<O?O=2147483647:-2147483648>O&&(O=-2147483648);O=+O;isNaN(O)&&(O=S?0:H.length-1);0>O&&(O=H.length+O);if(O>=H.length){if(S)return-1;O=H.length-1}else if(0>O)if(S)O=0;else return-1;"string"===typeof M&&(M=k.from(M,L));if(k.isBuffer(M))return 0===M.length?-1:n(H,M,O,L,S);if("number"===typeof M)return M&=255,k.kS&&"function"===typeof Uint8Array.prototype.indexOf?S?Uint8Array.prototype.indexOf.call(H,
M,O):Uint8Array.prototype.lastIndexOf.call(H,M,O):n(H,[M],O,L,S);throw new TypeError("val must be string, number or Buffer");}function n(H,M,O,L,S){function T(da,ba){return 1===V?da[ba]:da.quj(ba*V)}var V=1,la=H.length,Z=M.length;if(void 0!==L&&(L=String(L).toLowerCase(),"ucs2"===L||"ucs-2"===L||"utf16le"===L||"utf-16le"===L)){if(2>H.length||2>M.length)return-1;V=2;la/=2;Z/=2;O/=2}if(S)for(L=-1;O<la;O++)if(T(H,O)===T(M,-1===L?0:O-L)){if(-1===L&&(L=O),O-L+1===Z)return L*V}else-1!==L&&(O-=O-L),L=-1;
else for(O+Z>la&&(O=la-Z);0<=O;O--){la=!0;for(L=0;L<Z;L++)if(T(H,O+L)!==T(M,L)){la=!1;break}if(la)return O}return-1}function z(H,M,O){O=Math.min(H.length,O);for(var L=[];M<O;){var S=H[M],T=null,V=239<S?4:223<S?3:191<S?2:1;if(M+V<=O)switch(V){case 1:128>S&&(T=S);break;case 2:var la=H[M+1];128===(la&192)&&(S=(S&31)<<6|la&63,127<S&&(T=S));break;case 3:la=H[M+1];var Z=H[M+2];128===(la&192)&&128===(Z&192)&&(S=(S&15)<<12|(la&63)<<6|Z&63,2047<S&&(55296>S||57343<S)&&(T=S));break;case 4:la=H[M+1];Z=H[M+2];
var da=H[M+3];128===(la&192)&&128===(Z&192)&&128===(da&192)&&(S=(S&15)<<18|(la&63)<<12|(Z&63)<<6|da&63,65535<S&&1114112>S&&(T=S))}null===T?(T=65533,V=1):65535<T&&(T-=65536,L.push(T>>>10&1023|55296),T=56320|T&1023);L.push(T);M+=V}H=L.length;if(H<=R)L=String.fromCharCode.apply(String,L);else{O="";for(M=0;M<H;)O+=String.fromCharCode.apply(String,L.slice(M,M+=R));L=O}return L}function y(H,M){M=M||Infinity;for(var O,L=H.length,S=null,T=[],V=0;V<L;++V){O=H.charCodeAt(V);if(55295<O&&57344>O){if(!S){if(56319<
O){-1<(M-=3)&&T.push(239,191,189);continue}else if(V+1===L){-1<(M-=3)&&T.push(239,191,189);continue}S=O;continue}if(56320>O){-1<(M-=3)&&T.push(239,191,189);S=O;continue}O=(S-55296<<10|O-56320)+65536}else S&&-1<(M-=3)&&T.push(239,191,189);S=null;if(128>O){if(0>--M)break;T.push(O)}else if(2048>O){if(0>(M-=2))break;T.push(O>>6|192,O&63|128)}else if(65536>O){if(0>(M-=3))break;T.push(O>>12|224,O>>6&63|128,O&63|128)}else if(1114112>O){if(0>(M-=4))break;T.push(O>>18|240,O>>12&63|128,O>>6&63|128,O&63|128)}else throw Error("Invalid code point");
}return T}function B(H){for(var M=[],O=0;O<H.length;++O)M.push(H.charCodeAt(O)&255);return M}function G(H){var M=J,O=M.J$j;H=(H.trim?H.trim():H.replace(/^\s+|\s+$/g,"")).replace(X,"");if(2>H.length)H="";else for(;0!==H.length%4;)H+="=";return O.call(M,H)}function E(H,M,O,L){for(var S=0;S<L&&!(S+O>=M.length||S>=H.length);++S)M[S+O]=H[S];return S}var J=a(1278);a(1279);var I=a(1280);C.yAg=k;C.Hqk=function(H){+H!=H&&(H=0);return k.XDe(+H)};C.lqk=50;k.kS=void 0!==b.kS?b.kS:c();C.Jrk=k.kS?2147483647:1073741823;
k.from=function(H,M,O){return d(null,H,M,O)};k.kS&&(k.prototype.__proto__=Uint8Array.prototype,k.__proto__=Uint8Array,"undefined"!==typeof Symbol&&Symbol.species&&k[Symbol.species]===k&&Object.defineProperty(k,Symbol.species,{value:null,configurable:!0}));k.XDe=function(H){f(H);return h(null,H)};k.v2g=function(H){return u(null,H)};k.isBuffer=function(H){return!(null==H||!H.jLg)};k.compare=function(H,M){if(!k.isBuffer(H)||!k.isBuffer(M))throw new TypeError("Arguments must be Buffers");if(H===M)return 0;
for(var O=H.length,L=M.length,S=0,T=Math.min(O,L);S<T;++S)if(H[S]!==M[S]){O=H[S];L=M[S];break}return O<L?-1:L<O?1:0};k.ntf=function(H){switch(String(H).toLowerCase()){case "hex":case "utf8":case "utf-8":case "ascii":case "latin1":case "binary":case "base64":case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return!0;default:return!1}};k.concat=function(H,M){if(!I(H))throw new TypeError('"list" argument must be an Array of Buffers');if(0===H.length)return k.XDe(0);var O;if(void 0===M)for(O=M=
0;O<H.length;++O)M+=H[O].length;M=k.v2g(M);var L=0;for(O=0;O<H.length;++O){var S=H[O];if(!k.isBuffer(S))throw new TypeError('"list" argument must be an Array of Buffers');S.copy(M,L);L+=S.length}return M};k.byteLength=x;k.prototype.jLg=!0;k.prototype.toString=function(){var H=this.length|0;return 0===H?"":0===arguments.length?z(this,0,H):m.apply(this,arguments)};k.prototype.equals=function(H){if(!k.isBuffer(H))throw new TypeError("Argument must be a Buffer");return this===H?!0:0===k.compare(this,
H)};k.prototype.compare=function(H,M,O,L,S){if(!k.isBuffer(H))throw new TypeError("Argument must be a Buffer");void 0===M&&(M=0);void 0===O&&(O=H?H.length:0);void 0===L&&(L=0);void 0===S&&(S=this.length);if(0>M||O>H.length||0>L||S>this.length)throw new RangeError("out of range index");if(L>=S&&M>=O)return 0;if(L>=S)return-1;if(M>=O)return 1;M>>>=0;O>>>=0;L>>>=0;S>>>=0;if(this===H)return 0;var T=S-L,V=O-M,la=Math.min(T,V);L=this.slice(L,S);H=H.slice(M,O);for(M=0;M<la;++M)if(L[M]!==H[M]){T=L[M];V=H[M];
break}return T<V?-1:V<T?1:0};k.prototype.includes=function(H,M,O){return-1!==this.indexOf(H,M,O)};k.prototype.indexOf=function(H,M,O){return l(this,H,M,O,!0)};k.prototype.lastIndexOf=function(H,M,O){return l(this,H,M,O,!1)};k.prototype.write=function(H,M,O,L){if(void 0===M)L="utf8",O=this.length,M=0;else if(void 0===O&&"string"===typeof M)L=M,O=this.length,M=0;else if(isFinite(M))M|=0,isFinite(O)?(O|=0,void 0===L&&(L="utf8")):(L=O,O=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");
var S=this.length-M;if(void 0===O||O>S)O=S;if(0<H.length&&(0>O||0>M)||M>this.length)throw new RangeError("Attempt to write outside buffer bounds");L||(L="utf8");for(S=!1;;)switch(L){case "hex":M=Number(M)||0;L=this.length-M;O?(O=Number(O),O>L&&(O=L)):O=L;L=H.length;if(0!==L%2)throw new TypeError("Invalid hex string");O>L/2&&(O=L/2);for(L=0;L<O;++L){S=parseInt(H.substr(2*L,2),16);if(isNaN(S))break;this[M+L]=S}return L;case "utf8":case "utf-8":return E(y(H,this.length-M),this,M,O);case "ascii":return E(B(H),
this,M,O);case "latin1":case "binary":return E(B(H),this,M,O);case "base64":return E(G(H),this,M,O);case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":L=H;S=this.length-M;for(var T=[],V=0;V<L.length&&!(0>(S-=2));++V){var la=L.charCodeAt(V);H=la>>8;la%=256;T.push(la);T.push(H)}return E(T,this,M,O);default:if(S)throw new TypeError("Unknown encoding: "+L);L=(""+L).toLowerCase();S=!0}};k.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this.Oqk||this,0)}};var R=4096;
k.prototype.slice=function(H,M){var O=this.length;H=~~H;M=void 0===M?O:~~M;0>H?(H+=O,0>H&&(H=0)):H>O&&(H=O);0>M?(M+=O,0>M&&(M=0)):M>O&&(M=O);M<H&&(M=H);if(k.kS)M=this.subarray(H,M),M.__proto__=k.prototype;else{O=M-H;M=new k(O,void 0);for(var L=0;L<O;++L)M[L]=this[L+H]}return M};k.prototype.quj=function(H){if(0!==H%1||0>H)throw new RangeError("offset is not uint");if(H+2>this.length)throw new RangeError("Trying to access beyond buffer length");return this[H]<<8|this[H+1]};k.prototype.copy=function(H,
M,O,L){O||(O=0);L||0===L||(L=this.length);M>=H.length&&(M=H.length);M||(M=0);0<L&&L<O&&(L=O);if(L===O||0===H.length||0===this.length)return 0;if(0>M)throw new RangeError("targetStart out of bounds");if(0>O||O>=this.length)throw new RangeError("sourceStart out of bounds");if(0>L)throw new RangeError("sourceEnd out of bounds");L>this.length&&(L=this.length);H.length-M<L-O&&(L=H.length-M+O);var S=L-O;if(this===H&&O<M&&M<L)for(L=S-1;0<=L;--L)H[L+M]=this[L+O];else if(1E3>S||!k.kS)for(L=0;L<S;++L)H[L+M]=
this[L+O];else Uint8Array.prototype.set.call(H,this.subarray(O,O+S),M);return S};k.prototype.fill=function(H,M,O,L){if("string"===typeof H){"string"===typeof M?(L=M,M=0,O=this.length):"string"===typeof O&&(L=O,O=this.length);if(1===H.length){var S=H.charCodeAt(0);256>S&&(H=S)}if(void 0!==L&&"string"!==typeof L)throw new TypeError("encoding must be a string");if("string"===typeof L&&!k.ntf(L))throw new TypeError("Unknown encoding: "+L);}else"number"===typeof H&&(H&=255);if(0>M||this.length<M||this.length<
O)throw new RangeError("Out of range index");if(O<=M)return this;M>>>=0;O=void 0===O?this.length:O>>>0;H||(H=0);if("number"===typeof H)for(L=M;L<O;++L)this[L]=H;else for(H=k.isBuffer(H)?H:y((new k(H,L)).toString()),S=H.length,L=0;L<O-M;++L)this[L+M]=H[L%S];return this};var X=/[^+\/0-9A-Za-z-_]/g}).call(this,a(1277))},1277:function(w){var C=function(){return this}();try{C=C||(new Function("return this"))()}catch(a){"object"===typeof window&&(C=window)}w.exports=C},1278:function(w,C){function a(k){var d=
k.length;if(0<d%4)throw Error("Invalid string. Length must be a multiple of 4");k=k.indexOf("=");-1===k&&(k=d);return[k,k===d?0:4-k%4]}C.byteLength=function(k){k=a(k);var d=k[1];return 3*(k[0]+d)/4-d};C.J$j=function(k){var d=a(k);var f=d[0];d=d[1];var u=new h(3*(f+d)/4-d),r=0,t=0<d?f-4:f,v;for(v=0;v<t;v+=4)f=c[k.charCodeAt(v)]<<18|c[k.charCodeAt(v+1)]<<12|c[k.charCodeAt(v+2)]<<6|c[k.charCodeAt(v+3)],u[r++]=f>>16&255,u[r++]=f>>8&255,u[r++]=f&255;2===d&&(f=c[k.charCodeAt(v)]<<2|c[k.charCodeAt(v+1)]>>
4,u[r++]=f&255);1===d&&(f=c[k.charCodeAt(v)]<<10|c[k.charCodeAt(v+1)]<<4|c[k.charCodeAt(v+2)]>>2,u[r++]=f>>8&255,u[r++]=f&255);return u};C.D9e=function(k){for(var d=k.length,f=d%3,u=[],r=0,t=d-f;r<t;r+=16383){for(var v=u,x=v.push,m,l=k,n=r+16383>t?t:r+16383,z=[],y=r;y<n;y+=3)m=(l[y]<<16&16711680)+(l[y+1]<<8&65280)+(l[y+2]&255),z.push(b[m>>18&63]+b[m>>12&63]+b[m>>6&63]+b[m&63]);m=z.join("");x.call(v,m)}1===f?(k=k[d-1],u.push(b[k>>2]+b[k<<4&63]+"==")):2===f&&(k=(k[d-2]<<8)+k[d-1],u.push(b[k>>10]+b[k>>
4&63]+b[k<<2&63]+"="));return u.join("")};var b=[],c=[],h="undefined"!==typeof Uint8Array?Uint8Array:Array;for(w=0;64>w;++w)b[w]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[w],c["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(w)]=w;c[45]=62;c[95]=63},1279:function(w,C){C.read=function(a,b,c,h,k){var d=8*k-h-1;var f=(1<<d)-1,u=f>>1,r=-7;k=c?k-1:0;var t=c?-1:1,v=a[b+k];k+=t;c=v&(1<<-r)-1;v>>=-r;for(r+=d;0<r;c=256*c+a[b+k],k+=t,r-=8);d=c&(1<<-r)-1;
c>>=-r;for(r+=h;0<r;d=256*d+a[b+k],k+=t,r-=8);if(0===c)c=1-u;else{if(c===f)return d?NaN:Infinity*(v?-1:1);d+=Math.pow(2,h);c-=u}return(v?-1:1)*d*Math.pow(2,c-h)};C.write=function(a,b,c,h,k,d){var f,u=8*d-k-1,r=(1<<u)-1,t=r>>1,v=23===k?Math.pow(2,-24)-Math.pow(2,-77):0;d=h?0:d-1;var x=h?1:-1,m=0>b||0===b&&0>1/b?1:0;b=Math.abs(b);isNaN(b)||Infinity===b?(b=isNaN(b)?1:0,h=r):(h=Math.floor(Math.log(b)/Math.LN2),1>b*(f=Math.pow(2,-h))&&(h--,f*=2),b=1<=h+t?b+v/f:b+v*Math.pow(2,1-t),2<=b*f&&(h++,f/=2),h+
t>=r?(b=0,h=r):1<=h+t?(b=(b*f-1)*Math.pow(2,k),h+=t):(b=b*Math.pow(2,t-1)*Math.pow(2,k),h=0));for(;8<=k;a[c+d]=b&255,d+=x,b/=256,k-=8);h=h<<k|b;for(u+=k;0<u;a[c+d]=h&255,d+=x,h/=256,u-=8);a[c+d-x]|=128*m}},1280:function(w){var C={}.toString;w.exports=Array.isArray||function(a){return"[object Array]"==C.call(a)}},1281:function(w,C,a){a.d(C,"a",function(){return c});w=a(0);C=a(765);var b=a(738);class c extends C.a{constructor(){super();this.html=this.errorDescription=this.errorCode=null;this.H_=Object.assign(new b.a,
{T_:c.getTypeName(),B_:c.getBaseTypes()})}static getTypeName(){return"AugLoop_ImageToTable_DetectedHtmlTableAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}}Object(w.a)(c,"DetectedHtmlTableAnnotation",C.a,[])},1282:function(w,C,a){a.d(C,"a",function(){return b});w=a(0);class b{static hNa(c,h){if(!(c&&h&&c.length&&h.length)||256<c.length)return"";const k=Array(256),d=Array(256);let f,u=0,r=0;let t,v="";for(f=0;256>f;f++)k[f]=f;for(f=0;256>f;f++){var x=c.charCodeAt(f%c.length);if(256<=
x)return"";u=(u+k[f]+x)%256;x=k[f];k[f]=k[u];k[u]=x}for(f=0;256>f;f++)d[f]=k[256-f-1];u=f=0;for(c=0;c<h.length;c++){f=(f+1)%256;u=(u+k[f])%256;x=k[f];k[f]=k[u];k[u]=x;x=h.charCodeAt(c);if(256<=x)return"";t=x^k[(k[f]+k[u])%256];r=(r+d[f])%256;x=d[f];d[f]=d[r];d[r]=x;v+=String.fromCharCode(t^k[(d[f]+d[r])%256])}return v}}Object(w.a)(b,"RC4A",null,[])},1328:function(w,C,a){a.r(C);var b={};a.r(b);a.d(b,"DataFromPictureCommandHandler",function(){return ke});var c={};a.r(c);a.d(c,"PictureCommandHandler",
function(){return Vg});var h={};a.r(h);a.d(h,"AriaLiveNotifier",function(){return Sd});var k={};a.r(k);a.d(k,"GridHighlightBehaviorEventManager",function(){return Db});var d={};a.r(d);a.d(d,"GridHighlightsBehaviorManager",function(){return Pc});var f={};a.r(f);a.d(f,"TableManager",function(){return Ji});var u={};a.r(u);a.d(u,"EwaAccessibilityManager",function(){return Xh});var r={};a.r(r);a.d(r,"SessionReloadActivity",function(){return ei});var t={};a.r(t);a.d(t,"SparklineManager",function(){return pj});
var v={};a.r(v);a.d(v,"UploaderCreator",function(){return Gi});var x={};a.r(x);a.d(x,"WorkbookReadoutHandler",function(){return tj});var m={};a.r(m);a.d(m,"EmbeddedWorkbookReadoutHandler",function(){return Mh});var l=a(0),n=a(14),z=a(712),y=a(563),B=a(79),G=a(138),E;(function(A){A[A.applicationFeatureHelperHandler=0]="applicationFeatureHelperHandler";A[A.cloudPolicySettings=1]="cloudPolicySettings";A[A.alternateAuthToken=2]="alternateAuthToken"})(E||(E={}));Object(l.b)("ApplicationFeatureHelperRequestType",
E);class J{constructor(){this.message=null;this.d9=0}}Object(l.a)(J,"HttpRequstToPromiseRejectData",null,[]);var I=a(103),R=a(64),X=a(217),H=a(475);class M{constructor(A,ca){this.Oa=A;this.Qi=ca}pNa(A,ca,Ra,Zb,wc,Jc,fd,$d){Zb=void 0===Zb?null:Zb;wc=void 0===wc?null:wc;Jc=void 0===Jc?null:Jc;fd=void 0===fd?null:fd;$d=void 0===$d?null:$d;const Be=E[Ra],Re=Be+"RequestFailure";I.Health.instance.recordKpiUsage(Re,0,"jpittsdirects",null);return new Promise((lf,xf)=>{n.ULS.sendTraceTag(50622688,3004,50,
"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Initializing HttpRequest {0}.",Be);const $f=null!=fd?fd:this.Oa.Hf("ApplicationFeatureHelperRequestQueueTimeout",15E3),tg=null!=$d?$d:this.Oa.Hf("ApplicationFeatureHelperRequestSentTimeout",3E4);this.Qi.D6(A,1,null,this.HDb(Ra,Zb),Jc,!1,1,Vf=>{n.ULS.sendTraceTag(50622689,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: HttpRequest {0} Succeeded.",Be);try{if(void 0===Vf||null===Vf||void 0===Vf.data||null===Vf.data||void 0===Vf.data.Tf||
null===Vf.data.Tf){I.Health.instance.recordKpiFailure(Re,"Invalid RequestSucceededEventArgs",!1,!0,null);const lh=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data or args.Data.ResponseData is null or undefined request {0}",Be);xf(this.EK(lh,Vf))}else if(Vf.data.httpStatus!==X.a.PE){I.Health.instance.recordKpiFailure(Re,"HttpStatusCode_"+Vf.data.httpStatus.toString(),!1,!0,null);const lh=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: ApplicationFeatureHelper Service token generation returned unexpected response code {0}, request {1}",
Vf.data.httpStatus,Be);xf(this.EK(lh,Vf))}else{void 0!==wc&&null!==wc&&void 0!==Vf.data.responseHeaders&&null!==Vf.data.responseHeaders&&wc(Vf.data.responseHeaders);var ug=ca(Vf.data.Tf);if(ug)n.ULS.sendTraceTag(50622690,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Successfully parsed response for request {0}",Be),lf(ug);else{I.Health.instance.recordKpiFailure(Re,"Parse Failure",!1,!0,null);const lh=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Failed to parse response for request {0}",
Be);xf(this.EK(lh,Vf))}}}catch(lh){I.Health.instance.recordKpiFailure(Re,"Unexpected Failure",!1,!0,null),ug=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Exception {0} for request {1}",lh,Be),xf(this.EK(ug,Vf))}},Vf=>{if(Vf.data){I.Health.instance.recordKpiFailure(Re,"HttpStatusCode_"+Vf.data.httpStatus.toString(),!1,!0,null);var ug=H.a.nQa(Vf.data.Tf||"No Data");ug=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Request Failed: HttpStatus - {0}, ResponseData - {1} for Request - {2}",
Vf.data.httpStatus,ug,Be)}else I.Health.instance.recordKpiFailure(Re,"Invalid RequestFailedEventArgs",!1,!0,null),ug=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data is null or undefined for request {0}",Be);xf(this.EK(ug,Vf))},null,void 0,void 0,$f,tg)})}EK(A,ca){const Ra=new J;Ra.message=A;Ra.d9=ca&&ca.data?ca.data.httpStatus:-1;return Ra}HDb(A,ca){const Ra={};Ra["x-UserDataSignature"]=this.Oa.Sa("UserDataSignature");Ra["x-LicensingIsEnabled"]=this.Oa.pa("LicensingIsEnabled").toString();
Ra["x-CacheIsEnabled"]=this.Oa.pa("LicensingRedisIsEnabled").toString();Ra["x-OcpsIsEnabled"]=this.Oa.pa("OcpsIsEnabled").toString();Ra["x-LicensingAADIdIsEnabled"]=this.Oa.pa("LicensingAadIdIsEnabled").toString();0===A&&(Ra["x-LicenseCheckOnTenantEnabled"]="true",Ra["x-SupportUserConsentDependentFeatures"]="true",Ra["x-AFHUserConsentGroupValue"]="0",Ra["x-UseShellServiceForUserConsentGroup"]="true",Ra["x-SMBUserLicensingEnabled"]="true",Ra["x-AFHPIPLComplianceEnabled"]=R.a.gw(window.location.href,
"wd_afhpipl")||"false",Ra["x-ConsumerLicensingSNICertIsEnabled"]=this.Oa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ConsumerLicensingSNICertIsEnabled",!1).toString(),Ra["x-MSGraphInLicensingIsEnabled"]=this.Oa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.MSGraphInLicensingIsEnabled",!1).toString());if(ca)for(const Zb of ca.keys)Ra[Zb]=ca.ma(Zb);return Ra}}Object(l.a)(M,"HttpRequestToPromiseUtility",null,[]);var O=a(5),L;(function(A){A[A.loki=0]="loki";A[A.augloopACLP=1]="augloopACLP"})(L||
(L={}));Object(l.b)("AlternateAuthSupportApp",L);var S=a(429),T=a(42);class V{constructor(){this.Token=null;this.ExpirationTime=0}}Object(l.a)(V,"WacAlternateAuthToken",null,[]);class la{constructor(A,ca){this.pak=3E5;if(void 0===A||null===A||void 0===ca||null===ca)throw Error.argumentNull("appSettingsManager/clientRequestManager");this.Oa=A;this.PZb=new z.a(y.a.Fh());this.Dpb=new M(A,ca);void 0!==S.OAuthManagerSettings.sHd&&null!==S.OAuthManagerSettings.sHd&&void 0!==S.OAuthManagerSettings.Juc&&
null!==S.OAuthManagerSettings.Juc&&0<S.OAuthManagerSettings.Juc&&(A=new V,A.Token=S.OAuthManagerSettings.sHd,A.ExpirationTime=S.OAuthManagerSettings.Juc,this.PZb.fa("loki",A))}U1h(){let A=null;this.PZb.kd(L[0])&&(A=this.PZb.ma(L[0]));return void 0===A||null===A||this.EDd(A)?this.STh():Promise.resolve(A.Token)}EDd(A){return A.ExpirationTime-Date.now()<this.pak}STh(){const A=new z.a(y.a.Fh());A.fa("X-AlternateAuthApp",L[0]);return this.Dpb.pNa(this.Zea("/afhs/AlternateAuthHelperHandler.ashx"),Object(B.a)(this,
this.mjj,"parseAlternateAuthTokenResponse"),2,A).then(ca=>{n.ULS.sendTraceTag(545821456,3004,50,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Retrieved WacAlternateAuthToken for {0}",L[0]);this.PZb.fa(L[0],ca);return ca.Token},ca=>{ca=Object(G.a)(J,ca);n.ULS.sendTraceTag(545604827,3004,10,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Error: {0}, status code: {1}",ca.message,ca.d9);return null})}mjj(A){let ca=null;({Mu:ca}=T.d(A));return ca}Zea(A){const ca=this.Oa.pa("SuiteOriginForAFHSIsEnabled")?
this.Oa.Sa("SuiteOrigin"):this.Oa.Sa("WebServiceBase");return String.format("{0}{1}?{2}",ca,A,O.AFrameworkApplication.Ak)}}Object(l.a)(la,"AlternateAuthHelper",null,[226]);var Z=a(467);class da{constructor(A,ca,Ra){this.featureName=null;this.isEnabled=!1;this.tierName=0;this.featureName=A;this.isEnabled=ca;this.tierName=Ra}}Object(l.a)(da,"FeatureStateChangeArgs",null,[]);var ba=a(145),na=a(264),Y=a(32),Ga=a(113),ma=a(175),fa;(function(A){A[A.Enabled=0]="Enabled";A[A.Disabled=1]="Disabled"})(fa||
(fa={}));Object(l.b)("FeatureState",fa);var Xa=a(84),Ua=a(27),ka=a(174);class nb{constructor(A,ca,Ra,Zb,wc){Ra=void 0===Ra?null:Ra;Zb=void 0===Zb?null:Zb;wc=void 0===wc?null:wc;this.mza=this.u4b=this.tte=this.yva=this.u5b=null;this.Dpb=new M(A,ca);this.Oa=A;this.uMg=A.Hf("LicensingMaxRetryAttempts",0);this.a2b=A.pa("IsO365ConsumerHost");this.jWc=A.pa("IsO365CommercialHost");this.TVc=A.pa("PremiumUpsellIsEnabled");this.h1a=!1;this.qXc=0;this.xge=Ra;this.Lxe=Zb;this.Na=wc;this.xva=A.pa("LicensingIsEnabled");
this.zJa=A.pa("OcpsIsEnabled")&&this.jWc;this.P2c=A.pa("ShowPrivacyDialog")&&!!Zb;this.tVc=A.pa("IsAnonymousUser");this.Shc=new Promise(Jc=>{Jc(!1)});this.wGa=new Promise(Jc=>{Jc(!0)});this.lza=new z.a(y.a.Fh());this.i6b=!0;this.Foe=this.tai();this.EBd()&&!this.tVc?(void 0!==O.AFrameworkApplication.sa&&null!==O.AFrameworkApplication.sa&&(this.u5b=O.AFrameworkApplication.sa.EG,void 0!==this.u5b&&null!==this.u5b&&(this.yva=this.u5b.fi("WebServiceCall","ApplicationFeatureHelperService"))),this.mza=this.p9d()):
this.mza=new Promise(Jc=>{Jc({})});this.mza.catch(Jc=>{Jc=Object(G.a)(J,Jc);n.ULS.sendTraceTag(42513088,3004,10,"ApplicationFeatureHelper initialization failed, HttpStatus={0}",Jc?Jc.d9.toString():"Unknown")});this.i6b&&this.isFeatureEnabled("FreemiumUpsell",!0).then(Jc=>{this.h1a=Jc;return null})}tai(){const A=this.Oa.Ur("AllLicensedFeatures")?this.Oa.ay("AllLicensedFeatures"):[],ca=new Z.a;for(let Ra=0;Ra<A.length;Ra++)ca.add(A[Ra]);return ca}EBd(){return this.jWc||this.a2b}p9d(A,ca){A=void 0===
A?0:A;ca=void 0===ca?!1:ca;n.ULS.sendTraceTag(51185368,3004,50,"ApplicationFeatureHelper_TryInitializeLicensing: forceRefresh = {0}",ca);const Ra=ba.a.Zt();Ra&&(Ra.set("retryAttempt",A.toString()),Ra.set("forceRefresh",ca.toString()),Ra.set("isO365ConsumerHost",this.a2b.toString()),Ra.set("isO365CommercialHost",this.jWc.toString()),Ra.set("isFreemiumUpsellSettingEnabled",this.TVc.toString()));I.Health.instance.recordKpiUsageForAlertableKpi("AFHSLicensingFailedRequest","waclicensing",Ra);I.Health.instance.recordKpiUsage("AFHSLicensingSuccessfulRequest",
1,"waclicensing",Ra);void 0!==this.yva&&null!==this.yva&&this.yva.start();let Zb=null;ca&&(Zb=new z.a(y.a.Fh()),Zb.fa("x-LicensingForceRefresh","true"));this.tte=new Date;return(this.xva?this.Dpb.pNa(this.Zea("/afhs/ApplicationFeatureHelperHandler.ashx"),Object(B.a)(this,this.qjj,"parseApplicationFeatureHelperResponse"),0,Zb,Object(B.a)(this,this.apj,"processApplicationFeatureHelperResponseHeaders"),["Date"]):Promise.resolve({})).then(wc=>{const Jc=Object.assign(new ka.a,{durationMs:this.Bng()});
Jc.extendedProperties=Ra;Jc.extendedProperties&&wc&&(Jc.extendedProperties.set("featureCount",Ga.a.count(wc).toString()),Jc.extendedProperties.set("licensingTestFeatureEnabled",("LicensingTestFeature"in wc).toString()),Jc.extendedProperties.set("msoPremiumBadgeEnabled",("MsoPremiumBadge"in wc).toString()),"FreemiumUpsell"in wc&&Jc.extendedProperties.set("isFreemiumUpsellEnabled",wc.FreemiumUpsell.toString()),this.u4b&&Jc.extendedProperties.set("fromCache",(this.u4b<this.tte).toString()));I.Health.instance.recordKpiSuccess("AFHSLicensingSuccessfulRequest",
Jc);return wc},wc=>{const Jc=Object.assign(new ka.a,{durationMs:this.Bng()}),fd=Object(G.a)(J,wc);if(!fd)return n.ULS.sendTraceTag(51491471,3004,10,"ApplicationFeatureHelper_TryInitializeLicensing: Invalid cast to HttpRequestToPromiseRejectData"),I.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","InvalidCastToHttpRequestToPromiseRejectData",!1,!0,Jc),new Promise(($d,Be)=>{Be(wc)});Jc.extendedProperties=Ra;Jc.extendedProperties&&Jc.extendedProperties.set("status",fd.d9.toString());I.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest",
"RequestFailed",!1,!0,Jc);return 408===fd.d9&&++A<=this.uMg?this.p9d(A):new Promise(($d,Be)=>{Be(fd)})})}qjj(A){(A=T.b(A))?(n.ULS.sendTraceTag(50436170,3004,50,"ParseApplicationFeatureHelperResponse: Successfully fetched features"),n.ULS.sendTraceTag(50938594,3004,50,"{0}",A)):n.ULS.sendTraceTag(50436171,3004,10,"ParseApplicationFeatureHelperResponse: ApplicationFeatureHelper Service returned a null feature set");return A.Features}Zea(A){var ca=this.Oa.pa("SuiteOriginForAFHSIsEnabled")?this.Oa.Sa("SuiteOrigin"):
this.Oa.Sa("WebServiceBase");ca=String.format("{0}{1}",ca,A);this.Oa.Ur("ApplicationFeatureHelperHttpCachingEnabled")&&this.Oa.pa("ApplicationFeatureHelperHttpCachingEnabled")&&(A=nb.Ykc(this.Oa))&&0<A.length&&(this.i6b&&(A+="ucbf"),ca=new na.QueryStringBuilder(ca),ca.mj("afhskey",A),ca=ca.toString());return ca}isFeatureEnabled(A,ca){if(!this.zJa&&!this.P2c&&!this.xva)return this.wGa;n.ULS.sendTraceTag(42513091,3004,50,"ApplicationFeatureHelper.IsFeatureEnabled: Call made to check if feature: {0} is enabled.",
A);if("ConnectedServices"===A){var Ra=this.zJa?this.xge.k2("ControllerConnectedServicesEnabled"):this.wGa;const Jc=this.P2c?this.Lxe.getSettings().then(fd=>2!==fd.Xw,()=>ca):this.wGa;return Ra.then(fd=>fd?Jc:this.Shc)}if("FreemiumUpsell"===A&&(!this.TVc||!this.a2b||this.tVc))return this.Shc;Ra=null;Ra=this.zJa?this.xge.isFeatureEnabled(A):this.wGa;let Zb=null;Zb=this.xva?this.mEi(A,ca):this.wGa;let wc=null;wc=this.P2c?this.Lxe.isFeatureEnabled(A):this.wGa;return Ra.then(Jc=>Jc?wc.then(fd=>fd?Zb:this.Shc):
this.Shc).then(Jc=>{this.NCf(A,Jc,!0);return Jc},()=>{this.NCf(A,ca,!1);return ca})}NCf(A,ca,Ra){n.ULS.sendTraceTag(526713106,3004,50,"FeatureName={0}, IsEnabled={1}, IsSuccess={2}",A,ca,Ra)}getFeatureTier(A,ca){if(!this.xva)return new Promise(Ra=>{Ra(2)});n.ULS.sendTraceTag(42804871,3004,50,"ApplicationFeatureHelper.GetFeatureTier: Call made to get Feature's Tier.",A);return this.mza.then(Ra=>this.Wlc(A,Ra,ca),()=>ca)}isFreemiumUpsellEnabled(){if(this.TVc&&this.a2b&&!this.tVc){if(this.h1a&&2!==this.qXc||
!this.h1a&&1!==this.qXc)n.ULS.sendTraceTag(509728161,3004,20,"ApplicationFeatureHelper_IsFreemiumUpsellEnabled: isFreemiumUpsellFeatureEnabled={0}",this.h1a.toString()),this.qXc=this.h1a?2:1;return this.h1a}return!1}launchUpsellExperience(A,ca){ca=void 0===ca?null:ca;n.ULS.sendTraceTag(594564814,3004,50,String.format("ApplicationFeatureHelper_LaunchUpsellExperience: Launching upsell experience for experienceId: {0}",A));var Ra=ba.a.Zt();Ra&&(Ra.set("experienceId",A),ca&&Ra.set("campaignId",ca));I.Health.instance.recordKpiUsage("AFHCLaunchUpsellSuccess",
1,"waclicensing",Ra);if(Ra=Xa.a.instance.oi("Common.IInProductMessagingUIManager")){const Zb=Object(B.a)(this,this.Tmi,"handleDimeTaskComplete");Ra.LAf(A,Zb,ca)}else n.ULS.sendTraceTag(594367561,3004,15,"InProductMessaging was not initialized"),I.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","InProductMessagingNotInitialized",!1,!0,null),this.Na.eg(Ua.a.gjc,2,{["experience"]:A})}hWa(A,ca){if(!this.xva)return null;if(!A||!ca)return n.ULS.sendTraceTag(594564813,3004,10,"ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: Invalid input."),
null;const Ra=ma.a.create().toString();this.lza.kd(A)||this.lza.fa(A,new z.a(y.a.Fh()));this.lza.ma(A).add(Ra,ca);n.ULS.sendTraceTag(594564812,3004,50,String.format("ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: registered callback {0} for feature {1}",Ra,A));return Ra}YUd(A,ca){this.xva&&(A&&this.lza.kd(A)?ca&&ma.a.isValid(ca)?this.lza.ma(A).kd(ca)?(n.ULS.sendTraceTag(594564808,3004,50,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: Removing callback {0} for feature {1}",
ca,A)),this.lza.ma(A).remove(ca)):n.ULS.sendTraceTag(594564809,3004,15,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: callbackId {0} not registered for feature {1} ",ca,A)):n.ULS.sendTraceTag(594564810,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid callbackId {0} for feature {1}",ca,A)):n.ULS.sendTraceTag(594564811,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid or non registered featureName {0}",
A)))}Wlc(A,ca,Ra){return this.i6b?A in ca?ca[A].LicenseTier:Ra:A in ca?this.Ljj(ca[A],Ra):Ra}Ljj(A,ca){switch(A.toLowerCase()){case "unknown":return 0;case "basic":return 1;case "premium":return 2;default:return ca}}Tmi(){n.ULS.sendTraceTag(594367560,3004,50,"ApplicationFeatureHelper_HandleDimeTaskComplete");this.mza.then(A=>{this.Z3f(A)}).catch(()=>{this.Z3f({})})}Z3f(A){n.ULS.sendTraceTag(594051087,3004,50,"ApplicationFeatureHelper_RefreshLicensingAndNotifyUpdatedFeatures");const ca=this.p9d(0,
!0);ca.then(Ra=>{this.mza=ca;Ga.a.count(Ra)>Ga.a.count(A)?I.Health.instance.recordKpiSuccess("AFHCLaunchUpsellSuccess",null):I.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","FeatureCountNotIncreased",!1,!0,null);for(const Zb of this.lza.keys)if(Zb in Ra){const wc=this.Wlc(Zb,Ra,0);Zb in A?this.Wlc(Zb,A,0)!==wc&&this.cLd(Zb,!0,wc):this.cLd(Zb,!0,wc)}else Zb in A&&this.cLd(Zb,!1,this.Wlc(Zb,A,0))}).catch(Ra=>{I.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","LicensingRefreshFailed",
!1,!0,null);n.ULS.sendTraceTag(594051086,3004,10,JSON.stringify(Ra))})}cLd(A,ca,Ra){n.ULS.sendTraceTag(594051085,3004,50,"ApplicationFeatureHelper_NotifyFeatureStateChanged: Notify feature state changed callbacks for feature {0}, {1}, {2}",A,ca,Ra);ca=new da(A,ca,Ra);Ra=this.lza.ma(A);for(const Zb of Ra)try{Zb.value(ca)}catch(wc){n.ULS.sendTraceTag(594051084,3004,10,String.format("ApplicationFeatureHelper_NotifyFeatureStateChanged: Exception when calling registered callback: feature: {0} callbackId: {1}, exception {2}",
A,Zb.key,wc.message))}}Rf(A,ca){if(this.xva){const Ra=this.Foe.contains(A);let Zb=!0,wc="",Jc=!1;return this.mza.then(fd=>{A in fd?(fd=fd[A],wc=fa[fd.FeatureState],Zb=1!==fd.FeatureState):Zb=!Ra;this.ZCf(A,Ra,wc,Jc,ca,Zb);return Zb},()=>{Jc=!0;Ra&&(Zb=ca);this.ZCf(A,Ra,wc,Jc,ca,Zb);return Zb})}return this.wGa}ZCf(A,ca,Ra,Zb,wc,Jc){n.ULS.sendTraceTag(557389507,3004,50,"featureName : {0}, isLicenseControlledFeature={1}, encounteredError = {2}, featureData={3}, fallbackValue={4}, isAllowed={5}",A,ca,
Zb,Ra,wc,Jc)}mEi(A,ca){if(this.i6b)return this.Rf(A,ca);if(this.xva){if(this.Foe.contains(A))return this.mza.then(Ra=>A in Ra,()=>ca);n.ULS.sendTraceTag(590385821,3004,50,"ApplicationFeatureHelper_IsFeatureAllowedByUserLicense: Feature '{0}' requested while not in the licensed features set.",A)}return this.wGa}apj(A){try{A&&"Date"in A&&(this.u4b=new Date(A.Date),n.ULS.sendTraceTag(578863817,3004,50,"ProcessApplicationFeatureHelperResponseHeaders Date {0}",this.u4b.toString()))}catch(ca){n.ULS.sendTraceTag(578863818,
3004,10,"ProcessApplicationFeatureHelperResponseHeaders Exception {0}",ca)}}Bng(){if(void 0!==this.yva&&null!==this.yva){const A=this.yva.Te;this.yva.stop();return A}return null}static Ykc(A){try{if(Y.a.p7j){const ca=A.Sa("UserDataSignature").split(".");if(1<ca.length){const Ra=window.self.atob(ca[1]),Zb=JSON.parse(Ra).LocalStorageKey;if(void 0!==Zb&&null!==Zb&&0<Zb.length)return Zb}}}catch(ca){n.ULS.sendTraceTag(578863816,3004,10,"GetLocalStorageCacheKey exception {0}",ca.toString())}return null}}
Object(l.a)(nb,"ApplicationFeatureHelper",null,[227]);var Ea=a(198);class sb{constructor(A,ca){this.PolicySettings=null;this.ExpirationTime=0;this.PolicySettings=A.PolicySettings;A=new Date;A.setMinutes(A.getMinutes()+ca);this.ExpirationTime=A.getTime()}}Object(l.a)(sb,"CloudPolicySettingsCacheData",null,[]);var Oa=a(835),La=a(469),ia=a(269);class Sa{static Ilg(){return O.AFrameworkApplication.da.pa("SideCarIsEnabled")?Sa.qFc&&Sa.Yzd?new Promise(A=>{A(!0)}):new Promise((A,ca)=>{Sa.qFc=ia.a.create(O.AFrameworkApplication.da.Sa("SideCarUrl"));
La.a.Yya(Sa.qFc);Sa.qFc.dla((Ra,Zb)=>{(Sa.Yzd=Zb.succeeded)?A(Zb.succeeded):ca(Zb.succeeded)})}):new Promise(A=>{A(!1)})}}Sa.Yzd=!1;Sa.qFc=null;Object(l.a)(Sa,"SideCarLoader",null,[]);class Za{constructor(){this.ControllerConnectedServicesFeatureNames=this.PolicySettings=null}}Object(l.a)(Za,"CloudPolicySettingsData",null,[]);class Ab{constructor(A,ca){this.ZQc=0;this.zbc=null;this.Dpb=new M(A,ca);this.Oa=A;ca=A.Sa("HostAuthType");this.zJa=A.pa("OcpsIsEnabled")&&A.pa("IsO365CommercialHost")&&!(void 0===
ca||null===ca)&&"aad"===ca.toLowerCase();this.Oqe=T.b(A.Sa("OcpsDefaultSettings")||"{}");this.Dqb=this.Ykc();ca=this.Oa.Ur("ServicesControlsMicrosoftControllerServicesList")?this.Oa.ay("ServicesControlsMicrosoftControllerServicesList")||[]:[];this.P_b=new Z.a;for(let Ra=0;Ra<ca.length;Ra++)this.P_b.add(ca[Ra]);this.zJa&&!A.pa("IsAnonymousUser")&&A.pa("SideCarIsEnabled")?this.zbc=this.Edk():this.zbc=this.Ata(this.zJa,this.Zea("/afhs/CloudPolicySettings.ashx"),Object(B.a)(this,this.rjj,"parseCloudPolicySettingsResponse"));
this.zbc.then(()=>null).catch(Ra=>{Ra=Object(G.a)(J,Ra);n.ULS.sendTraceTag(50622685,3004,10,"CloudPolicySettingsHelper initialization failed, HttpStatus={0}",Ra?Ra.d9.toString():"Unknown")})}k2(A,ca){ca=void 0===ca?!0:ca;if(!this.zJa){const Jc=this;return new Promise(fd=>{fd(Jc.bEb(A))})}const Ra=this,Zb=this,wc=this.zbc.then(Jc=>{try{let fd=null;Jc.PolicySettings&&"unknown"in Jc.PolicySettings&&(fd=Jc.PolicySettings.unknown);if(fd){if(A in fd&&void 0!==fd[A]&&null!==fd[A])return new Promise(Be=>
{Be("0"!==fd[A])});const $d=A.toLowerCase();if($d in fd&&void 0!==fd[$d]&&null!==fd[$d])return new Promise(Be=>{Be("0"!==fd[$d])});n.ULS.sendTraceTag(51512667,3004,50,"Policy"+A+" not found, using default");return new Promise(Be=>{Be(Ra.bEb(A))})}return new Promise($d=>{$d(Ra.bEb(A))})}catch(fd){return n.ULS.sendTraceTag(50622686,3004,10,"Failed to get "+A+" policy value. Error Message: {0}",fd.message),Ra.handleError(fd.toString(),ca,Ra.bEb(A))}},Jc=>Zb.handleError(Jc,ca,Zb.bEb(A)));wc.then(Jc=>
{n.ULS.sendTraceTag(50651667,3004,50,"CloudPolicySettingsHelper.GetBooleanPolicySetting: policy: {0}, value: {1}",A,Jc);return null});return wc}isFeatureEnabled(A,ca){ca=void 0===ca?!0:ca;if(this.Oa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseApplicationFeatureHelperAPIForFeedbackAndSurvey",!1))return this.oEi(A,ca);let Ra=new Promise(wc=>{wc(!0)}),Zb="";this.P_b.contains(A)&&(Zb="ControllerConnectedServicesEnabled",Ra=this.k2(Zb,ca));Ra.then(wc=>{n.ULS.sendTraceTag(50651668,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabled: Feature: {0}, enabled or not: {1}, by policy: {2}",
A,wc,Zb);return null});return Ra}oEi(A,ca){ca=void 0===ca?!0:ca;let Ra=new Promise(wc=>{wc(!0)}),Zb="";"mso_sendASmile"===A?Zb="Enabled":"Survey"===A||"FloodgateSurvey"===A?Zb="SurveyEnabled":this.P_b.contains(A)&&(Zb="ControllerConnectedServicesEnabled");""!==Zb&&(Ra=this.k2(Zb,ca));Ra.then(wc=>{n.ULS.sendTraceTag(558187080,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabledV2: Feature: {0}, enabled or not: {1}, by policy: {2}",A,wc,Zb);return null});return Ra}handleError(A,ca,Ra){return ca?new Promise(Zb=>
{Zb(Ra)}):new Promise((Zb,wc)=>{wc(A)})}Ata(A,ca,Ra){if(!A)return Promise.resolve(new Za);let Zb=!1,wc=null;I.Health.instance.recordKpiUsage("GetCloudPolicySettings",1,"jpittsdirects",null);let Jc=this.Pdd("GetCloudPolicySettings");return(new Promise((fd,$d)=>{if(void 0!==this.Dqb&&null!==this.Dqb&&0<this.Dqb.length){const Be=this.pdk();if(void 0!==Be&&null!==Be){Zb=!0;fd(Be);return}}this.Dpb.pNa(ca,Ra,1,null,Object(B.a)(this,this.fpj,"processCloudPolicySettingsResponseHeaders"),["CheckIn-Interval"],
this.Oa.Hf("CloudPolicySettingsRequestQueueTimeout",15E3),this.Oa.Hf("CloudPolicySettingsRequestSentTimeout",3E4)).then(Be=>{n.ULS.sendTraceTag(51662933,3004,50,"Retrieved CloudPolicySettingsData from OCPS");this.dek(Be);fd(Be);return Be},Be=>{$d(Be);return null})})).then(fd=>{({stopwatch:Jc,returnValue:wc}=this.nJc(Jc));var $d=ba.a.Zt();$d&&$d.set("FromCache",Zb.toString());$d=Object.assign(new ka.a,{durationMs:wc,extendedProperties:$d});I.Health.instance.recordKpiSuccess("GetCloudPolicySettings",
$d);return fd})}Edk(){return Sa.Ilg().then(()=>{n.ULS.sendTraceTag(593282845,3004,50,"CloudPolicySettingsHelper - Retrieving CloudPolicySettingsData Promise from Sidecar");return sidecar.cloudPolicy.GetCloudPolicySettingsData()})}Zea(A){const ca=this.Oa.pa("SuiteOriginForAFHSIsEnabled")?this.Oa.Sa("SuiteOrigin"):this.Oa.Sa("WebServiceBase");return String.format("{0}{1}",ca,A)}rjj(A){let ca=null;({Mu:ca}=T.d(A));A=!!ca;n.ULS.sendTraceTag(50622687,3004,A?50:10,"ParseCloudPolicySettingsResponse: Success={0}",
A);return ca}fpj(A){try{if(void 0!==A&&null!==A&&"CheckIn-Interval"in A){const ca=parseInt(A["CheckIn-Interval"]);void 0!==ca&&null!==ca&&0<ca&&(this.ZQc=ca)}}catch(ca){n.ULS.sendTraceTag(51662934,3004,10,"ProcessCloudPolicySettingsResponseHeaders Exception {0}",ca)}}bEb(A){return A in this.Oqe?"0"!==this.Oqe[A]:!0}pdk(){try{const A=Oa.a.instance.getItem(this.Dqb);if(void 0===A||null===A)return n.ULS.sendTraceTag(51662936,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null"),
null;n.ULS.sendTraceTag(51662937,3004,50,"TryGetCloudPolicySettingsDataFromCache retrieved data {0} from LocalStorage",A);const ca=JSON.parse(A);if(void 0===ca||null===ca)return n.ULS.sendTraceTag(51662938,3004,15,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null after parsing"),null;if(void 0===ca.ExpirationTime||null===ca.ExpirationTime)return n.ULS.sendTraceTag(51662939,3004,15,"TryGetCloudPolicySettingsDataFromCache ExpirationTime from LocalStorage is null after parsing"),
null;if((new Date(ca.ExpirationTime)).getTime()<Date.now())return n.ULS.sendTraceTag(51662940,3004,50,"TryGetCloudPolicySettingsDataFromCache Cache is expired"),null;const Ra=new Za;Ra.PolicySettings=ca.PolicySettings;Ra.ControllerConnectedServicesFeatureNames=new Ea.a;this.Oa.Ur("ServicesControlsMicrosoftControllerServicesList")&&this.Oa.ay("ServicesControlsMicrosoftControllerServicesList");for(const Zb of this.P_b)Ra.ControllerConnectedServicesFeatureNames.add(Zb);n.ULS.sendTraceTag(51662941,3004,
50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage retrieved");return Ra}catch(A){return n.ULS.sendTraceTag(51662942,3004,10,"TryGetCloudPolicySettingsDataFromCache exception {0}",A.toString()),null}}dek(A){try{if(void 0===A||null===A||void 0===A.PolicySettings||null===A.PolicySettings)n.ULS.sendTraceTag(51662944,3004,15,"TrySetCloudPolicySettingsDataIntoCache data/PolicySettings is null");else if(0>=this.ZQc)n.ULS.sendTraceTag(51662945,3004,15,"TrySetCloudPolicySettingsDataIntoCache _checkInInterval is Invalid");
else{const ca=new sb(A,this.ZQc),Ra=JSON.stringify(ca);n.ULS.sendTraceTag(51662946,3004,50,"TrySetCloudPolicySettingsDataIntoCache data to cache {0}",Ra);Oa.a.instance.setItem(this.Dqb,Ra);n.ULS.sendTraceTag(51662947,3004,50,"TrySetCloudPolicySettingsDataIntoCache set data to cache")}}catch(ca){n.ULS.sendTraceTag(51662976,3004,10,"TrySetCloudPolicySettingsDataIntoCache exception {0}",ca.toString())}}Ykc(){const A=nb.Ykc(this.Oa);return A&&0<A.length?"OCPS"+A:null}Pdd(A){const ca=Xa.a.instance.oi("Microsoft.Office.Telemetry.Usage.IStopwatchBuilder");
return void 0!==ca&&null!==ca?ca.Ze("WebServiceCall",A):null}nJc(A){if(void 0!==A&&null!==A){const ca=A.Te;A.stop();return{returnValue:ca,stopwatch:null}}return{returnValue:null,stopwatch:A}}}Object(l.a)(Ab,"CloudPolicySettingsHelper",null,[224]);class pb{constructor(){this.UYe=this.sxg=this.Xw=0;this.VYe=this.txg=this.gNa="";this.t1c=this.Wia=2}clone(){const A=new pb;A.Xw=this.Xw;A.sxg=this.sxg;A.UYe=this.UYe;A.gNa=this.gNa;A.txg=this.txg;A.VYe=this.VYe;A.Wia=this.Wia;A.t1c=this.src;return A}get src(){return this.t1c}serialize(A){A=
void 0===A?null:A;const ca={};if(!A||A.contains(pb.dUa))ca[pb.dUa]=this.Xw;if(!A||A.contains(pb.iNb))ca[pb.iNb]=this.gNa;if(!A||A.contains(pb.jNb))ca[pb.jNb]=this.Wia;return JSON.stringify(ca)}static create(A,ca){ca=void 0===ca?null:ca;const Ra=new pb;Ra.t1c=A;void 0!==ca&&null!==ca&&(pb.dUa in ca&&(Ra.Xw=ca[pb.dUa]),pb.iNb in ca&&(Ra.gNa=ca[pb.iNb]),pb.jNb in ca&&(Ra.Wia=ca[pb.jNb]));return Ra}static deserialize(A,ca){try{const Ra=JSON.parse(A);if(void 0!==Ra&&null!==Ra)return pb.create(ca,Ra);n.ULS.sendTraceTag(50860946,
306,10,"UserPrivacySettings Deserialize: Unable to convert {0} to dict",A);throw Error.argument("settingsData");}catch(Ra){throw n.ULS.sendTraceTag(50860947,306,10,"UserPrivacySettings Deserialize Exception = {0}",Ra.toString()),Ra;}}}pb.dUa="CCS";pb.iNb="CCSTime";pb.jNb="OfficePrivacyRoamedNoticeShown";Object(l.a)(pb,"UserPrivacySettings",null,[]);var Tb=a(140);class ob{constructor(A,ca){if(void 0===A||null===A||void 0===ca||null===ca)throw Error.argumentNull("appSettingsManager/clientRequestManager");
this.Oa=A;this.Qi=ca;this.M0c=this.tg=null}Zea(A){var ca=String.format("{0}RoamingServiceHandler.ashx?action=",this.Oa.appSettings.RoamingServiceHandlerWebServiceBase||"");ca=new Sys.StringBuilder(ca);ca.append(A);ca.append("&");ca.append(O.AFrameworkApplication.Ak);return ca.toString()}executeRequest(A,ca,Ra,Zb){return this.Qi.Pwa(A,ca,void 0===Zb?null:Zb,null,Ra,"33",!1,null,6E4)}saveSettings(A){return new Promise((ca,Ra)=>{try{if(void 0===this.tg||null===this.tg||void 0===A||null===A)n.ULS.sendTraceTag(51258443,
3004,15,"SaveUserPrivacySettings: Can't determine setting changes to save"),Ra("Can't determine setting changes to save");else{var Zb=this.tg.Xw!==A.Xw;if(2===this.tg.src&&Zb)this.iKj(A),ca(!0);else{var wc=this.dOj(A);if(void 0===wc||null===wc||!wc.length)n.ULS.sendTraceTag(50917389,3004,15,"SaveUserPrivacySettings: returning since nothing changed"),Ra("No changes to save");else if(1===this.tg.src)ca(this.Wsg(wc));else if(0===this.tg.src){n.ULS.sendTraceTag(51258444,3004,50,"UserPrivacySettingsHelper: SaveSettings to Roaming {0}",
wc);const Jc=this.executeRequest(this.Zea("saveUserPrivacySettings"),2,"SaveUserPrivacySettingsRequest",wc);Jc.continueWith(()=>{if(Jc.qj||Jc.Kh)n.ULS.sendTraceTag(50860929,3004,10,"SaveUserPrivacySettings: Roaming Request Cancelled/Failed"),ca(!1);else{var fd=Jc.result;void 0!==fd.qh&&null!==fd.qh&&void 0!==fd.qh.data&&null!==fd.qh.data&&fd.qh.data.httpStatus===X.a.PE?(n.ULS.sendTraceTag(51258445,3004,50,"SaveUserPrivacySettings: Roaming Request Succeeded"),ca(!0)):(n.ULS.sendTraceTag(51258446,3004,
10,"SaveUserPrivacySettings: Roaming Request Failed"),ca(!1))}})}}}}catch(Jc){n.ULS.sendTraceTag(50860930,3004,10,"SaveUserPrivacySettings: Exception = {0}",Jc.toString()),ca(!1)}})}dOj(A){if(void 0===this.tg||null===this.tg||void 0===A||null===A)throw Error.invalidOperation("User Privacy settings have not been initialized");const ca=new Ea.a;0===A.src?(this.tg.Xw!==A.Xw&&(ca.add(pb.dUa),ca.add(pb.iNb)),this.tg.Wia!==A.Wia&&ca.add(pb.jNb)):1===A.src&&this.tg.Xw!==A.Xw&&ca.add(pb.dUa);return ca.count?
A.serialize(ca):(n.ULS.sendTraceTag(50860931,3004,50,"SaveUserPrivacySettings: returning since nothing changed"),null)}getSettings(){if(!this.M0c){const A=this;this.M0c=new Promise(ca=>{try{A.tg?ca(A.tg.clone()):A.ydk().then(Ra=>{A.tg=Ra;ca(A.tg.clone());return null},()=>{A.wdk().then(Ra=>{A.tg=Ra;ca(A.tg.clone());return null},()=>{A.xdk().then(Ra=>{A.tg=Ra;ca(A.tg.clone());return null},()=>{n.ULS.sendTraceTag(50967430,3004,10,"UserPrivacySettings TryGetSettingsFromQueryParams returned an error)");
A.tg=new pb;ca(A.tg.clone());return null});return null});return null})}catch(Ra){n.ULS.sendTraceTag(50860932,3004,10,"UserPrivacySettings GetSettings: Exception = {0}",Ra.toString()),A.tg=new pb,ca(A.tg.clone())}})}return this.M0c}ydk(){return new Promise((A,ca)=>{try{const Zb=-1!==window.location.href.indexOf("&wd_pn=2");if(this.Oa.pa("PrivacyDialogShouldCheckRoaming")||Zb){var Ra=this.executeRequest(this.Zea("getUserPrivacySettings"),1,"GetUserPrivacySettingsRequest");Ra.continueWith(()=>{try{if(Ra.qj||
Ra.Kh)n.ULS.sendTraceTag(50860934,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Request failure");else{const wc=Ra.result;if(wc&&wc.qh&&wc.qh.data)if(wc.qh.data.httpStatus!==X.a.PE)n.ULS.sendTraceTag(50860936,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Received error response {0}",wc.qh.data.httpStatus);else{if(wc.qh.data.Tf){A(ob.parse(wc.qh.data.Tf,0));n.ULS.sendTraceTag(51258447,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Success, Settings {0}",wc.qh.data.Tf);
return}n.ULS.sendTraceTag(50860937,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: ResponseData is null")}else n.ULS.sendTraceTag(50860935,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Data is null");ca("UserPrivacySettings TryGetSettingsFromRoaming Request Faillure")}}catch(wc){n.ULS.sendTraceTag(50860938,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming Exception handling request {0}",wc.toString()),ca("UserPrivacySettings TryGetSettingsFromRoaming Request Exception")}})}else n.ULS.sendTraceTag(50860933,
3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Roaming should not be used"),ca("Roaming should not be used")}catch(Zb){n.ULS.sendTraceTag(50860939,3004,10,"TryGetSettingsFromRoaming Exception = {0}",Zb.toString()),ca("UserPrivacySettings TryGetSettingsFromRoaming Exception")}})}wdk(){return new Promise((A,ca)=>{try{const Ra=Tb.a.get("WacUPToggleState");let Zb=null;void 0!==Ra&&null!==Ra&&0<Ra.length&&(Zb=decodeURIComponent(Ra));if(void 0!==Zb&&null!==Zb&&0<Zb.length){const wc=ob.parse(Zb,
1);n.ULS.sendTraceTag(51258448,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings retrieved from cookie {0}",wc.toString());A(wc)}else{const wc=pb.create(1),Jc=new Ea.a;Jc.add(pb.dUa);const fd=wc.serialize(Jc);this.Wsg(fd)?(n.ULS.sendTraceTag(51258449,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings initialized and retrieved from cookie {0}",fd),A(wc)):(n.ULS.sendTraceTag(51258450,3004,15,"TryGetSettingsFromCookie: Failure initializing cookie with settings {0}",fd),ca("UserPrivacySettings TryGetSettingsFromCookie Failure in TrySaveSettingsToCookie"))}}catch(Ra){n.ULS.sendTraceTag(50860941,
3004,10,"TryGetSettingsFromCookie from Cookie Exception = {0}",Ra.toString()),ca("UserPrivacySettings TryGetSettingsFromCookie Eception")}})}xdk(){return new Promise(A=>{try{var ca=-1!==window.location.href.indexOf("&wdccsoff=1");const Ra=pb.create(2);ca?(Ra.Xw=2,O.AFrameworkApplication.AXe(),n.ULS.sendTraceTag(51258451,3004,50,"TryGetSettingsFromQueryParams: Retrieved from query param {0}",Ra.toString())):(Ra.Xw=1,n.ULS.sendTraceTag(51258452,3004,50,"TryGetSettingsFromQueryParams: Initialized with query param as data source for {0}",
Ra.toString()));A(Ra)}catch(Ra){n.ULS.sendTraceTag(50967431,3004,50,"TryGetSettingsFromCookie from Query Params Exception = {0}",Ra.toString()),ca=pb.create(2),ca.Xw=1,A(ca)}})}iKj(A){n.ULS.sendTraceTag(51258453,3004,50,"UserPrivacySettingsHelper: SaveSettingsToQueryParam");2===A.Xw?O.AFrameworkApplication.AXe():O.AFrameworkApplication.oFh();n.ULS.sendTraceTag(51258454,3004,50,"SaveSettingsToQueryParam saved settings = {0}",A)}Wsg(A){try{n.ULS.sendTraceTag(51258455,3004,50,"UserPrivacySettingsHelper: TrySaveSettingsToCookie Saving settings {0}",
A);const ca=this.Oa.Sa("PrivacyCookieDomain")||"";if(!ca||!ca.length)throw Error.invalidOperation("PrivacyCookieDomain is null or empty");n.ULS.sendTraceTag(51258456,3004,50,"SaveUserPrivacySettings to Cookie {0}",A);return Tb.a.G1d("WacUPToggleState",A,Tb.a.pZ,"/",ca)}catch(ca){return n.ULS.sendTraceTag(50860942,3004,50,"SaveUserPrivacySettings to Cookie Exception = {0}",ca.toString()),!1}}isFeatureEnabled(A){return this.getSettings().then(ca=>{const Ra=this.Oa.Ur("ServicesControlsMicrosoftControllerServicesList")?
this.Oa.ay("ServicesControlsMicrosoftControllerServicesList"):[],Zb=new Z.a;for(let wc=0;wc<Ra.length;wc++)Zb.add(Ra[wc]);return Zb.contains(A)?2!==ca.Xw:!0},()=>{n.ULS.sendTraceTag(50860945,3004,10,"Failed to get privacy setting for feature {0}",A);return!0})}static parse(A,ca){try{return n.ULS.sendTraceTag(50860943,3004,50,"Parsing user privacy settings {0} from {1}",A,ca),pb.deserialize(A,ca)}catch(Ra){throw n.ULS.sendTraceTag(50860944,3004,10,"GetUserPrivacySettings Exception = {0}",Ra.toString()),
Ra;}}}Object(l.a)(ob,"UserPrivacySettingsHelper",null,[225]);var va=a(261);class Pa{constructor(){this.hd=null}get name(){return"Common.App.ApplicationFeatureHelper.ApplicationFeatureHelperPackage"}Xj(A){this.hd=A;this.hd.register(224,"Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper").Ee().Le(()=>new Ab(O.AFrameworkApplication.da,O.AFrameworkApplication.tf));this.hd.register(225,"Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper").Ee().Le(()=>new ob(O.AFrameworkApplication.da,
O.AFrameworkApplication.tf));this.hd.register(226,"Common.App.ApplicationFeatureHelper.IAlternateAuthHelper").Ee().Le(()=>new la(O.AFrameworkApplication.da,O.AFrameworkApplication.tf));this.hd.register(227,"Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").Ee().Le(()=>new nb(O.AFrameworkApplication.da,O.AFrameworkApplication.tf,this.hd.resolve("Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper"),this.hd.resolve("Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper"),
O.AFrameworkApplication.Dd))}init(){O.AFrameworkApplication.da.qx(()=>{const A=this.hd.resolve("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");O.AFrameworkApplication.da.pa("LicensingIsEnabled")&&(A.isFeatureEnabled("LicensingTestFeature",!1).then(ca=>{n.ULS.sendTraceTag(42513092,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned IsFeatureEnabled as {0}. IsAnonymousUser : {1}.",ca,O.AFrameworkApplication.da.Sa("IsAnonymousUser"));return null}),A.getFeatureTier("LicensingTestFeature",
0).then(ca=>{n.ULS.sendTraceTag(42804872,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned GetFeatureTier as {0}. IsAnonymousUser : {1}.",ca,O.AFrameworkApplication.da.Sa("IsAnonymousUser"));return null}));this.hd.resolve("Common.App.ApplicationFeatureHelper.IAlternateAuthHelper");this.Q8j()})}dispose(){}Q8j(){try{O.AFrameworkApplication.da.pa("SideCarIsEnabled")&&Sa.Ilg().then(A=>{n.ULS.sendTraceTag(594057429,3004,50,"Sidecar Loader attempted to load Sidecar.  SideCarIsAvailable:{0}",
A);return A})}catch(A){}}static main(){va.a.instance.Tk(new Pa)}}Object(l.a)(Pa,"ApplicationFeatureHelperPackage",null,[2,3]);var jb=a(2),Ob=a(233),kb=a(31),ra=a(333),rb=a(332),Kb=a(26),Sb=a(1),cb=a(39),cc=a(295),Ub=a(16);class wb extends cc.a{constructor(A){super(A);this.Zhh=()=>{n.ULS.sendTraceTag(537167827,0,50,"ClipboardReadPermissionAskDialog OK button pressed")};n.ULS.sendTraceTag(537167828,0,50,"ClipboardReadPermissionAskDialog.ClipboardReadPermissionAskDialog");this.Rd=0;this.qe(1,Ub.a.instance.ia(2260));
A=Ub.a.instance.ia(2258);const ca=this.CK();this.initializeAndShow(A,this.Zhh,ca)}get we(){return"ClipboardReadPermissionAskDialog"}CK(){const A={};A.id=this.we;const ca=Ub.a.instance.ia(2259);A.DialogMessage=ca;return A}}Object(l.a)(wb,"ClipboardReadPermissionAskDialog",cc.a,[]);var vc=a(55);const Lb=(A,ca,Ra,Zb,wc)=>{const Jc=A.Stopwatch,fd={};fd.a=wc;fd.e=Jc.id;fd.c="RearrangeRowColumn";fd.b="mouse";fd.d=A.OperationId.toString();fd.f=Ra.toString();fd.g=Zb.toString();fd.h=ca.toString();fd.i=A.DragDropIsShiftKeyDown;
fd.j=!0;fd.o=Jc.Te;fd.q=!1;fd.r=A.CopyPasteTargetType.toString();fd.s=A.EncounteredDeploymentErrors;return fd};class Ja{constructor(A,ca){this.WZh=()=>{const Ra={};Ra.SourceItem=this.toString();return Ra};this.sessionStateId=A;this.sessionId=ca;this.toJSON=this.WZh}rtf(A){return A?this.sessionStateId===A.sessionStateId&&this.sessionId===A.sessionId:!1}isFromCurrentSession(A){return this.sessionId===A.xa.UserSessionId}}Object(l.a)(Ja,"SourceItem",null,[]);class Hb extends Ja{constructor(A,ca,Ra,Zb,
wc){super(Ra,Zb);this.activeFloatingObjectControlId=A;this.sheetName=ca;this.type=wc}isEqual(A){return A&&Object.getType(A)===Hb?this.rtf(A)&&this.activeFloatingObjectControlId===A.activeFloatingObjectControlId&&this.sheetName===A.sheetName:!1}toString(){return this.type.toString()}}Object(l.a)(Hb,"ArtSourceItem",Ja,[]);var gc;(function(A){A[A.valid=0]="valid";A[A.notPairwiseDisjoint=1]="notPairwiseDisjoint";A[A.cutNotSupportedInDiscontinuousSelection=2]="cutNotSupportedInDiscontinuousSelection";
A[A.notValidForm=3]="notValidForm";A[A.temporarilyBlockedCopy=4]="temporarilyBlockedCopy"})(gc||(gc={}));Object(l.b)("CopySourceValidationOptions",gc);var ec=a(45);class Ta extends Ja{constructor(A,ca,Ra,Zb,wc){super(Zb,wc);n.ULS.shipAssertTag(537167645,0,!!ca&&0<ca.length,"RangeSourceItem.ctor: ranges should not be null or empty");this.$=A;this.ranges=ca;this.sheetName=Ra}isEqual(A){return A&&Object.getType(A)===Ta?this.rtf(A)&&ec.R(this.ranges,A.ranges)&&this.sheetName===A.sheetName:!1}toString(){return ec.i(this.ranges,
",",this.$,!1)}}Object(l.a)(Ta,"RangeSourceItem",Ja,[]);const ib=A=>!!A&&Object.getType(A)===Ta;class bc{}bc.llk="PasteError_FailedToReadFromClipboard_UserHashMismatchError";Object(l.a)(bc,"ExpectedErrorNames",null,[]);class jc{}jc.plainText="text/plain";jc.html="text/html";jc.png="image/png";jc.shadowWorkbook="data/shadow-workbook";jc.rGi="metadata/is-last-copy-was-external";jc.tCi="metadata/is-last-copy-was-external-XLO-source";jc.ygh="metadata/chrome-extension-id";jc.xdd="copyId";jc.x1g="metadata/additional-signature-data-attributes";
Object(l.a)(jc,"ClipboardDataFormat",null,[]);const sc=A=>A.clipboardItems&&(A=A.clipboardItems.getItem(jc.rGi))&&"1"===A?!0:!1,Fa=A=>sc(A)&&!(void 0===A.clipboardItems||null===A.clipboardItems)&&!!A.clipboardItems.getItem(jc.png)&&!A.clipboardItems.getItem(jc.plainText),Ha=A=>A.clipboardItems&&(A=A.clipboardItems.getItem(jc.tCi))&&"1"===A?!0:!1,Na=A=>A&&(A=A.getCachedMetadata(),null===A||void 0===A?0:A.lastCopy)?A.lastCopy:null;var W=a(51),U=a(19),za=a(36);class ua{constructor(A,ca,Ra,Zb){this.$=
A;this.originalDestinations=ca;this.Dhc=Ra;this.QEg=Zb;this.WOg=this.originalDestinations;this.PIg=this.Dhc;this.qMg="PasteRecoveryUI"}get w1g(){return this.QEg}get YAf(){return this.qMg}get Ivj(){return this.WOg}get a6e(){return this.PIg}Uza(){return ua.dkj}K6h(){return this.Dhc&&1===this.Dhc.length?this.L6h(this.Dhc[0]):null}Dpd(){return"PasteRecoveryUI-Floatie"}L6h(A){var ca=U.h(this.$);const Ra=ca.jd.$j(A);var Zb=ca.Ni(A,Ra);ca=ca.rtl;if(!Zb)return null;A=U.h(this.$).Xh(Ra);const wc=A.ao;if(!wc.hf(Zb))return null;
Zb=wc.wg(Zb);const Jc=Zb.topLeft.y;var fd=Zb.bottomRight.y;const $d=ca?Zb.bottomRight.x:Zb.topLeft.x;Zb=ca?Zb.topLeft.x:Zb.bottomRight.x;var Be=new W.a(Zb+(ca?-81:81),fd+38+6);if(wc.qma(Be))return this.n$a(A,wc,Ra,Zb,fd,ca?12:-3,66);Be=new W.a(Zb+(ca?-81:81),fd);if(wc.qma(Be))return this.n$a(A,wc,Ra,Zb,fd,ca?20:3,22);Be=new W.a(Zb,fd+38+6);if(wc.qma(Be))return this.n$a(A,wc,Ra,Zb,fd,-81+(ca?18:0),66);Zb=new W.a($d+(ca?81:-81),fd);if(wc.qma(Zb))return this.n$a(A,wc,Ra,$d,fd,-81+(ca?12:-6),22);fd=new W.a($d,
Jc-38-6);return wc.qma(fd)?this.n$a(A,wc,Ra,$d,Jc,ca?15:0,16):this.n$a(A,wc,Ra,ca?wc.topLeft.x:wc.bottomRight.x,wc.bottomRight.y,-81+(ca?15:-6),22)}n$a(A,ca,Ra,Zb,wc,Jc,fd){var $d=U.h(this.$);const Be=$d.rtl;A=Sys.UI.DomElement.getLocation(A.domElement);Zb=new Sys.UI.Point(Zb+(Be?0:A.x)-ca.topLeft.x,wc+A.y-ca.topLeft.y);Be&&($d=$d.view.visibleArea,Zb.x=$d.bottomRight.x-$d.topLeft.x-Zb.x,2===Ra||4===Ra)&&(Zb.x+=ca.bottomRight.x);Zb=za.a(this.$).eoa(Zb);return new Sys.UI.Point(Zb.x+Jc,Zb.y+fd)}}ua.dkj=
["PasteRecoveryUI"];Object(l.a)(ua,"PasteRecoveryUI",null,[387]);var $a=a(77),Va=a(296);class hb{}hb.WTg="ActiveSelection";hb.shadowWorkbook="ShadowWorkbook";hb.PBg="GVML";hb.plainText="PlainText";hb.html="Html";hb.T7g="Bitmap";Object(l.a)(hb,"PayloadType",null,[]);class qb{}qb.O2j="Slice6";Object(l.a)(qb,"SliceName",null,[]);class Nb{}Nb.H0i="NotCalled";Nb.success="Success";Nb.failed="Failed";Object(l.a)(Nb,"SucceededPopulatingSystemClipboardOptions",null,[]);var yb=a(346);const ja=(A,ca)=>A?ca&&
ca.xa?A.sessionId!==ca.xa.UserSessionId:(n.ULS.shipAssertTag(537166209,0,!1,"ewaControl shouldn't be null"),!1):(n.ULS.shipAssertTag(537166210,0,!1,"copyContext shouldn't be null"),!1),Ka=A=>{switch(A){case 0:return"None";case 2:return"Art";case 1:return"Range";default:return"Unknown"}},Pb=A=>{if(!A)return"null";const ca=[];for(const Ra of A.get())ca.push(`${Ra.clipboardDataFormat}(${Ra.data.length})`);ca.sort();return ca.join(",")};var rc;(function(A){A[A.valid=0]="valid";A[A.destinationRangesIsEmpty=
1]="destinationRangesIsEmpty";A[A.discontinuousSelectionNotSupportPasteFromExternal=2]="discontinuousSelectionNotSupportPasteFromExternal";A[A.discontinuousSelectionNotSupportPasteCrossSession=3]="discontinuousSelectionNotSupportPasteCrossSession";A[A.multipleSourcesAndMultipleDestinationsAreNotSupported=4]="multipleSourcesAndMultipleDestinationsAreNotSupported";A[A.multipleDestinationsAreNotMultiplyOfSourceRange=5]="multipleDestinationsAreNotMultiplyOfSourceRange";A[A.sourceAndDestinationAreOverlapping=
6]="sourceAndDestinationAreOverlapping";A[A.copySourceNotValid=7]="copySourceNotValid";A[A.cutNotSupportedInDiscontinuousSelection=8]="cutNotSupportedInDiscontinuousSelection";A[A.pasteLinkNotSupportMultipleDestination=9]="pasteLinkNotSupportMultipleDestination";A[A.temporarilyBlockedPaste=10]="temporarilyBlockedPaste";A[A.unknown=100]="unknown"})(rc||(rc={}));Object(l.b)("PasteValidationOptions",rc);var $c=a(53),Dd=a(159),Jd=a(38),Kd=a(170),ce=a(358),ge=a(34),uc=a(281),dd=a(11),Rd=a(22),Yd=a(139),
Md=a(122),ad=a(575),Mb=a(106),Aa=a(62),Bc=a(91);class Vc extends Sys.EventArgs{constructor(A,ca,Ra){super();this.command=A;this.destinationRange=ca;this.sourceRange=Ra}}Object(l.a)(Vc,"PasteCSERenderedEventArgs",Sys.EventArgs,[]);var hc=a(129),xc=a(155),ab=a(137),Wb=a(15);class Yc extends ua{constructor(A,ca,Ra,Zb){super(A,ca,Ra,Zb);this.ePi="DragRecoveryUI"}get YAf(){return this.ePi}Uza(){return Yc.NCh}Dpd(){return"DragRecoveryUI-Floatie"}}Yc.NCh=["DragRecoveryUI"];Object(l.a)(Yc,"DragFillRecoveryUI",
ua,[]);var Tc;(function(A){A[A.source=0]="source";A[A.destination=1]="destination"})(Tc||(Tc={}));Object(l.b)("RangeType",Tc);class ed extends cb.a{constructor(A,ca,Ra,Zb,wc,Jc,fd,$d,Be){Be=void 0===Be?null:Be;super();this.pasteShortcutManager=this.oAb=null;this.lsf=Sb.EwaSettings.Fd();this.lqg=null;this.zcb=!1;this.xDd=Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:6660890_Tag_aoi75RetryLoggingFix3");this.RXe=()=>{var Re;(null===(Re=this.oAb)||void 0===Re?0:Re.rwf())&&!ec.R(U.h(this.$).ha.ra.selectedRanges,
this.oAb.Atc)&&(this.oAb.Nma(),this.oAb=null);this.gridView.ha.Fr(this.RXe)};this.CNd=Re=>{this.PWj(Re)&&(this.pq.Qvd(),n.ULS.sendTraceTag(537167777,0,50,"CopyPasteInfrastructure.OnMetadataChanged: found that cut/copy operation was preformed in another session therefore removed the highlight in this session."))};this.aUi=(Re,lf)=>{n.ULS.sendTraceTag(537167768,0,50,`CopyPasteInfrastructure.LogShortcutDialogAndRestoreFocus: Got shortcut dialog, user pressed [${Re}]. userPressedExtensionLink=${lf}`);
this.gridView.focus()};this.wf=(Re,lf)=>{lf.yQ||lf.ni||this.Xt("OnWorkbookOpened",!1).catch(()=>{})};this.om=(Re,lf)=>{Re=Na(this.jL);const xf=this.pq.t$a(Re);xf&&(lf.na&&lf.na.sheetName===xf.sheetName&&xf.isFromCurrentSession(this.$)?this.pq.xnf(xf.ranges,Re.commandParameters.commandType):this.pq.Qvd())};this.ayc=(Re,lf)=>{Re=Na(this.jL);(Re=this.pq.t$a(Re))&&lf.item&&lf.item.sheetName===Re.sheetName&&Re.isFromCurrentSession(this.$)&&this.Xt("OnItemDeleting",!1).catch(()=>{})};this.GDa=(Re,lf)=>
{this.lsf?this.lqg(Re,lf):this.LUf()};this.WU=(Re,lf)=>{1===lf.Dt&&lf.Yh.operation.flags&2&&this.Xt("OnQueueItemChanged/ItemRemoved",!1).catch(()=>{})};this.$=A;this.eh=Ra;this.gridView=U.h(A);this.pq=wc;this.pyi=Jc;this.jL=ca;this.nyb=Zb;this.getStringifiedError=Be||copyPasteInfra.getStringifiedError;this.Fjg=1===$d;this.il();this.copyPasteShortcutDialogFactory=this.$.ga.Da(85);n.ULS.shipAssertTag(537167825,0,!!this.copyPasteShortcutDialogFactory,"CopyPasteInfrastructure.ctor: this.copyPasteShortcutDialogFactory shouldn't be null.");
fd||(n.ULS.sendTraceTag(537167824,0,50,"CopyPasteInfrastructure.ctor: userId is null, using default userId."),fd=ed.yxh);this.userHash=kb.a.Ly(fd);this.mYi="CultureTag: "+Ub.a.instance.wec+" HASH: ";this.jL.addMetadataChangeListener(ed.kHf,this.CNd);this.yXi=this.$.xa.CCPPastePlainTextLimit;this.QLb=this.$.xa.CCPCopyPasteHtmlLimit;A.ga.qd(478,Re=>{this.pasteShortcutManager=Re});this.lsf&&(this.lqg=uc.b(()=>{this.LUf()},1,this.$.ka,"CopyPasteInfrastructure.OnStartEditInternal",!0))}Nfc(){var A=Na(this.jL);
return A?(A=A.sourceItem)&&!A.isFromCurrentSession(this.$)?(n.ULS.sendTraceTag(537167778,0,50,"CopyPasteInfrastructure.DoesClipboardHaveCopiedOrCutContent: Last copy/cut operation was from a different session."),!1):!0:!1}get pasteIndicationManager(){return this.$.ga.Da(373)}O_g(A){this.addHandler(ed.DOd,A)}pCj(A){this.removeHandler(ed.DOd,A)}copy(A){A.stopwatch=this.$.Sd.Ze("UserAction",vc.b().zl(A.ribbonCommandInfo.command)+"ClientSide");const ca=$c.GetServiceTaskFactory.ud(this.$.ga,478,479,0);
Jd.TaskExtensions.za(ca,()=>{this.pasteShortcutManager=ca.result},this.ka,3);const Ra=!!Na(this.jL);Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!Y.a.XD&&(this.zcb=!1);this.Xt("Copy/before/"+ra.a[A.ribbonCommandInfo.method],!1,void 0,!0,A.copyPasteTargetType).catch(()=>{});var Zb=-1985798686===A.ribbonCommandInfo.command;if(1===this.gridView.Bg&&(Zb=this.pq.Bsf(this.gridView.ha.ra.selectedRanges,Zb),0!==Zb)){const fd=ed.Bmh(Zb);this.ZDa(fd,gc[Zb],
!1);return Promise.reject(!1)}A.userHash=this.userHash;A.id=ma.a.create().toString();let wc=this,Jc=this;return this.nyb.onCopy(A).then(fd=>{fd.isAsyncCopy||A.stopwatch.stop();wc.pasteIndicationManager.ZYe();const $d=yb.d(A);n.ULS.sendTraceTag(24150883,0,50,`CopyPasteInfrastructure.OnCopy: Copy operation finished successfully. ${$d}`);wc.VRi(fd,Ra);fd=1===A.copyPasteTargetType;!A.isFormatPainter&&fd&&(wc.pasteShortcutManager?wc.pasteShortcutManager.vFh():n.ULS.shipAssertTag(537167823,0,!1,"Copy: pasteShortcutManager is null."));
return Promise.resolve(!0)},fd=>{let $d=!1,Be="none",Re=ed.Bzb,lf=!0,xf=-1,$f=ed.copyErrorName+ed.sOa,tg=!1,Vf=null;if(fd){Vf=fd.copyContext;xf=fd.reason;$f+=ed.PPa(fd);fd.message&&(Re=fd.message);var ug=ed.Amh(fd);if(ug)if(3===ug.copyErrorName)$d=!0,Re=Be="Async Copy canceled by the user.",lf=!1;else if(ge.a.Rr(ug.ewaErrors))if(Re=Jc.zkc(ug.ewaErrors),ge.a.nj(ug.ewaErrors,ed.operationSucceededWithAlert))tg=$d=!0;else if(ge.a.nj(ug.ewaErrors,ed.pasteDataLimitHit)||ge.a.nj(ug.ewaErrors,ed.copyThrottlingError))$d=
!0;13===fd.reason?($d=!0,lf=!1):11===fd.reason&&(lf=!1)}ug=fd?Jc.getStringifiedError(fd):"null";$d?(ug=yb.d(A),n.ULS.sendTraceTag(36304157,0,15,`CopyPasteInfrastructure.OnCopy: Copy operation failed with an expected error. clearStateNeeded: ${lf}, Friendly message: ${Be}, Error Message: ${Re}, CommandParameters: ${ug}`)):n.ULS.sendTraceTag(24150912,0,10,`CopyPasteInfrastructure.OnCopy: Copy operation failed with an unexpected error. clearStateNeeded: ${lf}, Error Message: ${ug}, CommandParameters: ${yb.d(A)}`);
lf&&Jc.Xt("Copy/fail/"+ra.a[A.ribbonCommandInfo.method],!0,void 0,void 0,A.copyPasteTargetType).catch(()=>{});Jc.URi(A,$d,Re,$f,xf,tg,Vf);return Promise.reject(fd)})}ukj(A){if(this.Nfc())return Bc.a(this.Koc(A.commandType,A.ribbonCommandInfo));let ca;ca=ec.d(this.gridView.ha.ra.selectedRanges);A.originalDestinations=ca;A.expandDestinations=this.V$b(A.originalDestinations,A.commandType);if(this.gac(A.commandType,A.expandDestinations)||this.bLe())A.userHash=this.userHash,A.id=ma.a.create().toString(),
this.nyb.onPaste(A).then(()=>Promise.resolve(!0),Ra=>Promise.reject(Ra));return Promise.resolve(!0)}x7i(A){if(A.method){var ca=new Yc(this.$,ec.d(this.gridView.ha.ra.selectedRanges),ec.d(this.gridView.ha.ra.selectedRanges),{});(Ra=>{const Zb=$c.GetServiceTaskFactory.ud(this.$.ga,406,405,0);Jd.TaskExtensions.za(Zb,()=>{A.method&&Ra(Zb.result)},this.ka,8)})(Ra=>{Ra.vIe(ca);Ra.ilg(A.method);this.oAb=Ra});n.ULS.sendTraceTag(508680074,0,50,"CopyPasteInfrastructure.OnFill: Drag Copy Fill Floatie");this.gridView.ha.kr(this.RXe)}}paste(A){A.stopwatch=
this.$.Sd.Ze("UserAction",vc.b().zl(A.ribbonCommandInfo.command)+"ClientSide");Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!Y.a.XD&&(n.ULS.sendTraceTag(537167822,0,50,"CopyPasteInfrastructure.OnPaste: Cross-app shadow workbook paste is enabled"),this.zcb=!1,A.clipboardPicklingApiDataFormatsToRead=[jc.shadowWorkbook]);U.h(this.$).fj&&U.h(this.$).fj.P4(this.Crd(A.ribbonCommandInfo.command),A.stopwatch.id);if(A.isPasteCommandFromRecoveryUI){var ca=this.$.ga.Da(406);
var Ra=ec.d(ca.Atc);if(Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:8063983_ResolveWhenRecoveryRangeEmpty")&&!Ra)return n.ULS.sendTraceTag(508699777,0,20,"RecoveryUI paste destinations must not be null or undefined"),Promise.resolve(!0);ca=ca.LEd;A.pasteRecoveryCachedClipboardItems=ca?ca[ed.FXf]:null}else Ra=ec.d(this.gridView.ha.ra.selectedRanges);A.originalDestinations=Ra;A.expandDestinations=this.V$b(A.originalDestinations,A.commandType);if(this.gac(A.commandType,A.expandDestinations)||this.bLe())return A.userHash=
this.userHash,A.id=ma.a.create().toString(),Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PerfImpactExperimentForAsyncApi",!1)&&!Y.a.XD&&(A.clipboardReadPermissionPromptShown=!1,A.clipboardAsyncApiDataFormatsToRead=[jc.plainText+"Async"],this.nyb.shouldShowClipboardReadPermissionDialog().then(Zb=>{Zb&&(A.clipboardReadPermissionPromptShown=!0,new wb(this.$));return Promise.resolve(!0)},()=>Promise.resolve(!0))),this.nyb.onPaste(A).then(Zb=>this.Ayc(Zb,A),Zb=>this.iOb(A,Zb));this.$.Me(927125067,
$a.a.Bd,30,null);Ra=ec.i(A.expandDestinations,",",this.$,!1);n.ULS.sendTraceTag(24150913,0,15,`CopyPasteInfrastructure.OnPaste: paste was triggered but the estimated destination range is not editable, do nothing. ExpandDestinations: ${Ra}, CommandType: ${A.commandType}, copyPasteTargetType="${A.copyPasteTargetType}"`);return Promise.resolve(!0)}Crd(A){switch(A){case 1804571062:return 6;case -185374993:return 7;case 1766348718:return 8;case -875588320:return 19;default:return 3}}bLe(){return!!U.h(this.$).ha.Va.activeFloatingObjectControlId&&
this.$.Iu(null,!1,470)}odb(){const A=Na(this.jL);return A&&A.commandParameters?A.commandParameters.copyPasteTargetType:0}qGi(){return!!Na(this.jL)&&ja(Na(this.jL),this.$)}Xt(A,ca,Ra,Zb,wc){Ra=void 0===Ra?!1:Ra;Zb=void 0===Zb?!1:Zb;wc=void 0===wc?0:wc;try{this.pasteShortcutManager&&this.pasteShortcutManager.gfc();let Jc=wc;const fd=this.$Ni();if(!Zb&&2===fd)return n.ULS.sendTraceTag(537167821,0,50,`CopyPasteInfrastructure.ClearState clipboard won't be cleared as there's art in the clipboard. clearClipboardContent = '${ca}', isExplicit = '${Ra}', isForce = '${Zb}', Current CCP operation copyPasteTargetType = '${wc}', LastCopyPasteTargetType = '${fd}'`),
Promise.reject(null);0===Jc&&(Jc=fd);const $d=this.$.Sd.Ze("UserAction","ClearCopyState"),Be=$d.id;n.ULS.sendTraceTag(537167820,0,50,`CopyPasteInfrastructure.ClearState clear clipboard state. clearClipboardContent = '${ca}', isExplicit = '${Ra}', isForce = '${Zb}', Current CCP operation copyPasteTargetType = '${wc}', LastCopyPasteTargetType = '${fd}'`);this.pq.Qvd();this.Bsj();return this.nyb.onCancelCopy(ca).then(()=>{ca&&Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",
!1)&&!Y.a.XD&&(this.zcb=!1);$d.stop();this.DCf(A,Be,!0,Ra,ca,"","",$d.Te,Jc);return Promise.resolve(!0)},Re=>{var lf=Re?this.getStringifiedError(Re):"null";n.ULS.sendTraceTag(24150915,0,15,`CopyPasteInfrastructure.ClearState: error during call to copyPasteFlowManager.OnClear(). error: ${lf}`);$d.stop();lf=ed.Sdh+ed.sOa;let xf=ed.Bzb;Re&&(lf+=ed.PPa(Re),Re.message&&(xf=Re.message));this.DCf(A,Be,!1,Ra,ca,xf,lf,$d.Te,Jc);return Promise.reject(Re)})}catch(Jc){return Promise.reject(null)}}bbd(A,ca,Ra,
Zb){var wc=void 0;wc=void 0===wc?!1:wc;Ra=void 0===Ra?!1:Ra;Zb=void 0===Zb?0:Zb;return Ra||this.Nfc()?this.Xt(A,ca,wc,Ra,Zb):(n.ULS.sendTraceTag(537167819,0,50,"CopyPasteInfrastructure.ClearStateOnlyIfClipboardHasContentFromSameSession clipboard won't be cleared as there is no content in the clipboard from the current session"),Promise.reject(null))}ZDa(A,ca,Ra){n.ULS.sendTraceTag(590705172,0,50,`CopyPasteInfrastructure.PopupDiscontinuousSelectionErrorDialog: Blocked CCP due to discontinuous selection, reason: ${ca}`);
const Zb=new Mb.a;Zb.fa("reason",ca);ad.a(Yd.a.discontinuousSelectionBlocking,[Ra?Md.a.Xjj:Md.a.Anh],!0,!0,!1,!1,Zb);A=ge.a.qf(1,1,751,A,0,371863010,"DiscontinuousSelectionBlocking");Sb.EwaSettings.gC()?new ce.a(this.$,A):(A=new Kd.ErrorDialog(this.$,A),A.initialize(),A.Ji())}$Ni(){const A=Na(this.jL);return A&&A.sourceItem?Object.getType(A.sourceItem)===Hb?2:1:0}dragDropCells(A,ca,Ra,Zb,wc){wc=void 0===wc?!1:wc;A.stopwatch=this.$.Sd.Ze("UserAction","DragDropClientSide");A.isDragDrop=!0;this.Xt("DragDrop/before/"+
ra.a[A.ribbonCommandInfo.method],!1,void 0,void 0,A.copyPasteTargetType).catch(()=>{});const Jc=wc?2:1;let fd=0;fd=wc?4:Zb?256:128;const $d={encounteredDeploymentErrors:!1};$d.commandParameters=A;A.userHash=this.userHash;A.id=ma.a.create().toString();return this.xDd?this.pq.pasteRange(A.ribbonCommandInfo,ec.q(ca,this.$),ec.q(Ra,this.$),Jc,fd,[A.stopwatch],$d,!1,()=>{n.ULS.sendTraceTag(537167818,0,50,`CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="${A.copyPasteTargetType}"`);
this.Mdb(A,Jc,ca,Ra,$d)},Be=>{this.lfb(Be,A,Jc,ca,Ra,$d)}).then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},Be=>Promise.reject(Be)):this.pq.pasteRange(A.ribbonCommandInfo,ec.q(ca,this.$),ec.q(Ra,this.$),Jc,fd,[A.stopwatch],$d,!1,null,null).then(()=>{n.ULS.sendTraceTag(521410075,0,50,`CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="${A.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.Mdb(A,Jc,ca,Ra,$d);return Promise.resolve(!0)},Be=>{this.lfb(Be,
A,Jc,ca,Ra,$d);return Promise.reject(Be)})}MCh(A,ca,Ra,Zb,wc){wc=void 0===wc?!1:wc;A.stopwatch=this.$.Sd.Ze("UserAction","DragDropReplaceClientSide");A.isDragDrop=!0;this.bbd("DragDropReplace/before/"+ra.a[A.ribbonCommandInfo.method],!1,void 0,A.copyPasteTargetType).catch(()=>{});const Jc=wc?2:1;let fd=0;fd=wc?4:Zb?256:128;const $d={encounteredDeploymentErrors:!1};$d.commandParameters=A;Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:8105431_DragDropEnhancementsEnabled")&&(A.isDragInsert=!1);A.userHash=
this.userHash;A.id=ma.a.create().toString();return this.xDd?this.pq.pasteRange(A.ribbonCommandInfo,ec.q(ca,this.$),ec.q(Ra,this.$),Jc,fd,[A.stopwatch],$d,!1,()=>{n.ULS.sendTraceTag(537167816,0,50,`CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="${A.copyPasteTargetType}"`);this.Mdb(A,Jc,ca,Ra,$d)},Be=>this.lfb(Be,A,Jc,ca,Ra,$d)).then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},Be=>Promise.reject(Be)):this.pq.pasteRange(A.ribbonCommandInfo,ec.q(ca,
this.$),ec.q(Ra,this.$),Jc,fd,[A.stopwatch],$d,!1,null,null).then(()=>{n.ULS.sendTraceTag(521410073,0,50,`CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="${A.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.Mdb(A,Jc,ca,Ra,$d);return Promise.resolve(!0)},Be=>{this.lfb(Be,A,Jc,ca,Ra,$d);return Promise.reject(Be)})}LCh(A,ca,Ra,Zb,wc){wc=void 0===wc?!1:wc;A.stopwatch=this.$.Sd.Ze("UserAction","DragDropInsertClientSide");this.bbd("DragDropInsert/before/"+ra.a[A.ribbonCommandInfo.method],
!1,void 0,A.copyPasteTargetType).catch(()=>{});const Jc=wc?2:1,fd=ec.L(this.V$b([Ra],Jc));var $d=this.$.ea.na.sheetName;const Be=this.$.ea.na.sheetName,Re=ec.v(ca,this.$);Re.SheetName=$d;$d=ec.v(fd,this.$);$d.SheetName=Be;Zb=fd.isRow||ca.isRow||Zb?1:0;const lf={encounteredDeploymentErrors:!1};A.isDragInsert=!0;lf.commandParameters=A;A.userHash=this.userHash;A.id=ma.a.create().toString();if(this.xDd)return wc=this.pq.gZe(lf,Re,$d,wc,Zb,A.ribbonCommandInfo,()=>{n.ULS.sendTraceTag(537167814,0,50,`CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="${A.copyPasteTargetType}"`);
this.Mdb(A,Jc,ca,Ra,lf)},$f=>{this.lfb($f,A,Jc,ca,Ra,lf)}),Bc.d(wc.then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},$f=>Promise.reject($f))).Vr(()=>!0);wc=this.pq.gZe(lf,Re,$d,wc,Zb,A.ribbonCommandInfo,null,null);let xf=this;return Bc.d(wc.then(()=>{n.ULS.sendTraceTag(521410071,0,50,`CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="${A.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.Mdb(A,Jc,ca,Ra,lf);return Promise.resolve(!0)},$f=>
{xf.lfb($f,A,Jc,ca,Ra,lf);return Promise.reject($f)})).Vr(()=>!0)}Koc(A,ca,Ra,Zb,wc,Jc){var fd=Na(this.jL);if(!fd)return n.ULS.sendTraceTag(537167812,0,50,"InsertCopiedCutCells: CopyContext must not be null or undefined"),Aa.Task.Wa(!1);if(!ib(fd.sourceItem))return n.ULS.sendTraceTag(537167811,0,50,"InsertCopiedCutCells: CopyContext must be a Range"),Aa.Task.Wa(!1);var $d=fd.sourceItem;if(!$d)return n.ULS.shipAssertTag(537167810,0,!!$d,"InsertCopiedCutCells: rangeSourceItem must not be null or undefined"),
Aa.Task.Wa(!1);if(!$d.isFromCurrentSession(this.$)&&!Va.a.$Ra)return n.ULS.sendTraceTag(537167809,0,50,"InsertCopiedCutCells: rangeSourceItem is from a different session"),Aa.Task.Wa(!1);if(1<$d.ranges.length)return n.ULS.sendTraceTag(537167808,0,50,"InsertCopiedCutCells: multiple source ranges are not supported"),this.ZDa(2192,"InsertCopiedCutCells",!0),Aa.Task.Wa(!1);fd=ec.L($d.ranges);var Be=this.gridView.ha.ra.lf.clone();A=ec.L(this.V$b([Be],A));const Re=this.kAf();$d=$d.sheetName;Be=this.$.ea.na.sheetName;
const lf=ec.v(fd,this.$);lf.SheetName=$d;const xf=ec.v(A,this.$);xf.SheetName=Be;$d=this.gridView.ha.ra.activeRange;const $f=()=>{n.ULS.sendTraceTag(508929747,0,50,"InsertCopiedCutCellsCrossSession Succeeded")},tg=()=>{n.ULS.sendTraceTag(508929746,0,50,"InsertCopiedCutCellsCrossSession Failed")};return(A.Oi||fd.Oi||this.pq.FYj(this.$,fd,$d)?Aa.Task.Wa(0):A.isRow||fd.isRow||this.pq.GYj(this.$,fd,$d)?Aa.Task.Wa(1):this.pyi.Tcc(this.$,U.h(this.$).rtl)).Vr(Vf=>!this.Nfc()&&Va.a.$Ra?this.pq.executeInsertCopiedCutCellsAcrossSession(lf,
xf,Re,Vf.result,ca,$f,tg,Ra,Zb,wc,Jc):this.pq.executeInsertCopiedCutCellsOperation(lf,xf,Re,Vf.result,ca,null,null)).continueWith(()=>{this.Xt("InsertCopiedCutCells/success/"+ra.a[ca.method],!0)})}qIb(){const A=Na(this.jL),ca=this.gridView.ha.ra.Ij;return!!A&&ib(A.sourceItem)&&ca&&1===A.sourceItem.ranges.length}kAf(){return this.lAf(-911352779)}WCd(){var A,ca;const Ra=Na(this.jL);return Ra?(null===(A=Ra.asyncClipboardItemsKeys)||void 0===A?void 0:A.includes(jc.shadowWorkbook))||(null===(ca=Ra.syncClipboardItemsKeys)||
void 0===ca?void 0:ca.includes(jc.shadowWorkbook))||3!==Ra.copyStatus:!1}ztc(){return this.lAf(-1985798686)}gac(A,ca){var Ra=new Dd.a(this.$.va),Zb=36===A;const wc=Ra.Rf(4);A=2===this.odb()&&Ra.Rf(1);Zb=Zb&&wc;Ra=!Ra.Oj||!this.ztc()||!Dd.a.Dfc(ca,U.h(this.$));return Zb||A||this.$.Iu(ca,!0)&&Ra}dIb(A,ca){return this.pq.dIb(A,ca)}dispose(){super.dispose();this.Jk();this.jL.removeMetadataChangeListener(ed.kHf)}Bhd(A,ca,Ra,Zb,wc,Jc){if(!this.Hhh(A.commandParameters.ribbonCommandInfo.command))return A.cseStatus=
2,!1;if(Jc&&ca.hf(Zb))return A.cseStatus=4,!1;if(Ra!==wc)return A.cseStatus=6,!1;if(Zb.width%ca.width||Zb.height%ca.height)return A.cseStatus=16,!1;Ra=Zb.wg(this.gridView.Ol);Zb=null===ca.wg(this.gridView.Ol);wc=A.commandParameters.ribbonCommandInfo.command;if(Zb&&1804571062!==wc&&-185374993!==wc||!Ra)return A.cseStatus=7,!1;Zb=this.CIe(this.gridView,A.commandParameters.ribbonCommandInfo.command,ca,Tc.source);if(0!==Zb)return A.cseStatus=Zb,!1;Zb=this.CIe(this.gridView,A.commandParameters.ribbonCommandInfo.command,
Ra,Tc.destination);if(0!==Zb)return A.cseStatus=Zb,!1;Zb=ec.v(ca,this.$);Zb=this.eh.akj(this.gridView,Zb,ec.v(Ra,this.$),A.commandParameters.ribbonCommandInfo.command,A.commandParameters.stopwatch);1===Zb&&(Jc&&(this.eh.Tad(ca,!1),this.eh.Tad(ca,!0)),ca=new Vc(A.commandParameters.ribbonCommandInfo.command,Ra,ca),U.h(this.$).G1f(ca),this.pasteIndicationManager.ync(A.commandParameters.id,!0),this.sTb(A.commandParameters.expandDestinations,A.commandParameters.isPasteCommandFromRecoveryUI),this.abd("DoPasteClientEstimation/"+
ra.a[A.commandParameters.ribbonCommandInfo.method],A));A.cseStatus=Zb;return 1===Zb}CIe(A,ca,Ra,Zb){const wc=new hc.a("CopyPasteInfrastructure.blockCseForPaste",A,Ra);try{for(;wc.moveNext();){let Jc=wc.get_current().cell;if(Jc.RA)return 8;if(237279923===ca||-185374993===ca){if(Jc.jS)return 18;if(Jc.eQ)return 19}if(Zb===Tc.source&&(237279923===ca||1804571062===ca)&&this.EIi(A,Ra))return 20}}finally{wc&&wc.dispose()}return 0}UYf(){this.copyPasteShortcutDialogFactory.create(this.$).showDialog(!0,!1,
!1,this.aUi)}FTi(A,ca,Ra,Zb){A=Lb(A,ca,Ra,Zb,this.$.xa.UserSessionId);A.k=!0;vc.b().ih(45,A,!0)}Xcj(A,ca,Ra,Zb,wc){var Jc=!1,fd=!1,$d=ed.Bzb,Be=ed.aZe+ed.sOa;A&&(Be+=ed.PPa(A),ge.a.Rr(A.ewaErrors)?($d=this.zkc(A.ewaErrors),ge.a.nj(A.ewaErrors,[-103190598])&&(Jc=!0)):A.message&&($d=A.message));fd||(fd=this.oAd(A));ca=Lb(ca,Ra,Zb,wc,this.$.xa.UserSessionId);ca.k=!1;ca.l=fd;ca.n=$d;ca.p=Be;ca.q=Jc;vc.b().ih(45,ca,!0);return Promise.reject(A)}EIi(A,ca){const Ra=A.Kk("CopyPasteInfrastructure.isRangeWithBottomOrRightBorder",
new Kb.Range(ca.top,ca.right,ca.bottom,ca.right,!0,!0));for(;Ra.$$mn();){let Zb=Ra.$$cu();if(Zb&&Zb.IAa())return n.ULS.sendTraceTag(509436432,0,50,"CopyPasteInfrastructure.ShowInstantaneousFormattingFromRange: no instantaneous."),!0}for(A=A.Kk("CopyPasteInfrastructure.isRangeWithBottomOrRightBorder",new Kb.Range(ca.bottom,ca.left,ca.bottom,ca.right,!0,!0));A.$$mn();)if((ca=A.$$cu())&&ca.EAa())return n.ULS.sendTraceTag(509436431,0,50,"CopyPasteInfrastructure.ShowInstantaneousFormattingFromRange: no instantaneous."),
!0;return!1}r6g(A,ca,Ra){A.cseStatus=0;A.cseStatus=this.jEi(A.commandParameters.ribbonCommandInfo.command,Ra,this.gridView,ca);if(0!==A.cseStatus)return!1;A.cseStatus=this.eh.bkj(this.gridView,ca,Ra,A.commandParameters.stopwatch);ca=new Vc(A.commandParameters.ribbonCommandInfo.command,Ra,null);1===A.cseStatus&&(U.h(this.$).G1f(ca),this.pasteIndicationManager.ync(A.commandParameters.id,!0),this.sTb(A.commandParameters.expandDestinations,A.commandParameters.isPasteCommandFromRecoveryUI),this.abd("AttemptExternalPlainTextPasteClientEstimation/"+
ra.a[A.commandParameters.ribbonCommandInfo.method],A));return 1===A.cseStatus}jEi(A,ca,Ra,Zb){if(-875588320!==A&&-185374993!==A&&237279923!==A)return 2;if(Ra.zd.DIb(ca))return 8;if(Ra.zd.EMi(ca))return 18;if(Ra.zd.h3(ca))return 11;if(this.eh.JYe(ca))return 12;A=this.rch(ca,Zb);return U.j(this.gridView,A)?0:7}rch(A,ca){var Ra=ca.indexOf("\r");Ra=-1!==Ra?"\n"===ca[Ra+1]?ca.split("\r\n"):ca.split("\r"):ca.split("\n");ca=Ra.length;Ra=Ra[0].split("\t").length;return new Kb.Range(A.top,A.left,A.top+ca-
1,A.left+Ra-1,!0,!0)}Hhh(A){switch(A){case 237279923:case 808159687:case -185374993:case 1804571062:return!0;default:return!1}}lAf(A){const ca=Na(this.jL);if(!ca)return!1;const Ra=ca.sourceItem;return Va.a.$Ra||!Ra||Ra.isFromCurrentSession(this.$)?ca.commandParameters.ribbonCommandInfo.command===A:(n.ULS.sendTraceTag(537167779,0,50,"CopyPasteInfrastructure.LastOperationWasCopyCut: Last copy operation was from a different session."),!1)}PWj(A){return A&&A.lastCopy?ja(A.lastCopy,this.$):!0}scf(A,ca,
Ra,Zb,wc){const Jc={};Jc.a=this.$.xa.UserSessionId;Jc.e=A.stopwatch.id;Jc.c=vc.b().zl(A.ribbonCommandInfo.command);Jc.b=ra.a[A.ribbonCommandInfo.method];Jc.d=A.id;Jc.f=Ra.toString();Jc.g=Zb.toString();Jc.h=ca.toString();Jc.o=A.stopwatch.Te;Jc.q=!1;Jc.r=A.copyPasteTargetType.toString();Jc.s=wc.encounteredDeploymentErrors;Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:8105431_DragDropEnhancementsEnabled")&&(Jc.i=wc.commandParameters.dragDropIsShiftKeyDown,Jc.j=wc.commandParameters.isDragInsert);return Jc}Mdb(A,
ca,Ra,Zb,wc){A=this.scf(A,ca,Ra,Zb,wc);A.k=!0;vc.b().ih(45,A,!0)}cSi(A,ca,Ra,Zb,wc,Jc,fd,$d,Be){A=this.scf(A,ca,Ra,Zb,Be);A.k=!1;A.l=wc;A.n=Jc;A.p=fd;A.q=$d;vc.b().ih(45,A,!0)}DCf(A,ca,Ra,Zb,wc,Jc,fd,$d,Be){const Re={};Re.a=this.$.xa.UserSessionId;Re.b=ca;Re.c=A;Re.f=Ra;Re.e=Zb;Re.d=wc;Re.g=Jc;Re.h=fd;Re.i=$d;Re.j=Be.toString();vc.b().ih(46,Re,!0)}VRi(A,ca){A=this.Obf(A.commandParameters,A);A.l=!0;A.j=ca;vc.b().ih(43,A,!0)}URi(A,ca,Ra,Zb,wc,Jc,fd){A=this.Obf(A,fd);A.l=!1;A.m=ca;A.o=Ra;A.y=Zb;A.x=
wc;A.z=Jc;vc.b().ih(43,A,!0);n.ULS.sendTraceTag(537167776,0,15,`CopyPasteInfrastructure.LogCopyFailedTelemetry: ErrorName=${A.y},ErrorReason=${A.x},IsExpectedError=${A.m},IsSucceededWithAlert=${A.z},ErrorMessage=${A.o}`)}Obf(A,ca){const Ra={};Ra.a=this.$.xa.UserSessionId;Ra.f=A.stopwatch.id;Ra.g=A.id;Ra.c=vc.b().zl(A.ribbonCommandInfo.command);Ra.b=ra.a[A.ribbonCommandInfo.method];Ra.q=A.stopwatch.Te;Ra.bd=ed.Njc();Ra.bg=A.copyPasteHandlerName;Ra.bj=void 0===A.ribbonCommandInfo.Tg||null===A.ribbonCommandInfo.Tg?
null:rb.a[A.ribbonCommandInfo.Tg];Ra.bq=A.uploadToClipService;Ra.br=A.floatingObjectType;Ra.s=A.copyPasteTargetType.toString();Ra.bc=Ka(A.copyPasteTargetType);Ra.z=!1;if(ca){Ra.bk=ca.id;Ra.bl=ca.serverRequestTimeInMs;ca.requestTelemetryData&&(Ra.bm=ca.requestTelemetryData.EcsOperationDuration,Ra.bn=ca.requestTelemetryData.EcsRequestDuration,Ra.bo=ca.requestTelemetryData.WfeRequestDuration);Ra.d=ca.sourceItem?ca.sourceItem.toString():null;Ra.e=-1;if(ib(ca.sourceItem)){Ra.e=0;A=ca.sourceItem.ranges;
for(const Zb of A)Ra.e+=Zb.Uw}Ra.h=ca.isAsyncCopy;Ra.i=ca.isFromCache;Ra.k=ca.isSelectionAllowed;Ra.r=ca.plainTextPayloadSize;Ra.u=ca.htmlPayloadSize;Ra.v=ca.htmlSizeExceedsLimit;Ra.w=ca.copyTotalSizeExceedsLimit;Ra.t=ca.shadowWorkbookPayloadSize;Ra.p=ca.clientSideCopyTime;Ra.ba=ca.encounteredDeploymentErrors;Ra.bb=ca.shadowWorkbookSizeExceedsLimit;Ra.be=ca.syncClipboardItemsKeys;Ra.bf=ca.asyncClipboardItemsKeys;Ra.bh=this.uRe(ca.succeededPopulatingSystemClipboardSync);Ra.bi=this.uRe(ca.succeededPopulatingSystemClipboardAsync)}return Ra}sTb(A,
ca){ca=void 0===ca?!1:ca;if(!this.gridView.ld&&!this.gridView.fl){var Ra=this.gridView.ha.ra,Zb=!ca&&1===A.length&&ec.R(A,Ra.selectedRanges),wc=Zb?Ra.activeCell:A[0].topLeft;A[0].contains(wc)||(n.ULS.shipAssertTag(537167775,0,!1,`CopyPasteInfrastructure.SelectPastedRange: SelectedRanges ${Ra.selectedRanges}, IndexOfActiveRange ${Ra.tt}, ActiveCell ${Ra.activeCell}, calculatedDestinationRanges ${A}, keepThePreviousActiveCell ${Zb}, newActiveCell ${wc}, isPasteCommandFromRecoveryUI ${ca}`),wc=A[0].topLeft);
this.gridView.ha.WI(A,0,wc,0,void 0,"CopyPasteInfrastructure.SelectPastedRange")}}Zff(A,ca){const Ra={};Ra.a=this.$.xa.UserSessionId;Ra.g=A.stopwatch.id;Ra.t=A.stopwatch.Te;Ra.bz=!1;ca&&(Ra.bv=ca.id,Ra.bw=ca.serverRequestTimeInMs,Ra.n=ca.commandParameters.clipboardFormatReadTimes,Ra.o=ca.commandParameters.clipboardFormatReadStatus,Ra.p=ca.commandParameters.clipboardReadPermissionPromptShown,Ra.q=ca.commandParameters.asyncApiReadTimedOut,ca.requestTelemetryData&&(Ra.cb=ca.requestTelemetryData.EcsOperationDuration,
Ra.cc=ca.requestTelemetryData.EcsRequestDuration,Ra.cd=ca.requestTelemetryData.WfeRequestDuration));Ra.x=A.copyPasteTargetType.toString();Ra.bl=Ka(A.copyPasteTargetType);Ra.br=A.copyPasteHandlerName;Ra.i=ec.i(A.expandDestinations,",",this.$,!1);Ra.h=ec.i(A.originalDestinations,",",this.$,!1);Ra.e=A.id;Ra.d=A.commandType;Ra.c=vc.b().zl(A.ribbonCommandInfo.command);Ra.b=ra.a[A.ribbonCommandInfo.method];Ra.bf=!1;Ra.bg=!1;Ra.bp=ed.Njc();Ra.bt=void 0===A.ribbonCommandInfo.Tg||null===A.ribbonCommandInfo.Tg?
null:rb.a[A.ribbonCommandInfo.Tg];Ra.cj=A.isPasteCommandFromEnterShortcut;if(Ra.ca=A.isPasteCommandFromRecoveryUI)Ra.cf=A.pasteRecoveryUndoStopwatch.id,Ra.cg=A.pasteRecoveryUndoStopwatch.Te;if(ca){if((A=ca.copyContextSnapshot)&&!ca.wasLastCopyExternal){Ra.f=A.commandParameters.id;Ra.j=A.sourceItem.toString();Ra.k=-1;if(ib(A.sourceItem)){Ra.k=0;const Zb=A.sourceItem.ranges;for(const wc of Zb)Ra.k+=wc.Uw}Ra.bg=1===A.commandParameters.commandType}else ca.clipboardItems?Ra.f=ca.clipboardItems.getItem(jc.xdd):
n.ULS.sendTraceTag(537167774,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext.ClipboardItems is null");Ra.bz=ca.pasteRecoveryUIDisplayed;Ra.ci=ca.cseStatus}else n.ULS.sendTraceTag(537167773,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext is null");return Ra}mTi(A,ca,Ra,Zb,wc,Jc,fd,$d,Be){A=this.Zff(A,$d);A.l=!1;A.m=ca;A.s=Ra;A.bc=Zb;A.be=wc;A.bd=Jc;A.bf=fd;$d?(A.y=sc($d)||!$d.copyContextSnapshot,A.bi=!A.y&&ja($d.copyContextSnapshot,this.$),A.bj=$d.shadowWorkbookSizeExceedsLimit,
A.v=$d.shadowWorkbookPayloadSize,A.w=$d.htmlPayloadSize,A.bq=Pb($d.clipboardItems),A.bb=$d.activeSelectionType,A.bs=$d.isSameSession,A.bn=$d.payloadOrigin,A.bo=$d.payloadType,A.bu=$d.externalAppSource,A.bx=$d.indicationDisplayScheduled,A.by=$d.pasteIndicationDisplayStatus,A.ck=$d.pasteDestinationHasMergedCells):A.bi=ja(Be,this.$);vc.b().ih(44,A,!0);n.ULS.sendTraceTag(537167772,0,15,`CopyPasteInfrastructure.LogPasteFailedTelemetry: ErrorName=${A.be},ErrorReason=${A.bd},IsExpectedError=${A.m},IsSucceededWithAlert=${A.bf},ErrorMessage=${A.s}`)}nTi(A){const ca=
this.Zff(A.commandParameters,A);ca.y=A.wasLastCopyExternal;ca.l=!0;ca.u=A.plainTextPayloadSize;ca.v=A.shadowWorkbookPayloadSize;ca.w=A.htmlPayloadSize;ca.z=A.isClipboardDataContainShadowWorkbook;ca.ba=A.isShadowWorkbookParsedSuccessfully;ca.bb=A.activeSelectionType;ca.bc=A.pasteResult;ca.bh=A.encounteredDeploymentErrors;ca.bj=A.shadowWorkbookSizeExceedsLimit;ca.bk=Ha(A);ca.bq=Pb(A.clipboardItems);ca.bs=A.isSameSession;ca.bn=A.payloadOrigin;ca.bo=A.payloadType;ca.bu=A.externalAppSource;ca.bx=A.indicationDisplayScheduled;
ca.by=A.pasteIndicationDisplayStatus;ca.ck=A.pasteDestinationHasMergedCells;ca.bm=A.clipboardItems?A.clipboardItems.getItem(jc.ygh):null;ca.bi=!A.isSameSession&&!A.wasLastCopyExternal;ca.ci=A.cseStatus;vc.b().ih(44,ca,!0)}il(){this.$.va.Ri(this.om);this.$.va.TZg(this.ayc);this.$.userOperationManager.Pr(this.WU);this.$.Zm(this.wf);U.h(this.$).he.Gp(this.GDa)}Jk(){this.$&&this.$.va&&(this.$.va.uj(this.om),this.$.va.GBj(this.ayc));this.$&&this.$.userOperationManager&&this.$.userOperationManager.Ap(this.WU);
this.gridView&&this.gridView.he&&this.gridView.he.zp(this.GDa)}iOb(A,ca){var Ra=null;let Zb=!1;var wc=null;let Jc="UnknownFailure",fd=-1,$d=ed.Bzb,Be=ed.pasteErrorName+ed.sOa,Re=!1;this.pasteIndicationManager.ync(A.id,!1);this.pasteDestinationHasMergedCells(A.expandDestinations)&&(ca.pasteContext.pasteDestinationHasMergedCells=!0);const lf=Na(this.jL);(A.clearStateOnFinish||A.clearSystemClipboard)&&this.Xt("Paste/fail/"+ra.a[A.ribbonCommandInfo.method],!0,void 0,void 0,A.copyPasteTargetType).catch(()=>
{});if(ca){fd=ca.reason;Be+=ed.PPa(ca);ca.message&&($d=ca.message);if(Ra=ed.Pmh(ca))if(1===Ra.pasteErrorName)Zb=!0,Jc="CopyPasteLengthTooLongPopup",$d=wc="The pasted content is too long. Popup a dialog to the user.",n.ULS.sendTraceTag(25216992,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${wc}, copyPasteTargetType="${A.copyPasteTargetType}"`),Ra=ge.a.qf(1,0,26,690,0,1306609195,"CopyPasteOversizeError"),Sb.EwaSettings.gC()?new ce.a(this.$,Ra):(Ra=new Kd.ErrorDialog(this.$,Ra),Ra.initialize(),Ra.Ji());
else if(7===Ra.pasteErrorName)Zb=!0,Jc="No-Op",$d=wc="The shadow workbook is not ready yet and an async copy failed to populate the clipboard. Do nothing (by the spec)",n.ULS.sendTraceTag(33948251,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${wc}, copyPasteTargetType="${A.copyPasteTargetType}"`);else if(8===Ra.pasteErrorName)Zb=!0,Jc="UseShortcutsPopup",$d=wc="Unable to paste content from the system clipboard. Popup dialog to the user.",n.ULS.sendTraceTag(25216994,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${wc}, copyPasteTargetType="${A.copyPasteTargetType}"`),
this.UYf();else if(18===Ra.pasteErrorName){Zb=!0;Jc="PasteExternalNotSupportMultipleSelectionPopup";$d="Paste external not support multiple selection.";wc="Unknown";var xf=2192;100!==Ra.validationFailureReason&&(wc=rc[Ra.validationFailureReason],xf=ed.mRe(Ra.validationFailureReason));this.ZDa(xf,wc,!0)}else 20===Ra.pasteErrorName||19===Ra.pasteErrorName?(Zb=!0,20===Ra.pasteErrorName?(Jc="PasteAcrossSessionNotSupportMultipleSelectionPopup",$d="Paste across session does not support multiple selection."):
(Jc="PasteInSameSessionNotSupportMultipleSelectionPopup",$d="This kind of multiple selection is not supported for same session paste."),wc="Unknown",xf=2192,100!==Ra.validationFailureReason&&(wc=rc[Ra.validationFailureReason],xf=ed.mRe(Ra.validationFailureReason)),Ra=6===Ra.validationFailureReason,this.gac(A.commandType,A.expandDestinations)&&Ra&&this.sTb(A.expandDestinations),this.ZDa(xf,wc,!0)):6===Ra.pasteErrorName?(Zb=!0,Jc="No-Op",$d=wc="Paste Formatting/Transpose is not yet a supported operation on System Clipboard based content",
n.ULS.sendTraceTag(36263241,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${wc}, copyPasteTargetType="${A.copyPasteTargetType}"`)):17===Ra.pasteErrorName?(Zb=!0,Jc="No-Op",$d=wc="Paste text on Art is not yet a supported operation",n.ULS.sendTraceTag(0,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${wc}, copyPasteTargetType="${A.copyPasteTargetType}"`)):16===Ra.pasteErrorName?(Zb=!0,Jc="No-Op",$d=wc="Paste has failed because the previous copy has failed",Ra=this.getStringifiedError(Ra),n.ULS.sendTraceTag(537167771,
0,15,`CopyPasteInfrastructure.OnPasteFailed: ${wc}, copyPasteTargetType="${A.copyPasteTargetType}", error=${Ra}`)):ge.a.Rr(Ra.ewaErrors)?(ge.a.tda(Ra.ewaErrors)||ge.a.nj(Ra.ewaErrors,ge.a.lmc())?(Zb=!0,Jc="CommunicationError",wc=ge.a.ue(Ra.ewaErrors),n.ULS.sendTraceTag(36304159,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${$d} copyPasteTargetType="${A.copyPasteTargetType}"`)):ge.a.nj(Ra.ewaErrors,ed.vKj)?(Zb=!0,Jc="SavingWorkbookError",wc=ge.a.ue(Ra.ewaErrors),n.ULS.sendTraceTag(36304160,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${$d} copyPasteTargetType="${A.copyPasteTargetType}"`)):
ge.a.nj(Ra.ewaErrors,ed.operationSucceededWithAlert)&&(Re=Zb=!0,Jc="OperationSucceededWithAlert",wc=ge.a.ue(Ra.ewaErrors),n.ULS.sendTraceTag(36304161,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${$d} copyPasteTargetType="${A.copyPasteTargetType}"`)),Zb||($d=this.zkc(Ra.ewaErrors),Zb=this.oAd(ca))):11===Ra.pasteErrorName&&(Zb=!0,Jc="No-Op",$d="Paste has failed because user try copy cross-session oart object");15===ca.reason&&(Zb=!0,Jc="No-Op",$d="Rejecting deferred paste there is metadata update without copy context. Usually it means that copy canceled before finished.");
Rd.a.equals(Be,bc.llk,!1)&&(Zb=!0,Jc="No-Op",$d="User hash of the copy is different then the user hash of the paste during cross-session copy-paste. Do nothing.")}Zb||(Ra=ca?this.getStringifiedError(ca):"null",n.ULS.sendTraceTag(24150916,0,10,`CopyPasteInfrastructure.OnPasteFailed: ${Ra}, copyPasteTargetType="${A.copyPasteTargetType}"`));this.mTi(A,Zb,$d,Jc,Be,fd,Re,ca.pasteContext,lf);return Promise.reject(ca)}Ayc(A,ca){var Ra;n.ULS.sendTraceTag(24150917,0,50,`CopyPasteInfrastructure.OnPasteSuccess: paste succeed. copyPasteTargetType="${ca.copyPasteTargetType}"`);
this.pasteIndicationManager.ync(ca.id,!0);if(this.gkj(ca.copyPasteTargetType,A)){Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!Y.a.XD&&A.wasLastCopyExternal&&A.payloadType===hb.shadowWorkbook&&(this.zcb=!0);let Zb=null;(null===(Ra=A.pastedRange)||void 0===Ra?0:Ra.Ranges)&&0<A.pastedRange.Ranges.length?Zb=ec.g(A.pastedRange.Ranges):A.wasLastCopyExternal||(Zb=ca.expandDestinations);this.lMj(A,Zb);if(this.bZj(A,Zb)){let wc;Ra=ec.d(ca.originalDestinations);
wc=1028===ca.commandType?ec.d(ca.expandDestinations):ec.d(Zb);let Jc=null;A.wasLastCopyExternal&&(ca.isKeyboardEvent||ca.isPasteCommandFromRecoveryUI)&&(Jc={[ed.FXf]:A.clipboardItems});this.pasteDestinationHasMergedCells(ca.expandDestinations)&&(A.pasteDestinationHasMergedCells=!0);A.pasteRecoveryUIDisplayed=!0;const fd=new ua(this.$,Ra,wc,Jc),$d=$c.GetServiceTaskFactory.ud(this.$.ga,406,405,0);Jd.TaskExtensions.za($d,()=>{const Be=$d.result;Be.vIe(fd);Be.ilg(ca.ribbonCommandInfo.method)},this.ka,
8)}this.h6i(A,Zb)}this.abd("Paste/success/"+ra.a[ca.ribbonCommandInfo.method],A);this.nTi(A);this.Fjg&&(!ca.isKeyboardEvent||Ha(A))&&this.$.ea.pj.get(66)&&(n.ULS.sendTraceTag(537167770,0,15,"CopyPasteInfrastructure.OnPasteSuccess: show localStorage disable notification"),this.Fjg=!1,this.woh());return Promise.resolve(!0)}h6i(A,ca){Jd.TaskExtensions.za($c.GetServiceTaskFactory.ud(this.$.ga,534,535,1),Ra=>{Ra.result.Ack(A,ca)},this.$.ka,3)}bZj(A,ca){return!ca||1!==ca.length||A.commandParameters.clearSystemClipboard||
A.commandParameters.clearStateOnFinish||A.commandParameters.skipClipboardAccess?!1:sc(A)&&(ca=A.clipboardItems.getItem(jc.plainText),A=A.clipboardItems.getItem(jc.html),void 0===ca||null===ca||ca.length>this.yXi||void 0===A||null===A||A.length>this.QLb)?(n.ULS.sendTraceTag(537167769,0,50,"CopyPasteInfrastructure.ShouldShowPasteRecoveryUI: Not showing PasteRecoveryUI for external copy."),!1):!0}gkj(A,ca){return 1===A||ca.payloadType===hb.plainText||ca.payloadType===hb.html||Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",
!1)&&!Y.a.XD&&ca.payloadType===hb.shadowWorkbook}pasteDestinationHasMergedCells(A){const ca=U.h(this.$).ya.Xy();if(!ca||!ca.length)return!1;for(const Ra of ca)if(Ra.fw(A[0]))return!0;return!1}abd(A,ca){let Ra;(()=>{let Zb=this.rCi(ca);({HMa:Ra}=Zb);return Zb})().returnValue&&this.Xt(A,Ra,void 0,void 0,ca.commandParameters.copyPasteTargetType).catch(()=>{})}lfb(A,ca,Ra,Zb,wc,Jc){const fd=A?this.getStringifiedError(A):"null";let $d=!1,Be=!1,Re=!1,lf=ed.Bzb,xf=ed.aZe+ed.sOa;A&&(xf+=ed.PPa(A),ge.a.Rr(A.ewaErrors)?
(lf=this.zkc(A.ewaErrors),ge.a.nj(A.ewaErrors,ed.operationSucceededWithAlert)&&($d=!0),ge.a.nj(A.ewaErrors,ed.dragDropNonEmptyRange)&&(Be=Re=!0)):A.message&&(lf=A.message));Re||(Re=this.oAd(A));Be?this.gridView.ha.selectionType=-1:this.pq.Mvj(wc);Re||n.ULS.sendTraceTag(24150918,0,10,`CopyPasteInfrastructure.OnDragAndDropCellsFailed: ${fd}, copyPasteTargetType="${ca.copyPasteTargetType}`);this.cSi(ca,Ra,Zb,wc,Re,lf,xf,$d,Jc)}V$b(A,ca){let Ra=A;const Zb=this.gai();if(null===Zb||void 0===Zb?0:Zb.ranges)Ra=
this.pq.Jch(ca,Zb.ranges,A);return Ra}gai(){const A=Na(this.jL);return A&&ib(A.sourceItem)?A.sourceItem:null}Bsj(){this.raiseEvent(ed.DOd,null)}lMj(A,ca){const Ra=A.commandParameters.originalDestinations;ca&&(ec.R(this.gridView.ha.ra.selectedRanges,Ra)?(this.sTb(ca),A=dd.HelperMethods.Cvb(ca),n.ULS.sendTraceTag(537167767,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range, range: ${A}`)):A.commandParameters.isPasteCommandFromRecoveryUI?(this.sTb(ca,!0),n.ULS.sendTraceTag(537167766,
0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range for IsPasteCommandFromRecoveryUI, range: ${ca}, active cell: ${ca[0].topLeft}`)):(A=dd.HelperMethods.Cvb(Ra),n.ULS.sendTraceTag(537167765,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: user change his selection during paste operation. don't change selection. originalPasteDestinations: ${A}`)))}rCi(A){if(A.isPlainTextPaste||A.isHtmlPaste||Fa(A)||A.commandParameters.isPasteCommandFromEnterShortcut)return{returnValue:!0,
HMa:!1};var ca=A.copyContextSnapshot;if(A.commandParameters.clearStateOnFinish)return{returnValue:!0,HMa:!0};if(ca&&ib(ca.sourceItem)){var Ra=ca.sourceItem;if(!Ra.isFromCurrentSession(this.$))return{returnValue:!1,HMa:!0};ca=-1985798686===ca.commandParameters.ribbonCommandInfo.command;if(!(1<Ra.ranges.length||1<A.commandParameters.expandDestinations.length)){const Zb=ec.L(Ra.ranges);A=ec.L(A.commandParameters.expandDestinations);const wc=this.$.ea.na.sheetName;Ra=Ra.sheetName;if(Ra===wc&&A.equals(Zb))return{returnValue:!1,
HMa:!0};if(Ra===wc&&A.wg(Zb))return{returnValue:!0,HMa:!1}}return{returnValue:ca,HMa:!0}}return{returnValue:!1,HMa:!0}}LUf(){var A=Na(this.jL);(A=this.pq.t$a(A))&&A.isFromCurrentSession(this.$)&&this.Xt("OnStartEdit",!1).catch(()=>{})}zkc(A){A=ge.a.z7h(A,ed.sOa);return this.mYi+kb.a.Ly(A).toString()}oAd(A){A=ed.PPa(A);return!!A&&Rd.a.PAb(A,ed.lYi)}woh(){const A=ge.a.qf(1,2,327,328,Y.a.Sp?329:Y.a.TK?330:331,530046625,"ActivateLocalStorage"),ca=Object(xc.a)("OfficeVSO:7811663_ConvertBusinessBarManagerService2")?
Object(Bc.d)(ab.a.resolve(Wb.m,{Ja:0})):$c.GetServiceTaskFactory.ud(this.$.ga,5,4,0);Jd.TaskExtensions.za(ca,()=>{ca.result.yi(43,A)},this.ka,3)}uRe(A){return void 0===A||null===A?Nb.H0i:A?Nb.success:Nb.failed}static Pmh(A){const ca=A.innerError;return ca&&0!==ca.pasteErrorName?A.innerError:null}static Amh(A){const ca=A.innerError;return ca&&0!==ca.copyErrorName?A.innerError:null}static PPa(A){let ca="";if(!A)return ed.TVe;A.errorName&&(ca=A.errorName,A.innerError&&(ca+=ed.sOa+ed.PPa(A.innerError)));
ca||(ca=A&&A.name?A.name:ed.TVe);return ca}static Njc(){ed.Za||(ed.Za=qb.O2j);return ed.Za}static mRe(A){switch(A){case 7:case 1:return 2199;case 5:return 2196;case 6:return 2195;case 8:case 3:case 2:case 4:case 9:case 10:return 2192;default:return n.ULS.shipAssertTag(537167764,0,!1,`CopyPasteInfrastructure.ConvertPasteValidationOptionToJsStringId: no case for validationOptions = ${A}`),2199}}static Bmh(A){switch(A){case 3:return 2193;case 1:return 2194;case 2:case 4:return 2192;default:return n.ULS.shipAssertTag(537167763,
0,!1,`CopyPasteInfrastructure.ConvertCopySourceValidationOptionToJsStringId: no case for validationOptions = ${A}`),2199}}}ed.kHf="EwaJsMetadataChangeListenerId";ed.DOd="cpiOSC";ed.yxh="cpiDID";ed.Bzb="Unknown";ed.TVe="UnknownError";ed.sOa="_";ed.aZe="DragAndDropError";ed.pasteErrorName="PasteError";ed.Sdh="CancelError";ed.copyErrorName="CopyError";ed.lYi="MergedCellOverlap";ed.FXf="PasteRecoveryCachedClipboardItems";ed.vKj=[1352631530,1679665408];ed.operationSucceededWithAlert=[-103190598];ed.pasteDataLimitHit=
[1306609195];ed.copyThrottlingError=[-386183710];ed.dragDropNonEmptyRange=[563945982];ed.Za=null;Object(l.a)(ed,"CopyPasteInfrastructure",cb.a,[342,343,5]);class be{constructor(){this.c6a=this.gOe=null}}Object(l.a)(be,"ClipboardPlatformInitializationResult",null,[]);var Fc=a(661),vd=a(237),lb=a(124),Eb=a(8),Hc=a(6),Bd=a(59),he=a(30);const je=(A,ca,Ra,Zb,wc,Jc,fd,$d)=>{$d=void 0===$d?null:$d;fd=A.Pa(1,fd);fd.pasteHtmlParameters=ca;return Bd.g(A,"PasteHtmlContent",fd,Ra,Zb,wc,Jc,64,$d)},Fd=(A,ca,Ra,
Zb,wc,Jc,fd,$d,Be,Re)=>{Re=void 0===Re?null:Re;const lf=A.Pa(9,Be);if(he.a.Gsc()){Be="PasteStringV2";const xf={};xf.DestinationRange=ca;xf.Source=Ra;xf.AutoAdjustColumnsOn=Zb;lf.pasteStringParameters=xf}else Be="PasteString",lf.destinationRange=ca,lf.source=Ra;return Bd.g(A,Be,lf,wc,Jc,fd,$d,64,Re)},Oc=(A,ca,Ra,Zb,wc,Jc,fd,$d)=>{$d=void 0===$d?null:$d;fd=A.Pa(1,void 0===fd?null:fd);fd.copyParameters=ca;return Bd.g(A,"Copy",fd,Ra,Zb,wc,Jc,0,$d)},Ad=(A,ca,Ra,Zb,wc,Jc,fd,$d)=>{$d=void 0===$d?null:$d;
fd=A.Pa(1,void 0===fd?null:fd);fd.pasteParameters=ca;return Bd.g(A,"Paste",fd,Ra,Zb,wc,Jc,64,$d)};class Gb{constructor(A,ca,Ra){this.destinationRange=this.sourceRange=null;this.pasteFlags=0;this.sourceRange=A;this.destinationRange=ca;this.pasteFlags=Ra}}Object(l.a)(Gb,"MacroRecorderPasteRangePayload",null,[135]);class Wc{constructor(A,ca){this.content=this.destinationRange=null;this.destinationRange=A;this.content=ca}getContent(){return this.content}}Object(l.a)(Wc,"MacroRecorderPasteStringPayload",
null,[135]);var pd=a(74);class fe{constructor(A){this.pasteParameters=null;this.pasteParameters=A}}Object(l.a)(fe,"MacroRecorderPastePayload",null,[135]);var le=a(602),te;(function(A){A[A.none=0]="none";A[A.copyPasteLengthTooLong=1]="copyPasteLengthTooLong";A[A.applyLinkFailed=2]="applyLinkFailed";A[A.pasteHtmlFailed=3]="pasteHtmlFailed";A[A.pasteStringFailed=4]="pasteStringFailed";A[A.pasteRangeFailed=5]="pasteRangeFailed";A[A.pasteFromClipboardIsNotValidForFormattingAndTranspose=6]="pasteFromClipboardIsNotValidForFormattingAndTranspose";
A[A.asyncCopyFailedToPopulateClipboard=7]="asyncCopyFailedToPopulateClipboard";A[A.clipboardIsInaccessible=8]="clipboardIsInaccessible";A[A.pasteArtFailed=9]="pasteArtFailed";A[A.noArtSourceItem=10]="noArtSourceItem";A[A.blockedCrossSessionArtPaste=11]="blockedCrossSessionArtPaste";A[A.failedToParseShadowWorkbookJson=12]="failedToParseShadowWorkbookJson";A[A.invalidShadowWorkbook=13]="invalidShadowWorkbook";A[A.failedToStringifyShadowWorkbook=14]="failedToStringifyShadowWorkbook";A[A.failedToPasteExternalImage=
15]="failedToPasteExternalImage";A[A.lastAsyncSerializeFailed=16]="lastAsyncSerializeFailed";A[A.pasteOnArtIsNotValidForText=17]="pasteOnArtIsNotValidForText";A[A.pasteFromExternalNotSupportDiscontinuousSelection=18]="pasteFromExternalNotSupportDiscontinuousSelection";A[A.pasteFromSameSessionNotSupportDiscontinuousSelection=19]="pasteFromSameSessionNotSupportDiscontinuousSelection";A[A.pasteFromCrossSessionNotSupportDiscontinuousSelection=20]="pasteFromCrossSessionNotSupportDiscontinuousSelection";
A[A.insertCopiedCutCellsFailed=21]="insertCopiedCutCellsFailed";A[A.rearrangeRowColumnFailed=22]="rearrangeRowColumnFailed"})(te||(te={}));Object(l.b)("PasteErrorType",te);class Ce{constructor(A,ca){this.errorName=this.innerError=null;this.errorName=A;this.innerError=void 0===ca?null:ca}}Object(l.a)(Ce,"CCPError",null,[]);class Xb extends Ce{constructor(A,ca){ca=void 0===ca?null:ca;super(ge.a.ue(void 0===A?null:A,"_"),ca)}}Object(l.a)(Xb,"EwaCCPError",Ce,[]);class oc extends Ce{constructor(A,ca,Ra,
Zb,wc){ca=void 0===ca?null:ca;Ra=void 0===Ra?null:Ra;Zb=void 0===Zb?"":Zb;wc=void 0===wc?100:wc;super(te[A]);this.pasteErrorName=0;this.ewaErrors=this.message=null;this.validationFailureReason=0;this.pasteErrorName=A;this.ewaErrors=ca;this.validationFailureReason=wc;this.innerError=ca?new Xb(ca,Ra):Ra;this.message=Zb}}Object(l.a)(oc,"PasteInnerError",Ce,[]);var Zc=a(200),yd=a(218),Od=a(125),dc=a(247),gd=a(356);class wd{constructor(A){this.parameters=null;this.parameters=A}getParameters(){return this.parameters}}
Object(l.a)(wd,"MacroRecorderRangeCopyCutCellsInsertedPayload",null,[135]);var Ld=a(383);class Xd{constructor(A,ca){this.mtc=this.ZSa=null;this.Kpc=Sb.EwaSettings.getBooleanFeatureGate(Va.a.Yyb,!1);this.Iyd=!1;this.fX=null;this.wC=(Ra,Zb)=>{if(2===Zb.Dt)this.ly.clear(),this.ZSa=null;else if(1===Zb.Dt&&this.ly&&this.ly.contains(Zb.Yh)){Ra=lb.a(Zb.Yh.operation.operationName);const wc=Zb.Yh.dequeueUtcTime.getTime()-Zb.Yh.enqueueUtcTime.getTime();n.ULS.sendTraceTag(526758673,0,50,`CopyPasteUtils.OnQueueChanged: web method ${Ra} returned, it took ${wc} milliseconds to complete.`);
this.ly.remove(Zb.Yh);this.ZSa=null}};this.$=A;this.gridView=ca;this.Iyd&&(this.$.userOperationManager.Pr(this.wC),this.ly=new Ea.a);he.a.Xoa()&&void ab.a.resolve(Wb.j,{Ja:1}).then(Ra=>{this.fX=Ra})}get QLb(){return this.$.xa.CCPCopyPasteHtmlLimit}get sGf(){return this.$.xa.CCPPastePlainTextLimit}copy(A,ca,Ra,Zb,wc){Zb=void 0===Zb?null:Zb;wc=void 0===wc?null:wc;const Jc=this.$.qa.ua.ie();this.Iyd&&this.E0();this.mtc=Jc.ClientRequestId;var fd=new Zc.a(505,0,($d,Be,Re)=>{const lf={CopyPasteTargetType:1};
lf.SourceRanges=A;lf.CopyOperationId=ca.id;return this.ZSa=Oc(this.$.qa.Ry,lf,dc.b($d,Ra),Zb?dc.a(Be,Zb):Be,Re,ca.ribbonCommandInfo,Jc,wc)},80);fd=this.$.userOperationManager.enqueueOperation(fd,ca.ribbonCommandInfo);this.Iyd&&this.ly.add(fd)}EXf(A,ca,Ra,Zb,wc,Jc){return new Promise((fd,$d)=>{var Be;const Re=Jc.commandParameters.stopwatch.Te;let lf=2;20===Jc.commandParameters.commandType&&(lf=16);36===Jc.commandParameters.commandType&&(lf=32);68===Jc.commandParameters.commandType&&(lf=64);he.a.fEd(this.$)&&
1028===Jc.commandParameters.commandType&&(lf=1024);Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PasteWithColumnWidthsEnabled",!1)&&4100===Jc.commandParameters.commandType&&(lf=4096);let xf=null;if(null===(Be=Jc.copyContextSnapshot)||void 0===Be?0:Be.commandParameters)xf=Jc.copyContextSnapshot.commandParameters.id;Xd.A_d(this.$,A,Zb,ca,Ra,null,$f=>{Xd.Lmc($f,Jc,fd,$d,Re,this.$,null,!0,null,null)},$f=>{Jc.serverRequestTimeInMs=Jc.commandParameters.stopwatch.Te-Re;$f=Od.a.Lg($f.data);
$d(new oc(5,$f))},wc,lf,xf,Jc.commandParameters.id)})}pasteRange(A,ca,Ra,Zb,wc,Jc,fd,$d,Be,Re){return new Promise((lf,xf)=>{const $f=fd.commandParameters.stopwatch.Te;Xd.rNj(this.$,A,ca,Ra,Zb|-5&wc,tg=>{Xd.Lmc(tg,fd,lf,xf,$f,this.$,null,!0,Be,Re)},tg=>{fd.serverRequestTimeInMs=fd.commandParameters.stopwatch.Te-$f;tg=Od.a.Lg(tg.data);tg=new oc(5,tg);null===Re||void 0===Re?void 0:Re(tg);xf(tg)},Jc,$d)})}ypj(A,ca,Ra,Zb,wc,Jc,fd){return new Promise(($d,Be)=>{if(ca)if(ca.length>this.QLb){var Re=fd.clipboardItems.getItem(jc.plainText);
let lf=-1;void 0!==Re&&null!==Re&&(lf=Re.length);n.ULS.sendTraceTag(42071712,0,15,`CopyPasteInfrastructure.ProcessPasteHtml copy paste length too long. clipboardHtml.Length: ${ca.length}, MaxHtmlImportLength: ${this.QLb}, PlainTextLength: ${lf}`);Be(new oc(1))}else Re=new Zc.a(204,0,(lf,xf,$f)=>{this.$.iB();const tg=fd.commandParameters.stopwatch.Te;lf=dc.b(lf,ni=>{Xd.Lmc(ni,fd,$d,Be,tg,this.$,ca,!1,null,null)});xf=dc.a(xf,ni=>{fd.serverRequestTimeInMs=fd.commandParameters.stopwatch.Te-tg;ni=Od.a.Lg(ni.data);
Be(new oc(3,ni))});const Vf=this.$.qa.ua.ie(),ug=ec.v(A,this.$),lh={};lh.SourceHtml=ca;lh.DestinationRanges=ug?ec.s(ug):null;lh.CopyOperationId=Ra;lh.PasteId=Zb;lh.AutoAdjustColumnsOn=this.gX();return je(this.$.qa.Ry,lh,lf,xf,$f,null,Vf,Jc)},65),this.$.userOperationManager.enqueueOperation(Re,wc);else $d("")})}gX(){return null==this.fX?!1:this.fX.Yyd()}zpj(A,ca,Ra,Zb,wc){return new Promise((Jc,fd)=>{n.ULS.sendTraceTag(537167754,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: method start. pasteContext.Id=${wc.id}`);
ca&&(ca=Rd.a.trimEnd(ca,"\n","\r"));n.ULS.sendTraceTag(537167753,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after clipboardText.TrimEnd. pasteContext.Id=${wc.id}`);if(ca)if(ca.length>this.sGf)n.ULS.sendTraceTag(24150921,0,15,"CopyPasteInfrastructure.ProcessPasteText copy paste length too long. clipboardText.Length: {0}, MaxCopyPasteLength: {1}",ca.length,this.sGf),fd(new oc(1));else{let Be,Re;const lf=ec.v(A,this.$);n.ULS.sendTraceTag(537167752,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before treatAsLink calculation. pasteContext.Id=${wc.id}`);
var $d=!this.$.ea.isNamedObjectViewMode&&!ca.includes("\n")&&!ca.includes("\t");n.ULS.sendTraceTag(537167751,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before isLink check. pasteContext.Id=${wc.id}. treatAsLink=${$d}`);$d=$d&&Rd.a.Yuf(ca);n.ULS.sendTraceTag(537167750,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after treatAsLink calculation. pasteContext.Id=${wc.id}. treatAsLink=${$d}`);const xf=this.$.qa.ua.ie();if($d){Re=526;n.ULS.sendTraceTag(537167749,0,
50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before FixUpUrl. pasteContext.Id=${wc.id}`);const $f=yd.a.Amd(ca);n.ULS.sendTraceTag(537167748,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after FixUpUrl. pasteContext.Id=${wc.id}`);const tg=ec.s(lf);$d=(Vf,ug,lh)=>{const ni=wc.commandParameters.stopwatch.Te;Vf=dc.b(Vf,oi=>{n.ULS.sendTraceTag(537167747,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: on ApplyHyperlink successCallback. pasteContext.Id=${wc.id}`);
wc.requestTelemetryData=oi.RequestTelemetryData;wc.serverRequestTimeInMs=wc.commandParameters.stopwatch.Te-ni;oi.Errors&&0<oi.Errors.length?fd(new oc(2,oi.Errors)):Jc(ca)});ug=dc.a(ug,oi=>{wc.serverRequestTimeInMs=wc.commandParameters.stopwatch.Te-ni;oi=Od.a.Lg(oi.data);fd(new oc(2,oi))});this.$.iB();n.ULS.sendTraceTag(537167746,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before ApplyHyperlink. pasteContext.Id=${wc.id}`);return Bd.b(this.$.qa.ua,tg,ca,$f,!1,!1,63,Vf,ug,lh,A,xf,
Zb)};Be=()=>new le.a(tg,ca,$f)}else Re=180,$d=($f,tg,Vf)=>{this.$.iB();const ug=wc.commandParameters.stopwatch.Te;$f=dc.b($f,lh=>{n.ULS.sendTraceTag(537167745,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: on PasteString successCallback. pasteContext.Id=${wc.id}`);Xd.Lmc(lh,wc,Jc,fd,ug,this.$,ca,!1,null,null)});tg=dc.a(tg,lh=>{wc.serverRequestTimeInMs=wc.commandParameters.stopwatch.Te-ug;lh=Od.a.Lg(lh.data);fd(new oc(4,lh))});n.ULS.sendTraceTag(537167744,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before PasteString. pasteContext.Id=${wc.id}`);
return Fd(this.$.qa.Ry,lf,ca,this.gX(),$f,tg,Vf,null,xf,Zb)},Be=()=>new Wc(lf,ca);n.ULS.sendTraceTag(537167715,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before UserWebMethodOperation. pasteContext.Id=${wc.id}`);$d=new Zc.a(Re,0,$d,65,Be);n.ULS.sendTraceTag(537167714,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: returning. pasteContext.Id=${wc.id}`);this.$.userOperationManager.enqueueOperation($d,Ra)}else Jc("")})}xnf(A,ca){ca=[1===ca?4:5];this.gridView.Kd.QC(gd.a.jGa(pd.d(this.$.na),
A),ca,!0);this.gridView.Kd.Jt(ca);this.gridView.Kd.update(!0)}Qvd(){const A=[4,5];this.gridView.Kd.cm(A,!1,!1);this.gridView.Kd.kn(null,A,!1);1===this.gridView.ha.Bg&&this.gridView.Jt(!1,!1);this.gridView.Kd.update(!1,!1)}Jch(A,ca,Ra){const Zb=[];for(const wc of Ra)Zb.push(this.Qch(A,ca,wc));return Zb}E0(){if(this.ly)for(let A of this.ly)if(this.$&&this.$.userOperationManager){if(A.operation){const ca=lb.a(A.operation.operationName);n.ULS.sendTraceTag(526758675,0,50,`CopyPasteUtils.AbortOutstandingUserOperation: Trying to abort pending operation ${ca}.`)}this.Qdh();
this.$.userOperationManager.Bya(A)}}Qdh(){if(this.ZSa){const A=this.ZSa.Qw;n.ULS.sendTraceTag(526758674,0,15,`Cancelling pending copy request with Id=${A}`);Od.a.Gx(A);!Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:6151555_DisableCancelCopyRequest")&&this.mtc&&Bd.h(this.$.qa.ua,this.mtc,null,null,null);this.mtc=this.ZSa=null}}Qch(A,ca,Ra){n.ULS.shipAssertTag(537167713,0,!!ca,"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray shouldn't be null");n.ULS.shipAssertTag(537167712,0,0<ca.length,"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray length shouldn't be zero");
let Zb=0,wc=0;var Jc=new Set;const fd=new Set;for(const $d of ca){ca=`${$d.left}_${$d.right}`;const Be=`${$d.top}_${$d.bottom}`;fd.has(ca)||(fd.add(ca),wc+=$d.width);Jc.has(Be)||(Jc.add(Be),Zb+=$d.height)}if(36===A)return Ra.isSingle?Xd.Y5e(wc,Zb,Ra):Ra.clone();516===A&&(A=Zb,Zb=wc,wc=A);A=!(Ra.width%wc)&&!(Ra.height%Zb);Jc=Ra.xQ&&!(Ra.height%Zb);Ra.Q9&&!(Ra.width%wc)||Jc?Ra=Xd.Y5e(wc,Zb,Ra):A?Ra=Ra.clone():(Ra=Ra.clone(),Ra.bottom=Math.min(Eb.a.yh,Ra.top+Zb-1),Ra.right=Math.min(Eb.a.xh,Ra.left+wc-
1));return Ra}R4g(A,ca,Ra,Zb,wc,Jc,fd,$d,Be,Re,lf){if(!Zb||!Zb.length)return 1;if(1<Zb.length){if(!this.Kpc&&Jc)return 3;if(Re)return 0;if($d)return 9;if(Be)return 8;if(lf)return 2;if(1<ca.length)return 4;const xf=ca[0];if(!fd&&!vd.a.all(Zb,$f=>$f.isSingle||!($f.width%xf.width)&&!($f.height%xf.height)))return 5;if((!this.Kpc||!Jc)&&Rd.a.equals(A,Ra,!0))for(const $f of wc)if($f.hf(xf)&&!$f.equals(xf))return 6}else if(ca&&0<ca.length){if(0!==this.Bsf(ca,Be))return 7;if(1<ca.length){if(!this.Kpc&&Jc)return 3;
if((!this.Kpc||!Jc)&&Rd.a.equals(A,Ra,!0))for(const xf of ca)if(A=wc[0],xf.hf(A)&&!xf.equals(A))return 6}}return 0}Bsf(A,ca){if(!A||1>=A.length)return 0;if(ca)return 2;if(!ec.T(A))return 1;ca=new Fc.a(y.a.Fh());for(const Ra of A)for(const Zb of A){const wc=Ra.top===Zb.top&&Ra.bottom===Zb.bottom,Jc=Ra.left===Zb.left&&Ra.right===Zb.right,fd=Math.max(Ra.left,Zb.left)<Math.min(Ra.right,Zb.right);if(Math.max(Ra.top,Zb.top)<Math.min(Ra.bottom,Zb.bottom)&&!wc||fd&&!Jc)return 3;ca.add(`${Ra.top}-${Ra.bottom}-${Zb.left}-${Zb.right}`);
ca.add(`${Zb.top}-${Zb.bottom}-${Ra.left}-${Ra.right}`)}for(const Ra of A)ca.remove(`${Ra.top}-${Ra.bottom}-${Ra.left}-${Ra.right}`);return 0<ca.count?3:0}Mvj(A){const ca=this.gridView.ha;ca.updateSelection(A,A.topLeft,0);ca.selectionType=-1}t$a(A){if(null===A||void 0===A?0:A.sourceItem){if(!ib(A.sourceItem))return null;if((A=A.sourceItem)&&ec.db(A.ranges,!0))return A}return null}dIb(A,ca){n.ULS.shipAssertTag(537167711,0,!!A,"CopyPasteUtils.IsFromKeyboardShortcut: commandInfo shouldn't be null");
return ca&&Hc.a.BG in ca||A.tabName?!1:1===A.method}static rNj(A,ca,Ra,Zb,wc,Jc,fd,$d,Be){const Re=A.qa.ua.ie(Be?{cqa:!0,Qoa:1}:{cqa:!1,Qoa:0});Be=new Zc.a(506,0,(lf,xf,$f)=>{A.iB();var tg=A.qa.ua;lf=dc.b(lf,Jc);xf=dc.a(xf,fd);var Vf=$d;Vf=void 0===Vf?null:Vf;const ug=tg.Pa(9,Re);ug.sourceRanges=Ra;ug.destinationRanges=Zb;ug.flags=wc;return Bd.g(tg,"PasteRange",ug,lf,xf,$f,null,64,Vf)},65,()=>new Gb(Ra,Zb,wc));A.userOperationManager.enqueueOperation(Be,ca)}static Lmc(A,ca,Ra,Zb,wc,Jc,fd,$d,Be,Re){fd=
void 0===fd?null:fd;n.ULS.sendTraceTag(537167710,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: on HandlePasteResult start. pasteContext.Id=${ca.id}`);ca.requestTelemetryData=A.RequestTelemetryData;ca.serverRequestTimeInMs=ca.commandParameters.stopwatch.Te-wc;ge.a.ph(A.Errors)?ge.a.qla(A.Errors)?(ca&&(ca.encounteredDeploymentErrors=!0),A=ge.a.ue(A.Errors),n.ULS.sendTraceTag(537167707,0,15,`CopyPasteUtils.HandlePasteServerResponse: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${A}`)):
(A=new oc(5,A.Errors),null===Re||void 0===Re?void 0:Re(A),Zb(A)):A.Result?(Zb=!!A&&!!A.RequestTelemetryData,U.h(Jc).fj.dqa(ca.commandParameters.stopwatch.id,A.StateId,Zb?A.RequestTelemetryData.EcsOperationDuration:0,Zb?A.RequestTelemetryData.EcsRequestDuration:0,Zb?A.RequestTelemetryData.WfeRequestDuration:0),Zb=A.Result,ca.pastedRange=Zb.SheetMultiRange,n.ULS.sendTraceTag(537167708,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise ewaResult.Result is not null. pasteContext.Id=${ca.id}`),
null===Be||void 0===Be?void 0:Be(),Ra(!0),Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",!1)&&$d&&!ca.commandParameters.isDragDrop?(ca=Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Migrate2OptimizeWorkbookManager",!1)?ab.a.zg(Wb.bc):Jc.ga.Da(465))&&ca.uba(6,A):he.a.Xoa()&&Zb.AutoAdjustedColumns&&void ab.a.resolve(Wb.j,{Ja:1}).then(lf=>{lf.sLf("Paste")})):(n.ULS.sendTraceTag(537167709,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise when ewaResult.Result is null. pasteContext.Id=${ca.id}`),
Ra(fd||!0))}static A_d(A,ca,Ra,Zb,wc,Jc,fd,$d,Be,Re,lf,xf){const $f=A.qa.ua.ie(),tg=Xd.PTe(Ra,Zb,wc,Re,lf,xf);Ra=new Zc.a(503,0,(Vf,ug,lh)=>{A.iB();return Ad(A.qa.ua,tg,dc.b(Vf,fd),dc.a(ug,$d),lh,Jc,$f,Be)},65,()=>new fe(tg));A.userOperationManager.enqueueOperation(Ra,ca)}static PTe(A,ca,Ra,Zb,wc,Jc){const fd={};fd.ShadowWorkbookBase64=A.shadowWorkbookBase64;fd.SourceRanges={};fd.SourceRanges.Ranges=Array(1);fd.SourceRanges.Ranges[0]={};fd.SourceRanges.Ranges[0].FirstRow=A.rangeRowStart;fd.SourceRanges.Ranges[0].LastRow=
A.rangeRowEnd;fd.SourceRanges.Ranges[0].FirstColumn=A.rangeColumnStart;fd.SourceRanges.Ranges[0].LastColumn=A.rangeColumnEnd;Sb.EwaSettings.getBooleanFeatureGate(Va.a.Yyb,!1)?Ra?fd.DestinationRanges=ec.u(Ra.SheetName,Ra.NamedObjectName,ec.g(Ra.Ranges)):(n.ULS.sendTraceTag(537167706,0,15,"CopyPasteInfrastructure.CreatePasteParameters: multiRangeDestination is null"),fd.DestinationRanges=null):fd.DestinationRanges=ca?ec.s(ca):null;fd.CopyPasteTargetType=1;fd.PasteType=Zb;fd.CopyOperationId=wc;fd.PasteId=
Jc;fd.SourceClientPath=A.sourceClientPath;fd.SourceSheetName=A.sourceSheetName;fd.SourceWorkbookName=A.sourceWorkbookName;if(!A.originalSourceRangesCountExceedsLimit&&A.originalSourceRanges&&0<A.originalSourceRanges.length&&1024===Zb){fd.OriginalSourceMultiRange={};ca=Array(A.originalSourceRanges.length);for(Ra=0;Ra<ca.length;++Ra)ca[Ra]={},ca[Ra].FirstRow=A.originalSourceRanges[Ra][0],ca[Ra].FirstColumn=A.originalSourceRanges[Ra][1],ca[Ra].LastRow=A.originalSourceRanges[Ra][2],ca[Ra].LastColumn=
A.originalSourceRanges[Ra][3];fd.OriginalSourceMultiRange.Ranges=ca}return fd}static Y5e(A,ca,Ra){Ra=Ra.clone();Ra.height<ca&&(Ra.bottom=Math.min(Eb.a.yh,Ra.top+ca-1));Ra.width<A&&(Ra.right=Math.min(Eb.a.xh,Ra.left+A-1));return Ra}GYj(A,ca,Ra){return(A=U.h(A).zd.sh(Ra))?ca.width===A.usedRange.width&&Ra.left===A.usedRange.left||Ra.left===A.usedRange.left&&Ra.right===A.usedRange.right&&0===Ra.width%ca.width:!1}FYj(A,ca,Ra){return(A=U.h(A).zd.sh(Ra))?ca.height===A.usedRange.height&&Ra.top===A.usedRange.top||
Ra.top===A.usedRange.top&&Ra.bottom===A.usedRange.bottom&&0===Ra.height%ca.height:!1}executeInsertCopiedCutCellsOperation(A,ca,Ra,Zb,wc,Jc,fd){Jc=void 0===Jc?null:Jc;fd=void 0===fd?null:fd;const $d={};$d.InsertDirection=Zb;$d.SourceRange=A;$d.DestRange=ca;$d.CopyCutOperation=Ra?0:1;const Be=this.$.qa.ua,Re=this.$.qa.ua.ie(),lf=()=>new wd($d);return Ld.a(this.$.userOperationManager,(xf,$f,tg)=>{xf=Jc?dc.b(xf,Jc):xf;$f=fd?dc.a($f,fd):$f;const Vf=Be.Pa(41,null);Vf.insertCopiedCutCellsParameters=$d;return Bd.g(Be,
"InsertCopiedCutCellsV2",Vf,xf,$f,tg,Re,0)},xf=>new Zc.a(104,0,xf,void 0,lf),wc)}gZe(A,ca,Ra,Zb,wc,Jc,fd,$d){return new Promise((Be,Re)=>{this.executeInsertCopiedCutCellsOperation(ca,Ra,Zb,wc,Jc,lf=>{A.requestTelemetryData=lf.RequestTelemetryData;if(lf.Errors&&0<lf.Errors.length){const xf=new oc(21,lf.Errors);null===$d||void 0===$d?void 0:$d(xf);Re(new oc(21,lf.Errors))}else null===fd||void 0===fd?void 0:fd(),Be(!0)},lf=>{lf=Od.a.Lg(lf.data);lf=new oc(21,lf);null===$d||void 0===$d?void 0:$d(lf);Re(lf)})})}executeInsertCopiedCutCellsAcrossSession(A,
ca,Ra,Zb,wc,Jc,fd,$d,Be,Re,lf){Jc=void 0===Jc?null:Jc;fd=void 0===fd?null:fd;let xf={};xf.PasteParameters=Xd.PTe(Re,$d,Be,2,lf.copyContextSnapshot.commandParameters.id,lf.commandParameters.id);xf.InsertDirection=Zb;xf.SourceRange=A;xf.DestRange=ca;xf.CopyCutOperation=Ra?0:1;const $f=this.$.qa.ua,tg=this.$.qa.ua.ie(),Vf=()=>new wd(xf);return Ld.a(this.$.userOperationManager,(ug,lh,ni)=>{ug=Jc?dc.b(ug,Jc):ug;lh=fd?dc.a(lh,fd):lh;const oi=$f.Pa(41,null);oi.insertCopiedCutCellsParameters=xf;return Bd.g($f,
"InsertCopiedCutCellsCrossSession",oi,ug,lh,ni,tg,0)},ug=>new Zc.a(106,0,ug,void 0,Vf),wc)}}Object(l.a)(Xd,"CopyPasteUtils",null,[341]);var Ie=a(440),We;(function(A){A[A.range=0]="range";A[A.art=1]="art"})(We||(We={}));Object(l.b)("SourceItemType",We);var jf=a(93);class tc{constructor(A){this.aog={["SourceItemType.Range"]:0,["SourceItemType.Art"]:1};this.ZVb={};this.Xng={["FloatingObjectType.Unknown"]:99,["FloatingObjectType.CardView"]:6,["FloatingObjectType.Chart"]:0,["FloatingObjectType.Group"]:7,
["FloatingObjectType.Image"]:1,["FloatingObjectType.Ink"]:8,["FloatingObjectType.InteractiveReport"]:4,["FloatingObjectType.ModernOfficeExtension"]:3,["FloatingObjectType.Shape"]:5,["FloatingObjectType.Slicer"]:2,["FloatingObjectType.Unsupported"]:100};this.L7c={["99"]:"FloatingObjectType.Unknown",["6"]:"FloatingObjectType.CardView",["0"]:"FloatingObjectType.Chart",["7"]:"FloatingObjectType.Group",["1"]:"FloatingObjectType.Image",["8"]:"FloatingObjectType.Ink",["4"]:"FloatingObjectType.InteractiveReport",
["3"]:"FloatingObjectType.ModernOfficeExtension",["5"]:"FloatingObjectType.Shape",["2"]:"FloatingObjectType.Slicer",["100"]:"FloatingObjectType.Unsupported"};this.$ng={["RibbonCommand.Copy"]:-911352779,["RibbonCommand.Cut"]:-1985798686};this.BYd={["-911352779"]:"RibbonCommand.Copy",["-1985798686"]:"RibbonCommand.Cut"};this.Zng={["InputManager.InputMethod.NotDefined"]:-1,["InputManager.InputMethod.Unknown"]:0,["InputManager.InputMethod.Keyboard"]:1,["InputManager.InputMethod.Mouse"]:2,["InputManager.InputMethod.Touch"]:3,
["InputManager.InputMethod.CrossSlide"]:9};this.Noa={};this.Yng={["FrameMode.None"]:0,["FrameMode.Reading"]:1,["FrameMode.Edit"]:2};this.i9a={};this.bog={["UILocation.Unknown"]:0,["UILocation.UpperRibbon"]:1,["UILocation.Ribbon"]:2,["UILocation.QAT"]:3,["UILocation.Jewel"]:4,["UILocation.NavigationPane"]:5,["UILocation.KeyboardShortcut"]:6,["UILocation.StatusBar"]:7,["UILocation.Dialog"]:8,["UILocation.Floatie"]:9,["UILocation.NotificationBar"]:10,["UILocation.StandaloneCuiRoot"]:11,["UILocation.TaskPane"]:12,
["UILocation.HeroDock"]:13,["UILocation.SingleLineRibbon"]:14,["UILocation.MultilineRibbon"]:15,["UILocation.Overflow"]:16,["UILocation.TellMe"]:17,["UILocation.FarPeripheralControls"]:18,["UILocation.ContextMenu"]:19,["UILocation.DialogMenu"]:20,["UILocation.Header"]:21,["UILocation.FileMenu"]:22,["UILocation.Toolbar"]:26,["UILocation.Canvas"]:30};this.wu={};this.$=A;this.Noa.notDefined="InputManager.InputMethod.NotDefined";this.Noa.unknown="InputManager.InputMethod.Unknown";this.Noa.keyboard="InputManager.InputMethod.Keyboard";
this.Noa.mouse="InputManager.InputMethod.Mouse";this.Noa.touch="InputManager.InputMethod.Touch";this.Noa.crossSlide="InputManager.InputMethod.CrossSlide";this.i9a.none="FrameMode.None";this.i9a.reading="FrameMode.Reading";this.i9a.edit="FrameMode.Edit";this.wu.unknown="UILocation.Unknown";this.wu.upperRibbon="UILocation.UpperRibbon";this.wu.ribbon="UILocation.Ribbon";this.wu.QAT="UILocation.QAT";this.wu.jewel="UILocation.Jewel";this.wu.navigationPane="UILocation.NavigationPane";this.wu.keyboardShortcut=
"UILocation.KeyboardShortcut";this.wu.statusBar="UILocation.StatusBar";this.wu.dialog="UILocation.Dialog";this.wu.floatie="UILocation.Floatie";this.wu.notificationBar="UILocation.NotificationBar";this.wu.standaloneCuiRoot="UILocation.StandaloneCuiRoot";this.wu.taskPane="UILocation.TaskPane";this.wu.heroDock="UILocation.HeroDock";this.wu.singleLineRibbon="UILocation.SingleLineRibbon";this.wu.multilineRibbon="UILocation.MultilineRibbon";this.wu.overflow="UILocation.Overflow";this.wu.tellMe="UILocation.TellMe";
this.wu.farPeripheralControls="UILocation.FarPeripheralControls";this.wu.header="UILocation.Header";this.wu.fileMenu="UILocation.FileMenu";this.wu.contextMenu="UILocation.ContextMenu";this.wu.dialogMenu="UILocation.DialogMenu";this.wu.toolbar="UILocation.Toolbar";this.wu.canvas="UILocation.Canvas";this.ZVb.range="SourceItemType.Range";this.ZVb.art="SourceItemType.Art"}serializeSourceItem(A){const ca={};if(A&&Object.getType(A)===Ta)ca.sheetName=A.sheetName,ca.topArray=vd.a.map(A.ranges,Ra=>Ra.top),
ca.leftArray=vd.a.map(A.ranges,Ra=>Ra.left),ca.bottomArray=vd.a.map(A.ranges,Ra=>Ra.bottom),ca.rightArray=vd.a.map(A.ranges,Ra=>Ra.right),ca.sessionStateId=A.sessionStateId,ca.sessionId=A.sessionId,ca.sourceItemType=this.Pdg(0);else if(A&&Object.getType(A)===Hb)ca.activeFloatingObjectControlId=A.activeFloatingObjectControlId,ca.sheetName=A.sheetName,ca.sessionStateId=A.sessionStateId,ca.sessionId=A.sessionId,ca.floatingObjectType=this.TNj(A.type),ca.sourceItemType=this.Pdg(1);else return n.ULS.shipAssertTag(537167705,
0,!1,"EnvironmentSerializationHelper.SerializeSourceItem: sourceItem shouldn't be null."),null;return JSON.stringify(ca)}serializeCommandParameters(A){if(!A)return n.ULS.shipAssertTag(537167704,0,!1,"EnvironmentSerializationHelper.Serialize: commandParameters shouldn't be null."),null;const ca={};ca.id=A.id;ca.commandType=A.commandType;ca.copyPasteTargetType=A.copyPasteTargetType;A.ribbonCommandInfo&&(ca.ribbonCommandName=this.cOj(A.ribbonCommandInfo.command),ca.inputMethodName=this.XNj(A.ribbonCommandInfo.method),
ca.frameModeName=this.VNj(A.ribbonCommandInfo.mode),ca.uiLocationName=this.fOj(A.ribbonCommandInfo.Tg),ca.tabName=A.ribbonCommandInfo.tabName);return JSON.stringify(ca)}deserializeSourceItem(A){if(!A)return null;try{const ca=JSON.parse(A);if(!ca)return n.ULS.shipAssertTag(537167703,0,!1,"EnvironmentSerializationHelper.Deserialize: Json.Parse return null result."),null;let Ra=null;switch(this.Dyh(ca.sourceItemType)){case 0:Ra=new Ta(this.$,this.Ayh(ca),ca.sheetName,ca.sessionStateId,ca.sessionId);
break;case 1:Ra=new Hb(ca.activeFloatingObjectControlId,ca.sheetName,ca.sessionStateId,ca.sessionId,this.xyh(ca.floatingObjectType))}return Ra}catch(ca){return n.ULS.sendTraceTag(537167702,0,10,`EnvironmentSerializationHelper.DeserializeSourceItem: got exception while try to JSON.Parse string length: ${A?A.length:0}, errror: ${ca}`),null}}deserializeCommandParameters(A){if(!A)return null;try{const ca=JSON.parse(A);if(!ca)return n.ULS.shipAssertTag(537167701,0,!1,"EnvironmentSerializationHelper.DeserializeCommandParameters: Json.Parse return null result."),
null;const Ra=yb.a();Ra.id=ca.id;Ra.ribbonCommandInfo=this.Cyh(ca);Ra.commandType=ca.commandType;Ra.copyPasteTargetType=ca.copyPasteTargetType;return Ra}catch(ca){return n.ULS.sendTraceTag(537167700,0,10,`EnvironmentSerializationHelper.DeserializeCommandParameters: got exception while try to JSON.Parse string length: ${A?A.length:0}, errror: ${ca}`),null}}Ayh(A){const ca=[];n.ULS.shipAssertTag(537167699,0,!!A.topArray&&0<A.topArray.length,`EnvironmentSerializationHelper.DeserializeRanges: TopArray shouldn't be ${A.topArray?
"empty":"null"}.`);n.ULS.shipAssertTag(537167698,0,!!A.leftArray&&0<A.leftArray.length,`EnvironmentSerializationHelper.DeserializeRanges: LeftArray shouldn't be ${A.leftArray?"empty":"null"}.`);n.ULS.shipAssertTag(537167697,0,!!A.bottomArray&&0<A.bottomArray.length,`EnvironmentSerializationHelper.DeserializeRanges: BottomArray shouldn't be ${A.bottomArray?"empty":"null"}.`);n.ULS.shipAssertTag(537167696,0,!!A.rightArray&&0<A.rightArray.length,`EnvironmentSerializationHelper.DeserializeRanges: RightArray shouldn't be ${A.rightArray?
"empty":"null"}.`);if(!(A.topArray&&A.leftArray&&A.bottomArray&&A.rightArray))return ca;n.ULS.shipAssertTag(537167695,0,A.topArray.length===A.bottomArray.length&&A.topArray.length===A.leftArray.length&&A.topArray.length===A.rightArray.length,`EnvironmentSerializationHelper.DeserializeRanges: The length of TopArray(${A.topArray.length}), BottomArray(${A.bottomArray.length}), LeftArray(${A.leftArray.length}), RightArray(${A.rightArray.length}) should be the same.`);const Ra=Math.min(A.topArray.length,
A.bottomArray.length,A.leftArray.length,A.rightArray.length);for(let Zb=0;Zb<Ra;Zb++)ca.push(new Kb.Range(A.topArray[Zb],A.leftArray[Zb],A.bottomArray[Zb],A.rightArray[Zb],!1,!1));return ca}Cyh(A){return new jf.a(this.Byh(A.ribbonCommandName),this.zyh(A.inputMethodName),this.yyh(A.frameModeName),this.Fyh(A.uiLocationName),A.tabName)}cOj(A){return void 0!==A&&null!==A&&A.toString()in this.BYd?this.BYd[A.toString()]:(n.ULS.shipAssertTag(537167694,0,!1,`EnvironmentSerializationHelper.SerializeRibbonCommand expected to get RibbonCommand.Copy(${-911352779}) or RibbonCommand.Cut(${-1985798686}) but got ${A}`),
this.BYd["-911352779"])}Byh(A){return A&&A in this.$ng?this.$ng[A]:(n.ULS.shipAssertTag(537167693,0,!1,`EnvironmentSerializationHelper.DeserializeRibbonCommand: expected to get RibbonCommand.Copy(${-911352779}) or RibbonCommand.Cut(${-1985798686}) but got ${A}`),-911352779)}XNj(A){return void 0!==A&&null!==A&&ra.a[A]in this.Noa?this.Noa[ra.a[A]]:(n.ULS.shipAssertTag(537167692,0,!1,`EnvironmentSerializationHelper.SerializeInputMethod: got unexpected value ${A}`),this.Noa.unknown)}zyh(A){return A&&
A in this.Zng?this.Zng[A]:(n.ULS.shipAssertTag(537167691,0,!1,`EnvironmentSerializationHelper.DeserializeInputMethod: got unexpected value ${A}`),0)}VNj(A){return void 0!==A&&null!==A&&Ie.a[A]in this.i9a?this.i9a[Ie.a[A]]:(n.ULS.shipAssertTag(537167690,0,!1,`EnvironmentSerializationHelper.SerializeFrameMode: got unexpected value ${A}`),this.i9a.edit)}yyh(A){return A&&A in this.Yng?this.Yng[A]:(n.ULS.shipAssertTag(537167689,0,!1,`EnvironmentSerializationHelper.DeserializeFrameMode: got unexpected value ${A}`),
2)}Pdg(A){return void 0!==A&&null!==A&&We[A]in this.ZVb?this.ZVb[We[A]]:(n.ULS.shipAssertTag(537167688,0,!1,`EnvironmentSerializationHelper.SerializeSourceItemType: got unexpected value ${A}`),this.ZVb.range)}Dyh(A){return A&&A in this.aog?this.aog[A]:(n.ULS.shipAssertTag(537167687,0,!1,`EnvironmentSerializationHelper.DeserializeSourceItemType: got unexpected value ${A}`),0)}TNj(A){return void 0!==A&&null!==A&&A.toString()in this.L7c?this.L7c[A.toString()]:(n.ULS.shipAssertTag(537167686,0,!1,`EnvironmentSerializationHelper.SerializeArtSourceItemType: got unexpected value ${A}`),
this.L7c["99"])}xyh(A){return A&&A in this.Xng?this.Xng[A]:(n.ULS.shipAssertTag(537167685,0,!1,`EnvironmentSerializationHelper.DeserializeArtSourceItemType: got unexpected value ${A}`),99)}fOj(A){return void 0!==A&&null!==A&&rb.a[A]in this.wu?this.wu[rb.a[A]]:(n.ULS.shipAssertTag(36229129,0,!1,`EnvironmentSerializationHelper.SerializeUILocation: got unexpected value ${A}`),this.wu.ribbon)}Fyh(A){return A&&A in this.bog?this.bog[A]:(n.ULS.shipAssertTag(537167684,0,!1,`EnvironmentSerializationHelper.DeserializeUILocation: got unexpected value ${A}`),
2)}}Object(l.a)(tc,"EnvironmentSerializationHelper",null,[]);class Qc{}Qc.jbg="SameSession";Qc.nfd="CrossSession";Qc.$Af="LegacyCrossSession";Qc.external="External";Object(l.a)(Qc,"PayloadOrigin",null,[]);const xd=A=>A?A.shadowWorkbookSizeExceedsLimit&&void 0!==A.shadowWorkbookBlockedSize&&null!==A.shadowWorkbookBlockedSize?A.shadowWorkbookBlockedSize:A.shadowWorkbookBase64?A.shadowWorkbookBase64.length:0:0,Gd=A=>A.shadowWorkbookSizeExceedsLimit?!0:xd(A)>Eb.a.vvc;var pe=a(67),Dc=a(165),Wa=a(110);
class Qb{constructor(A,ca,Ra){Ra=void 0===Ra?null:Ra;this.hLa=!1;this._name=ca;this.$=A;this.Bo=Ub.a.instance;this.pq=new Xd(A,U.h(A));this.Dcc=Ra}get name(){return this._name}get O7c(){return this.Bo.Ia(5)}shouldWaitForCopyToComplete(){return!1}onDeferredPasteStarted(){}onDeferredPasteCompleted(){}beforePaste(){}Ndk(A){let ca;ca=null;try{const Ra=A.getItem(jc.shadowWorkbook);if(!Ra)return{returnValue:!1,k_:ca};ca=JSON.parse(Ra);return{returnValue:this.gMi(ca),k_:ca}}catch(Ra){return n.ULS.sendTraceTag(537167835,
0,50,"BaseCopyPasteHandler.TryParseRangeShadowWorkbookPayload: Exception caught: "+Ra),{returnValue:!1,k_:ca}}}gMi(A){return!!A&&(!!A.shadowWorkbookBase64||A.shadowWorkbookSizeExceedsLimit)&&void 0!==A.rangeRowStart&&void 0!==A.rangeRowEnd&&void 0!==A.rangeColumnStart&&void 0!==A.rangeColumnEnd}Zzc(A){A.wasLastCopyExternal=!0;Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SetDefaultPaste",!1)&&A.commandParameters.isPasteDefault&&this.$.shortcutKeyManager&&(A.commandParameters.commandType=
-185374993===this.$.shortcutKeyManager.sec?20:4);if(Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!Y.a.XD&&516!==A.commandParameters.commandType&&1028!==A.commandParameters.commandType){let ca=null;if((()=>{let Ra=this.Ndk(A.clipboardItems);({k_:ca}=Ra);return Ra})().returnValue)return A.isShadowWorkbookParsedSuccessfully=!0,this.Yjj(A,ca)}if(516!==A.commandParameters.commandType&&36!==A.commandParameters.commandType&&4100!==A.commandParameters.commandType){if(20!==
A.commandParameters.commandType){const ca=A.clipboardItems.getItem(jc.html),Ra=!(void 0===ca||null===ca)&&!!ca&&ca.trim()!==this.O7c&&(ca.startsWith("<")||Y.a.vh&&ca.startsWith("\n<")),Zb=A.clipboardItems.getItem(jc.xdd),wc=Dc.f(A.clipboardItems.getItem(jc.plainText));return!Ra||!Zb&&wc?(wc&&n.ULS.sendTraceTag(508863578,0,50,"BaseCopyPasteHandler.pasteFromExternal: Pasting a formula as plaintext"),this.MPd(A)):this.Wjj(A,ca,void 0===Zb?null:Zb)}return this.MPd(A)}return Promise.reject(new oc(6))}Yjj(A,
ca){n.ULS.sendTraceTag(537167834,0,50,"BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: Pasting shadow workbook from system clipboard");A.pasteResult="SystemClipboardShadowWorkbookPaste";A.payloadType=hb.shadowWorkbook;A.payloadOrigin=Qc.external;A.shadowWorkbookPayloadSize=xd(ca);A.shadowWorkbookSizeExceedsLimit=Gd(ca);let Ra=null,Zb=null;const wc=A.commandParameters.originalDestinations;Sb.EwaSettings.getBooleanFeatureGate(Va.a.Yyb,!1)?Ra=ec.r(wc,this.$):Zb=ec.v(ec.L(wc),this.$);ca.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&
(A.originalSourceRangesCountExceedsLimit=ca.originalSourceRangesCountExceedsLimit);if(A.shadowWorkbookSizeExceedsLimit)return n.ULS.sendTraceTag(537167833,0,15,`BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: shadow workbook length(${A.shadowWorkbookPayloadSize}) is over the limit(${Eb.a.vvc}). reject the paste request. ShadowWorkbookSizeExceedsLimit: ${ca.shadowWorkbookSizeExceedsLimit}`),Promise.reject(new oc(1));n.ULS.sendTraceTag(537167832,0,50,`BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: trigger Paste request. PasteOperationId=${A.commandParameters.id}`);
return this.pq.EXf(A.commandParameters.ribbonCommandInfo,Zb,Ra,ca,[A.commandParameters.stopwatch],A)}MPd(A){var ca=A.clipboardItems.getItem(jc.plainText);if(void 0!==ca&&null!==ca&&ca.trim()===this.O7c)return Promise.reject(new oc(7));void 0!==ca&&null!==ca&&(A.plainTextPayloadSize=ca.length);let Ra=!1;Va.a.eTh&&null!==this.Dcc&&(Ra=this.Dcc.r6g(A,Rd.a.trimEnd(ca,"\n","\r"),ec.L(A.commandParameters.originalDestinations)));Ra&&U.h(this.$).fj.JR(A.commandParameters.stopwatch.id,pe.BasicTelemetryCalculator.nQ);
this.hLa||(this.hLa=!0,Wa.b("AutoAdjustColumnWidthTriggered"));A.isPlainTextPaste=!0;A.pasteResult="SystemClipboardPaste";A.payloadOrigin=Ha(A)?Qc.$Af:Qc.external;A.payloadType=hb.plainText;n.ULS.sendTraceTag(537167831,0,50,`BaseRangeCopyPasteHandler.PasteByPlainText: trigger ProcessPasteText request. pasteContext.Id=${A.id}, PasteOperationId=${A.commandParameters.id}`);ca=this.pq.zpj(ec.L(A.commandParameters.originalDestinations),ca,A.commandParameters.ribbonCommandInfo,[A.commandParameters.stopwatch],
A);n.ULS.sendTraceTag(537167830,0,50,`BaseRangeCopyPasteHandler.PasteByPlainText: returned from ProcessPasteText. pasteContext.Id=${A.id}`);return ca}Wjj(A,ca,Ra){this.hLa||(this.hLa=!0,Wa.b("AutoAdjustColumnWidthTriggered"));A.htmlPayloadSize=ca.length;A.isHtmlPaste=!0;A.pasteResult="SystemClipboardHtmlPaste";A.payloadType=hb.html;A.payloadOrigin=Ha(A)?Qc.$Af:Qc.external;n.ULS.sendTraceTag(42071711,0,50,`BaseRangeCopyPasteHandler.PasteByHtml: trigger ProcessPasteHtml request. PasteOperationId=${A.commandParameters.id}`);
return this.pq.ypj(ec.L(A.commandParameters.originalDestinations),ca,Ra,A.commandParameters.id,A.commandParameters.ribbonCommandInfo,[A.commandParameters.stopwatch],A)}jUe(A){const ca={};A&&(ca.shadowWorkbookBase64=A.ShadowWorkbookBase64,ca.shadowWorkbookSizeExceedsLimit=A.ShadowWorkbookSizeExceedsLimit,ca.originalSourceRangesCountExceedsLimit=A.OriginalSourceRangesCountExceedsLimit,ca.originalSourceRangesCount=A.OriginalSourceRangesCount,ca.shadowWorkbookBlockedSize=A.ShadowWorkbookBlockedSize);
return ca}Txg(A,ca){const Ra=sc(A),Zb=32===(A.commandParameters.commandType&32),wc=1024===(A.commandParameters.commandType&1024);let Jc=!1,fd=null,$d=null,Be=!1;if(!Ra){Jc=-1985798686===A.commandParameters.ribbonCommandInfo.command;var Re=A.copyContextSnapshot;if(ca)Be=!Re.sourceItem.isFromCurrentSession(this.$);else if(Re=this.pq.t$a(Re))fd=Re.ranges,$d=Re.sheetName,Be=!A.isSameSession}return this.pq.R4g($d,fd,this.$.na.sheetName,A.commandParameters.originalDestinations,A.commandParameters.expandDestinations,
Be,Zb,wc,Jc,ca,Ra)}}Object(l.a)(Qb,"BaseCopyPasteHandler",null,[408,409,410]);class Lc{constructor(A){this.clipboardItems=this.key=null;this.Tda=A}uAa(A){return this.key&&this.key.isEqual(A)?this.createClipboardItems(this.clipboardItems):null}setValue(A,ca){this.key=A;this.clipboardItems=this.createClipboardItems(ca)}createClipboardItems(A){const ca=this.Tda.create();var Ra=A.getItem(jc.plainText);Ra&&ca.setItem(jc.plainText,Ra);(Ra=A.getItem(jc.shadowWorkbook))&&ca.setItem(jc.shadowWorkbook,Ra);
(A=A.getItem(jc.html))&&ca.setItem(jc.html,A);return ca}}Object(l.a)(Lc,"CopyCache",null,[]);class Ba extends Qb{constructor(A,ca,Ra,Zb,wc){wc=void 0===wc?null:wc;super(A,Zb,ca);this.Dcc=ca;this.Tda=Ra;this.vdd=wc||new Lc(this.Tda);this.gridView=U.h(A);this.ha=this.gridView.ha;this.clipboardRangeFactory=A.ga.Da(169)}getSourceItem(){const A=ec.d(this.gridView.ha.ra.selectedRanges);return new Ta(this.$,A,this.$.ea.na.sheetName,this.$.ea.xg,this.$.xa.UserSessionId)}beforeSerialize(A){A.isSelectionAllowed=
!1;A.isAsyncCopy=!1;A.isFromCache=!1;A.encounteredDeploymentErrors=!1;A.plainTextPayloadSize=0;A.shadowWorkbookPayloadSize=0;A.htmlPayloadSize=0;A.clientSideCopyTime=0;const ca=new Dd.a(this.$.va),Ra=A.sourceItem;A.isSelectionAllowed=vd.a.all(Ra.ranges,Zb=>this.isSelectionAllowed(ca,Zb));A.isSelectionAllowed&&this.pq.xnf(Ra.ranges,A.commandParameters.commandType)}mSa(A){return this.gridView.ya.k9()&&U.j(this.gridView,A)}xkj(A,ca,Ra,Zb){let wc=!1,Jc=1===ca.commandParameters.commandType,fd=Zb[0].Uw;
1===Ra.ranges.length&&1===Zb.length?Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests1")&&Jc&&1!==fd&&fd!==Ra.ranges[0].Uw?A.cseStatus=17:wc=this.Dcc.Bhd(A,ec.L(Ra.ranges),Ra.sheetName,ec.L(A.commandParameters.expandDestinations),this.$.ea.na.sheetName,Jc):A.cseStatus=5;wc&&U.h(this.$).fj.JR(A.commandParameters.stopwatch.id,pe.BasicTelemetryCalculator.nQ);return this.ekj(A,Ra,ec.u(this.$.na.sheetName,null,Zb),ca.commandParameters.commandType,wc)}isSelectionAllowed(A,ca){return A.pJb(ca,
this.gridView)}ekj(A,ca,Ra,Zb,wc){ca=ec.u(ca.sheetName,null,ca.ranges);A.pasteResult="SameSessionPaste";A.payloadOrigin=Qc.jbg;A.payloadType=hb.WTg;n.ULS.sendTraceTag(537167829,0,50,`BaseRangeCopyPasteHandler.PasteSameSession: trigger PasteRange request. PasteOperationId=${A.commandParameters.id}`);return this.pq.pasteRange(A.commandParameters.ribbonCommandInfo,ca,Ra,Zb,A.commandParameters.commandType,[A.commandParameters.stopwatch],A,wc,null,null)}}Object(l.a)(Ba,"BaseRangeCopyPasteHandler",Qb,[]);
var qa=a(40);class gb{constructor(A){this.MX=new qa.a(!0);this.$=A}onDeferredPasteStarted(A){this.MX.kd(A.id)||this.MX.add(A.id,!0);if(0<this.MX.count){const ca=Object(xc.a)("OfficeVSO:7811663_ConvertBusinessBarManagerService2")?Object(Bc.d)(ab.a.resolve(Wb.m,{Ja:0})):$c.GetServiceTaskFactory.ud(this.$.ga,5,4,0);Jd.TaskExtensions.za(ca,()=>{ca.result.yi(28,null)},this.$.ka,3)}}onDeferredPasteCompleted(A){const ca=0<this.MX.count;this.MX.kd(A.id)&&this.MX.remove(A.id);if(ca&&!this.MX.count){const Ra=
Object(xc.a)("OfficeVSO:7811663_ConvertBusinessBarManagerService2")?Object(Bc.d)(ab.a.resolve(Wb.m,{Ja:0})):$c.GetServiceTaskFactory.ud(this.$.ga,5,4,0);Jd.TaskExtensions.za(Ra,()=>{Ra.result.removeEntry(28)},this.$.ka,3)}}}Object(l.a)(gb,"DeferredPasteTracker",null,[]);var Bb;(function(A){A[A.none=0]="none";A[A.loadClipboardFromServerFailed=1]="loadClipboardFromServerFailed";A[A.loadCopiedDataFromServerFailed=2]="loadCopiedDataFromServerFailed";A[A.asyncCopyCanceled=3]="asyncCopyCanceled";A[A.loadCopiedArtDataFromServerFailed=
4]="loadCopiedArtDataFromServerFailed"})(Bb||(Bb={}));Object(l.b)("CopyErrorType",Bb);class ic extends Ce{constructor(A,ca){ca=void 0===ca?null:ca;super(Bb[A]);this.copyErrorName=0;this.ewaErrors=null;this.copyErrorName=A;this.ewaErrors=ca;if(null===ca||void 0===ca?0:ca.length)this.innerError=new Xb(ca,null)}}Object(l.a)(ic,"CopyInnerError",Ce,[]);var Cc=a(131);class hd extends Ba{constructor(A,ca,Ra,Zb){super(A,ca,Ra,"AcrossSessionRangeCopyPasteHandler",void 0===Zb?null:Zb);this.MX=new gb(A)}serialize(A){const ca=
A.sourceItem,Ra={};let Zb=this.vdd.uAa(ca);if(Zb)Ra.synchronousResult=Zb,A.isFromCache=!0,A.clientSideCopyTime=A.commandParameters.stopwatch.Te;else{let Jc=null;var wc=ec.G(ca.ranges);if(!he.a.suf()&&this.mSa(wc)){n.ULS.sendTraceTag(537167936,0,50,"AcrossSessionRangeCopyPasteHandler.Serialize: All data is loaded prepare the data in the client side.");wc=this.clipboardRangeFactory.create(wc);try{Jc=wc.toString(),Zb=this.Tda.create(),Zb.setItem(jc.plainText,Jc),this.vdd.setValue(ca,Zb),Ra.synchronousResult=
Zb,A.clientSideCopyTime=A.commandParameters.stopwatch.Te}finally{wc&&wc.dispose()}}else A.isAsyncCopy=!0,Ra.synchronousResult=this.Tda.create(),Ra.synchronousResult.setItem(jc.plainText,this.O7c);Ra.asynchronousResult=this.qpd(A,ca,Jc)}A.syncClipboardItemsKeys=Pb(Ra.synchronousResult);return Ra}shouldWaitForCopyToComplete(A){if(!A||!A.copyContextSnapshot)return n.ULS.sendTraceTag(537167907,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: pasteContext or pasteContext.CopyContextSnapshot is not define, return false."),
!1;n.ULS.shipAssertTag(537167906,0,!!this.$.xa,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: this.EwaControl.BootstrapContext shouldn't be null");if(A.copyContextSnapshot.sessionId===this.$.xa.UserSessionId)return n.ULS.sendTraceTag(537167905,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: Same session copy scenario, return false."),!1;n.ULS.sendTraceTag(537167904,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0}onDeferredPasteStarted(A){this.MX.onDeferredPasteStarted(A)}onDeferredPasteCompleted(A){this.MX.onDeferredPasteCompleted(A)}deserialize(A){A.isClipboardDataContainShadowWorkbook=
!(void 0===A.clipboardItems.getItem(jc.shadowWorkbook)||null===A.clipboardItems.getItem(jc.shadowWorkbook));if(U.h(this.$).ha.Bg&326)return sc(A)&&(A.wasLastCopyExternal=!0),Promise.reject(new oc(17));var ca=this.Txg(A,!1);if(0!==ca)return Promise.reject(new oc(sc(A)?18:A.isSameSession?19:20,void 0,void 0,void 0,ca));var Ra=A.copyContextSnapshot,Zb=this.pq.t$a(Ra);if(sc(A))return this.Zzc(A);ca=A.commandParameters.originalDestinations;if(Zb&&A.isSameSession)return this.xkj(A,Ra,Zb,ca);if(516!==A.commandParameters.commandType){let wc=
null;if((()=>{let Jc=this.Rsg(A.clipboardItems);({k_:wc}=Jc);return Jc})().returnValue)return A.isShadowWorkbookParsedSuccessfully=!0,Zb=Ra=null,Sb.EwaSettings.getBooleanFeatureGate(Va.a.Yyb,!1)?Ra=ec.r(ca,this.$):Zb=ec.v(ec.L(ca),this.$),this.Ujj(A,Zb,Ra,wc);if(A.isClipboardInaccessible)return Promise.reject(new oc(8));if(36!==A.commandParameters.commandType)return this.MPd(A)}return Promise.reject(new oc(6))}beforePaste(A){this.$.ga.Da(373).QKj(A);A.indicationDisplayScheduled=!0}gdk(A){let ca;if(!(A&&
A.SourceRanges&&A.SourceRanges.Ranges&&A.SourceRanges.Ranges.length&&(A.OriginalSourceRangesCountExceedsLimit||A.OriginalSourceMultiRange&&A.OriginalSourceMultiRange.Ranges&&A.OriginalSourceMultiRange.Ranges.length)))return{returnValue:!1,k_:null};var Ra=A.SourceRanges.Ranges[0];if(!A.ShadowWorkbookBase64&&!A.ShadowWorkbookSizeExceedsLimit)return{returnValue:!1,k_:null};ca=this.jUe(A);ca.rangeRowStart=Ra.FirstRow;ca.rangeRowEnd=Ra.LastRow;ca.rangeColumnStart=Ra.FirstColumn;ca.rangeColumnEnd=Ra.LastColumn;
ca.sourceClientPath=A.SourceClientPath;ca.sourceSheetName=A.SourceSheetName;ca.sourceWorkbookName=A.SourceWorkbookName;if(!A.OriginalSourceRangesCountExceedsLimit)for(A=A.OriginalSourceMultiRange.Ranges,ca.originalSourceRanges=Array(A.length),Ra=0;Ra<A.length;++Ra)ca.originalSourceRanges[Ra]=[A[Ra].FirstRow,A[Ra].FirstColumn,A[Ra].LastRow,A[Ra].LastColumn];return{returnValue:!0,k_:ca}}Rsg(A){let ca;ca=null;A=A.getItem(jc.shadowWorkbook);if(!A)return{returnValue:!1,k_:ca};ca=JSON.parse(A);return{returnValue:this.fMi(ca),
k_:ca}}fMi(A){return!!A&&(!!A.shadowWorkbookBase64||A.shadowWorkbookSizeExceedsLimit)&&void 0!==A.rangeRowStart&&void 0!==A.rangeRowEnd&&void 0!==A.rangeColumnStart&&void 0!==A.rangeColumnEnd}Ujj(A,ca,Ra,Zb){n.ULS.shipAssertTag(537167903,0,!!Zb,"AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadowWorkbookPayload shouldn't be null");A.pasteResult="CrossSessionPaste";A.payloadOrigin=Qc.nfd;A.payloadType=hb.shadowWorkbook;A.shadowWorkbookPayloadSize=xd(Zb);A.shadowWorkbookSizeExceedsLimit=
Gd(Zb);Zb.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&(A.originalSourceRangesCountExceedsLimit=Zb.originalSourceRangesCountExceedsLimit);if(A.shadowWorkbookSizeExceedsLimit)return n.ULS.sendTraceTag(34415003,0,15,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadow workbook length(${A.shadowWorkbookPayloadSize}) is over the limit(${Eb.a.vvc}). reject the paste request. ShadowWorkbookSizeExceedsLimit: ${Zb.shadowWorkbookSizeExceedsLimit}`),Promise.reject(new oc(1));if(1028===
A.commandParameters.commandType&&A.originalSourceRangesCountExceedsLimit)return n.ULS.sendTraceTag(572617859,0,15,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: Original source ranges count(${Zb.originalSourceRangesCount}) is over the limit(${Eb.a.bXi}). Reject the paste request. OriginalSourceRangesCountExceedsLimit: ${Zb.originalSourceRangesCountExceedsLimit}`),Promise.reject(new oc(1));n.ULS.sendTraceTag(537167902,0,50,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: trigger Paste request. PasteOperationId=${A.commandParameters.id}`);
return this.pq.EXf(A.commandParameters.ribbonCommandInfo,ca,Ra,Zb,[A.commandParameters.stopwatch],A)}qpd(A,ca,Ra){n.ULS.shipAssertTag(537167901,0,!!A,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: copyContext shouldn't be null");const Zb=A.commandParameters.stopwatch.Te,wc=ec.u(ca.sheetName,null,ca.ranges);return new Promise((Jc,fd)=>{n.ULS.sendTraceTag(26035421,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data for copy Id: ${A.id}`);
this.pq.copy(wc,A.commandParameters,$d=>{A.requestTelemetryData=$d.RequestTelemetryData;A.serverRequestTimeInMs=A.commandParameters.stopwatch.Te-Zb;if(ge.a.ph($d.Errors))if(ge.a.qla($d.Errors))A.encounteredDeploymentErrors=!0,$d=ge.a.ue($d.Errors),n.ULS.sendTraceTag(537167898,0,15,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${$d}. copy Id: ${A.id}`);else{var Be=ge.a.ue($d.Errors),Re=[-591377245];
if(Va.a.Dnh&&ge.a.nj($d.Errors,Re)&&(Re=this.EA(wc))){Re=String.format(this.Bo.xd(218),Re.toLocaleUpperCase());var lf=Cc.d($d.Errors,tg=>-591377245===tg.MessageId);$d.Errors[lf].Description=Re;n.ULS.sendTraceTag(509125507,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: Added range string to CopyMaxCellCountExceededError. copy Id: ${A.id}`)}n.ULS.sendTraceTag(26035419,0,10,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${Be}. copy Id: ${A.id}`);
fd(new ic(2,$d.Errors))}else if(n.ULS.sendTraceTag(537167900,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeed for copy Id: ${A.id}`),A.markForCancellation)fd(new ic(3,$d.Errors));else{var xf=$d.Result;Re=xf.PlainTextResult;void 0!==Ra&&null!==Ra&&(Re=Ra);void 0!==Re&&null!==Re&&(A.plainTextPayloadSize=Re.length);Be=this.Tda.create();var $f;(()=>{let tg=this.gdk(xf);({k_:$f}=tg);return tg})().returnValue&&(A.shadowWorkbookPayloadSize=xd($f),A.shadowWorkbookSizeExceedsLimit=
Gd($f),A.originalSourceRangesCountExceedsLimit=xf.OriginalSourceRangesCountExceedsLimit,lf=JSON.stringify($f),Be.setItem(jc.shadowWorkbook,lf));Be.setItem(jc.plainText,Re);he.a.suf()&&(Re=xf.HtmlResult,A.htmlSizeExceedsLimit=xf.HtmlSizeExceedsLimit,void 0!==Re&&null!==Re&&(A.htmlPayloadSize=Re.length),Be.setItem(jc.html,Re));A.copyTotalSizeExceedsLimit=xf.CopyTotalSizeExceedsLimit;Be.setItem(jc.xdd,A.commandParameters.id);this.vdd.setValue(ca,Be);A.asyncClipboardItemsKeys=Pb(Be);Jc(Be);Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",
!1)&&(Be=1===A.commandParameters.commandType?8:7,(Re=Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Migrate2OptimizeWorkbookManager",!1)?ab.a.zg(Wb.bc):this.$.ga.Da(465))&&Re.uba(Be,$d))}},$d=>{A.serverRequestTimeInMs=A.commandParameters.stopwatch.Te-Zb;$d=Od.a.Lg($d.data);const Be=ge.a.ue($d);n.ULS.sendTraceTag(537167897,0,10,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${Be}. copy Id: ${A.id}`);fd(new ic(2,$d))},[A.commandParameters.stopwatch])})}EA(A){return null==
A||null==A.Ranges||0===A.Ranges.length?(n.ULS.sendTraceTag(509125506,0,15,"AcrossSessionRangeCopyPasteHandler.GetRangeString sourceRange is null"),null):(1===A.Ranges.length?ec.C(A.Ranges[0]):ec.G(ec.g(A.Ranges))).toString()}}Object(l.a)(hd,"AcrossSessionRangeCopyPasteHandler",Ba,[]);class Pd{constructor(A,ca,Ra,Zb,wc,Jc,fd){this.floatingObjectId=A;this.commandParameters=ca;this.cJ=Ra;this.Jvh=Zb;this.jna=void 0===Jc?null:Jc;this.Dae=void 0===fd?null:fd;this.rnh=wc}}Object(l.a)(Pd,"CopyArtRequest",
null,[]);class ue{constructor(A,ca,Ra,Zb,wc,Jc,fd,$d,Be){this.promise=null;this.ribbonCommandInfo=A;this.destination=ca;this.MWe=Ra;this.Dae=wc;this.k_=Jc;this.item=fd;this.pasteContext=$d;this.ATa=Ra||ca.FirstRow+"_"+ca.FirstColumn;this.Quf=!0;this.dOe=Be}}Object(l.a)(ue,"PasteArtRequest",null,[]);class Ee{constructor(A,ca){this.gSb=new Mb.a;this.x4a=A;this.$=ca;this.cqj=Ra=>Promise.resolve(Ra);this.iOb=Ra=>Promise.reject(Ra)}Ooi(A){if(this.OHi(A.ATa)){n.ULS.sendTraceTag(537167681,5,50,`PasteArtRequestManager.HandleRequest: Enqueued paste request as a result of rapid paste on same destination: ${A.ATa}`);
const ca=this.gSb.ma(A.ATa);this.gSb.fa(A.ATa,A);const Ra=ca.promise;ca.Quf=!1;return this.XFh(A,Ra)}this.gSb.fa(A.ATa,A);return this.YOi(A)}OHi(A){return this.gSb.kd(A)}YOi(A){return new Promise((ca,Ra)=>{A.promise=this.x4a.AXf(A).then(Zb=>{ca(null);return this.Ayc(A,Zb)},Zb=>{Ra(null);return this.iOb(Zb)})})}XFh(A,ca){return new Promise((Ra,Zb)=>{A.promise=ca.then(wc=>{this.gjk(A,wc);return this.x4a.AXf(A).then(Jc=>{Ra(null);return this.Ayc(A,Jc)},Jc=>{Zb(null);return this.iOb(Jc)})},wc=>this.iOb(wc))})}Ayc(A,
ca){A.Quf&&(this.fhh(A.ATa),this.c_d(A,ca));return this.cqj(ca)}fhh(A){this.gSb.remove(A)}c_d(A,ca){const Ra=this.pgi();A.ATa===Ra&&this.x4a.c_d(A.destination,ca,A.item.type)}pgi(){var A=U.h(this.$).ha.Va.activeFloatingObjectControlId;A||(A=ec.v(U.h(this.$).ha.ra.activeCell,this.$),A=A.FirstRow+"_"+A.FirstColumn);return A}gjk(A,ca){A.destination=null;A.MWe=ca}}Object(l.a)(Ee,"PasteArtRequestManager",null,[]);var Se=a(211),cf=a(132),mf=a(111);class ac extends Qb{constructor(A,ca,Ra,Zb,wc){wc=void 0===
wc?null:wc;super(A,"ArtCopyPasteHandler");this.$hh="XLO";this.aih="3";this.MX=new gb(A);this.Tda=ca;this.x4a=Ra;this.ha=U.h(A).ha;this.udd=wc||new Lc(this.Tda);this.Vjj=new Ee(Ra,A);this.Dvb=Zb}getSourceItem(){n.ULS.shipAssertTag(537167896,0,!!this.ha.Va.activeFloatingObjectControlId,"Expecting a floating object to be currently selected for copy");n.ULS.sendTraceTag(537167895,0,50,`ArtCopyPasteHandler.GetSourceItem: Creating ArtSourceItem with FloatingObjectId=[${this.ha.Va.activeFloatingObjectControlId}]`);
return new Hb(this.ha.Va.activeFloatingObjectControlId,this.$.ea.na.sheetName,this.$.ea.xg,this.$.xa.UserSessionId,this.ha.Va.pe.floatingObject.type)}beforeSerialize(A){A&&A.commandParameters?(A?(A.isAsyncCopy=!1,A.isSelectionAllowed=!1,A.isFromCache=!1,A.plainTextPayloadSize=0,A.shadowWorkbookPayloadSize=0,A.htmlPayloadSize=0,A.htmlSizeExceedsLimit=!1,A.clientSideCopyTime=0,A.encounteredDeploymentErrors=!1,A.shadowWorkbookSizeExceedsLimit=!1,A.originalSourceRangesCountExceedsLimit=!1,A.copyTotalSizeExceedsLimit=
!1):n.ULS.sendTraceTag(537167826,0,10,"CommonCopyPasteUtils.InitializeCopyContext: copyContext is null."),A.commandParameters.copyPasteTargetType=2):n.ULS.sendTraceTag(537167894,0,10,"ArtCopyPasteHandler.BeforeSerialize: copyContext or copyContext.CommandParameters is null.")}serialize(A){const ca=A.sourceItem,Ra={};if(!ca)return n.ULS.sendTraceTag(537167893,0,10,"ArtCopyPasteHandler.Serialize: artSourceItem should not be null"),Ra;if(!this.SKi())return n.ULS.sendTraceTag(36824456,0,50,"ArtCopyPasteHandler.Serialize: Unsupported floating object type. This will clear the clipboard"),
Ra;n.ULS.sendTraceTag(537167892,0,50,`ArtCopyPasteHandler.Serialize: Serializing ArtSourceItem with FloatingObjectId=[${ca.activeFloatingObjectControlId}]`);this.dRd();let Zb=this.udd.uAa(ca);if(Zb)Ra.synchronousResult=Zb,A.isFromCache=!0,A.isAsyncCopy=!1,A.clientSideCopyTime=A.commandParameters.stopwatch.Te,1===A.commandParameters.commandType&&this.$.Me(2045211913,A.commandParameters.ribbonCommandInfo.method,A.commandParameters.ribbonCommandInfo.Tg,null);else{A.isFromCache=!1;A.isAsyncCopy=!0;Zb=
this.Tda.create();if(A.commandParameters.uploadToClipService){const wc={};wc["data-clipservice-ccpid"]=A.commandParameters.id;wc["data-pkey"]=A.commandParameters.pKey;wc["data-clipservice-type"]=A.commandParameters.clipServiceDataType;wc["data-clipservice-count"]=A.commandParameters.objectCount.toString();wc["data-clipservice-dc"]=A.commandParameters.clipServiceDataCenter;wc["data-clipservice-client"]=this.$hh;wc["data-TimeStamp"]=(new Date).toUTCString();wc["data-clipservice-version"]=this.aih;Zb.setItem(jc.x1g,
JSON.stringify(wc))}Ra.synchronousResult=this.KVg(Zb);Ra.asynchronousResult=this.qpd(A,ca,Zb)}A.syncClipboardItemsKeys=Pb(Ra.synchronousResult);return Ra}KVg(A){n.ULS.shipAssertTag(537167891,0,!!this.ha.Va.pe,"Expecting a floating object to be currently selected for copy");A||(A=this.Tda.create());const ca=this.ha.Va.pe.GCb();ca&&A.setItem(jc.html,`<img src='${ca}'>`);return A}dRd(){const A=this.ha.Va.pe;this.Dvb.dRd(cf.a.Exb(A.floatingObject),cf.a.cih(A.mt))}shouldWaitForCopyToComplete(){n.ULS.sendTraceTag(537167890,
0,50,"ArtCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0}onDeferredPasteStarted(A){this.MX.onDeferredPasteStarted(A)}onDeferredPasteCompleted(A){this.MX.onDeferredPasteCompleted(A)}deserialize(A){var ca=sc(A),Ra=null;let Zb=null;var wc=!1;if(!ca){Ra=A.copyContextSnapshot;Zb=Ra.sourceItem;if(!Zb)return Promise.reject(new oc(10));wc=Zb.isFromCurrentSession(this.$)}var Jc=this.Txg(A,!0);if(0!==Jc)return Promise.reject(new oc(ca?18:wc?19:20,void 0,void 0,void 0,Jc));if(ca)return this.Zzc(A);
if(!wc&&!ac.YCi(Zb))return A=`User attempted to paste art of type [${Zb.type}] between sessions.`,n.ULS.sendTraceTag(537167889,0,50,A),Promise.reject(new oc(11,void 0,void 0,A));if(Ra.isAsyncSerializeFailed)return Promise.reject(new oc(16,void 0,void 0,"Last async serialize failed, therefore no current shadow workbook payload to paste"));let fd;try{const $d=A.clipboardItems.getItem(jc.shadowWorkbook);fd=JSON.parse($d)}catch($d){return A=copyPasteInfra.getStringifiedError($d),n.ULS.sendTraceTag(537167888,
0,10,`ArtCopyPasteHandler.Deserialize: Failed to parse shadow workbook JSON with exception: ${A}`),Promise.reject(new oc(12,void 0,$d))}fd.floatingObjectId!==Zb.activeFloatingObjectControlId?n.ULS.sendTraceTag(537167887,0,10,`ArtCopyPasteHandler.Deserialize: FloatingObjectId mismatch! Deserializing with artSourceItem.ActiveFloatingObjectControlId=[${Zb.activeFloatingObjectControlId}], shadowWorkbookPayload.FloatingObjectId=[${fd.floatingObjectId}]`):n.ULS.sendTraceTag(537167886,0,50,`ArtCopyPasteHandler.Deserialize: Deserializing with artSourceItem.ActiveFloatingObjectControlId=[${Zb.activeFloatingObjectControlId}], shadowWorkbookPayload.FloatingObjectId=[${fd.floatingObjectId}]`);
if(!fd||!fd.shadowWorkbookBase64)return Promise.reject(new oc(13,void 0,void 0,`shadowWorkbookPayload is null = ${!fd}`));A.isShadowWorkbookParsedSuccessfully=!0;A.shadowWorkbookPayloadSize=xd(fd);A.shadowWorkbookSizeExceedsLimit=Gd(fd);A.payloadOrigin=wc?Qc.jbg:Qc.nfd;A.payloadType=hb.PBg;if(Gd(fd))return A=`Shadow workbook size [${A.shadowWorkbookPayloadSize}] is over the limit [${Eb.a.vvc}]. ShadowWorkbookSizeExceedsLimit: ${fd.shadowWorkbookSizeExceedsLimit}`,n.ULS.sendTraceTag(36304156,0,15,
`ArtCopyPasteHandler.Deserialize: ${A}`),Promise.reject(new oc(1,void 0,void 0,A));Ra=ca=null;U.h(this.$).ha.Bg&326?Ra=U.h(this.$).ha.Va.activeFloatingObjectControlId:ca=this.$.na&&this.$.na.activeCell?ec.v(this.$.na.activeCell,this.$):ec.v(ec.L(A.commandParameters.originalDestinations),this.$);wc||!Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossSessionChartPasteEnabled",!1)&&!Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossSessionInkPasteEnabled",!1)||n.ULS.sendTraceTag(508422155,
0,20,`User is attempting to paste art of type [${Zb.type}] between sessions.`);wc=null;if(this.Dvb.cjg(Zb))try{wc=this.Dvb.Bhd()}catch($d){Jc=copyPasteInfra.getStringifiedError($d),n.ULS.sendTraceTag(537167885,0,10,`ArtCopyPasteHandler.Deserialize: Exception encountered while performing client-side estimation. Exception: ${Jc}`)}return this.Vjj.Ooi(new ue(A.commandParameters.ribbonCommandInfo,ca,Ra,A.commandParameters.commandType,[A.commandParameters.stopwatch],fd,Zb,A,wc))}Zzc(A){A.wasLastCopyExternal=
!0;if(A.clipboardItems.getItem("image/png")){const ca=A.commandParameters.stopwatch.Te;A.payloadType=hb.T7g;return Bc.c(this.$.Me(1403967063,A.commandParameters.ribbonCommandInfo.method,A.commandParameters.ribbonCommandInfo.Tg,{["dataUrl"]:A.clipboardItems.getItem("image/png")})).then(Ra=>{A.serverRequestTimeInMs=A.commandParameters.stopwatch.Te-ca;return Ra?Promise.resolve(null):Promise.reject(new oc(15))},()=>{A.serverRequestTimeInMs=A.commandParameters.stopwatch.Te-ca;return Promise.reject(new oc(15))})}n.ULS.shipAssertTag(537167884,
0,!1,"Should not paste external content that is not image via ArtCopyPasteHandler");return super.Zzc(A)}SKi(){const A=U.h(this.$).ha;return A.Va.activeFloatingObjectControlId&&A.Va.pe&&A.Va.pe.floatingObject?A.Va.pe.floatingObject.G6d():!1}qpd(A,ca,Ra){return new Promise((Zb,wc)=>{const Jc=A.commandParameters.stopwatch.Te;n.ULS.sendTraceTag(41562516,0,50,"ArtCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data...");this.x4a.wnh(new Pd(ca.activeFloatingObjectControlId,
A.commandParameters,fd=>{A.requestTelemetryData=fd.RequestTelemetryData;A.serverRequestTimeInMs=A.commandParameters.stopwatch.Te-Jc;if(ge.a.ph(fd.Errors))if(ge.a.qla(fd.Errors))A.encounteredDeploymentErrors=!0,fd=ge.a.ue(fd.Errors),n.ULS.sendTraceTag(537167879,0,15,`ArtCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${fd}`);else{var $d=ge.a.ue(fd.Errors);n.ULS.sendTraceTag(36229122,0,10,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${$d}`);
wc(new ic(4,fd.Errors))}else if(n.ULS.sendTraceTag(537167883,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeeded for FloatingObjectId=[${ca.activeFloatingObjectControlId}].`),A.markForCancellation)wc(new ic(3,fd.Errors));else{if(ge.a.Rr(fd.Errors)){var Be=ge.a.ue(fd.Errors);n.ULS.sendTraceTag(537167882,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: Server messages present. Errors: ${Be}`)}if(Be=fd.Result){Be=this.jUe(Be);Be.floatingObjectId=ca.activeFloatingObjectControlId;
A.shadowWorkbookPayloadSize=xd(Be);A.shadowWorkbookSizeExceedsLimit=Gd(Be);try{$d=JSON.stringify(Be)}catch(Re){wc(new oc(14,void 0,Re,`Failed to stringify shadow workbook: copyContext.ShadowWorkbookPayloadSize: [${A.shadowWorkbookPayloadSize}], shadowWorkbookPayload.FloatingObjectId: [${Be.floatingObjectId}]`));return}n.ULS.shipAssertTag(537167881,0,!!Ra,"Expecting syncClipboardItems to be defined");Ra.setItem(jc.shadowWorkbook,$d);1===A.commandParameters.commandType&&(this.Knj(ca.type,ca.activeFloatingObjectControlId,
fd.StateId),this.deleteFloatingObject(ca.activeFloatingObjectControlId,ca.type));this.udd.setValue(ca,Ra);A.asyncClipboardItemsKeys=Pb(Ra);Zb(Ra)}else n.ULS.sendTraceTag(537167880,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: Result form server returned null, copied item id: ${ca.activeFloatingObjectControlId}`),Zb(this.udd.uAa(ca))}},A.commandParameters.commandType,ca.type,fd=>{A.serverRequestTimeInMs=A.commandParameters.stopwatch.Te-Jc;fd=Od.a.Lg(fd.data);1===A.commandParameters.commandType&&
this.x4a.Oek(ca.type,ca.activeFloatingObjectControlId);const $d=ge.a.ue(fd);n.ULS.sendTraceTag(537167878,0,10,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${$d}`);wc(new ic(4,fd))},[A.commandParameters.stopwatch]))})}deleteFloatingObject(A,ca){A=Se.a.SB(ca,A);if(A=mf.a(this.$).qt(A))mf.a(this.$).deleteFloatingObject(A,14,!0),U.h(this.$).ha.Va.FD=null}Knj(A,ca,Ra){const Zb=Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigrateValidationTelemetryManager",
!1)?ab.a.zg(Wb.cd):this.$.ga.Da(277);if(Zb){let Jc=null;A=Se.a.SB(A,ca);A=mf.a(this.$).qt(A);if(null===A||void 0===A?0:A.Zk)Jc=A.Zk.block;if(Jc){var wc=A.floatingObject.Wi();Zb.m7b(()=>!Jc.jk.kd(wc),Ra,"CutArt")}}}static YCi(A){return 1===A.type||5===A.type||Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossSessionChartPasteEnabled",!1)&&0===A.type||Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossSessionInkPasteEnabled",!1)&&8===A.type}}Object(l.a)(ac,"ArtCopyPasteHandler",
Qb,[]);var bd=a(63);class nd extends fe{constructor(A,ca,Ra,Zb){super(A);this.isFromCurrentSession=!1;this.left=this.top=0;this.isFromCurrentSession=ca;this.top=Ra;this.left=Zb}}Object(l.a)(nd,"MacroRecorderPasteArtPayload",fe,[]);class se{constructor(A,ca){this.$=A;this.Dvb=ca}yui(A,ca,Ra,Zb,wc,Jc,fd){Jc=void 0===Jc?null:Jc;fd=void 0===fd?null:fd;const $d=this.$.qa.ua.ie();let Be=null;const Re={CopyPasteTargetType:2};Re.FloatingObjectId=A;Re.CopyOperationId=Ra.id;Ra.floatingObjectType=ca;Re.UploadToClipService=
Ra.uploadToClipService;Re.PKey=Ra.pKey;Re.ClipServiceDataCenter=Ra.clipServiceDataCenter;let lf=0;2===wc?(wc=505,lf=16,Be=(xf,$f,tg)=>Oc(this.$.qa.ua,Re,dc.b(xf,Zb),Jc?dc.a($f,Jc):$f,tg,Ra.ribbonCommandInfo,$d,fd)):(wc=179,Be=(xf,$f,tg)=>{this.KBh(ca,A);this.$.iB();var Vf=this.$.qa.ua;xf=dc.b(xf,Zb);$f=Jc?dc.a($f,Jc):$f;var ug=Ra.ribbonCommandInfo,lh=fd;lh=void 0===lh?null:lh;const ni=Vf.Pa(1,void 0===$d?null:$d);ni.copyParameters=Re;return Bd.g(Vf,"Cut",ni,xf,$f,tg,ug,0,lh)});this.$.userOperationManager.enqueueOperation(new Zc.a(wc,
0,Be,lf|64),Ra.ribbonCommandInfo)}KBh(A,ca){var Ra=Se.a.SB(A,ca);(Ra=mf.a(this.$).qt(Ra))?(U.h(this.$).ha.Va.oK(Ra),Ra.isVisible=!1):n.ULS.sendTraceTag(537167876,0,50,`ArtCopyPasteUtils.DoCutClientEstimation: floatingObjectcontrol is null. FloatingObjectType : ${A}, FloatingObjectId: ${ca}`)}Oek(A,ca){A=Se.a.SB(A,ca);if(A=mf.a(this.$).qt(A))A.isVisible=!0}wnh(A){this.yui(A.floatingObjectId,A.rnh,A.commandParameters,A.cJ,A.Jvh,A.jna,A.Dae)}dvi(A,ca,Ra,Zb,wc,Jc,fd,$d,Be){$d=void 0===$d?null:$d;Be=void 0===
Be?!0:Be;return new Promise((Re,lf)=>{const xf=Jc.commandParameters.stopwatch.Te;this.A_d(A,wc,ca,Ra,$f=>{Jc.requestTelemetryData=$f.RequestTelemetryData;Jc.serverRequestTimeInMs=Jc.commandParameters.stopwatch.Te-xf;if(ge.a.qla($f.Errors))Jc&&(Jc.encounteredDeploymentErrors=!0),$f=ge.a.ue($f.Errors),n.ULS.sendTraceTag(537167875,0,15,`ArtCopyPasteUtils.PasteArt: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${$f}`);else if(ge.a.ph($f.Errors)){var tg=ge.a.ue($f.Errors);
n.ULS.sendTraceTag(36459652,0,10,`ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: ${tg}`);lf(new oc(9,$f.Errors))}else $f.Result?(tg=$f.Result,n.ULS.sendTraceTag(537167874,0,50,"ArtCopyPasteUtils.PasteArt: PasteArt succeeded."),this.Wnj(fd,tg.FloatingObjectId,$f.StateId),Re(se.$wd(tg.FloatingObjectId))):(n.ULS.sendTraceTag(537167873,0,10,"ArtCopyPasteUtils.PasteArt: PasteArt failed, result returned from server is null."),lf(new oc(9,$f.Errors)))},$f=>{Jc.serverRequestTimeInMs=Jc.commandParameters.stopwatch.Te-
xf;$f=Od.a.Lg($f.data);n.ULS.sendTraceTag(537167872,0,10,`ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: ${ge.a.ue($f)}`);lf(new oc(9,$f))},Zb,$d,Be)})}Wnj(A,ca,Ra){const Zb=Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigrateValidationTelemetryManager",!1)?ab.a.zg(Wb.cd):this.$.ga.Da(277);if(Zb){const wc=Se.a.SB(A,se.$wd(ca));Zb.m7b(()=>!!mf.a(this.$).qt(wc),Ra,"PasteArt")}}G9d(A,ca){ca&&this.Dvb.G9d(A,Se.a.SB(A.type,ca))}AXf(A){return this.dvi(A.ribbonCommandInfo,A.destination,
A.MWe,A.Dae,A.k_,A.pasteContext,A.item.type,A.dOe,A.item.isFromCurrentSession(this.$)).then(ca=>ca,ca=>{this.G9d(A.item,A.dOe);return Promise.reject(ca)})}c_d(A,ca,Ra){A||(A=ec.v(U.h(this.$).ha.ra.activeCell,this.$));U.h(this.$).Hrc(ec.E(A),1)?mf.a(this.$).Iaa(Ra,ca,!0):U.h(this.$).ha.Va.DMa(A,ca,Ra).continueWith(Zb=>{Zb.result?n.ULS.sendTraceTag(537167843,5,50,`ArtCopyPasteUtils.SelectPastedObject: Selection succeeded in async manner for object ID [${ca}]`):n.ULS.sendTraceTag(537167842,5,10,`ArtCopyPasteUtils.SelectPastedObject: Selection failed in async manner for object ID [${ca}]`)})}A_d(A,
ca,Ra,Zb,wc,Jc,fd,$d,Be){Be=void 0===Be?!0:Be;const Re=this.$.qa.ua.ie(),lf={};lf.ShadowWorkbookBase64=ca.shadowWorkbookBase64;lf.FloatingObjectId=Zb;lf.DestinationRanges=Ra?ec.s(Ra):null;lf.CopyPasteTargetType=2;lf.ClientEstimationFloatingObjectId=$d;Ra=new Zc.a(503,0,(xf,$f,tg)=>{$d||this.$.iB();return Ad(this.$.qa.ua,lf,dc.b(xf,wc),dc.a($f,Jc),tg,null,Re,fd)},void 0,()=>{if(Be){let xf;xf=bd.a.Fk(bd.a.He(lf));xf.FloatingObjectId=ca.floatingObjectId;lf.DestinationRanges||(xf.DestinationRanges=ec.p(this.$.va.na.sheetName,
"",0,0,0,0));return new nd(xf,Be,0,0)}return new nd(lf,Be,0,0)});Ra.flags=65;this.$.userOperationManager.enqueueOperation(Ra,A)}static $wd(A){return`${A.length+2}.{${A.toUpperCase()}}`}}Object(l.a)(se,"ArtCopyPasteUtils",null,[422]);var Ge=a(203);class Ve{constructor(A){this.sdd=this.Xxa=null;this.rgb=15;this.$=A}dRd(A,ca){this.Xxa=A;this.sdd=ca}Bhd(){if(!this.Xxa||!this.sdd)return n.ULS.sendTraceTag(537167841,0,15,"ArtPasteClientEstimation.DoPasteClientEstimation: copiedFloatingObjectControl and/or copiedEffectsExtents is null, aborting client side estimation."),
"";const A=cf.a.Exb(new Se.a(this.Xxa));A.Id=se.$wd(ma.a.create().toString());A.Version=-1;A.Name="";A.IsClientEstimation=!0;var ca=this.wwi(A);if(!ca)return null;const Ra=new Se.a(A);ca.block.jk.add(Ra);Ra.lSb();const Zb=mf.a(this.$);Zb.Rcc(Ra,ca);ca=Zb.qt(Se.a.B9h(A));!ca||ca.floatingObject.URa||ca.floatingObject.vSa||ca.LXa(this.sdd);Zb.Iaa(A.Type,A.Id,!0);return A.Id}cjg(A){return Sb.EwaSettings.Ea(205)&&A.isFromCurrentSession(this.$)&&!U.h(this.$).rtl&&!U.h(this.$).jd.Ek}G9d(A,ca){this.cjg(A)&&
(A=mf.a(this.$).qt(ca))&&(n.ULS.sendTraceTag(537167840,5,50,`ArtPasteClientEstimation.UndoPasteClientEstimation: undoing client-side estimation. Removing floating object with ID: [${ca}] of type [${A.floatingObject.type}]`),mf.a(this.$).deleteFloatingObject(A,15,!0),A.Zk&&A.Whb(A.Zk,!1))}wwi(A){if(!A)return n.ULS.sendTraceTag(537167839,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: Called with null FloatingObjectData."),null;if(U.h(this.$).ha.Va.activeFloatingObjectControlId){var ca=
U.h(this.$).ha.Va.FD.floatingObject;A.OriginDeltaX=ca.offsetX+this.rgb;A.OriginDeltaY=ca.offsetY+this.rgb;A.AbsoluteLeft+=this.rgb;A.AbsoluteTop+=this.rgb;A.AbsoluteRight+=this.rgb;A.AbsoluteBottom+=this.rgb;A.ZOrder=ca.OE+1;return U.h(this.$).ha.Va.FD.Zk}if(!this.$.na||!this.$.na.activeCell)return n.ULS.sendTraceTag(537167838,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: ActiveItem/ActiveCell is null - cannot perform estimation for grid paste."),null;var Ra=this.$.na.activeCell;
ca=U.h(this.$).G_(Ra);if(!ca)return n.ULS.sendTraceTag(537167837,0,15,`ArtPasteClientEstimation.InitializeFloatingObjectLocation: gridViewBlock for range ${Ra.toString()} is null.`),null;const Zb=dd.HelperMethods.cEb(ca.domElement,ca.pl.domElement);Ra=ca.gridView.Ni(Ra,2);if(!Zb||!Ra)return n.ULS.sendTraceTag(537167836,0,15,`ArtPasteClientEstimation.InitializeFloatingObjectLocation: blockPositionRelativeToGridOrigin is null: ${!Zb}. cellPositionRelativeToGridOrigin is null: ${!Ra} .`),null;A.OriginDeltaX=
Ra.topLeft.x-Zb.x;A.OriginDeltaY=Ra.topLeft.y-Zb.y;A.AbsoluteLeft=Ra.topLeft.x;A.AbsoluteTop=Ra.topLeft.y;A.AbsoluteRight=A.AbsoluteLeft+Math.abs(this.Xxa.AbsoluteRight-this.Xxa.AbsoluteLeft);A.AbsoluteBottom=A.AbsoluteTop+Math.abs(this.Xxa.AbsoluteBottom-this.Xxa.AbsoluteTop);A.ZOrder=this.Xxa.ZOrder+100;return new Ge.a(ca.gridView.ya.Zj(ca.hashCode),ca.hashCode)}}Object(l.a)(Ve,"ArtPasteClientEstimation",null,[423]);class df{create(){const A=window.clipboardPlatform;return A?A.createClipboardItems():
null}}Object(l.a)(df,"ClipboardItemsFactory",null,[421]);class pf{}pf.undefined="Undefined";Object(l.a)(pf,"CCPTelemetryConsts",null,[]);class kf{}kf.cells="Cells";kf.floatingObject="FloatingObject";kf.unknown="Unknown";Object(l.a)(kf,"ActiveSelection",null,[]);class Af{}Af.UAh="DisplayNotInvoked";Af.uhd="Displayed";Af.eoj="PrerequisitesNotReady";Object(l.a)(Af,"PasteIndicationDisplayStatus",null,[]);class eb extends hd{constructor(A,ca,Ra,Zb){super(A,ca,Ra,void 0===Zb?null:Zb);this.Ecc=null}beforePaste(){n.ULS.sendTraceTag(509162378,
0,50,"AcrossSessionInsertCopiedCutCellsHandler is called")}deserialize(A){A.isClipboardDataContainShadowWorkbook=!(void 0===A.clipboardItems.getItem(jc.shadowWorkbook)||null===A.clipboardItems.getItem(jc.shadowWorkbook));this.pq.t$a(A.copyContextSnapshot);const ca=A.commandParameters.originalDestinations;if(!A.isClipboardDataContainShadowWorkbook)return Promise.resolve(!0);let Ra=null;if((()=>{let Zb=this.Rsg(A.clipboardItems);({k_:Ra}=Zb);return Zb})().returnValue){A.isShadowWorkbookParsedSuccessfully=
!0;let Zb=null,wc=null;Sb.EwaSettings.getBooleanFeatureGate(Va.a.Yyb,!1)?Zb=ec.r(ca,this.$):wc=ec.v(ec.L(ca),this.$);return this.skj(A,wc,Zb,Ra)}return A.isClipboardInaccessible?Promise.reject(new oc(8)):Promise.reject(new oc(6))}get copyPasteInfrastructure(){var A;null!==(A=this.Ecc)&&void 0!==A?A:this.Ecc=this.$.ga.Da(254,!0);return this.Ecc}oyi(A,ca,Ra,Zb){return this.copyPasteInfrastructure?Bc.a(this.copyPasteInfrastructure.Koc(null,Zb.commandParameters.ribbonCommandInfo,A,ca,Ra,Zb)):Promise.reject(new oc(0))}skj(A,
ca,Ra,Zb){A.pasteResult="CrossSessionPaste";A.payloadOrigin=Qc.nfd;A.payloadType=hb.shadowWorkbook;A.shadowWorkbookPayloadSize=xd(Zb);A.shadowWorkbookSizeExceedsLimit=Gd(Zb);Zb.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&(A.originalSourceRangesCountExceedsLimit=Zb.originalSourceRangesCountExceedsLimit);return A.shadowWorkbookSizeExceedsLimit?Promise.reject(new oc(1)):1028===A.commandParameters.commandType&&A.originalSourceRangesCountExceedsLimit?Promise.reject(new oc(1)):this.oyi(ca,
Ra,Zb,A)}}Object(l.a)(eb,"AcrossSessionInsertCopiedCutCellsHandler",hd,[]);class bb{constructor(A){this.nVc=this.VPc=this.m_c=null;this.$=A}get cTd(){if(!this.m_c){const A=this.$.ga.Da(254,!0);A&&(this.m_c=new hd(this.$,A,new df))}return this.m_c}get ryi(){if(!this.nVc){const A=this.$.ga.Da(254,!0);A&&(this.nVc=new eb(this.$,A,new df))}return this.nVc}get K7c(){if(!this.VPc&&this.$.ga.Da(254,!0)){const A=new Ve(this.$);this.VPc=new ac(this.$,new df,new se(this.$,A),A)}return this.VPc}getCopyFlowHandler(A){const ca=
this.r5h(U.h(this.$).Bg);A.commandParameters.copyPasteHandlerName=ca.name;return ca}getPasteFlowHandler(A){var ca=A.copyContextSnapshot;switch(A.commandParameters.ribbonCommandInfo.command){case -160032004:case -1065525230:return A=this.ryi;default:return ca=Fa(A)?this.K7c:sc(A)?this.cTd:(null===ca||void 0===ca?0:ca.sourceItem)&&Object.getType(ca.sourceItem)===Hb?this.K7c:this.cTd,A.commandParameters.copyPasteHandlerName=ca.name,ca}}initializePasteContext(A){if(A&&(A.isSameSession=!1,A.isShadowWorkbookParsedSuccessfully=
!1,A.pasteResult=pf.undefined,A.payloadOrigin=pf.undefined,A.payloadType=pf.undefined,A.encounteredDeploymentErrors=!1,A.shadowWorkbookSizeExceedsLimit=!1,A.originalSourceRangesCountExceedsLimit=!1,A.activeSelectionType=this.l1h(),A.indicationDisplayScheduled=!1,A.pasteDestinationHasMergedCells=!1,A.cseStatus=0,A.pasteIndicationDisplayStatus=Af.UAh,A.copyContextSnapshot)){var ca=A.copyContextSnapshot;const fd=ib(ca.sourceItem);var Ra=ca.sourceItem;var Zb=!!Ra&&Object.getType(Ra)===Hb;Ra=0;var wc=
!1;fd?(wc=ca.sourceItem,A.isSameSession=wc.isFromCurrentSession(this.$),Ra=1,wc=this.QHi(wc,A)):Zb&&(A.isSameSession=ca.sourceItem.isFromCurrentSession(this.$),Ra=2);if(A.copyContextSnapshot.commandParameters){const $d=-1985798686===ca.commandParameters.ribbonCommandInfo.command;Zb=A.commandParameters;var Jc=this.$;ca?Jc&&Jc.xa?ca=ca.sessionId===Jc.xa.UserSessionId:(n.ULS.shipAssertTag(537166211,0,!1,"ewaControl shouldn't be null"),ca=!1):(n.ULS.shipAssertTag(537166212,0,!1,"copyContext shouldn't be null"),
ca=!1);Zb.clearSystemClipboard=ca&&$d&&fd&&!wc;A.commandParameters.copyPasteTargetType=Ra}}}getSessionId(){return this.$.xa.UserSessionId}QHi(A,ca){const Ra=Cc.b(A.ranges,Zb=>Zb.Oi)&&Cc.b(ca.commandParameters.originalDestinations,Zb=>1!==Zb.top);return Cc.b(A.ranges,Zb=>Zb.isRow)&&Cc.b(ca.commandParameters.originalDestinations,Zb=>1!==Zb.left)||Ra}r5h(A){switch(A){case 1:return this.cTd;case 64:case 4:case 2:case 256:return this.K7c;default:throw Error.invalidOperation("Unsupported selection");}}l1h(){return U.h(this.$).ha.Bg&
470?kf.floatingObject:1===U.h(this.$).ha.Bg?kf.cells:kf.unknown}getDialogResponse(){}}Object(l.a)(bb,"ExcelCopyPasteApplicationHost",null,[340]);var Rb=a(179);class Q extends cc.a{constructor(A,ca){super(A);this.Zv=null;this.qyi=(Ra,Zb)=>{1===Ra?(Ra=Q.bAh[Zb[Q.aAh]],n.ULS.sendTraceTag(537167683,0,50,`InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler OK button pressed with valid input, shift direction = ${0===Ra?"Horizontal":"Vertical"}`),this.Zv.setResult(Ra)):(n.ULS.sendTraceTag(537167682,
0,50,"InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler cancel button pressed"),this.Zv.ww())};this.ri(ca)}get we(){return"InsertCopiedCutCellsDialog"}ri(A){this.Zv=new Rb.a;const ca=Ub.a.instance.ia(16);A=this.CK(A);this.initializeAndShow(ca,this.qyi,A)}CK(A){return{[Q.Ou]:this.we,[Q.xJi]:A}}}Q.aAh="direction";Q.xJi="isRtl";Q.bAh={["Vertical"]:1,["Horizontal"]:0};Object(l.a)(Q,"InsertCopiedCutCellsDialog",cc.a,[]);class Ia{Tcc(A,ca){return(new Q(A,ca)).Zv.task}}Object(l.a)(Ia,"InsertCopiedCutCellsDialogFactory",
null,[339]);var ub=a(96),Yb=a(54),Ca=a(48),tb=a(430),$b=a(33),cd=a(282);class sd{constructor(A){this.Ndc="";this.UU=this.Rv=null;this.qgb=new Map;this.v6=null;this.PAc=!1;this.bnf=(ca,Ra)=>{this.hide(void 0===ca?null:ca,void 0===Ra?null:Ra)};this.$=A;this.gridView=U.h(A);this.gridView.ha.kr(this.bnf)}ZYe(){this.PAc||(n.ULS.sendTraceTag(537167680,0,50,"PasteIndicationManager.DownloadPrerequisitesIfNeeded: Trying to get appChrome"),this.gridView.$.DK(A=>{A.B8(0).then(()=>{this.PAc=!0})}))}QKj(A){const ca=
A.commandParameters.id;n.ULS.sendTraceTag(537167651,0,50,`PasteIndicationManager.ScheduleDisplay: pasteCommandId = ${ca}, cancelCtx is null = ${!this.Rv}, PrerequisitesDownloaded = ${this.PAc}`);this.ZYe();this.Ndc=ca;const Ra=!this.QIf();if(!this.Rv||Ra)this.tLe(),this.Rv=Yb.a.instance.create(()=>{this.TAh(A)},void 0===A.timeoutToShowSpinnerInMs||null===A.timeoutToShowSpinnerInMs?100:A.timeoutToShowSpinnerInMs,Ca.a.Zjj);this.v6=A.commandParameters.originalDestinations;Va.a.HXf&&this.XKj(ca)}TAh(A){this.PAc?
(this.display(A.commandParameters.originalDestinations),A.pasteIndicationDisplayStatus=Af.uhd):(n.ULS.sendTraceTag(537167650,0,50,"PasteIndicationManager.DisplayIfPossible: Prerequisites were not ready, skipping display"),this.hide(),A.pasteIndicationDisplayStatus=Af.eoj)}XKj(A){this.qgb.set(A,$b.a.$b.og);Yb.a.instance.create(()=>{this.bBh(A)},this.$.xa.PasteToastNotificationDelayTime,Ca.a.$jj)}bBh(A){this.qgb.has(A)&&(this.UU?this.UU.displayTimeoutSeconds+=this.$.xa.PasteToastNotificationDefaultDisplayDuration:
(A=Ub.a.instance.ia(2341),this.UU=tb.a.GB.notificationBar.u1(A,!1),this.UU.image=3,this.UU.displayTimeoutSeconds=this.$.xa.PasteToastNotificationDefaultDisplayDuration,tb.a.GB.notificationBar.tD(this.UU)))}a9(A){A&&this.UU&&(A=Ub.a.instance.ia(2342),this.UU.wMc(A));setTimeout(()=>{this.Zzj()},3E3)}Zzj(){this.UU&&(tb.a.GB.notificationBar.removeEntry(this.UU),this.UU=null)}display(A){n.ULS.sendTraceTag(537167649,0,50,"PasteIndicationManager.Display: started");this.gridView.Kd.QC(gd.a.jGa(pd.d(this.gridView.$.na),
A),sd.$zc,!0);this.gridView.Kd.Jt(sd.$zc)}ync(A,ca){ca=void 0===ca?!0:ca;n.ULS.sendTraceTag(537167648,0,50,`PasteIndicationManager.HideForPasteId: pasteCommandId = ${A}, currentPasteCommandId = ${this.Ndc}`);A&&Rd.a.equals(A,this.Ndc,!1)&&this.hide();if(Va.a.HXf&&A&&this.qgb.has(A)){const Ra=cd.a($b.a.$b.og,this.qgb.get(A));6E4<Ra&&n.ULS.sendTraceTag(508839751,0,50,`PasteIndicationManager.hideForPasteId: large paste. CommandId (${A}), scheduleDisplayToHideDurationInMs (${Ra}))`);this.qgb.delete(A);
null!=this.UU&&0===this.qgb.size&&this.a9(ca)}}hide(A){this.v6&&(void 0===A?0:A)&&this.QIf()&&n.ULS.sendTraceTag(537167647,0,15,"PasteIndicationManager.Hide: Triggered by a SelectionChanged event while indication is (or will be) active but active range did not change");this.Ndc="";this.tLe();this.v6=null;0!==this.gridView.Kd.xod([30]).length&&(this.gridView.Kd.cm(sd.$zc),this.gridView.Kd.kn(null,sd.$zc))}QIf(){return ec.R(this.gridView.ha.ra.selectedRanges,this.v6)}tLe(){this.Rv&&(ub.a.Ma(this.Rv),
this.Rv=null)}dispose(){this.hide();this.UU&&this.a9(!1);this.gridView.ha.Fr(this.bnf)}}sd.$zc=[30];Object(l.a)(sd,"PasteIndicationManager",null,[338,5]);var re=a(1128),De=a(56),Ye=a(737);class $e extends Ob.a{constructor(A){super();this.sHf=79;this.$=A;this.Bo=Ub.a.instance;this.Tyd=Va.a.Tyd&&!this.$.isMobileMode;this.Uyd=Va.a.Uyd&&this.$.isMobileMode&&this.$.isEditMode;this.je()}create(){const A=De.a.hZ([73,74],4,this.Ta,void 0,void 0,void 0,$e.ksa),ca=Object(Bc.d)(ab.a.resolve(Wb.gb,{Ja:this.Ta}));
Jd.TaskExtensions.za(Jd.TaskExtensions.Wf([ca,A],this.ka),()=>{const Ra=new re.a;let Zb=null;this.Nkh(Ra).then(wc=>{Zb=wc.gOe;const Jc=copyPasteInfra.createCopyPasteInfra(Zb,new bb(this.$),Ra,{isChangeGateEnabled:Sb.EwaSettings.isChangeGateEnabled});n.ULS.shipAssertTag(537167762,0,!!this.$.xa,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext should not be null");n.ULS.shipAssertTag(537167761,0,!!this.$.xa&&!!this.$.xa.DocumentHostInfo,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext.DocumentHostInfo should not be null");
const fd=Zb.getMetadataManager();var $d=Object(Ye.a)(this.$.ga,254,()=>new ed(this.$,fd,ca.result,Jc,new Xd(this.$,U.h(this.$)),new Ia,this.$.xa.DocumentHostInfo.UserId,Zb.getInitializationError()));this.Ld($d);if(wc.c6a){$d=ed.Njc();const Be=JSON.stringify(wc.c6a.dataClipboardCapabilities),Re=wc.c6a.clipboardStrategiesToInitialize[0].clipboardStrategyType===wc.c6a.dataClipboardStrategyType,lf=void 0===window.bsqmXLSPageLoadStartTime||null===window.bsqmXLSPageLoadStartTime?"-1":(Date.now()-window.bsqmXLSPageLoadStartTime.getTime()).toString();
n.ULS.sendTraceTag(41731933,0,50,`CopyPasteInfrastructureFactory.Create: Initialize CCP infra succeed. SliceName=${$d}, StrategyType=${wc.c6a.dataClipboardStrategyType}, StrategyCapabilities=${Be}, IsBestStrategyTypeInitialized=${Re}, InfraLoadTimeMS=${lf}`)}else n.ULS.shipAssertTag(537167760,0,!1,"CopyPasteInfrastructureFactory.Create: initResult.ClipboardPlatformEnvironmentInitializationInfo should not be null")},wc=>{const Jc=ed.Njc();wc=wc?copyPasteInfra.getStringifiedError(wc):"null";n.ULS.shipAssertTag(38847436,
0,!1,`CopyPasteInfrastructureFactory.Create: error during call to clipboardPlatformEnvironment.Init(). Copy Paste operations will not be available in this session. SliceName: ${Jc} error: ${wc}`)})},this.ka,3)}dispose(){super.dispose()}Nkh(A){let ca=null;var Ra=window.clipboardPlatform;Ra&&(ca=Ra.getClipboardPlatformEnvironment());if(!ca)return n.ULS.shipAssertTag(537167759,0,!1,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: getClipboardPlatformEnvironment should have returned a valid object"),
Promise.reject(null);Ra=this.$.xa;const Zb=[Ra.OfficeOnlineChromeExtensionId,Ra.ChromeClipboardAccessExtensionId],wc=this.Bo.Ia(5);var Jc=this.$.mg.get(57);let fd=!Jc&&this.$.mg.get(5);var $d=this.$.ea.te;$d&&($d.inWebPart||$d.inViewerFromWebPart||$d.isDivSyndicated)&&(fd=!1);$d=()=>{var Be=navigator.userAgentData;if(Be)for(let Re=0;Re<Be.brands.length;Re++){if("Microsoft Edge"===Be.brands[Re].brand&&parseFloat(Be.brands[Re].version)>=this.sHf)return!0}else if(navigator.userAgent&&(Be=navigator.userAgent.match(/(Edg|EdgiOS|EdgA)\/(\d+)/i))&&
parseFloat(Be[2])>=this.sHf)return!0;return!1};($d=(this.Tyd||this.Uyd)&&!Jc&&!!(navigator&&navigator.clipboard&&navigator.clipboard.read&&navigator.clipboard.write&&$d()))&&n.ULS.sendTraceTag(508703874,0,50,"CopyPasteInfrastructureFactory.configureClipboardPlatformEnvironment: Async System Clipboard is allowed");Jc=this.s4h(fd,!Jc,$d);n.ULS.shipAssertTag(537167758,0,!!Ra.DocumentHostInfo,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: bootstrapContext.DocumentHostInfo should not be null");
return ca.init({isChangeGateEnabled:Sb.EwaSettings.isChangeGateEnabled},A,Zb,Ra.SharedClipboardHostingApp,Ra.SharedClipboardHostingApps,Ra.SharedClipboardHostingEnvironments,Ra.SharedClipboardOverrideOrigin,Ra.SharedClipboardSchemaVersion,Ra.SharedClipboardExpirationInMinutes,Ra.ClipboardPromiseTimeoutInMinutes,wc,Ra.MachineCluster,new tc(this.$),Jc,Ra.DocumentHostInfo.UserId,Ra.ClipboardTtlInMS,Sb.EwaSettings.Ea(273),Ra.UserSessionId,Ra.BulsEndpointUrl).then(Be=>Object(jb.a)(new be,{gOe:ca,c6a:Be}),
Be=>Promise.reject(Be))}s4h(A,ca,Ra){const Zb=[];A&&Ra&&Zb.push(this.tUe(9));A&&ca&&Zb.push(this.tUe(6));ca&&(Zb.push(this.efd(7)),Zb.push(this.efd(0)));A&&Zb.push(this.pTe());Zb.push({clipboardStrategyType:4});Ra=Zb?Zb.map(wc=>JSON.stringify(wc)).join(","):"[]";n.ULS.sendTraceTag(39978242,0,50,`CopyPasteInfrastructureFactory.GetClipboardStrategiesInitList: create clipboard stratgy initialization list: isBrowserStorageAllowed=${A}, isSystemClipboardAllowed=${ca}, result = ${Ra}`);return Zb}pTe(){const A=
this.$.xa,ca={clipboardStrategyType:5};ca.sessionId=A.UserSessionId;ca.useSharedClipboardIframe=!0;ca.sharedClipboardHostingApp=A.SharedClipboardHostingApp;ca.sharedClipboardHostingApps=A.SharedClipboardHostingApps;ca.sharedClipboardHostingEnvironments=A.SharedClipboardHostingEnvironments;ca.sharedClipboardOverrideOrigin=A.SharedClipboardOverrideOrigin;ca.sharedClipboardSchemaVersion=A.SharedClipboardSchemaVersion;ca.sharedClipboardExpirationInMinutes=A.SharedClipboardExpirationInMinutes;ca.wacCluster=
A.MachineCluster;return ca}tUe(A){const ca={};ca.clipboardStrategyType=A;ca.localStorageStrategyParameters=this.pTe();ca.systemClipboardStrategyParameters=this.efd(0);return ca}efd(A){const ca={};ca.clipboardStrategyType=A;ca.skipFilesIfPlainTextExists=!0;return ca}static la(A){A.ga.Qa(373,new sd(A));A.ga.Qa($e.ksa,new $e(A))}}$e.ksa=255;Object(l.a)($e,"CopyPasteInfrastructureFactory",Ob.a,[]);var tf=a(10),Jb=a(117),yc=a(13);class Id extends cb.a{constructor(A,ca,Ra){super();this.statusBarManager=
null;this.HXe=()=>{this.gfc()};this.jAh=()=>{this.gfc()};this.GXe=Zb=>{10===Zb&&this.gfc()};this.onKeyDown=Zb=>13===Zb.Ba.keyCode?(Zb=new jf.a(237279923,1,2,6,null),this.$.Ha.Ad(Zb,{[Hc.a.skipClipboardAccess]:!0,[Hc.a.F0e]:!0}),!0):!1;this.$=A;this.ju=ca;this.Wo=Ra;this.wjd=!1;this.$.ga.qd(29,Zb=>{this.statusBarManager=Zb;Zb.zM(this)})}dispose(){this.Jk();this.Wo=this.ju=this.$=null;this.statusBarManager&&(this.statusBarManager.MI(this),this.statusBarManager=null)}Up(){return!0}Ru(A,ca){if("QueryPasteShortcutEnabledLabel"!==
A&&!Id.M5j.includes(A))return!1;const Ra=this.oI();"QueryPasteShortcutEnabledLabel"===A?(ca.Visible=Ra,n.ULS.sendTraceTag(537167636,0,100,`PasteShortcutManager.ExecuteRootCommand: Setting visible to ${Ra} for commandId ${A}`)):(ca.Visible=!Ra,n.ULS.sendTraceTag(537167635,0,100,`PasteShortcutManager.ExecuteRootCommand: Setting visible to ${!Ra} for commandId ${A}`));return!0}vFh(){this.il();this.raiseEvent("pasteShortcutStatusChanged")}gfc(){this.Jk();this.raiseEvent("pasteShortcutStatusChanged")}oI(){return this.wjd}Xs(A){this.addHandler("pasteShortcutStatusChanged",
A)}Gt(A){this.removeHandler("pasteShortcutStatusChanged",A)}il(){if(!this.oI()){this.wjd=!0;U.h(this.$).Nk.Gp(this.HXe);this.Wo.la("blur",this.jAh);const A=this.$.ga.Da(65);A&&A.q7&&A.q7.registerForCommentEvents(this.GXe);this.ju.tw(yc.a.me,this.$.Ww,this.onKeyDown,!0)}}Jk(){if(this.oI()){this.wjd=!1;U.h(this.$).Nk.zp(this.HXe);this.Wo.detach("blur");const A=this.$.ga.Da(65);A&&A.q7&&A.q7.unregisterForCommentEvents(this.GXe);this.ju.zw(yc.a.me,this.$.Ww,this.onKeyDown,!0)}}}Id.M5j=["QuerySheetNumberButton",
"QueryWorkbookStatisticsButton"];Object(l.a)(Id,"PasteShortcutManager",cb.a,[325,295,188,5]);var qe=a(148);class Me extends Ob.a{constructor(A){super();this.$=A;this.je()}create(){const A=this.$;this.Ld(A.ga.Da(478)||this.$.ga.Qa(478,new Id(A,Jb.KeyInputManager.instance,qe.a.instance.UM())))}static la(A){A.ga.Qa(479,new Me(A))}}Object(l.a)(Me,"PasteShortcutManagerFactory",Ob.a,[]);var oa=a(734),vb=a(731),Ac=a(108),jd=a(1275),Ud=a(199);let ke=class{constructor(A,ca,Ra){this.szb=null;this.$=A;ca?(n.ULS.sendTraceTag(537163346,
0,50,"DataFromPictureCommandHandler.constructor - AugmentationLoopManager and UploaderCreator instantiated."),this.szb=new jd.a(A,ca,Ra)):n.ULS.sendTraceTag(537163347,0,10,"DataFromPictureCommandHandler.constructor - Failed to instantiate AugmentationLoopManager.")}Pe(){return!1}executeCommand(A,ca,Ra){A=!1;switch(ca.command){case 73979048:this.szb&&this.szb.Rnj(ca,Ac.a.instance,O.AFrameworkApplication.da,Ra),A=!0}return A?Aa.Task.Wa(!0):Ud.a(ca.command)}Be(A,ca){return 73979048===ca.command&&Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DataFromPictureOnXLO",
!1)}Ue(){return!1}dispose(){this.szb&&this.szb.dispose()}};ke=Object(vb.a)([Object(ab.d)(Wb.K),Object(vb.b)(0,Object(Wb.W)()),Object(vb.b)(1,Object(Wb.i)()),Object(vb.b)(2,Object(Wb.bd)())],ke);Object(l.a)(ke,"DataFromPictureCommandHandler",null,[203,5]);class Pe extends oa.a{constructor(A){super(A)}Uf(){const A=Object(Bc.d)(ab.a.resolve(Wb.i,{Ja:1})),ca=Object(Bc.d)(ab.a.resolve(Wb.bd,{Ja:this.Ta}));Jd.TaskExtensions.za(Jd.TaskExtensions.Wf([A,ca],this.$.ka),()=>{this.Lf([new ke(this.$,A.result,
ca.result)])},this.$.ka,3)}static la(A){oa.a.qg(452,new Pe(A))}}Object(l.a)(Pe,"DataFromPictureCommandHandlerFactory",oa.a,[]);var ze=a(521),Ue=a(112);class hg{constructor(A,ca,Ra){this.Tl=this.IOd=null;this.WJa=this.Kca=0;this.S0b=null;this.eW=A;this.fg=ca;this.Oa=Ra;this.z7a=!1;this.vae=!0;this.sGj();this.Aeb=this.da.pa("NativeFileOpenDialogIsEnabled")}get context(){return this.eW}get da(){return this.Oa}get retryCount(){return this.Kca}get sEc(){return this.WJa}HOb(A){this.Tl=A;if(!this.z7a){if(this.vae){if(this.Aeb&&
Y.a.dE){this.S0b=A.Bfc(Object(B.a)(this,this.RMd,"onFileChosen"));return}this.S0b=A.Bfc(null);if(!this.VGa(this.S0b,A))return}this.finalizeUpload(A,null)}}RMd(A){if(this.VGa(A,this.Tl)){if(Y.a.dE||Y.a.vh)this.S0b=A;this.finalizeUpload(this.Tl,null)}}izc(){this.IOd&&this.IOd()}sGj(){this.Kca=0;this.WJa=this.da.Hf("Box4UploadRetryDelayStart",200);this.Tl&&(this.Tl.dispose(),this.Tl=null)}}Object(l.a)(hg,"FileUploader",null,[]);var of=a(330),Gf=a(831),Wf=a(152);class bg extends hg{constructor(A,ca,Ra){super(A,
ca,Ra);this.J3b=this.vwa=null}get MR(){return O.AFrameworkApplication.sa.EG}Hcf(A){switch(A){case 1:return CommonUIStrings.l_ImageUploadNoFileSpecified;case 2:return CommonUIStrings.l_ImageUploadUnsupportedFileType;default:return""}}Rxg(A){return bg.VGa(A,this.dki())}dki(){return bg.Oxe}VGa(A,ca){ca=void 0===ca?null:ca;A=this.Rxg(A);return 0!==A?(ca&&ca.cAe(),2===A&&this.Uk(0,this.Hcf(A)),!1):!0}finalizeUpload(A,ca){n.ULS.sendTraceTag(36783360,322,50,"PictureUploader.FinalizeUpload");this.IOd=ca;
this.C0j();of.a.mark(5576);this.J3b=this.MR.Ze("LoadResource","PictureUploadTime")}Uk(A,ca){const Ra=new Wf.StandardDialog;Ra.Rd=0;Ra.UC(A,CommonUIStrings.l_ImageUploadFailedTitle,ca,null)}izc(){n.ULS.sendTraceTag(36783361,322,50,"PictureUploader.OnUploadComplete");super.izc();this.J3b&&(this.J3b.stop(),this.J3b=null);this.lih()}C0j(){this.vwa=(new Gf.a).create();this.vwa.message=CommonUIStrings.l_ImageUploadWait;this.vwa.Rd=5;this.vwa.hw=!1;this.vwa.FFa(null,null,null)}lih(){this.vwa&&(this.vwa.close(),
this.vwa=null)}static Qqi(A,ca){A=kb.a.Tm(A);for(let Ra=0;Ra<ca.length;++Ra)if(A.endsWith(ca[Ra]))return!0;return!1}static VGa(A,ca){ca=void 0===ca?null:ca;ca||(ca=bg.Oxe);return A?bg.Qqi(A,ca)?0:2:1}}bg.Oxe=".jpg .jpeg .png .gif .bmp .tif .tiff".split(" ");Object(l.a)(bg,"PictureUploader",hg,[]);var Dg=a(567),Gg=a(324),Rf=a(248),Eg=a(151),vh=a(176),Og=a(95),e=a(102),sa=a(181),Ya=a(194),Fb;(function(A){A[A.unknown=0]="unknown";A[A.bing=1]="bing";A[A.M365=2]="M365"})(Fb||(Fb={}));Object(l.b)("InsertMediaProviders",
Fb);var pc=a(97),Uc=a(906);class Sc extends Uc.a{constructor(A,ca){super(A,R.a.rN(ca))}UQb(A,ca){this.isEnabled()&&this.LS(this.targetOrigin)&&(this.Rn(A),this.fm(A,ca))}}Object(l.a)(Sc,"InsertMediaCrossDocumentMessenger",Uc.a,[267,268,5]);class Nd{}Object(l.a)(Nd,"OnlineMediaSearchResult",null,[]);var ne=a(326),ye=a(870),bf=a(357),uf;(function(A){A[A.OK=0]="OK";A[A.cancel=1]="cancel";A[A.error=2]="error";A[A.open=3]="open"})(uf||(uf={}));Object(l.b)("HubbleAction",uf);var Qf=a(73);class Yf extends Eg.a{constructor(A,
ca,Ra,Zb,wc,Jc){super();this.Fqc=!1;this.correlationId=this.MFd=this.qE=this.YAa=null;this.i4i=()=>{this.kza(this.h5a);this.QFc(1)};this.CEd=fd=>{fd.keyCode===Sys.UI.Key.tab&&("KeepFocusDiv"!==fd.target.id||fd.shiftKey?"KeepFocusStartDiv"===fd.target.id&&fd.shiftKey&&(fd.preventDefault(),document.getElementById("KeepFocusDiv").focus()):(fd.preventDefault(),document.getElementById("KeepFocusStartDiv").focus()))};this.Aaj=()=>{this.gvb&&(this.gvb.launchUpsellExperience("stockimages"),n.ULS.sendTraceTag(537155807,
0,50,"OnLaunchM365Upsell: Launched Dime Upsell flow"))};this.Ybj=fd=>{fd&&fd.Values&&(fd=fd.Values,delete fd.m_Origin,delete fd.m_Source,delete fd.m_ReceivedTime,n.ULS.sendTraceTag(508953229,0,50,"Received OTel event: "+fd.eventName||!1),vh.a.sendOtelEvent(Object.assign(new ye.a,{otelEvent:fd})))};this.xm=Jc;this.$=A;this.kqf=ca;this.gvb=Ra;this.Kaa=[];this.meb=Zb;this.Gzh=wc;this.hEe=this.$.xa.InsertOnlinePictureMaxCountOfImagesToInsert;this.di=this.grh()}u0j(A){this.Fqc=!1;this.showDialog(this.xm,
null);this.YAa=document.getElementById(this.Rj("InsertMediaFrame"));if(!this.YAa)throw this.kza(this.h5a),Error.invalidOperation("Couldn't get InsertMediaIframe.");var ca=document.getElementById(this.Rj("WACDialogPanel"));ca&&ca.setAttribute(Og.a.Mf,Og.a.Avb);ca=document.createElement("div");ca.id="KeepFocusStartDiv";ca.tabIndex=0;ca.className="keep-focus-start";this.YAa.parentNode.insertBefore(ca,this.YAa.parentNode.firstChild);ca=document.createElement("div");ca.id="KeepFocusDiv";ca.tabIndex=0;
ca.className="keep-focus";this.correlationId=ma.a.create();this.YAa.parentNode.appendChild(ca);$addHandler(this.QNa,"keydown",this.CEd);this.YAa.src=this.kqf;this.YAa.frameBorder="0";ca=document.getElementById(this.Rj("WACDialogButtonPanel"));if(!ca)throw Error.invalidOperation("Couldn't get WACDialogButtonPanel.");ca.className="display-none";ca=document.getElementById(this.Rj("WACDialogTitleText"));if(!ca)throw Error.invalidOperation("Couldn't get WACDialogTitleText.");ca.className="display-none";
2===this.meb&&(document.getElementById(this.Rj("WACDialogTitlePanel")).className="display-none",document.getElementById(this.Rj("WACDialogBodyPanel")).className="padding-zero");e.FocusManager.instance().ZT().scope.FU=!0;this.qE=new Sc(this.YAa.contentWindow,this.kqf);this.qE.LS("https://osiziwuspersimmon002.blob.core.windows.net");this.qE.LS("https://osizewuspersimmon001.blob.core.windows.net");this.qE.LS("https://osizpscuspersimmon000.blob.core.windows.net");this.qE.LS("https://cdn.hubblecontent.msit.osi.office.net");
this.qE.LS("https://cdn.hubblecontent.osi.office.net");this.qE.UQb(sa.a.QVg,Ra=>{this.$2i(Ra,A.Pta)});this.qE.UQb(sa.a.insert,()=>{this.N$i(A.Pta)});this.qE.UQb(sa.a.o$c,this.i4i);this.qE.UQb(sa.a.rWg,Ra=>{this.Ybj(Ra)});2===this.meb&&0===this.Gzh&&(this.qE.UQb(sa.a.POi,this.Aaj),this.MFd=this.gvb.hWa("MsoPremiumStockImages",Ra=>{n.ULS.sendTraceTag(537155811,0,50,"OnCompleteM365Upsell: Upsell completed from stock images");Ra.isEnabled?this.qE.sendMessage(sa.a.Fkk,{["LicenseTier"]:Ra.toString()}):
n.ULS.sendTraceTag(537155810,0,10,"OnCompleteM365Upsell: Upsell completed but license tier didn't upgrade.")}));this.QFc(3)}dispose(){this.Kaa=null;this.gvb&&this.MFd&&this.gvb.YUd("MsoPremiumStockImages",this.MFd);this.qE&&(this.qE.dispose(),this.qE=null);super.dispose()}hide(){super.hide();pc.a.BGc(this.$)}get y8(){return Ya.a.Pec+"/InsertMediaDialog"}get i1(){return!1}$2i(A,ca){A=A&&A.Values?(A=A.Values)?Object(jb.a)(new Nd,{Action:A.action||"",Caption:A.caption||"",ContentType:A.contentType||
"",FileExtension:A.extension||"",PageUrl:A.pageUrl||"",SourceUrl:A.sourceUrl||"",ThumbnailUrl:A.thumbnailUrl||"",LicenseUrl:A.licenseUrl||"",LicenseDisplayName:A.licenseDisplayName||"",Height:A.height||0,Width:A.width||0}):null:null;A&&(this.Kaa.push(A),this.Fqc&&(n.ULS.sendTraceTag(537155809,0,50,"InsertMediaDialog.OnAddItem: Insert Message handling was pending"),ca(this.Kaa),this.Fqc=!1,this.kza(this.h5a)))}N$i(A){this.Kaa&&0<this.Kaa.length?this.Kaa.length<=this.hEe?(A(this.Kaa),this.QFc(0),this.kza(this.h5a)):
(this.UC(),n.ULS.sendTraceTag(537155808,0,10,"OnInsert : Tried to insert more than allowed limit of items."),this.Kaa.length=0,this.QFc(2)):this.Fqc=!0}grh(){const A=document.createElement("div");A.id="InsertMediaDialog";A.className=Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixHorizonalScroll",!0)?"insert-media-dialog":"insert-media-dialog-old";const ca=document.createElement("div");ca.id="InsertMediaPanel";ca.className=Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixCancelButton",
!0)?"insert-media-panel":"insert-media-panel-old";const Ra=document.createElement("iframe");Ra.id="InsertMediaFrame";Ra.className="insert-media-frame";A.appendChild(ca);ca.appendChild(Ra);return ne.b(A)}UC(){const A=ge.a.qf(1,0,0,0,0,466721363,"InsertPictureExceededAllowedCount");A.Description=String.format(Ub.a.instance.xd(206),this.hEe.toLocaleString());Sb.EwaSettings.gC()?new ce.a(this.$,A):(new Kd.ErrorDialog(this.$,A)).Ji()}Tai(){return 2===this.meb?"M365":"bing"}QFc(A){var ca,Ra;if(2===this.meb||
1===this.meb){const wc=O.AFrameworkApplication.da.Sa("InsertMediaDialogAriaTenantNameSpace");if(wc&&""!==wc){var Zb=[];Array.add(Zb,Object.assign(new Qf.a,{name:"DialogMode",string:this.Tai()}));Array.add(Zb,Object.assign(new Qf.a,{name:"Provider",string:Fb[this.meb]}));Array.add(Zb,Object.assign(new Qf.a,{name:"InsertedFiles",int64:null===(ca=this.Kaa)||void 0===ca?void 0:ca.length}));Zb.push(Object.assign(new Qf.a,{name:"MediaDetails",string:this.Kaa?JSON.stringify(this.Kaa.map(Jc=>Jc.SourceUrl)):
null}));Array.add(Zb,Object.assign(new Qf.a,{name:"DialogResult",string:uf[A]}));Array.add(Zb,Object.assign(new Qf.a,{name:"CorrelationId",string:null===(Ra=this.correlationId)||void 0===Ra?void 0:Ra.toString()}));vh.a.sendTelemetryEvent(Object.assign(new bf.a,{name:String.format("{0}.{1}",wc,"InsertOnlineImages"),dataFields:Zb}))}}}}Object(l.a)(Yf,"InsertMediaDialog",Eg.a,[]);var Of=a(389),eg=a(302);class gf extends bg{constructor(A,ca,Ra,Zb,wc,Jc){super(null,Ra,Zb);this.lEf=0;this.Pta=fd=>{if(fd){var $d=
Array(fd.length);for(var Be=0;Be<fd.length;Be++){const xf=fd[Be];$d[Be]={};$d[Be].SourceUrl=xf.SourceUrl;kb.a.Nbb(xf.LicenseUrl)&&kb.a.Nbb(xf.PageUrl)&&($d[Be].LicenseUrl=xf.LicenseUrl,$d[Be].LicenseDisplayName=xf.LicenseDisplayName,$d[Be].PageUrl=xf.PageUrl);$d[Be].AltText=-2053056795===this.Bf.command?xf.Caption:"";$d[Be].IsCellPicture=15735758===this.Bf.command||570484235===this.Bf.command}var Re=-2009825598===this.Bf.command?"bing":"M365";Be=U.h(this.$);var lf=ec.o(Be.ha.ra.activeCell,this.$);
Ld.a(this.$.userOperationManager,(xf,$f,tg)=>Gg.u(this.$.qa.ua,lf,$d,Re,dc.b(xf,this.qcj),dc.a($f,this.pcj),tg,null),xf=>new Zc.a(595,0,xf),this.Bf);dd.HelperMethods.d3?(Be=new Map,Be.set("MediaProvider",Re),Be.set("ImagesCount",fd.length.toString()),Be.set("TimeTakenToOpenDialog",this.lEf.toString()),I.Health.instance.recordKpiUsage(eg.a.zyi,1,Of.a.Lpg,Be)):n.ULS.sendTraceTag(537155805,0,15,"OnlinePictureUploaderWrapper.UploadResponseReceived: KPI Usage not supported.");this.izc()}else n.ULS.sendTraceTag(537155806,
0,10,"OnlinePictureUploaderWrapper.UploadResponseReceived: Response is null")};this.qcj=fd=>{if(Rf.a(fd))n.ULS.sendTraceTag(537155799,0,10,`OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded with errors. Errors: ${ge.a.ue(fd.Errors)}`);else{n.ULS.sendTraceTag(537155801,0,50,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded.");const $d=this.Bf.command;15735758!==$d&&570484235!==$d&&(fd.Result?mf.a(this.$).Iaa(1,fd.Result):n.ULS.sendTraceTag(537155800,0,
10,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess:Result.result is null"))}};this.pcj=()=>{n.ULS.sendTraceTag(537155798,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadFailed: Operation failed")};this.$=A;this.Bf=ca;this.UL=Jc;this.PEe=Xa.a.instance.Qd("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");this.showDialog()}dispose(){this.$=null}showDialog(){let A=null;A=this.$.Sd.Ze("UserAction","showOnlineImagesDialogTimeStopwatch");switch(this.Bf.command){case -2009825598:case 15735758:this.F_j();
break;case -2053056795:case 570484235:this.PEe.execute(ca=>{ca.isFeatureEnabled("MsoPremiumStockImages",!1).catch(Ra=>n.ULS.sendTraceTag(557200643,0,10,`OnlinePictureUploaderWrapper::ShowDialog - Failed to load the premium state from application feature helper: ${Ra}`)).then(Ra=>{this.G_j(Ra);return null})})}A.stop();this.lEf=A.Te}F_j(){let A=this.$.xa.BingPictureEndpoint;const ca=Dg.a.pN(O.AFrameworkApplication.lcid),Ra=ma.a.create();A?(A=0<A.search(RegExp("insertmedia.bing.office.net","gi"))?String.format(A,
1,1):String.format(A,1,O.AFrameworkApplication.lcid,ca?ca.name:"en-us",O.AFrameworkApplication.buildVersion,Ra.toString(),1,this.$.xa.DocumentHostInfo.LoggableUserId),this.Tcc(A,1,-1,Ub.a.instance.ia(1764))):(n.ULS.sendTraceTag(537155804,0,10,"OnlinePictureUploaderWrapper::ShowDialogForBingPictures - Can't access the Bing service endpoint"),this.UL.setException(Error.create("Failed to access the Bing service endpoint")))}G_j(A){var ca=this.$.xa.M365PictureEndpoint,Ra=ma.a.create();if(ca){var Zb=this.$.xa.DocumentHostInfo.UserId;
Zb=Zb?kb.a.Ly(Zb).toString():"0";var wc=this.PEe.instance.isFreemiumUpsellEnabled();A=A?1:wc?0:-1;Ra=Ra.toString();wc=Dg.a.pN(O.AFrameworkApplication.lcid).name;ca=String.format(ca,O.AFrameworkApplication.lcid,wc,O.AFrameworkApplication.buildVersion,Ra,1,Zb,A,1);this.Tcc(ca,2,A,Ub.a.instance.ia(1763))}else n.ULS.sendTraceTag(537155803,0,10,"OnlinePictureUploaderWrapper::ShowDialogForStockImages - Can't access the M365 service endpoint"),this.UL.setException(Error.create("Failed to access the M365 service endpoint"))}Tcc(A,
ca,Ra,Zb){try{(new Yf(this.$,A,Xa.a.instance.oi("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),ca,Ra,Zb)).u0j(this),this.UL.setResult(!0)}catch(wc){n.ULS.sendTraceTag(537155802,0,10,`OnlinePictureUploaderWrapper::CreateAndShowDialog failed [Exception : ${wc}] [MediaProvider : ${ca}] [DialogLicenseTier : ${Ra}]`),this.UL.setException(wc)}}}Object(l.a)(gf,"OnlinePictureUploaderWrapper",bg,[5]);let Vg=class{constructor(A,ca){this.$=A;this.uploaderCreator=ca}executeCommand(A,ca,Ra){A=
ca.command;switch(A){case 1403967063:case -2060689045:if(Ra&&"dataUrl"in Ra)return ca=new Rb.a,this.uploaderCreator&&this.uploaderCreator.iwi(this.$,Ac.a.instance,O.AFrameworkApplication.da,Ra,Ra.dataUrl,ca),ca.task;this.uploaderCreator&&this.uploaderCreator.ixi(this.$,ca,Ac.a.instance,O.AFrameworkApplication.da,Ra);return Aa.Task.Wa(!0);case -2053056795:case -2009825598:case 570484235:case 15735758:return A=new Rb.a,new gf(this.$,ca,Ac.a.instance,O.AFrameworkApplication.da,Ra,A),A.task;default:return Ud.a(A)}}Be(A,
ca){let Ra=this.$.isEditMode;if(Ra)switch(ca.command){case 1403967063:Ra=!0;break;case -2053056795:Ra=!0;break;case -2009825598:Ra=!0;break;case -2060689045:case 15735758:case 570484235:Ra=he.a.rIb()&&1===A;break;default:Ra=!1}return Ra}Ue(){return!1}Pe(){return!1}};Vg=Object(vb.a)([Object(ab.d)(Wb.Db),Object(vb.b)(0,Object(Wb.W)()),Object(vb.b)(1,Object(Wb.bd)())],Vg);Object(l.a)(Vg,"PictureCommandHandler",null,[203]);class Jh extends oa.a{constructor(A){super(A)}Uf(){Jd.TaskExtensions.za(Object(Bc.d)(ab.a.resolve(Wb.bd,
{Ja:this.Ta})),A=>{this.Lf([new Vg(this.$,A.result)])},this.$.ka,3)}static la(A){oa.a.qg(90,new Jh(A))}}Object(l.a)(Jh,"PictureCommandHandlerFactory",oa.a,[]);var Nh=a(394),Qg=a(47);class bh{constructor(){this.xha=this.I$e=null}}Object(l.a)(bh,"GestureAdapterInfo",null,[]);class Yg{constructor(){this.oSc=null}lQi(){if(!this.oSc){var A="hammer.min.js";O.AFrameworkApplication.da.Ur("IsServerFlavorDebug")&&(A=O.AFrameworkApplication.da.pa("IsServerFlavorDebug")?"hammer.js":"hammer.min.js");A=O.AFrameworkApplication.qV(String.format("{0}",
A),5);A=ia.a.create(A,null,null);La.a.Yya(A);this.oSc=A.Jdb}return this.oSc}static get instance(){Yg.La||(Yg.La=new Yg);return Yg.La}}Yg.La=null;Object(l.a)(Yg,"HammerJsDependencyLoader",null,[352]);var kh;(function(A){A[A.none=-1]="none";A[A.pinch=0]="pinch";A[A.pan=1]="pan";A[A.swipe=2]="swipe"})(kh||(kh={}));Object(l.b)("GestureEvent",kh);var qh=a(82);class nh extends qh.a{constructor(A,ca,Ra,Zb,wc,Jc,fd,$d){super(A,Ra,Zb,Jc);this.Jnb=ca;this.wka=fd;this.Y_=$d;this.BJg=wc}get shiftKey(){return this.wka}get ctrlKey(){return this.Y_}get clientPoint(){return this.Jnb}get Iza(){return this.BJg}static create(A,
ca,Ra,Zb,wc,Jc){if(Ra.rawEvent)if(Jc){var fd=Ra.rawEvent;fd=new Sys.UI.Point(fd.clientX,fd.clientY)}else fd=qh.a.bDb(Ra);else fd=new Sys.UI.Point(Ra.clientX,Ra.clientY);return new nh(A,fd,ca,Ra,Zb,wc,Ra.shiftKey,Ra.ctrlKey,Jc)}}Object(l.a)(nh,"GestureEventArgs",qh.a,[]);class Zg{constructor(){this.srcEvent=this.pointerType=this.changedPointers=this.pointers=null;this.maxPointers=this.rotation=this.scale=this.angle=this.distance=this.overallVelocity=this.overallVelocityY=this.overallVelocityX=0;this.additionalEvent=
this.center=this.target=null;this.isFinal=this.isFirst=!1;this.deltaTime=this.timeStamp=this.deltaY=this.deltaX=this.eventType=0;this.offsetDirection=null}}Object(l.a)(Zg,"GestureManagerData",null,[]);class Rg{}Rg.YCg=2;Rg.ZCg=4;Rg.$Cg=8;Rg.aDg=8;Object(l.a)(Rg,"HammerConstants",null,[]);var Eh=a(100),hh=a(205),ch=a(85);class qg extends Qg.a{constructor(A,ca){super();this.lva=Nh.a.T0h;this.VZc=!!window.PointerEvent;this.Zwe=window.hasOwnProperty("ontouchstart");this.U0a=this.lrb=null;this.nca=!1;
this.vW=new Mb.a;this.Frb=new Mb.a;this.CJg=new Ea.a;this.Jua=null;this.X_a=this.dUc=this.ige=this.YQc=this.KXc=this.vte=this.oge=this.ktb=!1;this.Qqb=-1;this.curRecognizer=this.element=this.handlers=this.session=this.D1c=null;this.Xf=Eh.EventHandlerManager.instance;this.VZc?(n.ULS.sendTraceTag(593893141,310,50,"Using pointer events"),this.lrb=Object(B.a)(this,this.xUa,"onPointerEvent"),this.U0a=yc.a.V0h):this.Zwe?(n.ULS.sendTraceTag(593893140,310,50,"Using touch events"),this.lrb=Object(B.a)(this,
this.HDa,"onTouchEvent"),this.U0a=yc.a.touchEvents):(n.ULS.sendTraceTag(593893139,310,50,"Using mouse events"),this.lrb=Object(B.a)(this,this.qyc,"onMouseEvent"),this.U0a=yc.a.U0h);this.Hj=ca;this.vja=A;O.AFrameworkApplication.da&&(this.ktb=O.AFrameworkApplication.da.pa("UsePointerCaptureIsEnabled"),this.oge=O.AFrameworkApplication.da.pa("ClearCacheOnPrimaryPointerIsEnabled"),this.vte=O.AFrameworkApplication.da.pa("ResetHandledBeforeInputHandlerIsEnabled"),this.KXc=O.AFrameworkApplication.da.pa("LogCoalescedEventsIsEnabled"),
this.YQc=O.AFrameworkApplication.da.pa("CheckExistenceOfGetCoalescedEventsIsEnabled"),this.ige=O.AFrameworkApplication.da.pa("CheckIfHammerExistsAfterDownloadIsEnabled"),this.dUc=O.AFrameworkApplication.da.pa("HammerJsPerformanceTimersIsEnabled"),this.X_a=this.ktb&&O.AFrameworkApplication.da.pa("CancelDragFromGestureInputManagerIsEnabled")&&O.AFrameworkApplication.da.pa("UseGestureInputManagerPointerCacheIsEnabled"))}j9h(){return this.VZc?0:this.Zwe?1:2}Pp(A){super.Pp(A);this.Xf.Loa(this.U0a,A,0,
this.lrb)}Ko(A){super.Ko(A);this.Xf.KNa(A,this.U0a)}Swj(A,ca,Ra){Ra=void 0===Ra?null:Ra;var Zb=void 0===Zb?null:Zb;O.AFrameworkApplication.Xqc()?Yg.instance.lQi().continueWith(wc=>{this.n5j();if(wc.Kh||wc.qj)n.ULS.sendTraceTag(591192778,310,10,"Hammer did not download correctly: {0}",wc.status);else{n.ULS.sendTraceTag(591192779,310,50,"Hammer download status: {0}",wc.status);if(this.ige){wc=window.Hammer;if("undefined"===typeof wc){n.ULS.sendTraceTag(590901389,310,10,"Hammer does not exist");this.uJc();
return}if("undefined"===typeof wc.inputHandler){n.ULS.sendTraceTag(590901390,310,10,"Hammer.inputHandler does not exist");this.uJc();return}}if(!A)throw this.uJc(),Error.argumentNull("source element can not be null");wc=hh.a.iAa(A,this.lva);if(void 0===wc||null===wc)wc=new Mb.a,hh.a.Cjb(A,this.lva,wc),this.Twj(A);var Jc=null;if(!wc.kd(kh[0])){Jc=Object;var fd=Jc.assign,$d=new bh,Be=kh[0],Re=Zb;Re=void 0===Re?null:Re;if(void 0===this||null===this)throw n.ULS.sendTraceTag(42256258,310,10,"manager cannot be null"),
Error.argumentNull("manager can not be null");let lf=null;switch(Be){case yc.a.pinch:lf=new Hammer.Pinch(Re);break;case yc.a.pan:lf=new Hammer.Pan(Re)}lf&&(lf.manager=this);Jc=fd.call(Jc,$d,{xha:lf,I$e:ca});wc.add(kh[0],Jc)}if(void 0!==Ra&&null!==Ra)for(fd=0;fd<Ra.length;fd++)wc.kd(kh[Ra[fd]])&&($d=wc.ma(kh[Ra[fd]]),Jc.xha.recognizeWith($d.xha))}this.uJc()}):n.ULS.sendTraceTag(42256219,310,10,"Multi Touch is not enabled either from common BRS or from your app BRS")}n5j(){this.dUc&&(this.Hj?this.D1c=
this.Hj.Ze("Task","RegisterGestureAdapterAfterLoad"):n.ULS.sendTraceTag(590387074,310,10,"_stopwatchBuilder is null"))}uJc(){this.dUc&&(this.D1c?this.D1c.stop():n.ULS.sendTraceTag(590387075,310,10,"_stopwatchForRegisterGestureAdapterAfterLoad is null"))}Twj(A){this.CJg.add(A);this.Xf.Loa(this.U0a,A,0,this.lrb)}recognize(A){var ca=Array(A.pointers.length);for(var Ra=0;Ra<A.pointers.length;Ra++)ca[Ra]=A.pointers[Ra].target;Ra=null;for(this.Jua=this.Kai(ca);void 0!==this.Jua&&null!==this.Jua&&(Ra=hh.a.iAa(this.Jua,
this.lva),void 0===Ra||null===Ra);this.Jua=this.Jua.parentNode);if(void 0!==Ra&&null!==Ra){this.curRecognizer&&this.curRecognizer.state===Rg.aDg&&(this.curRecognizer=null);ca=Ra.keys;for(const Zb of ca){ca=Ra.ma(Zb);void 0!==ca&&null!==ca&&void 0!==ca.xha&&null!==ca.xha&&(void 0===this.curRecognizer||null===this.curRecognizer||ca.xha===this.curRecognizer||ca.xha.canRecognizeWith(this.curRecognizer))&&ca.xha.recognize(A);const wc=ca.xha.state;this.curRecognizer||Rg.YCg!==wc&&Rg.ZCg!==wc&&Rg.$Cg!==
wc||(this.curRecognizer=ca.xha)}}}emit(A,ca){if("hammer.input"!==A){this.nca=!1;ca=nh.create(A,this.Jua,ca.srcEvent,ca,3,this.VZc);var Ra=hh.a.iAa(this.Jua,this.lva);if(this.WHi(A))var Zb=0;else if(this.LHi(A))Zb=1;else if(this.XKi(A))Zb=2;else{n.ULS.sendTraceTag(42256256,310,15,"Event can not be recognized by current manager");return}({value:Ra}=Ra.kf(kh[Zb]));void 0!==Ra&&null!==Ra&&((Ra=Ra.I$e,Ra.gFi())?A.endsWith("start")?this.nca=Ra.i8i(ca):A.endsWith("end")?(Ra.g8i(ca),this.nca=!0):A.endsWith("cancel")?
(Ra.f8i(ca),this.nca=!0):A.endsWith("move")&&(this.nca=Ra.h8i(ca)):n.ULS.sendTraceTag(42256257,310,50,"App rejected to perform gesture now : {0}",A))}}get(A){return Object(G.a)(Hammer.Recognizer,A)}Kai(A){if(1>A.length)return null;if(1===A.length)return A[0];var ca=A[0],Ra=!0;for(let Zb=1;Zb<A.length;Zb++){if(!A[Zb])return null;if(ca!==A[Zb]){Ra=!1;break}}if(Ra)return ca;ca=this.baf(A[0]);Ra=0;for(const Zb of A){A=this.baf(Zb);if(ca.ma(ca.count-1)!==A.ma(A.count-1))return null;for(let wc=ca.count-
2,Jc=A.count-2;wc>=Ra&&0<=Jc;wc--,Jc--)if(ca.ma(wc)!==A.ma(Jc)){Ra=wc+1;break}}return ca.ma(Ra)}baf(A){const ca=new Ea.a;for(;void 0!==A&&null!==A;A=A.parentNode)ca.add(A);return ca}gef(A){switch(A){case yc.a.Bh:case yc.a.Cda:return 1;case yc.a.Ki:case yc.a.Kla:return 2;case yc.a.sg:case yc.a.ZLa:return 4;case yc.a.hLc:case yc.a.k9c:return 8}return 0}HDa(A,ca,Ra){A=this.gef(A);ca=this.n$h(Ra);Hammer.inputHandler(this,A,ca);this.nca&&Ra.preventDefault();return this.nca}Hlf(){return 1<this.vW.count}nac(){n.ULS.sendTraceTag(594055960,
310,50,"CancelPendingPointerEvents");if(this.ktb)for(const A of this.vW)this.X5f(A.key);else this.vW=new Mb.a;this.session=null}nWg(A,ca,Ra){n.ULS.sendTraceTag(594055959,310,50,"AddOrReplacePointerInCaches: pointerId: {0}",A);if(!this.Frb.kd(A)){try{ca.setPointerCapture(A)}catch(Zb){n.ULS.sendTraceTag(594055958,310,10,"Exception: {0}",Zb)}this.Frb.add(A,ca)}this.vW.fa(A,Ra);this.X_a&&1<this.vW.count&&this.vja&&!this.vja.Uwb&&(this.vja.Uwb=!0)}X5f(A){n.ULS.sendTraceTag(594055957,310,50,"RemovePointerFromCaches: pointerId: {0}",
A);if(this.Frb.kd(A)){try{this.Frb.ma(A).releasePointerCapture(A)}catch(ca){n.ULS.sendTraceTag(594055956,310,10,"Exception: {0}",ca)}this.Frb.remove(A)}else n.ULS.sendTraceTag(594055955,310,10,"RemovePointerFromCaches: pointerId should be in cache: {0}",A);this.vW.remove(A);this.X_a&&1>=this.vW.count&&this.vja&&this.vja.Uwb&&(this.vja.Uwb=!1)}xUa(A,ca,Ra){var Zb=Ra.rawEvent.pointerType.toString();const wc=Ra.rawEvent.pointerId.toString();if("touch"!==Zb)return!1;A=this.gef(A);if(1!==A&&!this.vW.kd(wc))return!1;
this.oge&&1===A&&Ra.rawEvent.isPrimary&&this.vW.count&&(n.ULS.sendTraceTag(593839564,310,10,"Pointer cache should be empty"),this.nac());this.ktb?this.nWg(wc,ca,Ra):this.vW.fa(wc,Ra);this.KXc&&2===A&&(!this.YQc||this.YQc&&"function"===typeof Ra.rawEvent.getCoalescedEvents)&&(ca=Ra.rawEvent.getCoalescedEvents())&&this.Hlf()&&(this.Qqb=Math.max(this.Qqb,ca.length));this.vte&&(this.nca=!1);Zb=this.m$h(this.vW,Ra,Zb);Hammer.inputHandler(this,A,Zb);if(4===A||8===A)this.ktb?this.X5f(wc):this.vW.remove(wc),
this.vW.count||(this.session=null,this.KXc&&-1!==this.Qqb&&(n.ULS.sendTraceTag(593597138,310,50,"Max number of coalesced events: {0}",this.Qqb),this.Qqb=-1));this.nca&&Ra.preventDefault();return this.nca}qyc(){return!1}n$h(A){const ca=new Zg;var Ra=A.rawEvent;const Zb=Ra.touches;Ra=Ra.changedTouches;ca.pointers=Array.clone(Zb);ca.pointers=Array.clone(0<Zb.length?Zb:Ra);ca.changedPointers=Array.clone(Ra);ca.srcEvent=A;ca.pointerType="touch";return ca}m$h(A,ca,Ra){const Zb=new Zg;Zb.pointers=ch.toArray(A.values);
Zb.changedPointers=[ca];Zb.pointerType=Ra;Zb.srcEvent=ca;return Zb}WHi(A){return kb.a.startsWith(A,yc.a.pinch)}LHi(A){return kb.a.startsWith(A,yc.a.pan)}XKi(A){return kb.a.startsWith(A,yc.a.swipe)}}Object(l.a)(qg,"GestureInputManager",Qg.a,[322,323]);var zg=a(292);class wh{constructor(){this.hd=null;this.Rz=!1}get name(){return"Common.App.GestureInputManager"}Xj(A){A.register(qg,"Common.App.GestureManager.GestureInputManager").as("Common.IGestureInputManager").Ee().Le(()=>new qg(zg.a.instance,O.AFrameworkApplication.sa.EG));
this.hd=A}init(){this.Rz||(this.hd.resolve("Common.App.GestureManager.GestureInputManager"),this.Rz=!0)}dispose(){}static main(){va.a.instance.Tk(new wh)}}Object(l.a)(wh,"GestureInputManagerPackage",null,[2,3]);var Ag=a(105);class Sg extends Ag.a{constructor(){super()}static instance(){return Sg.La||(Sg.La=new Sg)}}Sg.Dfj="OnTextSelectionHighlightChangeEvent";Sg.La=null;Object(l.a)(Sg,"TextSelectionHighlightChangeEvent",Ag.a,[]);class dh extends Eg.a{constructor(A,ca){super(!1,!1,!0);this.uHa=A;this.ORg=
ca}start(){var A={["tooltipPersistenceEnabled"]:this.uHa.Dwd};O.AFrameworkApplication.da.getBooleanFeatureGate("Microsoft.Office.WordOnline.SelectionHighlightChangeEnabled",!1)&&(A.textSelectionChangeEnabled=this.uHa.VWb);A={["id"]:"AccessibilitySettingsDialog",["bodyControls"]:A};this.initializeAndShow("",Object(B.a)(this,this.EHj,"resultHandler"),A)}EHj(A,ca){1===A&&(this.uHa.Dwd=ca.tooltipPersistenceEnabled,O.AFrameworkApplication.da.getBooleanFeatureGate("Microsoft.Office.WordOnline.SelectionHighlightChangeEnabled",
!1)&&(A=ca.textSelectionChangeEnabled,this.uHa.VWb!==A&&this.ORg.raiseEvent(Sg.Dfj),this.uHa.VWb=A))}}Object(l.a)(dh,"AccessibilitySettingsDialog",Eg.a,[]);var Sh=a(116);class Tf{constructor(A,ca){this.Na=A;this.uHa=ca}tj(){this.Na.ae(Ua.a.TZj,Sh.a.frame,Object(B.a)(this,this.UZj,"showAccessibilitySettingsDialogHandler"))}UZj(){(new dh(this.uHa,Sg.instance())).start();return 32}}Object(l.a)(Tf,"AccessibilitySettingsDialogActor",null,[324]);const ag=A=>{const ca=new Rb.a;O.AFrameworkApplication.tf.Ho(yh(A),
1,null,null,!0,2,Ra=>{200===Ra.data.httpStatus?ca.setResult("true"===Ra.data.Tf.toLowerCase()):ca.setResult(!1)},()=>{ca.setResult(!1)},null,void 0,void 0,void 0,void 0,"7");return ca.task},Cf=(A,ca)=>{O.AFrameworkApplication.tf.Ho(yh(A),2,ca.toString().toLowerCase(),null,!0,2,null,null,null,void 0,void 0,void 0,void 0,"8")},yh=A=>String.format("{0}RoamingServiceHandler.ashx?action={1}&{2}",O.AFrameworkApplication.da.appSettings.RoamingServiceHandlerWebServiceBase||"",A,O.AFrameworkApplication.Ak);
var xa=a(147);class wa{constructor(){this.P2a=this.$0a=null}get Dwd(){return!!this.$0a}set Dwd(A){A!==this.$0a&&(this.$0a=A,xa.a("setHoverableTooltipsPreference")&&appChrome.api.setHoverableTooltipsPreference(A),this.Yrc()&&Cf("saveHoverableRibbonTooltipIsEnabled",A))}get VWb(){return!!this.P2a}set VWb(A){A!==this.P2a&&(this.P2a=A,this.Yrc()&&Cf("saveTextSelectionHighlightChangeIsEnabled",A))}rQi(){const A=new Rb.a;if(this.$0a)A.setResult(this.$0a);else if(this.Yrc()){const ca=ag("getHoverableRibbonTooltipIsEnabled");
ca.continueWith(()=>{this.$0a=ca.result;xa.a("setHoverableTooltipsPreference")&&appChrome.api.setHoverableTooltipsPreference(ca.result);A.setResult(ca.result)},8)}else A.setResult(!1)}OQi(){const A=new Rb.a;if(this.P2a)A.setResult(this.P2a);else if(this.Yrc()){const ca=ag("getTextSelectionHighlightChangeIsEnabled");ca.continueWith(()=>{this.P2a=ca.result;A.setResult(ca.result)},8)}else A.setResult(!1)}Yrc(){const A=O.AFrameworkApplication.da.pa("IsRoamingServiceEnabled"),ca=O.AFrameworkApplication.da.pa("IsAnonymousUser");
return A&&!ca}}Object(l.a)(wa,"AccessibilitySettingsInfo",null,[321]);var Ic=a(119);class Zd{constructor(){this.hd=null}get name(){return"Common.App.AccessibilitySettings"}Xj(A){this.hd=A;this.hd.register(wa,"Common.App.AccessibilitySettings.AccessibilitySettingsInfo").as("Common.App.AccessibilitySettings.IAccessibilitySettingsInfo").Le(()=>new wa).Ee();this.hd.register(Tf,"Common.App.AccessibilitySettings.AccessibilitySettingsDialogActor").as("Common.App.AccessibilitySettings.IAccessibilitySettingsDialogActor").Le(()=>
new Tf(O.AFrameworkApplication.Dd,this.hd.oi("Common.App.AccessibilitySettings.IAccessibilitySettingsInfo"))).Ee()}init(){const A=this.hd.oi("Common.App.AccessibilitySettings.IAccessibilitySettingsInfo"),ca=this.hd.oi("Common.App.AccessibilitySettings.IAccessibilitySettingsDialogActor");A&&ca?(ca.tj(),A.rQi(),A.OQi(),Ic.a(508827098,200,50,"Text Selection Highlight Change Setting value on boot: {0}",A.VWb)):Ic.a(539637639,200,15,"Failed to resolve IAccessibilitySettingsDialogActor or IAccessibilitySettingsInfo. A11y dialog feature is not enabled.")}dispose(){}static main(){va.a.instance.Tk(new Zd)}}
Object(l.a)(Zd,"AccessibilitySettingsPackage",null,[2,3]);var Ke=a(35),Te=a(12),If=a(253);class Ef{constructor(A){this.WEc=A||""}static get x_e(){return Ef.Tie||(Ef.Tie=new Ef(""))}static get tHd(){return Ef.fpe||(Ef.fpe=Ef.oY(2).WEc)}static iPa(A){A=kb.a.nm(A||"");return new Ef(A)}static Ena(A){return Ef.iPa(Ub.a.instance.ia(A))}static oY(A){return new Ef(Ub.a.instance.Ia(A))}static Hnd(A,...ca){return Ef.cZh(Ub.a.instance.xd(A),...ca)}static cZh(A,...ca){const Ra=ca.length,Zb=Array(Ra);for(let wc=
0;wc<Ra;wc++)Zb[wc]=(ca[wc]||Ef.x_e).WEc;return new Ef(String.format(A,Zb))}}Ef.Tie=null;Ef.fpe=null;Object(l.a)(Ef,"SafeHtml",null,[243]);const ta=(A,ca)=>{ca&&(A.append(ca),A.append(Ef.tHd))};var zb=a(118),qc=a(779),Kc=a(224);class Xc{constructor(A,ca){this.g4=this.fV=this.gO=null;this.zna=ca;this.lth(A);this.Lnj();Sb.EwaSettings.Fd()&&A.ga.Qa(244,this)}get isActive(){return!!this.zna&&document.activeElement===this.zna}readText(A){A=Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:7663175_RemoveGridBeingReadoutInFocusBasedReadout")?
A:String.format(Ub.a.instance.xd(30),A);this.gO.setAttribute(Hc.a.Pw,A);this.fV.setAttribute(Hc.a.Pw,A);this.G7j()}dispose(){this.g4&&this.g4.parentNode&&this.g4.parentNode.removeChild(this.g4);this.fV=this.gO=this.g4=this.zna=null}lth(A){var ca=A.Pd+"readoutElementWrapper";const Ra=A.Pd+"readoutElement1",Zb=A.Pd+"readoutElement2";this.g4=document.getElementById(ca);this.g4||(this.g4=document.createElement(Kc.a.div),this.g4.id=ca,this.gO=document.createElement(Kc.a.label),this.gO.id=Ra,this.gO.setAttribute(Hc.a.Mf,
Hc.a.v4a),this.gO.setAttribute("aria-roledescription",""),this.gO.setAttribute("aria-multiline",!1),this.fV=document.createElement(Kc.a.label),this.fV.id=Zb,this.fV.setAttribute(Hc.a.Mf,Hc.a.v4a),this.fV.setAttribute("aria-roledescription",""),this.fV.setAttribute("aria-multiline",!1),this.gO.style.width="0px",this.gO.style.height="0px",this.fV.style.width="0px",this.fV.style.height="0px",this.gO.tabIndex=-1,this.fV.tabIndex=-1,this.g4.appendChild(this.gO),this.g4.appendChild(this.fV),A=A.Pd+Hc.a.occ,
ca=document.getElementById(A),n.ULS.shipAssertTag(537153942,3,!!ca,`FocusBasedReadout.CreateReadoutElementsIfNeeded: expected to find contentAreaDiv with id: ${A}`),ca&&ca.appendChild(this.g4))}Lnj(){this.zna&&this.gO&&this.fV&&(this.zna.setAttribute(Hc.a.N6,this.gO.id),this.zna.setAttribute(Hc.a.A9b,`${this.gO.id} ${this.fV.id}`))}G7j(){if(this.isActive){let A="";Te.DOMElementExtensions.hasAttribute(this.zna,Hc.a.N6)&&(A=this.zna.getAttribute(Hc.a.N6).toString());this.zna.setAttribute(Hc.a.N6,A===
this.gO.id?this.fV.id:this.gO.id)}else n.ULS.shipAssertTag(537153941,0,!1,"FocusBasedReadout.SwitchVirtualFocus: called when is not active.")}static tBa(){if(null==Xc.mCb)if(Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ActiveDescendantGridReadout",!1)&&!Y.a.uSa)Xc.mCb=!0,n.ULS.sendTraceTag(537153940,0,50,"FocusBasedReadout.IsFocusBasedCellReadoutActive: ActiveDescendantGridReadout Flight is enabled");else if(Xc.mCb=!1,Y.a.TK||Y.a.vh)Xc.mCb=!0,n.ULS.sendTraceTag(537153939,0,50,"FocusBasedReadout.IsFocusBasedCellReadoutActive: The FocusBasedCellReadout BRS is on");
return Xc.mCb}static la(A){Xc.tBa()&&A.ga.Qa(244,new Xc(A,U.h(A).cellTextEditBox.textBox.Pg))}}Xc.mCb=null;Object(l.a)(Xc,"FocusBasedReadout",null,[216,5]);let Sd=class{constructor(A,ca,Ra,Zb){Ra=void 0===Ra?A.Ww:Ra;Zb=void 0===Zb?A.Eh:Zb;this.HMf=(wc,Jc)=>{this.wTd(Jc.Bf.command)};this.odg=()=>{if(!this.$.ea.oe){var wc={["AriaLiveOffCount"]:this.Vee,["AriaLivePoliteCount"]:this.Wee,["AriaLiveAssertiveCount"]:this.Uee,["AriaLiveRudeCount"]:this.Xee,["ScreenReaderDivCount"]:this.tue,["AlertScreenReaderDivCount"]:this.Aee,
["AuxScreenReaderDivCount"]:this.efe,["AriaAlertCount"]:this.See,["ReadCommandOnCompletionCount"]:this.ate,["TotalAriaLiveRegionUpdates"]:this.Ywe};vh.a.sendTelemetryEvent(Object(jb.a)(new bf.a,{name:"Office.Excel.Online.Accessibility.AriaLiveNotifier",dataFields:zb.a.$k(wc)}))}};this.$=A;this.Zd=void 0===ca?null:ca;this.Jba=document.createElement("div");this.Jba.setAttribute(Hc.a.O6,Hc.a.Hm);this.Jba.className=Ke.a.akd;Ra.insertBefore(this.Jba,Zb);this.Lca=document.createElement("div");this.Lca.setAttribute(Hc.a.O6,
Hc.a.Hm);this.Lca.className=Ke.a.akd;Ra.insertBefore(this.Lca,this.Jba);this.JMg=Ub.a.instance.Ia(2);this.Q6=document.createElement("div");this.Q6.setAttribute(Hc.a.Mf,Hc.a.tla);this.Q6.setAttribute(Hc.a.ula,Hc.a.FLa);this.Q6.className=Ke.a.akd;Ra.insertBefore(this.Q6,this.Lca);this.Ywe=this.ate=this.See=this.efe=this.Aee=this.tue=this.Xee=this.Uee=this.Wee=this.Vee=0;this.register();Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Migrate2AriaLiveNotifier",!1)||this.$.ga.Qa(211,this)}get zTa(){return this.JMg}get isActive(){return!0}get j2g(){return this.Jba}get cLj(){return this.Lca}get activeCell(){return U.h(this.$).Hd(null)}get rHb(){return Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ConfirmationForFreewayScenarios",
!1)}dispose(){this.$&&this.unregister();Te.DOMElementExtensions.Oh(this.Q6);Te.DOMElementExtensions.Oh(this.Jba);Te.DOMElementExtensions.Oh(this.Lca);this.Lca=this.Jba=this.Q6=this.$=null}setEnabled(A){this.ifg(this.Lca,A)}oQj(){this.ifg(this.Jba,!0)}readText(A){this.Bhb(Ef.iPa(A),!0)}uha(A){this.Bhb(Ef.iPa(A),!1)}P2f(A,ca){if(1>ca||!A)n.ULS.shipAssertTag(537153954,0,!1,"Skiping listbox description readout");else{var Ra=new Sys.StringBuilder;A=String.format(Ub.a.instance.xd(34),ca,A);ta(Ra,A);ta(Ra,
Ub.a.instance.ia(857));this.Bhb(Ef.iPa(Ra.toString()),!1)}}duj(A,ca,Ra){if(1>Ra||1>ca||ca>Ra||!A)n.ULS.shipAssertTag(537153952,0,!1,"Skipping listbox item readout");else{var Zb=new Sys.StringBuilder;ta(Zb,A);Zb.append(String.format(Ub.a.instance.xd(55),ca,Ra));this.Bhb(Ef.iPa(Zb.toString()),!1)}}wTd(A){this.rHb||(A=this.Hfi(A),this.Bhb(A,!1))}buj(A){this.rHb&&(A=this.Gfi(A),this.Bhb(A,!1,!0))}Bhb(A,ca,Ra){Ra=void 0===Ra?!1:Ra;if(A=A?A.WEc:null)ca=ca?this.Lca:this.Jba,Rd.a.equals(ca.innerHTML,A,!1)&&
(A+=Ef.tHd),this.Grg(ca,Ra),this.Zd.Tj(ca,A)}RVa(A,ca){this.Q6.getAttribute(Hc.a.ula)!==ca&&this.Q6.setAttribute(Hc.a.ula,ca);A=A?Ef.iPa(A).WEc:"";this.Grg(this.Q6);this.Zd.Tj(this.Q6,A)}euj(A,ca,Ra,Zb){var wc=!0;wc=void 0===wc?!1:wc;const Jc=Ub.a.instance.xd(54);n.ULS.shipAssertTag(537153949,0,!(void 0===A||null===A));n.ULS.shipAssertTag(537153948,0,!(void 0===ca||null===ca));n.ULS.shipAssertTag(537153947,0,!(void 0===Ra||null===Ra));n.ULS.shipAssertTag(537153946,0,!(void 0===Zb||null===Zb));n.ULS.shipAssertTag(537153945,
0,!(void 0===Jc||null===Jc));A=String.format(Jc,A||"",ca||"",Ra||"",Zb||"");wc?this.RVa(A,Hc.a.kxa):this.readText(A)}Agk(A){var ca=this.Lca.style;A?(A=If.a.B$b(A.cell,ca),ca=A.pB,ca.top=ca.left=ca.bottom=ca.right=null,A.dX()):ca.cssText=""}Hfi(A){if(this.rHb)return null;switch(A){case -1985798686:return Ef.Ena(12);case -911352779:return Ef.Ena(11);case 237279923:return Ef.Ena(13);case -1502853784:return Ef.oY(81);case -111689794:return Ef.oY(78);case -287251124:return this.nsd(1333,ca=>ca.bold);case -1925065947:return this.nsd(1334,
ca=>ca.italic);case 1764140053:return this.nsd(1335,ca=>ca.underline)}return null}Gfi(A){if(!this.rHb||6!==A.Tg)return null;const ca=this.activeCell;if(!ca)return null;switch(A.command){case -1985798686:return Ef.Ena(12);case -911352779:return Ef.Ena(11);case 237279923:return Ef.Ena(13);case -1502853784:return Ef.oY(81);case -111689794:return Ef.oY(78);case 368460465:A=U.h(this.$).zd.sh(ca.range,!0);if(null!==A)return this.jQa(2291,!A.hasAutoFilter,!1);A=this.$.va.getItemByName(this.$.ea.na.sheetName);
return this.jQa(2291,null===A.zV,!1);case -1522760979:return this.jQa(1150,U.h(this.$).isFormulaView,!1);case 1941920197:return Ef.Ena(836);case 1051390410:return Ef.oY(589);case 1542466017:return Ef.oY(591);case -706918724:return Ef.oY(590);case 369708605:return Ef.oY(592);case -1215659745:return Ef.oY(523);case 1783960667:return Ef.oY(521);case -1355155015:return Ef.oY(554);case -1158102843:return Ef.oY(522);case -287251124:return A=this.oqc(A.command,ca),null===A?null:this.jQa(1333,A);case -1925065947:return A=
this.oqc(A.command,ca),null===A?null:this.jQa(1334,A);case 1764140053:return A=this.oqc(A.command,ca),null===A?null:this.jQa(1335,A);case -1590502662:return A=this.oqc(A.command,ca),null===A?null:this.jQa(1336,A);case 862890474:case 963349338:if(A=this.$za(ca),null!==A)return A=Ef.iPa(String(A)),Ef.Hnd(214,A)}return null}register(){n.ULS.shipAssertTag(537153944,0,!!this.$,"Can't register to ewaControl's events");this.$&&(n.ULS.shipAssertTag(537153943,0,!!this.$.Ha,"Can't register to CommandHandlerManager's event"),
this.$.Ha&&this.$.Ha.bla(this.HMf),this.$.ea&&this.$.ea.jH(this.odg))}unregister(){this.$&&(this.$.Ha.Hha(this.HMf),this.$.ea.OI(this.odg))}ifg(A,ca){const Ra=A===this.Jba;ca?(Ra&&Xc.tBa()||A.setAttribute(Hc.a.ula,Hc.a.kxa),Ra&&A.setAttribute(Hc.a.Mf,Hc.a.tla),A.setAttribute(Hc.a.O6,Hc.a.Ov),A.removeAttribute(Hc.a.O6),this.Zd.Tj(A,A.innerHTML+" ")):(A.removeAttribute(Hc.a.ula),Ra&&A.removeAttribute(Hc.a.Mf),A.setAttribute(Hc.a.O6,Hc.a.Hm))}nsd(A,ca){const Ra=this.activeCell;if(!Ra)return null;const Zb=
Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:7150857_FlipRibbonCommandStateAriaDescription"),wc=[7,8];ca=ca(Ra)?!0:!1;return Ef.Hnd(Zb?wc[+ca]:wc[+!ca],Ef.Ena(A))}Grg(A,ca){ca=void 0===ca?!1:ca;switch(A.getAttribute(Hc.a.ula)){case Hc.a.FGe:++this.Vee;break;case Hc.a.kxa:++this.Wee;break;case Hc.a.FLa:++this.Uee;break;case Hc.a.h5g:++this.Xee}switch(A){case this.cLj:++this.tue;break;case this.j2g:++this.Aee;break;case this.Q6:++this.efe}A.getAttribute(Hc.a.Mf)===Hc.a.tla&&++this.See;ca&&++this.ate;
this.Ywe++}jQa(A,ca,Ra){Ra=void 0===Ra?!0:Ra;return this.rHb?Ef.Hnd(ca?Ra?7:216:Ra?8:217,Ef.Ena(A)):null}oqc(A,ca){return U.h(this.$).ha.Va.rU?this.LEi(A):this.MEi(A,ca)}LEi(A){const ca={};switch(A){case -287251124:A="QueryBold";break;case -1925065947:A="QueryItalics";break;case 1764140053:A="QueryUnderline";break;case -1590502662:A="QueryStrikethrough";break;default:return!1}const Ra=mf.a(this.$);return Ra?(Ra.HQa(A,ca),ca[qc.a.On]):!1}MEi(A,ca){if(!ca)return null;var Ra=U.h(this.$);ca=Dc.a(ca);
Sb.EwaSettings.Fd()&&Ra.ld&&(ca.Font=Ra.Nk.aAa(ca.Font));Ra=ca.Font;switch(A){case -287251124:return Ra.Bold;case -1925065947:return Ra.Italic;case 1764140053:return Ra.Underline;case -1590502662:return Ra.Strikethrough}return!1}$za(A){if(!A)return null;let ca=U.h(this.$);if(ca.ha.Va.rU)return null;A=Dc.a(A);Sb.EwaSettings.Fd()&&ca.ld&&(A.Font=ca.Nk.aAa(A.Font));return A.Font.FontSize}};Sd=Object(vb.a)([Object(ab.d)(Wb.f),Object(vb.b)(0,Object(Wb.W)()),Object(vb.b)(1,Object(Wb.Ab)())],Sd);Object(l.a)(Sd,
"AriaLiveNotifier",null,[215,216,5]);class me extends Ob.a{constructor(A){super();this.$=A;this.je()}create(){const A=Object(Bc.d)(ab.a.resolve(Wb.Ab,{Ja:this.Ta}));Jd.TaskExtensions.za(Jd.TaskExtensions.Wf([A],this.$.ka),()=>{this.Ld(this.$.ga.Da(211)||new Sd(this.$,A.result,this.$.Ww,this.$.Eh))},this.ka,3)}static la(A){A.ga.Qa(212,new me(A))}}Object(l.a)(me,"AriaLiveNotifierFactory",Ob.a,[]);class Le extends Ob.a{constructor(A){super();this.$=A;this.je()}create(){Xc.tBa()?U.h(this.$).cellTextEditBox.textBox.eT(()=>
{const A=this.$.ga.Da(244)||new Xc(this.$,U.h(this.$).cellTextEditBox.textBox.Pg);this.Ld(A)}):this.Ld(null)}static la(A){A.ga.Qa(315,new Le(A))}}Object(l.a)(Le,"FocusBasedReadoutFactory",Ob.a,[]);const Xe=A=>{switch(A){case 1:return 1457;case 2:return 1458;case 3:return 1459;case 4:return 1460;case 5:return 1461;case 6:return 1462;case 7:return 1463;case 8:return 1464;case 9:return 1465;case 10:return 1466;case 11:return 1467;case 12:return 1468;case 13:return 1469;case 14:return 1470;case 15:return 1471;
case 16:return 1472;case 17:return 1473;case 18:return 1474;case 19:return 1475;case 20:return 1476;case 21:return 1477;case 22:return 1480;case 23:return 1478;case 24:return 1479;case 25:return 1481;case 26:return 1482;case 27:return 1483;case 28:return 1484;default:return 1485}};var rf=a(221);class Ff{static get Psj(){return Ff.Tse||(Ff.Tse=RegExp("([A-Z]+)","g"))}static get Osj(){return Ff.Sse||(Ff.Sse=RegExp("([A-Z])","g"))}static get $fh(){return Ff.jge||(Ff.jge=RegExp("^\\$?[A-Z]+\\$?[0-9]+$|^\\$?[A-Z]+\\$?[0-9]+:\\$?[A-Z]+\\$?[0-9]+$|^\\$?[A-Z]+:\\$?[A-Z]+$|^\\$?[0-9]+:\\$?[0-9]+$"))}static bsd(A){return Ff.Agf(A.toString())}static Agf(A){return Ff.$fh.test(A)?
A.replace(Ff.Psj,"$1 ").replace(Ff.Osj,' "$1"').trim():A}static fEj(A){const ca=A.lastIndexOf("!");return A.substring(0,-1<ca?ca+1:0)+Ff.Agf(A.substring(-1<ca?ca+1:0,A.length))}}Ff.Tse=null;Ff.Sse=null;Ff.jge=null;Object(l.a)(Ff,"RangeAriaExtensions",null,[]);class Kf{constructor(){this.activeItemName=null;this.bxf=!1;this.tableName=null;this.j6a=0;this.bKc=!1}}Object(l.a)(Kf,"SelectionReadoutState",null,[]);class Pf{constructor(A,ca,Ra,Zb,wc){this.gridReadoutNotifier=null;this.vhb=!1;this.Axa=this.Fvb=
null;this.tha=()=>{Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:5963256_DoNotReadActiveItemIfDisposed")&&!this.$?n.ULS.sendTraceTag(526235470,0,15,"calling readActiveItemDescription after dispose, ignoring."):(!U.h(this.$).ld||Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:8009961_ReadoutRangePicker")&&U.h(this.$).inRangePicker)&&this.E9b.Es()};this.W2i=()=>{if(!U.h(this.$).ha.Va.OBd){var Jc,fd=(()=>{let $d=this.i1h();({activeCell:Jc}=$d);return $d})().returnValue;this.readText(fd,Jc)}};this.hE=()=>
{const Jc=this.activeCell;this.readText("Editing",Jc);Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:5190952_removePhoneticErrorDialog2")||Jc&&Jc.dnc&&!U.h(this.$).Rlf||this.E9b.cancel()};this.uf=()=>{Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:6053639_DoNotHandleSelectionChangedIfDisposed")&&!this.$?n.ULS.sendTraceTag(525366409,0,15,"calling onSelectionChanged after dispose, ignoring."):(this.tha(),this.vhb&&U.h(this.$).inRangePicker&&1===$a.a.Bd&&(null===this.Fvb?this.Fvb=Yb.a.instance.create(this.BTd,
Pf.H6b,"readSelectedRanges"):this.Fvb.Es()))};this.$=ca;this.ariaLiveNotifier=A;this.$Vb=Zb;this.tableManager=Ra;this.wG=new Kf;this.tBa=Xc.tBa();this.vhb=Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:5888244_FixCellReadoutInRangePicking");this.tBa&&(Sb.EwaSettings.Fd()?this.gridReadoutNotifier=wc:this.gridReadoutNotifier=ca.ga.Da(244),n.ULS.shipAssertTag(537153937,0,!!this.gridReadoutNotifier,"SelectionReadoutHandler.ctor: gridReadoutNotifier shouldn't be null"),Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:7945213_removeActiveCellDelayForBraille")?
Pf.H6b=0:Pf.H6b=700);this.E9b=Yb.a.instance.create(this.W2i,Pf.H6b,Ca.a.EMj,!1);this.il()}get activeCell(){return U.h(this.$).Hd(null)}dispose(){this.$&&this.Jk();ub.a.Ma(this.E9b);this.$Vb=this.$=this.E9b=null}Rod(A,ca,Ra){Ra=void 0===Ra?!0:Ra;if(null!==this.$.yd.$i&&"FindAndReplaceDialog"===this.$.yd.$i.we||!A)return"";var Zb=this.$.ga;const wc=new Sys.StringBuilder;this.T3g(wc,A,ca);if(Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:4124702_ColumnHeaderReadout")){var Jc=this.tableManager.coa(A.range);
(null===Jc||void 0===Jc?0:Jc.Q3d)&&this.fFe(wc,Jc);Jc=this.tableManager.fu(A.range);(null===Jc||void 0===Jc?0:Jc.Aoa)&&this.fFe(wc,Jc)}Jc=A.W8?this.Wdf(A):A.text;ta(wc,Jc);Jc=this.$.activeItemName;this.wG.activeItemName!==Jc&&(ta(wc,Jc),this.wG.activeItemName=Jc);Jc=1===ca.length?ec.L(ca).isSingle?"":Ub.a.instance.ia(853):String.format(Ub.a.instance.xd(31),ca.length);ta(wc,Jc);for(var fd of ca)Jc=this.tBa?fd.toString():Ff.bsd(fd),ta(wc,Jc),1===ca.length&&Pf.DLi(fd)&&(Jc=U.h(this.$).ya.du(fd.bottomRight),
void 0!==Jc&&null!==Jc&&Jc.text&&(Jc=Jc.W8?this.Vdf(Jc,Jc.text):Jc.text,ta(wc,Jc)));fd=A.cell;fd=this.Tci(fd.QIj,fd.$ih);ta(wc,fd);this.D3g(wc,A);Ra&&(A.dcb?ta(wc,Ub.a.instance.ia(841)):A.jSa&&ta(wc,Ub.a.instance.ia(842)));if(A.hasAutoFilter||A.E2)this.U3g(wc,A.hasAutoFilter?A.cell.autoFilterType:A.cell.Zkj),Ra&&ta(wc,Ub.a.instance.ia(844));rf.c(this.$,A.range)&&ta(wc,Ub.a.instance.ia(848));this.A3g(wc,A);Ra=(Ra=Zb.Da(14))?Ra.h2h():"";ta(wc,Ra);A.dz&&(Ra=U.h(this.$).ya.du(A.range),Ra=!!Ra&&Ra.hasIgnorableError,
Pf.zWj(A)?Pf.B3g(wc,A):Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:3286994_NarratorForFormulaErrors")&&Ra?ta(wc,Ub.a.instance.ia(846)):ta(wc,Ub.a.instance.ia(845)));A.eQ&&(ta(wc,Ub.a.instance.ia(847)),A.kFb&&ta(wc,String.format(Ub.a.instance.xd(16),A.fwh)),ta(wc,A.iconName));A.hasRichValueIcon&&(fd=this.$.ga.Da(271),Ra="",fd&&A.cell.pBf&&(fd=fd.QX(A.cell.pBf))&&fd.DomainId.Id!==Pf.Gok&&(Ra=fd.Name),A.cell.dBi?(ta(wc,String.format(Ub.a.instance.xd(187),Ra)),ta(wc,Ub.a.instance.ia(1812))):(ta(wc,
String.format(Ub.a.instance.xd(185),Ra)),ta(wc,Ub.a.instance.ia(1811))));this.iqi(A)&&ta(wc,Pf.X8h(A));(Zb=Zb.Da(231))&&ta(wc,Zb.kef(ca,!0));1===ca.length&&ca[0].isSingle&&Pf.yWj(A,ca[0],this.$)&&(ca=this.$.ga.Da(271))&&ta(wc,ca.u2h());A.lXb&&A.mXb&&ta(wc,A.mXb);(ca=A.cell.V$c)&&ta(wc,ca);this.z3g(wc,A);A.hSa&&A.uPb&&(A=A.fQd)&&(ta(wc,Ub.a.instance.ia(1985)),ta(wc,A));return wc.toString()}mKe(A){this.Axa=this.wG;this.wG=Object(jb.a)(new Kf,{activeItemName:this.Axa.activeItemName,bKc:A?this.Axa.bKc:
!1,tableName:A?this.Axa.tableName:"",j6a:A?this.Axa.j6a:-1})}t$f(){this.Axa&&(this.wG=this.Axa,this.Axa=null)}Tci(A,ca){return 2===A||2===ca?Ub.a.instance.ia(875):1===A||1===ca?Ub.a.instance.ia(876):""}Wdf(A){return this.Vdf(A.cell,A.text)}T3g(A,ca,Ra){if(Ra&&1===Ra.length&&Ra[0].isSingle){Ra="";var Zb=this.tableManager.coa(ca.range);if(Zb){Ra=Zb.pivotTableName;this.V6c(A,Ra);var wc=Zb.aqc?Ub.a.instance.ia(835):"";Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:6154754_NarratorReadoutForPivotTableAltText")&&
(wc+=(Zb.altText?Zb.altText+" . ":"")+(Zb.altTextSummary?Zb.altTextSummary:""));this.hFe(A,!0,Ra,wc);ta(A,this.tableManager.rJi(Zb,ca.range)?Ub.a.instance.ia(838):"");ta(A,this.tableManager.CCi(Zb,ca.range)?Ub.a.instance.ia(837):"")}else if(Zb=this.tableManager.fu(ca.range)){Ra=(wc=U.h(this.$).zd.sh(ca.range))?wc.name:"";this.V6c(A,Ra);let Jc="";wc&&(Jc=(wc.cZa?wc.cZa+" . ":"")+(wc.dZa?wc.dZa:""));this.hFe(A,!1,Ra,Jc);ta(A,this.tableManager.huf(Zb,ca.range)?Ub.a.instance.ia(837):"")}else this.V6c(A,
Ra),this.wG.tableName="",this.wG.j6a=-1}}V6c(A,ca){ca!==this.wG.tableName&&this.wG.tableName&&(A.append(Ub.a.instance.ia(this.wG.bKc?834:833)),ta(A," "+this.wG.tableName))}hFe(A,ca,Ra,Zb){Ra!==this.wG.tableName&&(A.append(Ub.a.instance.ia(ca?832:831)),ta(A," "+Ra),ta(A,Zb),this.wG.tableName=Ra,this.wG.bKc=ca,this.wG.j6a=-1)}fFe(A,ca){const Ra=U.h(this.$).ha.ra.activeCell;if(Ra.top!==ca.top&&Ra.left!==this.wG.j6a){A.append(Ub.a.instance.ia(837));ca=new Kb.Range(ca.top,Ra.left,ca.top,Ra.left,!0,!0);
ta(A,Ff.bsd(ca));if(ca=U.h(this.$).Hd(ca))ca=ca.W8?this.Wdf(ca):ca.text,ta(A,ca);this.wG.j6a=Ra.left}}Vdf(A,ca){const Ra=A.rab;return A.FAa?String.format(Ub.a.instance.xd(14),ca,Ra):String.format(Ub.a.instance.xd(13),ca,Ff.fEj(Ra))}il(){n.ULS.shipAssertTag(537153930,0,!!this.$,"Can't register to ewaControl's events");if(this.$){var A=U.h(this.$);n.ULS.shipAssertTag(537153929,0,!!A,"Can't register to grid's events");A&&(A.he.Gp(this.hE),A.ya.Ws(this.tha),A.iH(this.tha),this.vhb&&A.he.Mq(this.wj.bind(this)),
A=A.ha,n.ULS.shipAssertTag(537153928,0,!!A,"Can't register to selectionManager's events"),A&&(A.kr(this.uf),A.add_activeCellChanged(this.tha),A.Va.ZW(this.tha),this.vhb&&(this.BTd=this.BTd.bind(this))))}}Jk(){if(this.$){var A=U.h(this.$);A&&(A.he.zp(this.hE),A.ya.Bs(this.tha),A.NI(this.tha),this.vhb&&A.he.$p(this.wj),A=A.ha)&&(A.Fr(this.tha),A.remove_activeCellChanged(this.tha),A.Va.taa(this.tha))}}readText(A,ca){this.tBa&&this.gridReadoutNotifier&&this.gridReadoutNotifier.isActive?this.gridReadoutNotifier.readText(A):
(this.ariaLiveNotifier.setEnabled(!0),this.ariaLiveNotifier.readText(A),this.vhb&&!ca||this.ariaLiveNotifier.Agk(ca))}wj(){this.Fvb&&this.Fvb.cancel()}BTd(){this.readText(this.sgi())}sgi(){let A="";U.h(this.$).ha.rangePicker.dO.forEach(()=>{A+=void 0});return A+=" selected"}i1h(){let A;A=null;var ca=U.h(this.$).ha;if(1!==ca.Bg&&!ca.Va.pe)return n.ULS.sendTraceTag(537153927,0,15,`selectionManager.CommandSelectionMode=${ca.Bg} and selectionManager.SelectedFloatingObjectControl is null`),{returnValue:"",
activeCell:A};switch(ca.Bg){case 2:return{returnValue:this.e4h(ca),activeCell:A};case 64:var Ra=ca.Va.pe.floatingObject;let Zb="";if(ca=ca.Va.pe.uv||ca.Va.pe.Kf)Zb=(ca=ca.firstChild)?Te.DOMElementExtensions.getTextContent(ca):"";return{returnValue:String.format(Ub.a.instance.xd(53),Pf.wjc(Ra.altText,Ra.altTextDescription,Ra.name),Zb,Ra.altTextDescription),activeCell:A};case 4:return{returnValue:Pf.J2g(ca.Va.pe.floatingObject),activeCell:A};case 512:return{returnValue:cf.a.xcf(ca.Va.pe.floatingObject.jid),
activeCell:A};case 8:return Ra=ca.Va.pe.floatingObject,{returnValue:String.format(Ub.a.instance.xd(51),Ra?Ra.name:""),activeCell:A};case 1:return A=this.activeCell,Ra=ca.ra.selectedRanges,Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:8009961_ReadoutRangePicker")&&U.h(this.$).inRangePicker?this.Iei(ca,A):{returnValue:this.Rod(A,Ra),activeCell:A}}return{returnValue:"",activeCell:A}}Iei(A,ca){A=A.rangePicker.dO.map(Zb=>Zb.range);const Ra=U.h(this.$).Hd(A[0]);return{returnValue:this.Rod(Ra,A),activeCell:ca}}e4h(A){const ca=
new Sys.StringBuilder;ca.append(Pf.tfh(A));const Ra=this.$.ga.Da(231);Ra&&ta(ca,Ra.kef(A.Va.pe.floatingObject,!1));return ca.toString()}iqi(A){A=A.bsf();let ca=!1;this.wG.bxf!==A&&(this.wG.bxf=A,ca=!0);return ca}D3g(A,ca){if(ca.aab)if(ca=this.$Vb.vhi(ca)){var Ra=Ub.a.instance,Zb=Ra.ia;a:switch(ca.type){case 0:var wc=828;break a;case 1:wc=829;break a;default:wc=830}Ra=Zb.call(Ra,wc);ta(A,String.format(Ub.a.instance.xd(25),Ra));ca=String.format(Ub.a.instance.xd(24),Ff.bsd(ca.U3j));ta(A,ca)}else n.ULS.sendTraceTag(537153925,
0,15,"No sparkline range was found on a cell with sparkline."),ta(A,String.format(Ub.a.instance.xd(25),""))}U3g(A,ca){switch(ca){case 1:case 11:ta(A,Ub.a.instance.ia(849));break;case 6:ta(A,Ub.a.instance.ia(849));ta(A,Ub.a.instance.ia(851));break;case 7:ta(A,Ub.a.instance.ia(849));ta(A,Ub.a.instance.ia(852));break;case 2:ta(A,Ub.a.instance.ia(850));ta(A,Ub.a.instance.ia(851));break;case 3:ta(A,Ub.a.instance.ia(850));ta(A,Ub.a.instance.ia(852));break;default:ta(A,Ub.a.instance.ia(850))}}A3g(A,ca){var Ra;
const Zb=this.$.ga.Da(65);ca=Zb?Zb.DPa(ca.range):null;let wc="";const Jc=Object(G.a)(319,ca);if(ca)wc=!ca.Kbb&&Jc&&Jc.aLi?String.format(Ub.a.instance.xd(29),Jc.y8j):String.format(Ub.a.instance.xd(23),ca.author);else if(null===(Ra=null===Zb||void 0===Zb?void 0:Zb.rp)||void 0===Ra?0:Ra.aI)wc=String.format(Ub.a.instance.xd(28),Zb.rp.MQ.author);ta(A,wc)}z3g(A,ca){const Ra=this.$.ga.Da(286);Ra&&(ca=Ra.j2h(pd.d(this.$.na),ca.range))&&0<ca.length&&(ca=String.format(Ub.a.instance.xd(1===ca.length?220:221),
ca[0]),ta(A,ca))}static J2g(A){return String.format(Ub.a.instance.xd(52),Pf.wjc(A.altText,A.altTextDescription,A.name),A.altTextDescription)}static X8h(A){return Ub.a.instance.ia(A.bsf()?839:840)}static wjc(A,ca,Ra){return A||ca?A:Ra}static tfh(A){var ca=A.Va.pe;A=ca.floatingObject;const Ra=A.df,Zb=Ra.ChartTitle,wc=A.altText,Jc=A.altTextDescription,fd=!!(Ra.Attributes&4);return(ca=ca.getSelectionDescription())?ca:Ra.DataRangeForDisplay?String.format(Ub.a.instance.xd(fd?49:47),Pf.wjc(wc,Jc,A.name),
Jc,Zb,Ub.a.instance.ia(Xe(Ra.ChartCategory)),Ra.DataRangeForDisplay):String.format(Ub.a.instance.xd(fd?50:48),Pf.wjc(wc,Jc,A.name),Jc,Zb,Ub.a.instance.ia(Xe(Ra.ChartCategory)))}static zWj(A){return Sb.EwaSettings.Ea(101)&&(A.GHb||A.Zpc)}static B3g(A,ca){ca.Vsa?ca.GHb?ta(A,String.format(Ub.a.instance.xd(26),ca.Vsa.topLeft.toString())):ca.Zpc&&(ca=ca.Vsa.YR(),ta(A,String.format(Ub.a.instance.xd(27),(ca.LastColumn-ca.FirstColumn+1).toString(),(ca.LastRow-ca.FirstRow+1).toString()))):n.ULS.shipAssertTag(537153924,
0,!1,"SelectionReadoutHandler.AppendAriaDynamicArrayFormulaDescription: This method should only be called with a valid dynamic array range.")}static yWj(A,ca,Ra){return A.dz||!Sb.EwaSettings.Ea(131)?!1:(A=Ra.ga.Da(271))?A.Cpc(ca):!1}static DLi(A){return A.top===A.bottom&&A.left+1===A.right||A.top+1===A.bottom&&A.left===A.right}}Pf.Gok=268435712;Pf.H6b=500;Object(l.a)(Pf,"SelectionReadoutHandler",null,[320,5]);class ya extends Ob.a{constructor(A){super();this.$=A;this.je()}create(){const A=this.$.ga,
ca=Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Migrate2AriaLiveNotifier",!1)?Object(Bc.d)(ab.a.resolve(Wb.f,{Ja:this.Ta})):$c.GetServiceTaskFactory.ud(A,211,212,this.Ta),Ra=Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:8111699_MigrateTableManager")?Object(Bc.d)(ab.a.resolve(Wb.Vc,{Ja:this.Ta})):$c.GetServiceTaskFactory.ud(A,66,134,this.Ta),Zb=Object(Bc.d)(ab.a.resolve(Wb.Tc,{Ja:this.Ta}));let wc=Aa.Task.Wa(null);Sb.EwaSettings.Fd()&&(wc=$c.GetServiceTaskFactory.ud(A,244,315,this.Ta));
Jd.TaskExtensions.za(Jd.TaskExtensions.Wf([ca,Ra,Zb,wc],this.ka),()=>{const Jc=Object(Ye.a)(this.$.ga,226,()=>new Pf(ca.result,this.$,Ra.result,Zb.result,wc.result));this.Ld(Jc)},this.$.ka,3)}static la(A){A.ga.Qa(227,new ya(A))}}Object(l.a)(ya,"SelectionReadoutHandlerFactory",Ob.a,[]);let Db=class extends cb.a{constructor(A){super();Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Migrate2GridHighlightBehaviorEventManager",!1)||A.ga.Qa(376,this)}N0g(A){this.addHandler("TAF",A)}iDj(A){this.removeHandler("TAF",
A)}Krj(){this.raiseEvent("TAF")}};Db=Object(vb.a)([Object(ab.d)(Wb.ub),Object(vb.b)(0,Object(Wb.W)())],Db);Object(l.a)(Db,"GridHighlightBehaviorEventManager",cb.a,[220,5]);class lc extends Ob.a{constructor(A){super();this.$=A;this.je()}create(){this.Ld(this.$.ga.Da(376)||new Db(this.$))}static la(A){A.ga.Qa(377,new lc(A))}}Object(l.a)(lc,"GridHighlightBehaviorEventManagerFactory",Ob.a,[]);var zc=a(83),id=a(250),Vd=a(172),de=a(127);class Je extends Sys.EventArgs{constructor(A,ca){super();this.start=
A;this.Fab=ca}}Object(l.a)(Je,"MarqueeResizeStartedOrEndedEventArgs",Sys.EventArgs,[]);class Ze extends cb.a{constructor(A){super();this.qvc=[3];this.fva=void 0;this.gridView=A;this.dtg=he.a.cG();this.sQ=he.a.cG()}get coloredReferencesManager(){const A=this.gridView.$.ga.Da(281);A||n.ULS.sendTraceTag(537159395,0,50,"BehaviorHelperMethods.ColoredReferencesManager: coloredReferencesManager is null. (This is not always an error, for example when called from SetMarqueeHandlesVisibility while moving between view and edit modes).");
return A}get RD(){if(this.fva)return this.fva;const A=this.gridView.$.ga.Da(464);A||n.ULS.sendTraceTag(510255179,0,50,"BehaviorHelperMethods.formulaAssistanceManager: formulaAssistanceManager is null. (This is not always an error, for example when called from SetMarqueeHandlesVisibility while moving between view and edit modes).");A.RD||n.ULS.sendTraceTag(510255178,0,50,"BehaviorHelperMethods.formulaAssistanceManager: formulaHighlightsControl is null.");return this.fva=A.RD}n_g(A){this.addHandler("mrek",
A)}pR(A,ca,Ra){for(const Zb of this.gridView.Xp)id.a.instance.ta(yc.a.Fn,Zb.domElement,A);id.a.instance.ta(yc.a.Gi,document.documentElement,ca);this.gridView.cellTextEditBox.ngc(!0);Ra&&id.a.instance.ta(yc.a.oE,this.gridView.un,ca)}S9d(A,ca,Ra){for(const Zb of this.gridView.Xp)id.a.instance.Aa(yc.a.Fn,Zb.domElement,A);id.a.instance.Aa(yc.a.Gi,document.documentElement,ca);this.gridView.cellTextEditBox.ngc(!1);Ra&&id.a.instance.Aa(yc.a.oE,this.gridView.un,ca)}Ywj(A,ca){for(const Ra of this.gridView.Xp)Vd.a.instance.ta(yc.a.Ki,
Ra.domElement,A);Vd.a.instance.ta(yc.a.sg,document.documentElement,ca)}xfk(A,ca){for(const Ra of this.gridView.Xp)Vd.a.instance.Aa(yc.a.Ki,Ra.domElement,A);Vd.a.instance.Aa(yc.a.sg,document.documentElement,ca)}ISe(A,ca,Ra,Zb){const wc=document.createElement("div");wc.className=ca;for(const Jc of Ra)wc.classList.add(Jc);A.appendChild(wc);id.a.instance.ta(yc.a.pointerDown,wc,Zb);return wc}whf(A){A=A.$d.parentNode;if(!A)return n.ULS.shipAssertTag(537159394,0,!1,"BehaviorHelperMethods.GetSelectedMarqueeHighlightState: selectedHighlightElement is null."),
null;A=parseInt(A.getAttribute(Hc.a.Fab),10);return isNaN(A)?(n.ULS.shipAssertTag(537159393,0,!1,"BehaviorHelperMethods.GetSelectedMarqueeHighlightState: indexInMarqueeCollection is not a valid number."),null):this.gridView.Kd.RF(3,1,A)}vUb(A,ca,Ra){A=(void 0===Ra?!0:Ra)&&(this.sQ?!!this.RD&&this.RD.IGi(A):!!this.coloredReferencesManager&&this.coloredReferencesManager.HGi(A));for(const Zb of ca)Te.DOMElementExtensions.setVisible(Zb,A)}yjc(){return this.gridView.ks?de.a(this.gridView.$):this.gridView.he}g3f(){if(this.sQ){var A=
this.yjc();A&&this.RD?this.dtg?A.FG(null):this.RD.Olb(A,null):(n.ULS.sendTraceTag(510255177,0,10,"BehaviorHelperMethods.RecalculateColoredReferences: Can't UpdateColoredReferences, will hide all marquee as a last fallback."),this.gridView.Kd.cm(this.qvc),this.gridView.Kd.kn(null,this.qvc))}else this.Kuj()}Kuj(){const A=this.yjc();A&&this.coloredReferencesManager?this.dtg?A.FG(null):this.coloredReferencesManager.FG(A,null):(n.ULS.sendTraceTag(537159392,0,10,"BehaviorHelperMethods.RecalculateColoredReferences: Can't UpdateColoredReferences, will hide all marquee as a last fallback."),
this.gridView.Kd.cm(this.qvc),this.gridView.Kd.kn(null,this.qvc))}y1f(A,ca){this.raiseEvent("mrek",new Je(A,ca))}}Object(l.a)(Ze,"BehaviorHelperMethods",cb.a,[]);var yf=a(41),Lf=a(101);class aa extends Lf.a{constructor(A,ca){super(A,void 0===ca?null:ca)}X3a(){}}Object(l.a)(aa,"HighlightFlyweightBehavior",Lf.a,[]);var db=a(18),N=a(433),pa=a(126),Ib=a(234),nc=a(249),kd=a(68);class Wd extends nc.a{constructor(A,ca,Ra){super(document.createElement("div"));this.Odc=null;this.UYb=!1;this.onPointerDown=
Zb=>{Zb=za.a(this.$)?za.a(this.$).yg(Zb):Zb;this.UYb=!1;if(3===($a.a.Bd=Zb.Gd)){const wc=Zb.Ba.rawEvent,Jc=wc.srcElement||wc.target;Te.DOMElementExtensions.mi(this.domElement,Jc)&&Te.DOMElementExtensions.mi(wc.currentTarget,Jc)&&(this.UYb=!0,this.Odc=Zb.clientPoint)}return!1};this.Yi=Zb=>{Zb=za.a(this.$)?za.a(this.$).yg(Zb):Zb;this.raiseEvent("GrPointerUp",Zb);return this.UYb=!1};this.gl=Zb=>{Zb=za.a(this.$)?za.a(this.$).yg(Zb):Zb;3===Zb.Gd&&this.UYb&&this.uqi(Zb.clientPoint)&&(this.raiseEvent("GrDrag"),
this.UYb=!1);return!1};this.mf=Zb=>{za.a(this.$)&&za.a(this.$).yg(Zb);return!0};this.$=Ra;Ra=!Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:5858804_CanvasHitTest");this.domElement.classList.add(Ra?kd.a.M4e:kd.a.L4e);this.domElement.classList.add(kd.a.shc);A.appendChild(this.domElement);Te.DOMElementExtensions.setVisible(this.domElement,!1);this.EQa=document.createElement("div");this.EQa.classList.add(kd.a.qhc);this.EQa.style.borderColor=ca;this.domElement.appendChild(this.EQa);id.a.instance.ta(yc.a.pointerDown,
this.domElement,this.onPointerDown);id.a.instance.ta(yc.a.Gi,this.domElement,this.Yi);Vd.a.instance.ta(yc.a.sg,this.domElement,this.Yi);id.a.instance.ta(yc.a.Fn,this.domElement,this.gl);Vd.a.instance.ta(yc.a.Ki,this.domElement,this.gl);Ib.a.instance.ta(yc.a.click,this.domElement,this.mf)}eCe(A){this.addHandler("GrDrag",A)}V6f(A){this.removeHandler("GrDrag",A)}dCe(A){this.addHandler("GrContxt",A)}U6f(A){this.removeHandler("GrContxt",A)}fCe(A){this.addHandler("GrPointerUp",A)}W6f(A){this.removeHandler("GrPointerUp",
A)}dispose(){Qg.a.Hra(this.domElement);super.dispose()}seg(){this.domElement.classList.remove(kd.a.shc);this.EQa.classList.remove(kd.a.qhc);this.EQa.classList.add(Sb.EwaSettings.sU?kd.a.O4e:kd.a.N4e)}oug(){this.EQa.classList.remove(Sb.EwaSettings.sU?kd.a.O4e:kd.a.N4e);this.EQa.classList.add(kd.a.qhc);this.domElement.classList.add(kd.a.shc)}uqi(A){return!!this.Odc&&(3<Math.abs(A.x-this.Odc.x)||3<Math.abs(A.y-this.Odc.y))}static aDb(A){return Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:5858804_CanvasHitTest")?
(A=za.a(A.$)?za.a(A.$).zoom:Eb.a.C3,Math.round(9/Math.max(A,1))):9}}Wd.wId=0;Object(l.a)(Wd,"TouchGrippie",nc.a,[]);class Ae extends aa{constructor(A,ca,Ra,Zb){super(ca);this.JDd=this.rvb=!1;this.N$b=null;this.Nfa=this.FDd=!1;this.uz=()=>{this.rvb&&this.FDd?this.Lsa():this.Z8()};this.FPf=Jc=>{3===Jc.Gd&&(this.FDd=!0,this.Lsa());return!1};this.GPf=Jc=>{if(3===Jc.Gd){if(!Jc.$d||this.dEi(Jc))return!1;this.FDd=!1;this.Z8()}return!1};this.Mh=()=>{this.Nfa&&this.W9d();this.Lsa();this.JDd=!1};this.gv=()=>
{this.Z8();this.JDd=!0};this.CDa=(Jc,fd)=>{fd.c9===this.c9&&(fd.visible?this.JDd||this.Lsa():this.Z8())};this.mVf=()=>{this.HPf(this.KV.domElement,!1)};this.MLf=()=>{this.HPf(this.$S.domElement,!0)};this.Uxc=(Jc,fd)=>{this.ha.wra(fd)};this.Vxc=(Jc,fd)=>{this.ha.wra(N.b(fd))};this.TNb=()=>{3===$a.a.Bd?this.Lsa():this.Z8();this.Nfa&&1===$a.a.Bd&&this.W9d()};this.nVf=()=>{this.YOj()};this.GZe=()=>{this.Z8()};this.Wp=()=>{this.ha.Va.pe&&this.Z8()};this.yLf=()=>{this.Z8()};this.zPf=(Jc,fd)=>{this.W9d();
3===fd.Gd?this.Lsa():this.Z8()};this.IBc=()=>{this.rvb&&(this.Z8(),this.Lsa())};const wc=Ra.$;this.Dv=Ra;this.ha=Ra.ha;this.JK=A;this.xMj=ca;this.paneType=Zb;A=this.domElement.currentStyle;ca="#000000";A&&(ca=A.borderTopColor);this.KV=new Wd(this.z7e(),ca,wc);this.$S=new Wd(this.z7e(),ca,wc);this.KV.eCe(this.mVf);this.KV.dCe(this.Uxc);this.KV.fCe(this.Vxc);this.$S.eCe(this.MLf);this.$S.dCe(this.Uxc);this.$S.fCe(this.Vxc);for(const Jc of this.gridView.Xp)Vd.a.instance.ta(yc.a.Bh,Jc.domElement,this.GPf),
Vd.a.instance.ta(yc.a.sg,Jc.domElement,this.FPf);Ra.view.Rt(this.uz);Ra.he.Gp(this.GZe);Ra.Kd.Gub(this.CDa);Ra.G7b(this.yLf);wc.IB(this.IBc);Ra.Fu(this.IBc);this.ha.fla(this.Mh);this.ha.gla(this.gv);Ra.iH(this.Wp);this.ha.K7b(this.zPf);$a.a.mCe(this.TNb);Jd.TaskExtensions.za(Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Migrate2GridHighlightBehaviorEventManager",!1)?Object(Bc.d)(ab.a.resolve(Wb.ub,{Ja:0})):$c.GetServiceTaskFactory.ud(wc.ga,376,377,0),Jc=>{Jc.result.N0g(this.nVf)},wc.ka,
3)}get gridView(){return this.Dv}dispose(){ub.a.Fe([this.KV,this.$S]);this.KV.V6f(this.mVf);this.KV.U6f(this.Uxc);this.KV.W6f(this.Vxc);this.$S.V6f(this.MLf);this.$S.U6f(this.Uxc);this.$S.W6f(this.Vxc);for(var A of this.gridView.Xp)Vd.a.instance.Aa(yc.a.Bh,A.domElement,this.GPf),Vd.a.instance.Aa(yc.a.sg,A.domElement,this.FPf);this.gridView.view.Cs(this.uz);this.gridView.he.zp(this.GZe);this.gridView.Kd.JRb(this.CDa);this.gridView.YCc(this.yLf);this.gridView.$.vE(this.IBc);this.gridView.Ax(this.IBc);
this.ha.xaa(this.Mh);this.ha.Kha(this.gv);this.gridView.NI(this.Wp);this.ha.bDc(this.zPf);$a.a.b7f(this.TNb);this.Nfa&&n.ULS.sendTraceTag(537159314,0,15,"SelectionTouchGrippiesBehaviorBase.Dispose during autofill mode");(A=Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Migrate2GridHighlightBehaviorEventManager",!1)?ab.a.zg(Wb.ub):this.gridView.$.ga.Da(376))&&A.iDj(this.nVf);super.dispose()}kYa(){if(!this.JK.range||!this.JK.range.equals(this.fjb))return!1;const A=!this.gridView.iSa();
return this.gridView.ld&&A&&(this.fjb.isRow||this.fjb.Oi)?!1:this.Nfa?!0:3===$a.a.Bd}Z8(){this.rvb&&(this.KV.set_visible(!1),this.$S.set_visible(!1),this.rvb=!1)}Lsa(){if(this.kYa()){var A=Te.DOMElementExtensions.getBoundingClientRect(this.N$b);A||n.ULS.shipAssertTag(537159313,0,!1,"grippiesParentBounds is null. GridView.ContainerElement: {0}, Freezepanes: {1}",this.gridView.un,this.gridView.jd.Ek);var ca=Te.DOMElementExtensions.getBoundingClientRect(this.xMj),Ra=new Sys.UI.Bounds(ca.x-A.x,ca.y-A.y,
ca.width,ca.height),Zb=this.fjb,wc=Zb.topLeft,Jc=Zb.bottomRight,fd=Zb.isRow||Zb.Oi;if(Zb.Oi){var $d=this.BVh();Zb=Ra.x-2*Wd.aDb(this.gridView);var Be=$d;var Re=Ra.x+ca.width}else Zb.isRow?(Zb=Re=this.AVh(),Be=Ra.y-2*Wd.aDb(this.gridView),$d=Ra.y+ca.height):(Be=Ra.y,$d=Ra.y+ca.height,this.gridView.rtl?(Zb=Ra.x+ca.width,Re=Ra.x):(Zb=Ra.x,Re=Ra.x+ca.width));ca=Wd.wId+(fd?0:Wd.aDb(this.gridView));this.KV.style.left=dd.HelperMethods.Qe(Zb-ca);this.KV.style.top=dd.HelperMethods.Qe(Be-ca);this.$S.style.left=
dd.HelperMethods.Qe(Re-ca);this.$S.style.top=dd.HelperMethods.Qe($d-ca);this.KV.set_visible(this.guf(Be,Zb,wc,fd,A));this.$S.set_visible(this.guf($d,Re,Jc,fd,A));this.rvb=!0}}guf(A,ca,Ra,Zb,wc){const Jc=Te.DOMElementExtensions.getBoundingClientRect(this.gridView.Xh(this.paneType).domElement);wc=new Sys.UI.Bounds(Jc.x-wc.x-3,Jc.y-wc.y-3,Jc.width+6,Jc.height+6);return(this.gridView.jd.$j(Ra)===this.paneType||Zb)&&yf.a.tU(wc,new Sys.UI.Point(ca,A))}BVh(){return(this.gridView.view.visibleArea.height+
this.gridView.jd.height+Wd.wId-Wd.aDb(this.gridView))/2}AVh(){return(this.gridView.view.visibleArea.width+this.gridView.jd.width+Wd.wId-Wd.aDb(this.gridView))/2}ATf(){this.Lsa()}dEi(A){return Te.DOMElementExtensions.eXa(A.$d,db.a.Uy)&&(this.pFi(A)||this.qFi(A))}qFi(A){if(this.gridView.rtl)A=A.clientPoint.x;else{const ca=Te.DOMElementExtensions.getBoundingClientRect(A.$d);A=A.clientPoint.x-(ca.x+ca.width-pa.a.oy)}return 0<A&&A<=pa.a.oy}pFi(A){const ca=Te.DOMElementExtensions.getBoundingClientRect(A.$d);
A=A.clientPoint.y-(ca.y+ca.height-pa.a.oy);return 0<A&&A<=pa.a.oy}HPf(A,ca){this.Nfa&&n.ULS.sendTraceTag(537159312,0,50,"SelectionTouchGrippiesBehaviorBase: Performing Touch Autofill");this.ha.z$c(A,ca,this.Nfa);this.Z8()}YOj(){this.Nfa||(n.ULS.sendTraceTag(537159311,0,50,"SelectionTouchGrippiesBehaviorBase.SetAutoFillMode"),this.Nfa=!0,this.KV.seg(),this.$S.seg(),this.gridView.ha.sourceRange=this.gridView.ha.ra.lf,this.Lsa())}W9d(){this.Nfa&&(n.ULS.sendTraceTag(537159310,0,50,"SelectionTouchGrippiesBehaviorBase.UnsetAutoFillMode"),
this.Nfa=!1,this.KV.oug(),this.$S.oug())}z7e(){this.N$b||(this.N$b=this.gridView.un);return this.N$b}}Object(l.a)(Ae,"SelectionTouchGrippiesBehaviorBase",aa,[]);class Oe extends Ae{constructor(A,ca,Ra,Zb){super(A,ca,Ra,Zb)}get c9(){return 19}get fjb(){return this.gridView.ha.ra.activeRange}kYa(){const A=this.gridView.fl||this.gridView.ld;return!this.gridView.ha.ra.Ij&&!A&&super.kYa()}}Object(l.a)(Oe,"DiscontinuousSelectionTouchGrippiesBehavior",Ae,[]);class sf extends aa{constructor(A){super(A);const ca=
document.createElement("div");ca.className=kd.a.GQh;A.appendChild(ca)}}Object(l.a)(sf,"SelectionBorderBehavior",aa,[]);class ff{}ff.W4e="ewr-selection-draghandle";ff.X4e="ewr-selection-draghandle-grab";ff.yQh="ewr-selection-draghandle-top-ie-enhanced";ff.xQh="ewr-selection-draghandle-top-enhanced";ff.sQh="ewr-selection-draghandle-bottom-ie-enhanced";ff.rQh="ewr-selection-draghandle-bottom-enhanced";ff.uQh="ewr-selection-draghandle-left-ie-enhanced";ff.tQh="ewr-selection-draghandle-left-enhanced";
ff.wQh="ewr-selection-draghandle-right-ie-enhanced";ff.vQh="ewr-selection-draghandle-right-enhanced";ff.zQh="ewr-selection-dragtooltip";ff.AQh="ewr-selection-dragtooltip-updated";ff.PQh="ewr_selection_rearrangeleft";ff.QQh="ewr_selection_rearrangeright";ff.RQh="ewr_selection_rearrangetop";ff.OQh="ewr_selection_rearrangebottom";ff.selecting="selecting";ff.SQh="ewr-selection-resizemarqueehandle";ff.VQh="ewr-selection-resizemarqueehandle-topleft";ff.WQh="ewr-selection-resizemarqueehandle-topright";ff.TQh=
"ewr-selection-resizemarqueehandle-bottomleft";ff.UQh="ewr-selection-resizemarqueehandle-bottomright";ff.hQh="ewr-marquee-thick";ff.lQh="ewr-resizemarqueehandle-thick";Object(l.a)(ff,"CssClassNames",null,[]);var cg=a(263);class jg extends sf{constructor(A,ca,Ra,Zb){super(A);this.RYa=!1;this.cze=this.dze=null;this.Xca=0;this.wt=Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:8105431_DragDropEnhancementsEnabled");this.ube=this.kwd=this.n1=0;this.EZ=this.Md=this.sourceRange=this.rra=null;this.Yi=wc=>{wc=
za.a(this.$).yg(wc);return this.mSf(wc)};this.onPointerDown=wc=>{wc=za.a(this.$).yg(wc);if(!this.PHc())return!1;if(2===wc.Gd&&wc.yq===Sys.UI.MouseButton.leftButton&&!this.RYa){var Jc=this.wsd(wc);if(!Jc)return n.ULS.shipAssertTag(537159379,0,!1,"DragSelectionClickBehaviorBase.OnPointerDown: GetSelectedRange failed"),!1;this.Md=Jc.clone();this.sourceRange=this.Md.clone();this.rra=this.Md;if(Jc=this.qbi(wc))return this.Jo=5,this.ube=Jc.top-this.sourceRange.top,this.kwd=Jc.left-this.sourceRange.left,
U.h(this.$).gj.Hr(this.wt?jg.qAb:jg.bZe),this.VNd(wc),this.RYa=!0,cg.b(this.$,!0),!0}return!1};this.gl=wc=>{wc=za.a(this.$).yg(wc);if(this.wt&&this.WNd(wc))return!0;if(wc=this.ha.As(wc.clientPoint,wc.$d,5,void 0,void 0,!0)){wc=this.Nwb(wc);if(this.Md.equals(wc))return!0;this.Md=wc;if(!this.OV())return n.ULS.shipAssertTag(537159378,0,!1,"DragSelectionClickBehaviorBase.OnPointerMove: UpdateHighlightOnMove failed"),this.Phc(!0),!1}return!0};this.wf=(wc,Jc)=>{Jc.yQ||this.wGc(this.$.isEditMode)};this.LD=
[];this.$=ca;this.ha=U.h(this.$).ha;this.paneType=Ra;this.mr=Zb;this.edg=Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:5858804_CanvasHitTest")?[ff.xQh,ff.rQh,ff.tQh,ff.vQh]:[ff.yQh,ff.sQh,ff.uQh,ff.wQh];this.$.Zm(this.wf)}get Kd(){return U.h(this.$).Kd}get Jo(){return this.ha.selectionType}set Jo(A){this.ha.selectionType=A}dispose(){this.LD.forEach(A=>{id.a.instance.Aa(yc.a.pointerDown,A,this.onPointerDown)});this.LD.length=0;this.rra=this.sourceRange=this.Md=null;n.ULS.sendTraceTag(537159381,0,50,
`DragSelectionClickBehaviorBase.Dispose: ActiveRegistrationCount = ${this.Xca}, EwaControl is null : ${!this.$}`);this.$&&(this.$.co(this.wf),1===this.Xca&&(n.ULS.sendTraceTag(537159380,0,15,"DragSelectionClickBehaviorBase.Dispose: Some handlers are still registered"),this.JM(this.cze,this.dze,!1)));super.dispose()}mSf(A){if(5!==this.Jo)return!1;(A=this.zUa(A))||this.Phc(!1);cg.b(this.$,!1);return A}pR(A,ca){n.ULS.shipAssertTag(537159377,0,!this.Xca,`DragSelectionClickBehaviorBase.RegisterHandlersForMouse: More than one active registration is not expected but got ${this.Xca}`);
this.Xca+=1;this.cze=A;this.dze=ca;this.mr.pR(A,ca,this.Q8d())}Nwb(A){if(!A||!this.Md)return n.ULS.shipAssertTag(537159376,0,!!A,"DragSelectionClickBehaviorBase.CalculateDragRange: mouseSelectionRange is null"),n.ULS.shipAssertTag(537159375,0,!!this.Md,"DragSelectionClickBehaviorBase.CalculateDragRange: CurrentRange is null"),null;const ca=this.Md.clone();1!==this.n1&&(ca.left=Math.max(A.left-this.kwd,1),ca.right=ca.left+this.sourceRange.width-1);2!==this.n1&&(ca.top=Math.max(A.top-this.ube,1),ca.bottom=
ca.top+this.sourceRange.height-1);return this.Rub(ca)}JM(A,ca,Ra,Zb){Ra=void 0===Ra?!0:Ra;Zb=void 0===Zb?!0:Zb;n.ULS.shipAssertTag(537159374,0,1===this.Xca,`DragSelectionClickBehaviorBase.CleanUp: Expected exactly one active registration but got ${this.Xca}`);--this.Xca;this.wt||U.h(this.$).gj.Hr(Hc.a.BY);this.mr.S9d(A,ca,this.Q8d());Ra&&this.rNe(Zb);this.n1=0;this.RYa=!1}Rub(A){var ca=U.h(this.$);let Ra=A;if(ca.jd.gQ){if(!ca.Hd(A.topLeft)){ca=ca.Kk("DragSelectionClickBehaviorBase.AdjustHiddenRowColumns",
ca.UT,this.rra.top!==A.top?1:2);try{ca.Km=this.rra.top<A.top||this.rra.left<A.left,ca.iy(A.topLeft),Ra=ca.$$cu().range}finally{ca&&ca.dispose()}}Ra.right=Math.min(Ra.left+A.width-1,Eb.a.xh);Ra.bottom=Math.min(Ra.top+A.height-1,Eb.a.yh)}return this.rra=Ra}wGc(A){this.LD.forEach(ca=>{Te.DOMElementExtensions.setVisible(ca,A)})}qbi(A){const ca=A.$d;A=A.clientPoint;if(!ca||!A)return n.ULS.shipAssertTag(537159373,0,!!ca,"DragSelectionClickBehaviorBase.GetMouseSelectionRange: source is null"),n.ULS.shipAssertTag(537159372,
0,!!A,"DragSelectionClickBehaviorBase.GetMouseSelectionRange: point is null"),null;A.y+=ca===this.LD[jg.Sfc]?2:ca===this.LD[jg.eZe]?-2:0;A.x+=ca===this.LD[jg.fZe]?2:ca===this.LD[jg.Rfc]?-2:0;return this.ha.As(A,ca,5,void 0,void 0,!0)}}jg.bZe="move";jg.wdd="copy";jg.qAb="grabbing";jg.Sfc=0;jg.eZe=1;jg.fZe=2;jg.Rfc=3;Object(l.a)(jg,"DragSelectionClickBehaviorBase",sf,[]);class pg extends jg{constructor(A,ca,Ra,Zb,wc,Jc){super(A,ca,Ra,wc);this.Ie=this.SI=null;this.$kf=()=>{this.Phc(!0)};for(const fd of this.edg)ca=
this.mr.ISe(A,fd,this.wt?[ff.X4e]:[ff.W4e],this.onPointerDown),this.LD.push(ca);this.wGc(this.$.isEditMode);this.gridView=U.h(this.$);this.tI=Zb;this.coloredReferencesManager=this.$.ga.Da(281);n.ULS.shipAssertTag(537159391,0,!!this.coloredReferencesManager,"DragMarqueeClickBehavior Ctor: coloredReferencesManager is null. We already have marquee highlights so it shouldn't happen.");if(this.sQ=he.a.cG())A=this.$.ga.Da(464),n.ULS.shipAssertTag(512312961,0,!!A,"DragMarqueeClickBehavior Ctor: formulaAssistanceManager is null. We already have marquee highlights so it shouldn't happen."),
this.RD=A.RD;for(const fd of this.LD)id.a.instance.ta(yc.a.FZ,fd,this.tI.cof),id.a.instance.ta(yc.a.oE,fd,this.tI.dof);this.X3a(Jc)}X3a(A){this.mr.vUb(A,this.LD);this.tI.p4()}VNd(A){n.ULS.sendTraceTag(537159390,0,50,"DragMarqueeClickBehavior.OnPointerDownInternal: Starting drag marquee operation.");this.gridView.jRa=!0;this.Ie.sH(!1);this.Jo=5;this.tI.iZe(A.$d);this.Ie.textBox.removeSelection();this.Ie.W7b(this.$kf);this.pR(this.gl,this.Yi);this.n1=this.sourceRange.isRow?1:this.sourceRange.Oi?2:0}zUa(){const A=
this.i_();this.Jo=-1;this.JM(this.gl,this.Yi);return A}rNe(){this.gridView.jRa=!1;this.tI.jZe(this.LD[0]);this.Ie.textBox.setCaretPositionToEnd();this.Ie.mDc(this.$kf);this.mr.g3f()}Phc(A){n.ULS.sendTraceTag(537159389,0,10,"DragMarqueeClickBehavior.FailureFallback: Operation failed, will try to recalculate colored references as a fallback in CleanUp.");A&&this.JM(this.gl,this.Yi)}wsd(A){this.Ie=this.mr.yjc();this.SI=this.mr.whf(A);return this.Ie&&this.SI&&this.SI.range?this.SI.range:(n.ULS.shipAssertTag(537159388,
0,!!this.Ie,"DragMarqueeClickBehavior.GetSelectedRange: cellContentEditor is null"),n.ULS.shipAssertTag(537159387,0,!!this.SI,"DragMarqueeClickBehavior.GetSelectedRange: selectedHighlightState is null"),n.ULS.shipAssertTag(537159386,0,!!this.SI.range,"DragMarqueeClickBehavior.GetSelectedRange: selectedHighlightState.Range is null"),null)}i_(){return this.SI?this.sQ?this.RD.pMb(this.Ie,this.SI,this.Md):this.coloredReferencesManager.pMb(this.Ie,this.SI,this.Md):(n.ULS.shipAssertTag(537159385,0,!1,"DragMarqueeClickBehavior.SetSelectedRange called when selectedHighlightState is null. It shouldn't be null while dragging a marquee highlight."),
!1)}OV(){return this.i_()}Q8d(){return!0}WNd(){return!1}PHc(){return!0}}Object(l.a)(pg,"DragMarqueeClickBehavior",jg,[]);var Wg=a(92),ih=a(355),Ah=a(750),ki=a(235),ai=a(46);class fg extends jg{constructor(A,ca,Ra,Zb,wc){super(A,ca,Ra,wc);this.vj=null;this.Oi=this.isRow=!1;this.Mh=()=>{this.domElement.classList.remove(ff.selecting)};this.gv=()=>{this.domElement.classList.add(ff.selecting)};this.uf=()=>{if(this.$.isEditMode){const Jc=this.PHc();this.wGc(Jc)}};this.tableManager=Zb;this.gridView=U.h(this.$);
this.$zd=!1;if(0===fg.wfc[Ra].length)for(const Jc of this.edg)ca=document.createElement("div"),ca.className=Jc,ca.classList.add(this.wt?ff.X4e:ff.W4e),fg.wfc[Ra].push(ca);for(const Jc of fg.wfc[Ra])A.appendChild(Jc),id.a.instance.ta(yc.a.pointerDown,Jc,this.onPointerDown),this.LD.push(Jc);this.wGc(this.$.isEditMode);this.jq={};this.gridView.QK=!1;this.ha.gla(this.gv);this.ha.fla(this.Mh)}dispose(){this.ha&&(this.ha.Kha(this.gv),this.ha.xaa(this.Mh));if(this.jq)for(var A=1;4>=A;A++)Te.DOMElementExtensions.Oh(this.jq[A.toString()]);
for(A=1;4>=A;A++)fg.wfc[A].length=0;this.jq=this.vj=null;super.dispose()}rNe(A){A&&(this.wt&&U.h(this.$).gj.Hr(Hc.a.BY),Jb.KeyInputManager.instance.Aa(yc.a.me,this.domElement.ownerDocument.body,this.onKeyDown),this.gridView.QK=!1);for(A=1;4>=A;A++){const ca=this.jq[A.toString()];ca&&ca.parentNode.removeChild(ca);this.jq[A.toString()]=null}this.vj=null}wsd(){return this.ha.ra.lf}i_(){this.ha.updateSelection(this.Md,this.Md.topLeft,0);return!0}OV(A){A=void 0===A?!1:A;this.Kd.kn(this.Md,this.zn());this.Kd.Jt(this.zn());
this.ZI(A);return!0}Ita(A){A=void 0===A?!1:A;this.Kd.kn(this.Md,this.vj);this.Kd.Jt(this.vj);this.ZI(A)}Phc(){n.ULS.sendTraceTag(508908561,0,15,"DragSelectionClickBehavior.FailureFallback: this function was not implemented for dragging selection")}Q8d(){return!1}Waa(A,ca,Ra,Zb,wc){wc=void 0===wc?!1:wc;var Jc=Te.DOMElementExtensions.getBoundingClientRect(ca);let fd=ca===this.LD[jg.Sfc]||ca===this.LD[jg.eZe];if(this.wt){var $d=ca===this.LD[jg.fZe]||ca===this.LD[jg.Rfc];this.isRow&&$d||this.Oi&&fd?$d=
"100px":(fd=this.isRow||fd,$d=(fd?wc?fg.Bak:fg.Gak:wc?fg.Aak:fg.Dak)+"px");ca=fd?ca===this.LD[jg.Sfc]?"top":"bottom":ca===this.LD[jg.Rfc]?"right":"left";A=100*(fd?A.x-Jc.x:A.y-Jc.y)/(fd?Jc.width:Jc.height);for(Jc=1;4>=Jc;Jc++){Zb=document.createElement("div");var Be=document.createElement("div");const Re=document.createElement("div");Zb.appendChild(Be);Zb.appendChild(Re);wc&&(Be=document.createElement("div"),Zb.appendChild(Be),Re.style.fontWeight="bold");Zb.className=ff.AQh;this.jq[Jc.toString()]=
Zb;this.Kd.RF(Ra,Jc).Qg.appendChild(Zb);if(Zb=this.jq[Jc.toString()])Zb.style[ca]=$d,Zb.style[fd?"left":"top"]=A+"%"}}else for(wc=(fd?-fg.Fak:-fg.Cak)+"px",$d=fd?ca===this.LD[jg.Sfc]?"top":"bottom":ca===this.LD[jg.Rfc]||Zb?"right":"left",ca=100*(fd?Zb?0:A.x-Jc.x:A.y-Jc.y)/(fd?Jc.width:Jc.height),A=1;4>=A;A++)if(Jc=document.createElement("div"),Jc.className=ff.zQh,this.jq[A.toString()]=Jc,this.Kd.RF(Ra,A).Qg.appendChild(Jc),Jc=this.jq[A.toString()])Jc.style[$d]=wc,Jc.style[fd?"left":"top"]=ca+"%"}Zvg(A,
ca,Ra){const Zb=U.h(this.$),wc=Zb.Ni(A);var Jc=Zb.Xh(this.paneType);Ra=Ah.a.ty(Jc.view.yk,this.domElement.parentNode,Ra,Zb.rtl);Jc=!1;let fd=2;ca&&Ra.y-wc.topLeft.y>wc.height/2?(Jc=!0,fd=1):!ca&&Ra.x-wc.topLeft.x>wc.width/2&&(Jc=!0);if(Jc){ca=Zb.Kk("DragSelectionClickBehavior.updateMouseSelectionRange",Zb.UT,fd);try{ca.iy(A),ca.$$mn(),ca.$$cu()}finally{ca&&ca.dispose()}}}nxb(A){this.Kd.cm(this.vj);this.JM(this.Pqa,this.Qqa,void 0,A)}rX(A){this.Kd.cm(this.zn());this.JM(this.gl,this.Yi,void 0,A)}pDb(){return this.wt?
48:6}zn(){return this.wt?fg.KCh:fg.OCh}jbb(A){return A.Ba.keyCode===Wg.a.Sta||Y.a.isMac&&A.Ba.keyCode===Wg.a.d_a}SGb(A){A=U.h(this.$).getRangeInformation(A);for(let ca=0,Ra=A.length;ca<Ra;++ca)if(Object(ih.a)(ki.PivotTableRange,A[ca]))return A=ge.a.qf(1,0,902,901,0,2105176604,"InsDelCellsPivotTable"),ai.a(this.$).pv([A]),!0;return!1}BAe(){this.$zd||(this.ha.PCe(this.sOd),this.$zd=!0)}sWa(){this.ha&&(this.ha.p7f(this.sOd),this.$zd=!1)}}fg.Cak=50;fg.Fak=25;fg.Dak=-85;fg.Gak=-40;fg.Aak=-120;fg.Bak=-50;
fg.OCh=[6];fg.KCh=[48];fg.wfc=[[],[],[],[],[],[]];Object(l.a)(fg,"DragSelectionClickBehavior",jg,[]);class Bi{constructor(A,ca){this.destinationRange=this.sourceRange=null;this.sourceRange=A;this.destinationRange=ca}}Object(l.a)(Bi,"MacroRecorderTableRowColumnRearrangedPayload",null,[135]);class Wi extends fg{constructor(A,ca,Ra,Zb,wc){super(A,ca,Ra,Zb,wc);this.ria=null;this.DU=this.EU=!1;this.Ezf=0;this.gYa=this.$Na=null;this.nK=0;this.Tfc=Ub.a.instance.ia(2269);this.kZe=Ub.a.instance.ia(2270);this.qHc=
Ub.a.instance.ia(2271);this.qig=Ub.a.instance.ia(2272);this.onKeyDown=Jc=>{if(this.wt){if(this.jbb(Jc)||Jc.Ba.keyCode===Wg.a.f_a)return this.aSa||(Jb.KeyInputManager.instance.ta(yc.a.Vf,this.domElement.ownerDocument.body,this.onKeyUp),this.aSa=!0),!this.OY&&this.jbb(Jc)&&(U.h(this.$).gj.Hr(jg.wdd),this.OY=!0),this.PY||Jc.Ba.keyCode!==Wg.a.f_a||(U.h(this.$).gj.Hr(jg.qAb),this.PY=!0,2===this.nK?(n.ULS.shipAssertTag(509159443,0,!!this.zn(),"DragSelectionClickBehaviorCellRangeAndTable: getDragHighlight is null"),
n.ULS.sendTraceTag(509150300,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler"),this.rX(!1),this.n1=0,this.vj=this.DU?[11]:[12],this.EU=this.DU,this.uUd(),n.ULS.shipAssertTag(509159442,0,!!this.vj,"DragSelectionClickBehaviorCellRangeAndTable: currentHighlight is null"),this.Ita()):3===this.nK?(n.ULS.shipAssertTag(509159441,0,!!this.vj,"DragSelectionClickBehaviorCellRangeAndTable: currentHighlight is null"),n.ULS.sendTraceTag(509150299,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler"),
this.mxb(!1),this.n1=this.isRow?1:2,this.Era(),n.ULS.shipAssertTag(509159440,0,!!this.zn(),"DragSelectionClickBehaviorCellRangeAndTable: getDragHighlight is null"),this.OV()):1===this.nK&&(n.ULS.shipAssertTag(509159439,0,!!this.vj,"DragSelectionClickBehaviorCellRangeAndTable: currentHighlight is null"),n.ULS.sendTraceTag(509150298,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler"),this.nxb(!1),this.Era(),n.ULS.shipAssertTag(509159438,0,!!this.zn(),"DragSelectionClickBehaviorCellRangeAndTable: getDragHighlight is null"),
this.OV())),!0}else if(!this.OY&&(Jc.Ba.keyCode===Wg.a.Sta||Y.a.isMac&&Jc.Ba.keyCode===Wg.a.d_a))return Jb.KeyInputManager.instance.ta(yc.a.Vf,this.domElement.ownerDocument.body,this.onKeyUp),U.h(this.$).gj.Hr(jg.wdd),this.OY=!0;return!1};this.onKeyUp=Jc=>{if(this.wt){if(this.jbb(Jc)||Jc.Ba.keyCode===Wg.a.f_a)return this.Ezf=this.jbb(Jc)?0:1,this.gridView.QK&&U.h(this.$).gj.Hr(jg.qAb),Jc.Ba.keyCode===Wg.a.f_a&&(2===this.nK?(n.ULS.shipAssertTag(509159437,0,!!this.vj,"DragSelectionClickBehaviorCellRangeAndTable: currentHighlight is null"),
n.ULS.sendTraceTag(509150297,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler"),this.mxb(!1),this.n1=0,this.Era(!0),n.ULS.shipAssertTag(509159436,0,!!this.zn(),"DragSelectionClickBehaviorCellRangeAndTable: getDragHighlight is null"),this.OV(!0)):3===this.nK?(n.ULS.shipAssertTag(509159435,0,!!this.zn(),"DragSelectionClickBehaviorCellRangeAndTable: getDragHighlight is null"),n.ULS.sendTraceTag(509150296,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler"),
this.rX(!1),this.n1=this.isRow?1:2,this.vj=this.isRow?[11]:[12],this.uUd(!0),n.ULS.shipAssertTag(509159434,0,!!this.vj,"DragSelectionClickBehaviorCellRangeAndTable: currentHighlight is null"),this.Ita(!0)):1===this.nK&&(n.ULS.shipAssertTag(509159433,0,!!this.zn(),"DragSelectionClickBehaviorCellRangeAndTable: getDragHighlight is null"),n.ULS.sendTraceTag(509150295,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler"),this.rX(!1),this.vj=this.DU?[11]:[12],this.VQb(!0),n.ULS.shipAssertTag(509159432,
0,!!this.vj,"DragSelectionClickBehaviorCellRangeAndTable: currentHighlight is null"),this.Ita(!0))),this.Wlb(this.Ezf),!0}else if(Jc.Ba.keyCode===Wg.a.Sta||Y.a.isMac&&Jc.Ba.keyCode===Wg.a.d_a)return this.Wlb(),this.gridView.QK&&U.h(this.$).gj.Hr(jg.bZe),!0;return!1};this.Qqa=Jc=>{Jc=za.a(this.$).yg(Jc);this.sWa();5===this.Jo?this.mSf(Jc):(this.gridView.QK=!1,n.ULS.shipAssertTag(509159430,0,!!this.vj,"DragSelectionClickBehaviorCellRangeAndTable: currentHighlight is null"),this.Kd.cm(this.vj),!this.$.Iu([this.Md],
!1)||this.Iuj()||this.xvf()||(this.ha.sourceRange=this.sourceRange.clone(),this.wt?this.Bpj():this.L5e(),this.Vfa()?this.Md.top>this.sourceRange.top&&(Jc=this.Md.height,this.Md.top-=Jc,this.Md.bottom-=Jc):this.Md.left>this.sourceRange.left&&(Jc=this.Md.width,this.Md.left-=Jc,this.Md.right-=Jc),this.i_()),this.yGd());n.ULS.sendTraceTag(509150292,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler");this.JM(this.Pqa,this.Qqa);this.tableRange=null;this.Jo=-1;this.wt&&(this.ria=
null,this.nK=0);return!0};this.kOb=()=>{this.gridView.QK=!1;this.sWa();this.nK=0;n.ULS.shipAssertTag(509159429,0,!!this.vj,"DragSelectionClickBehaviorCellRangeAndTable: currentHighlight is null");this.Kd.cm(this.vj);if(!this.$.Iu([this.Md],!1))return n.ULS.sendTraceTag(509150291,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler"),this.JM(this.jOb,this.kOb),this.Jo=-1,!0;if(!(this.ha.ra.lf.equals(this.Md)||this.SGb(this.Md)||this.SGb(this.sourceRange)||this.xvf()||(this.i_(),
this.ha.sourceRange=this.sourceRange.clone(),this.$.Me(-694765314,2,30,{[Hc.a.ZNa]:this.OY,[Hc.a.Shd]:!0,[Hc.a.Thd]:this.EU,[Hc.a.wea]:this.ha.sourceRange,[Hc.a.vea]:this.ha.ra.lf,[Hc.a.mAb]:this.PY}),this.OY))){if(this.Md.top>this.sourceRange.top&&(this.isRow||this.Md.left===this.sourceRange.left&&this.EU)){var Jc=this.Md.height;this.Md.top-=Jc;this.Md.bottom-=Jc}else this.Md.left>this.sourceRange.left&&(this.Oi||this.Md.top===this.sourceRange.top&&!this.EU)&&(Jc=this.Md.width,this.Md.left-=Jc,this.Md.right-=
Jc);this.i_()}n.ULS.sendTraceTag(509150290,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler");this.JM(this.jOb,this.kOb);this.ria=this.tableRange=null;this.Jo=-1;this.EU=!1;this.yGd();return!0};this.Pqa=Jc=>{Jc=za.a(this.$).yg(Jc);var fd=Jc.clientPoint;this.wt&&(this.EZ=Jc);if(Jc=this.ha.As(fd,Jc.$d,5,void 0,void 0,!0)){if(this.tableRange.contains(Jc.topLeft)){if(this.Zvg(Jc,this.Vfa(),fd),this.Md=this.mMa(Jc),this.ha.sourceRange=this.Md,this.Kd.kn(this.Md,this.vj),n.ULS.shipAssertTag(509159428,
0,!!this.vj,"DragSelectionClickBehaviorCellRangeAndTable: currentHighlight is null"),this.Kd.Jt(this.vj),n.ULS.shipAssertTag(509159427,0,!!this.zn(),"DragSelectionClickBehaviorCellRangeAndTable: getDragHighlight is null"),this.Kd.cm(this.zn()),6!==this.Jo){for(fd=1;4>=fd;fd++)if(Jc=this.jq[fd.toString()])Jc.parentNode.removeChild(Jc),this.Kd.RF(this.Vfa()?11:12,fd).Qg.appendChild(Jc);this.Jo=6}}else if(this.Md=this.Nwb(Jc),this.wt)this.Bkf(!1);else if(this.Kd.kn(this.Md,this.zn()),n.ULS.shipAssertTag(509159426,
0,!!this.zn(),"DragSelectionClickBehaviorCellRangeAndTable: getDragHighlight is null"),this.Kd.Jt(this.zn()),n.ULS.shipAssertTag(509159425,0,!!this.vj,"DragSelectionClickBehaviorCellRangeAndTable: currentHighlight is null"),this.Kd.cm(this.vj),5!==this.Jo){for(fd=1;4>=fd;fd++)if(Jc=this.jq[fd.toString()])Jc.parentNode.removeChild(Jc),this.Kd.RF(this.pDb(),fd).Qg.appendChild(Jc);this.Jo=5}this.ZI()}return!0};this.jOb=Jc=>{Jc=za.a(this.$).yg(Jc);var fd=Jc.clientPoint;this.EZ=Jc;var $d=this.ha.As(fd,
Jc.$d,5,void 0,void 0,!0);if($d){if(this.amf($d))return this.Md=this.Nwb($d),this.Akf(!1),!0;var Be=U.h(this.$),Re=Be.Ni($d),lf=Be.Xh(this.paneType);fd=Ah.a.ty(lf.view.yk,this.domElement.parentNode,fd,Be.rtl);lf=!1;let xf=2;this.EU=!1;if(this.isRow||this.Oi){this.isRow&&fd.y-Re.topLeft.y>Re.height/2?(lf=!0,xf=1):this.Oi&&fd.x-Re.topLeft.x>Re.width/2&&(lf=!0);if(lf){Jc=Be.Kk("DragSelectionClickBehaviorCellRangeAndTable.OnPointerMoveDragInsert",Be.UT,xf);try{Jc.iy($d),Jc.$$mn(),$d=Jc.$$cu().range}finally{Jc&&
Jc.dispose()}}this.Md=this.Nwb($d)}else{fd.x-Re.topLeft.x===Re.width?(this.EU=!1,lf=!0):fd.y-Re.topLeft.y>Re.height/2&&(this.EU=lf=!0,xf=1);this.ria&&(this.EU=this.DU);if(lf){Be=Be.Kk("DragSelectionClickBehaviorCellRangeAndTable.OnPointerMoveDragInsert",Be.UT,xf);try{Be.iy($d),Be.$$mn(),$d=Be.$$cu().range}finally{Be&&Be.dispose()}}n.ULS.shipAssertTag(509159424,0,!!this.vj,"DragSelectionClickBehaviorCellRangeAndTable: currentHighlight is null");this.Kd.cm(this.vj);this.vj=this.EU?[11]:[12];for(Be=
1;4>=Be;Be++)(Re=this.jq[Be.toString()])&&Re.parentNode.removeChild(Re),this.jq[Be.toString()]=null;this.Waa(Jc.clientPoint,Jc.$d,this.EU?11:12,!0);this.Md=this.mMa($d)}this.ha.sourceRange=this.Md;this.Kd.kn(this.Md,this.vj);n.ULS.shipAssertTag(509159395,0,!!this.vj,"DragSelectionClickBehaviorCellRangeAndTable: currentHighlight is null");this.Kd.Jt(this.vj);n.ULS.shipAssertTag(509159394,0,!!this.zn(),"DragSelectionClickBehaviorCellRangeAndTable: getDragHighlight is null");this.Kd.cm(this.zn());if(6!==
this.Jo){for($d=1;4>=$d;$d++)if(Jc=this.jq[$d.toString()])Jc.parentNode.removeChild(Jc),this.Kd.RF(this.isRow||this.EU?11:12,$d).Qg.appendChild(Jc);this.Jo=6}this.ZI()}return!0};this.sOd=()=>{this.wt?(this.gridView.QK&&5<=this.Jo&&(this.tableRange?this.PY?(n.ULS.shipAssertTag(509159381,0,!!this.zn(),"DragSelectionClickBehaviorCellRangeAndTable: getDragHighlight is null"),n.ULS.sendTraceTag(509150281,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler"),this.rX(!0)):(n.ULS.shipAssertTag(509159380,
0,!!this.vj,"DragSelectionClickBehaviorCellRangeAndTable: currentHighlight is null"),n.ULS.sendTraceTag(509150280,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler"),this.nxb(!0)):this.PY?this.isRow||this.Oi?(n.ULS.shipAssertTag(509159385,0,!!this.zn(),"DragSelectionClickBehaviorCellRangeAndTable: getDragHighlight is null"),n.ULS.sendTraceTag(509150285,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler"),this.rX(!0)):(n.ULS.shipAssertTag(509159384,
0,!!this.vj,"DragSelectionClickBehaviorCellRangeAndTable: currentHighlight is null"),n.ULS.sendTraceTag(509150284,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler"),this.mxb(!0)):this.isRow||this.Oi?(n.ULS.shipAssertTag(509159383,0,!!this.vj,"DragSelectionClickBehaviorCellRangeAndTable: currentHighlight is null"),n.ULS.sendTraceTag(509150283,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler"),this.mxb(!0)):(n.ULS.shipAssertTag(509159382,0,!!this.zn(),
"DragSelectionClickBehaviorCellRangeAndTable: getDragHighlight is null"),n.ULS.sendTraceTag(509150282,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler"),this.rX(!0))),this.OY&&this.Wlb(),this.PY&&this.Wlb(1),this.nK=0,this.Jo=-1):this.gridView.QK&&5<=this.Jo&&(this.tableRange?(n.ULS.shipAssertTag(509159378,0,!!this.vj,"DragSelectionClickBehaviorCellRangeAndTable: currentHighlight is null"),this.Kd.cm(this.vj),n.ULS.sendTraceTag(509150278,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler"),
this.JM(this.Pqa,this.Qqa)):(n.ULS.shipAssertTag(509159379,0,!!this.zn(),"DragSelectionClickBehaviorCellRangeAndTable: getDragHighlight is null"),this.Kd.cm(this.zn()),n.ULS.sendTraceTag(509150279,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler"),this.JM(this.gl,this.Yi)));this.sWa()};this.tableRange=null;this.aSa=this.OY=this.PY=!1}dispose(){this.OY&&this.Wlb();this.wt&&this.PY&&this.Wlb(1);super.dispose()}VNd(A){this.wt&&(this.EZ=A,this.ria=null,this.DU=this.isRow=this.Oi=
this.EU=!1,Jb.KeyInputManager.instance.ta(yc.a.me,this.domElement.ownerDocument.body,this.onKeyDown));this.BAe();this.gridView.QK=!0;(this.tableRange=this.Rch(this.tableManager.fu(this.sourceRange.topLeft)))&&!this.tableRange.equals(this.sourceRange)?this.wt?(this.ria=this.tableRange,this.nK=1,this.vj=(this.DU=this.tableRange.left===this.sourceRange.left&&this.tableRange.right===this.sourceRange.right)?[11]:[12],this.Jo=6,n.ULS.sendTraceTag(509150305,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Registering mouse handler"),
this.pR(this.Pqa,this.Qqa),this.$Na=this.Tfc,this.gYa=this.qHc,this.Waa(A.clientPoint,A.$d,this.DU?11:12,!0,!0),n.ULS.shipAssertTag(509159447,0,!!this.vj,"DragSelectionClickBehaviorCellRangeAndTable: currentHighlight is null"),this.Ita(!0)):(this.vj=(this.isRow=this.tableRange.left===this.sourceRange.left&&this.tableRange.right===this.sourceRange.right)?[11]:[12],this.Jo=6,n.ULS.sendTraceTag(509150304,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Registering mouse handler"),this.pR(this.Pqa,
this.Qqa),this.Waa(A.clientPoint,A.$d,this.isRow?11:12,!0)):(this.tableRange=null,this.wt?(this.isRow=this.sourceRange.isRow,this.Oi=this.sourceRange.Oi,this.isRow||this.Oi?(this.nK=3,this.n1=this.isRow?1:2,this.Jo=6,this.vj=this.isRow?[11]:[12],n.ULS.sendTraceTag(509150303,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Registering mouse handler"),this.pR(this.jOb,this.kOb),this.$Na=this.Tfc,this.gYa=this.qHc,this.Waa(A.clientPoint,A.$d,this.isRow?11:12,!0,!0),n.ULS.shipAssertTag(509159446,0,
!!this.vj,"DragSelectionClickBehaviorCellRangeAndTable: currentHighlight is null"),this.Ita(!0)):(this.nK=2,this.n1=0,n.ULS.sendTraceTag(509150302,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Registering mouse handler"),this.pR(this.gl,this.Yi),this.$Na=this.kZe,this.gYa=this.qig,this.Waa(A.clientPoint,A.$d,this.pDb(),!1,!0),n.ULS.shipAssertTag(509159445,0,!!this.zn(),"DragSelectionClickBehaviorCellRangeAndTable: getDragHighlight is null"),this.OV(!0))):(n.ULS.sendTraceTag(509150301,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Registering mouse handler"),
this.pR(this.gl,this.Yi),Jb.KeyInputManager.instance.ta(yc.a.me,this.domElement.ownerDocument.body,this.onKeyDown),this.n1=this.sourceRange.isRow?1:this.sourceRange.Oi?2:0,this.Waa(A.clientPoint,A.$d,this.pDb(),!1),n.ULS.shipAssertTag(509159444,0,!!this.zn(),"DragSelectionClickBehaviorCellRangeAndTable: getDragHighlight is null"),this.OV()))}zUa(){this.gridView.QK=!1;this.sWa();this.wt&&(this.nK=0);n.ULS.shipAssertTag(509159431,0,!!this.zn(),"DragSelectionClickBehaviorCellRangeAndTable: getDragHighlight is null");
this.Kd.cm(this.zn());if(!this.$.Iu([this.Md],!1))return n.ULS.sendTraceTag(509150294,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler"),this.JM(this.gl,this.Yi),this.Jo=-1,!0;if(this.ha.ra.lf.equals(this.Md)||this.SGb(this.Md)||this.SGb(this.sourceRange))this.Jo=-1;else{this.i_();this.ha.sourceRange=this.sourceRange.clone();const A=this.ha.sourceRange,ca=this.ha.ra.lf;this.wt?this.$.Me(-694765314,2,30,{[Hc.a.ZNa]:this.OY,[Hc.a.wea]:A,[Hc.a.vea]:ca,[Hc.a.mAb]:this.PY}):
this.$.Me(-694765314,2,30,{[Hc.a.ZNa]:this.OY,[Hc.a.wea]:A,[Hc.a.vea]:ca})}if(this.wt||!this.tableRange)n.ULS.sendTraceTag(509150293,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler"),this.JM(this.gl,this.Yi);this.yGd();return!0}WNd(A){const ca=this.ha.As(A.clientPoint,A.$d,5,void 0,void 0,!0);this.EZ=A;return this.amf(ca)?(this.Md=this.mMa(ca),this.Akf(!0),!0):this.Ypi(ca)?(this.Md=this.Nwb(ca),this.Bkf(!0),!0):!1}ZI(A){A=void 0===A?!1:A;const ca=this.Md.toString();if(this.wt)for(var Ra=
1;4>=Ra;Ra++){const Zb=this.jq[Ra.toString()];Zb&&Zb.childNodes&&0<Zb.childNodes.length&&(Zb.childNodes[0].innerText=ca,Zb.childNodes[1].innerText=this.$Na,A&&(Zb.childNodes[2].innerText=this.gYa))}else for(A=1;4>=A;A++)if(Ra=this.jq[A.toString()])Ra.innerText=ca}amf(A){return!!this.ria&&1!==this.nK&&!!A&&this.ria.contains(A.topLeft)}Ypi(A){return!!this.ria&&1===this.nK&&!!A&&!this.ria.contains(A.topLeft)}Akf(A){this.tableRange=this.ria;this.nK=1;const ca=!this.PY;A?(n.ULS.shipAssertTag(509159393,
0,!!this.zn(),"DragSelectionClickBehaviorCellRangeAndTable: getDragHighlight is null"),n.ULS.sendTraceTag(509150289,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler"),this.rX(!1),this.vj=this.DU?[11]:[12],this.VQb(ca),n.ULS.shipAssertTag(509159392,0,!!this.vj,"DragSelectionClickBehaviorCellRangeAndTable: currentHighlight is null"),this.Ita(ca)):(n.ULS.shipAssertTag(509159391,0,!!this.vj,"DragSelectionClickBehaviorCellRangeAndTable: currentHighlight is null"),n.ULS.sendTraceTag(509150288,
0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler"),this.mxb(!1),this.Era(ca),n.ULS.shipAssertTag(509159390,0,!!this.zn(),"DragSelectionClickBehaviorCellRangeAndTable: getDragHighlight is null"),this.OV(ca))}Bkf(A){this.tableRange=null;this.nK=2;const ca=!this.PY;A?(n.ULS.shipAssertTag(509159389,0,!!this.zn(),"DragSelectionClickBehaviorCellRangeAndTable: getDragHighlight is null"),n.ULS.sendTraceTag(509150287,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler"),
this.rX(!1),this.vj=this.DU?[11]:[12],this.EU=this.DU,this.uUd(ca),n.ULS.shipAssertTag(509159388,0,!!this.vj,"DragSelectionClickBehaviorCellRangeAndTable: currentHighlight is null"),this.Ita(ca)):(n.ULS.shipAssertTag(509159387,0,!!this.vj,"DragSelectionClickBehaviorCellRangeAndTable: currentHighlight is null"),n.ULS.sendTraceTag(509150286,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Cleaning up mouse handler"),this.nxb(!1),this.Era(ca),n.ULS.shipAssertTag(509159386,0,!!this.zn(),"DragSelectionClickBehaviorCellRangeAndTable: getDragHighlight is null"),
this.OV(ca))}PHc(){if(!U.h(this.$).ha.ra.Ij)return!1;const A=U.h(this.$).getRangeInformation(this.ha.ra.lf);for(const ca of A)if(Object(ih.a)(ki.PivotTableRange,ca))return!1;return!0}Rch(A){if(A&&A.contains(this.sourceRange)&&!A.equals(this.sourceRange)){if(A.Aoa&&this.sourceRange.bottom===this.sourceRange.top&&this.sourceRange.top===A.top){const ca=new Kb.Range(this.sourceRange.top,this.sourceRange.left,A.bottom,this.sourceRange.right,!1,!1);if(!ca.equals(A))return this.sourceRange=ca,this.ha.updateSelection(this.sourceRange,
this.sourceRange.topLeft,0),A}this.wt?this.DU=A.left===this.sourceRange.left&&A.right===this.sourceRange.right:this.isRow=A.left===this.sourceRange.left&&A.right===this.sourceRange.right;if(A.top===this.sourceRange.top&&A.bottom===this.sourceRange.bottom||this.Vfa())return A}return null}mMa(A){const ca=A.clone();this.Vfa()?ca.left=Math.max(A.left-this.kwd,1):ca.top=Math.max(A.top-this.ube,1);ca.right=ca.left+this.sourceRange.width-1;ca.bottom=ca.top+this.sourceRange.height-1;return this.Rub(ca)}xvf(){const A=
this.Md.topLeft.hf(this.sourceRange);return A||this.wt&&!this.tableRange?A:this.Vfa()?this.Md.top===this.sourceRange.bottom+1:this.Md.left===this.sourceRange.right+1}Iuj(){if(this.Vfa()&&this.Md.left!==this.tableRange.left||!this.Vfa()&&this.Md.top!==this.tableRange.top){const A=ge.a.qf(1,1,0,918,0,2065438552,"RearrangeInvalidDest");ai.a(this.$).pv([A]);return!0}return!1}Bpj(){const A=this.$.Sd.Ze("UserAction","RearrangeRowColumnClientSide"),ca={["CopyPasteTargetType"]:1,["OperationId"]:ma.a.create().toString(),
["Stopwatch"]:A,["DragDropIsShiftKeyDown"]:this.PY,["EncounteredDeploymentErrors"]:!1},Ra=this.OY?2:1,Zb=this.$.ga.Da(254);(new Promise((wc,Jc)=>{this.L5e(fd=>{fd.Errors&&0<fd.Errors.length?Jc(new oc(22,fd.Errors)):wc(!0)},fd=>{fd=Od.a.Lg(fd.data);Jc(new oc(22,fd))})})).then(()=>{n.ULS.sendTraceTag(520747156,0,50,'DragSelectionClickBehaviorCellRangeAndTable.RearrangeRowColumn: success. copyPasteTargetType="1"');Zb&&Zb.FTi(ca,Ra,this.sourceRange,this.Md);return Promise.resolve(!0)},wc=>{n.ULS.sendTraceTag(520747155,
0,10,`DragSelectionClickBehaviorCellRangeAndTable.RearrangeRowColumn: ${wc?copyPasteInfra.getStringifiedError(wc):"null"}, copyPasteTargetType="${1}"`);return Zb?Zb.Xcj(wc,ca,Ra,this.sourceRange,this.Md):Promise.reject(wc)})}L5e(A,ca){A=void 0===A?null:A;ca=void 0===ca?null:ca;const Ra={};this.Vfa()?(Ra.FirstRow=this.Md.top-1,Ra.FirstColumn=0,Ra.DeltaColumn=0,Ra.DeltaRow=this.Md.bottom-this.Md.top+1):(Ra.FirstRow=0,Ra.FirstColumn=this.Md.left-1,Ra.DeltaColumn=this.Md.right-this.Md.left+1,Ra.DeltaRow=
0);Ra.LastRow=Eb.a.UA;Ra.LastColumn=Eb.a.lz;Ra.SheetName=this.$.va.na?this.$.va.na.name:this.$.Ud.getItemByName(this.$.Ud.na.name).sheetName;const Zb=ec.v(this.sourceRange,this.$);this.$.userOperationManager.enqueueOperation(new Zc.a(514,0,(wc,Jc,fd)=>{var $d=this.$.qa.ua;wc=A?dc.b(wc,A):wc;Jc=ca?dc.a(Jc,ca):Jc;const Be=$d.Pa(41,null);Be.sourceRange=Zb;Be.destinationRange=Ra;return Bd.g($d,"RearrangeRowColumn",Be,wc,Jc,fd,null,0)},64,()=>new Bi(Zb,Ra)),null)}Wlb(A){A=void 0===A?0:A;0===A?this.OY=
!1:1===A&&(this.PY=!1);this.wt&&(this.OY||this.PY)||(Jb.KeyInputManager.instance.Aa(yc.a.Vf,this.domElement.ownerDocument.body,this.onKeyUp),this.aSa=!1)}Era(A){A=void 0===A?!1:A;this.Jo=5;n.ULS.sendTraceTag(509150277,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Registering mouse handler");this.pR(this.gl,this.Yi);this.$Na=this.kZe;this.gYa=this.qig;this.Waa(this.EZ.clientPoint,this.EZ.$d,this.pDb(),!1,A)}uUd(A){A=void 0===A?!1:A;this.Jo=6;n.ULS.sendTraceTag(509150276,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Registering mouse handler");
this.pR(this.jOb,this.kOb);this.$Na=this.Tfc;this.gYa=this.qHc;this.Waa(this.EZ.clientPoint,this.EZ.$d,this.isRow||this.DU?11:12,!0,A)}VQb(A){A=void 0===A?!1:A;this.Jo=6;n.ULS.sendTraceTag(509150275,0,50,"DragSelectionClickBehaviorCellRangeAndTable: Registering mouse handler");this.pR(this.Pqa,this.Qqa);this.$Na=this.Tfc;this.gYa=this.qHc;this.Waa(this.EZ.clientPoint,this.EZ.$d,this.Vfa()?11:12,!0,A)}Vfa(){return!this.wt&&this.isRow||this.wt&&this.DU}mxb(A){this.Kd.cm(this.vj);this.JM(this.jOb,this.kOb,
void 0,A)}yGd(){const A=Xa.a.instance.Qd("Common.ISystemInitiatedFeedback");A&&A.execute(ca=>{ca.logActivity("DragDrop",null)})}}Object(l.a)(Wi,"DragSelectionClickBehaviorCellRangeAndTable",fg,[]);var Pi=a(328);class Qi extends fg{constructor(A,ca,Ra,Zb,wc){super(A,ca,Ra,Zb,wc);this.sOd=()=>{this.gridView.QK&&(n.ULS.shipAssertTag(509159371,0,!!this.vj,"DragSelectionClickBehaviorPivotTableRange: currentHighlight is null"),n.ULS.sendTraceTag(509150340,0,50,"DragSelectionClickBehaviorPivotTableRange: Cleaning up mouse handler"),
this.nxb(!0));5===this.Jo&&(n.ULS.shipAssertTag(509159370,0,!!this.zn(),"DragSelectionClickBehaviorPivotTableRange: getDragHighlight is null"),n.ULS.sendTraceTag(509150339,0,50,"DragSelectionClickBehaviorPivotTableRange: Cleaning up mouse handler"),this.rX(!0));this.sWa()};this.Qqa=Jc=>{za.a(this.$).yg(Jc);this.gridView.QK=!1;this.sWa();n.ULS.shipAssertTag(509159369,0,!!this.vj,"DragSelectionClickBehaviorPivotTableRange: currentHighlight is null");this.Kd.cm(this.vj);this.ha.sourceRange=this.sourceRange.clone();
this.rxf?this.$.Me(927125067,$a.a.Bd,30,null):this.mBa?(this.i_(),this.ha.sourceRange=this.sourceRange.clone(),this.$.Me(-694765314,2,30,{[Hc.a.ZNa]:!0,[Hc.a.wea]:this.ha.sourceRange,[Hc.a.vea]:this.ha.ra.lf,[Hc.a.mAb]:!1}),n.ULS.sendTraceTag(509617280,0,50,"DragSelectionClickBehaviorPivotTableRange.onPointerUpRearrange: dragDropCells"),U.h(this.$).gj.Hr(Hc.a.BY),this.mBa=!1):this.spj();n.ULS.sendTraceTag(509150338,0,50,"DragSelectionClickBehaviorPivotTableRange: Cleaning up mouse handler");this.JM(this.Pqa,
this.Qqa);this.Jo=-1;return!0};this.Pqa=Jc=>{Jc=za.a(this.$).yg(Jc);const fd=Jc.clientPoint;this.EZ=Jc;let $d=this.ha.As(fd,Jc.$d,5,void 0,void 0,!0);if($d){if(!this.lCd($d))return this.Vmi(Jc),!0;this.Zvg($d,this.isRow,fd);if(this.isRow||this.Oi)this.Md=this.mMa($d);this.ha.sourceRange=this.Md;this.Kd.kn(this.Md,this.vj);n.ULS.shipAssertTag(509159368,0,!!this.vj,"DragSelectionClickBehaviorPivotTableRange: currentHighlight is null");this.Kd.Jt(this.vj);n.ULS.shipAssertTag(509159367,0,!!this.zn(),
"DragSelectionClickBehaviorPivotTableRange: getDragHighlight is null");this.Kd.cm(this.zn());this.ZI()}return!0};this.onKeyDown=Jc=>this.jbb(Jc)?(this.aSa||(Jb.KeyInputManager.instance.ta(yc.a.Vf,this.domElement.ownerDocument.body,this.onKeyUp),this.aSa=!0),this.mBa||(U.h(this.$).gj.Hr(jg.wdd),this.mBa=!0),!0):!1;this.onKeyUp=Jc=>{this.jbb(Jc)&&(Jb.KeyInputManager.instance.Aa(yc.a.Vf,this.domElement.ownerDocument.body,this.onKeyUp),this.aSa=!1,this.gridView.QK?U.h(this.$).gj.Hr(jg.qAb):U.h(this.$).gj.Hr(Hc.a.BY),
this.mBa=!1);return!0};this.rRf=Jc=>{Jc.Errors&&0<Jc.Errors.length?(n.ULS.sendTraceTag(521410185,0,10,`DragSelectionClickBehaviorPivotTableRange.onMoveLineItemsSuccess: Errors: [${ge.a.ue(Jc.Errors)}]`),this.Md.left=this.sourceRange.left,this.Md.right=this.sourceRange.right,this.Md.top=this.sourceRange.top,this.Md.bottom=this.sourceRange.bottom):this.isRow?this.sourceRange.top<=this.Md.top&&this.sourceRange.bottom>=this.Md.top-1?(this.Md.top=this.sourceRange.top,this.Md.bottom=this.sourceRange.bottom):
(this.sourceRange.top>this.Md.top||(this.Md.top-=this.sourceRange.height),this.Md.bottom=this.Md.top+this.sourceRange.height-1):this.sourceRange.left<=this.Md.left&&this.sourceRange.right>=this.Md.left-1?(this.Md.left=this.sourceRange.left,this.Md.right=this.sourceRange.right):(this.sourceRange.left>this.Md.left||(this.Md.left-=this.sourceRange.width),this.Md.right=this.Md.left+this.sourceRange.width-1);this.i_();this.Jo=-1};this.qRf=Jc=>{Jc=Od.a.Lg(Jc.data);n.ULS.sendTraceTag(521410184,0,10,`DragSelectionClickBehaviorPivotTableRange.onMoveLineItemsFail: Errors: [${ge.a.ue(Jc)}]`)};
this.mBa=this.aSa=!1}dispose(){super.dispose()}VNd(A){this.EZ=A;this.isRow=this.Oi=!1;this.BAe();this.n1=null!=this.Md?this.Md.isRow?1:this.Md.Oi?2:0:0;this.gridView.QK=!0;Jb.KeyInputManager.instance.ta(yc.a.me,this.domElement.ownerDocument.body,this.onKeyDown);this.de=this.tableManager.coa(this.sourceRange);this.ssf=this.BIi(this.Md);this.de||n.ULS.sendTraceTag(512341332,0,50,"DragSelectionClickBehaviorPivotTableRange.onPointerDownInternal: pivotTableRange null for range {0}",this.sourceRange);this.rxf=
(new Dd.a(this.$.va)).Oj;U.h(this.$).gj.Hr(jg.qAb);this.lCd(this.Md)?(this.isRow=this.tJi(),this.Oi=this.DCi(),this.isRow||this.Oi?(this.$bb=!1,this.VQb(A),this.Md=this.mMa(this.Md),n.ULS.shipAssertTag(509159377,0,!!this.vj,"DragSelectionClickBehaviorPivotTableRange: currentHighlight is null"),this.Ita()):(this.$bb=!0,this.Era(A),n.ULS.shipAssertTag(509159376,0,!!this.zn(),"DragSelectionClickBehaviorPivotTableRange: getDragHighlight is null"),this.OV())):(this.$bb=!0,this.Era(A),n.ULS.shipAssertTag(509159375,
0,!!this.zn(),"DragSelectionClickBehaviorPivotTableRange: getDragHighlight is null"),this.OV())}zUa(){this.gridView.QK=!1;this.sWa();return this.rxf?(this.$.Me(927125067,$a.a.Bd,30,null),n.ULS.shipAssertTag(509159374,0,!!this.zn(),"DragSelectionClickBehaviorPivotTableRange: getDragHighlight is null"),n.ULS.sendTraceTag(509150343,0,50,"DragSelectionClickBehaviorPivotTableRange: Cleaning up mouse handler"),this.rX(!0),this.$bb=!1,this.Jo=-1,!0):this.mBa||this.ssf?(this.i_(),this.ha.sourceRange=this.sourceRange.clone(),
this.$.Me(-694765314,2,30,{[Hc.a.ZNa]:this.mBa,[Hc.a.wea]:this.ha.sourceRange,[Hc.a.vea]:this.ha.ra.lf,[Hc.a.mAb]:!1}),n.ULS.sendTraceTag(509617281,0,50,`DragSelectionClickBehaviorPivotTableRange.onPointerUpInternal: dragDropCells with isCopyOperation="${this.mBa}"`),U.h(this.$).gj.Hr(Hc.a.BY),n.ULS.shipAssertTag(509159373,0,!!this.zn(),"DragSelectionClickBehaviorPivotTableRange: getDragHighlight is null"),n.ULS.sendTraceTag(509150342,0,50,"DragSelectionClickBehaviorPivotTableRange: Cleaning up mouse handler"),
this.rX(!0),this.$bb=!1,this.Jo=-1,this.ssf=!1,!0):5===this.Jo?(n.ULS.shipAssertTag(509159372,0,!!this.zn(),"DragSelectionClickBehaviorPivotTableRange: getDragHighlight is null"),n.ULS.sendTraceTag(509150341,0,50,"DragSelectionClickBehaviorPivotTableRange: Cleaning up mouse handler"),this.rX(!0),this.$bb=!1,this.L_j(),this.Jo=-1,!0):!1}WNd(A){const ca=this.ha.As(A.clientPoint,A.$d,5,void 0,void 0,!0);this.EZ=A;return this.$bb?!1:this.lCd(ca)?(this.Wmi(A),!0):!1}ZI(){let A=new Kb.Range(this.Md.top,
this.Md.left,this.Md.bottom,this.Md.right,!1,!0);6===this.Jo&&(this.isRow?(--A.top,A.bottom=A.top+this.Md.height-1):(--A.left,A.right=A.left+this.Md.width-1));for(let ca=1;4>=ca;ca++){const Ra=this.jq[ca.toString()];Ra&&Ra.childNodes&&0<Ra.childNodes.length&&(Ra.childNodes[0].innerText=A.toString())}}PHc(){if(!U.h(this.$).ha.ra.Ij)return!1;var A=U.h(this.$).getRangeInformation(this.ha.ra.lf);for(var ca of A)if(Object(ih.a)(ki.PivotTableRange,ca)&&(A=this.tableManager.coa(ca)))return ca=!A.isOlap||
!A.LSa(!0),n.ULS.sendTraceTag(512341331,0,50,"DragSelectionClickBehaviorPivotTableRange.shouldShowHandlesOnSelectionChanged: enabling for range {0}",A),A.isActionable&&ca;return!1}mMa(A){A=A.clone();this.isRow?(A.left=this.sourceRange.left,A.right=this.de.right,A.bottom=A.top+this.sourceRange.height-1):this.Oi?(A.top=this.sourceRange.top,A.bottom=this.de.KC?this.de.KC.bottom:this.de.bottom,A.right=A.left+this.sourceRange.width-1):n.ULS.sendTraceTag(520176346,0,10,"DragSelectionClickBehaviorPivotTableRange.calculateRearrangeRange: no row/column rearrange");
return this.Rub(A)}spj(){const A={},ca=ec.v(this.sourceRange,this.$);U.h(this.$).getRangeInformation(this.Md);if(this.isRow){ca.FirstColumn=A.FirstColumn=this.Md.left-1;ca.LastColumn=A.LastColumn=this.Md.right-1;if(this.sourceRange.top<=this.Md.top&&this.sourceRange.bottom>=this.Md.top-1){n.ULS.sendTraceTag(520176345,0,50,"DragSelectionClickBehaviorPivotTableRange.processMoveLineItems: no-op");return}this.sourceRange.top>this.Md.top?A.LastRow=A.FirstRow=this.Md.top-1:(A.FirstRow=this.Md.top-this.sourceRange.height-
1,A.LastRow=A.FirstRow+this.sourceRange.height-1)}else{A.FirstRow=Math.min(this.Md.top,this.Md.bottom-1);A.LastRow=this.Md.bottom-1;if(this.sourceRange.left<=this.Md.left&&this.sourceRange.right>=this.Md.left-1){n.ULS.sendTraceTag(520176344,0,50,"DragSelectionClickBehaviorPivotTableRange.processMoveLineItems: no-op");return}A.LastColumn=this.sourceRange.left>this.Md.left?A.FirstColumn=this.Md.left-1:A.FirstColumn=this.Md.left-this.sourceRange.width-1}const Ra={};Ra.SheetName=this.$.va.na?this.$.va.na.name:
this.$.Ud.getItemByName(this.$.Ud.na.name).sheetName;Ra.Ranges=Array(2);Ra.Ranges[0]=ca;Ra.Ranges[1]=A;this.mSh(Ra)}mSh(A){this.$.userOperationManager.enqueueOperation(new Zc.a(265,0,(ca,Ra,Zb)=>{var wc=this.$.qa.ua;ca=this.rRf?dc.b(ca,this.rRf):ca;Ra=this.qRf?dc.a(Ra,this.qRf):Ra;const Jc=wc.Pa(1,null);Jc.moveRange=A;return Bd.g(wc,"MoveLineItems",Jc,ca,Ra,Zb,null,0)},64),null)}lCd(A){return null!==this.de&&this.tGi(A)&&this.nJi(A)&&this.CLi(A)&&this.GBi(A)}tGi(A){return this.de.KC?A.left>=this.de.KC.left:
this.de.lA?A.left>=this.de.lA.left:A.left>=this.de.left}nJi(A){return this.de.lA?A.right<=this.de.lA.right:this.de.KC?A.right<=this.de.KC.right:A.right<=this.de.right}CLi(A){return this.isRow?null!==this.de.KC&&A.top>=this.de.KC.top:this.Oi?null!==this.de.lA&&A.top>=this.de.lA.top:null===this.de.top||A.top>=this.de.top}GBi(A){return this.de.KC?A.bottom<=this.de.KC.bottom:this.de.lA?A.bottom<=this.de.lA.bottom:A.bottom<=this.de.bottom}BIi(A){return null!==this.de&&this.de.left>=A.left&&this.de.right<=
A.right&&this.de.top>=A.top&&this.de.bottom<=A.bottom}tJi(){return null!==this.de&&null!==this.de.KC&&this.de.KC.top<=this.Md.top&&this.de.KC.left<=this.Md.left&&this.de.KC.right>=this.Md.left}DCi(){return null!==this.de&&null!==this.de.lA&&this.de.lA.top===this.Md.top&&this.de.lA.left<=this.Md.left&&this.de.lA.right>=this.Md.right}VQb(A){this.Jo=6;this.vj=this.isRow?[11]:[12];n.ULS.sendTraceTag(509150337,0,50,"DragSelectionClickBehaviorPivotTableRange: Registering mouse handler");this.pR(this.Pqa,
this.Qqa);this.Waa(A.clientPoint,A.$d,this.isRow?11:12,!0,!1)}Era(A){this.Jo=5;n.ULS.sendTraceTag(509150336,0,50,"DragSelectionClickBehaviorPivotTableRange: Registering mouse handler");this.pR(this.gl,this.Yi);this.Waa(A.clientPoint,A.$d,this.pDb(),!1,!1)}Wmi(A){n.ULS.shipAssertTag(509159366,0,!!this.zn(),"DragSelectionClickBehaviorPivotTableRange.handleDragWithinPivotTable: getDragHighlight is null");n.ULS.sendTraceTag(509150307,0,50,"DragSelectionClickBehaviorPivotTableRange: Cleaning up mouse handler");
this.rX(!1);this.VQb(A);this.Md=this.mMa(this.Md);n.ULS.shipAssertTag(509159365,0,!!this.vj,"DragSelectionClickBehaviorPivotTableRange: currentHighlight is null");this.Ita()}Vmi(A){n.ULS.shipAssertTag(509159364,0,!!this.vj,"DragSelectionClickBehaviorPivotTableRange: currentHighlight is null");n.ULS.sendTraceTag(509150306,0,50,"DragSelectionClickBehaviorPivotTableRange: Cleaning up mouse handler");this.nxb(!1);this.Era(A);n.ULS.shipAssertTag(509159363,0,!!this.zn(),"DragSelectionClickBehaviorPivotTableRange.handleDragOutsidePivotTable: getDragHighlight is null");
this.OV()}L_j(){if((null==this.sourceRange||null==this.Md||this.sourceRange.EA(!1)!==this.Md.EA(!1))&&!this.SGb(this.Md)){var A=ge.a.qf(1,0,904,903,0,2069074184,"PivotTableInvalidMove");A.HelpTopicId=Pi.a.D3j;A.HelpDescription=Ub.a.instance.ia(913);ai.a(this.$).pv([A])}}}Object(l.a)(Qi,"DragSelectionClickBehaviorPivotTableRange",fg,[]);var zh=a(384);class Ri extends sf{constructor(A,ca){super(A);this.Mh=()=>{this.domElement.classList.remove(ff.selecting);zh.c(this.gridView.$,!0,"FillHandleClickBehavior:OnSelectionEnded")};
this.gv=()=>{this.domElement.classList.add(ff.selecting)};this.onPointerDown=Ra=>{2===Ra.Gd&&Ra.yq===Sys.UI.MouseButton.leftButton&&(this.gridView.ha.selectionType=4,this.gridView.ha.sourceRange=this.gridView.ha.ra.lf,zh.c(this.gridView.$,!1,"FillHandleClickBehavior:OnSelectionStarted"));return!1};this.Mga=()=>{this.gridView.$.Me(1983983164,2,30,null);return!0};this.wf=()=>{Te.DOMElementExtensions.setVisible(this.Kea,this.gridView.$.isEditMode)};this.LDa=()=>{Te.DOMElementExtensions.setVisible(this.Kea,
!1)};this.KDa=()=>{Te.DOMElementExtensions.setVisible(this.Kea,!0)};this.BPf=()=>{Te.DOMElementExtensions.setVisible(this.Kea,!1)};this.APf=()=>{Te.DOMElementExtensions.setVisible(this.Kea,!0)};this.yNb=(Ra,Zb)=>{Te.DOMElementExtensions.setVisible(this.Kea,!Zb.fze)};this.gridView=ca;ca=document.createElement("div");ca.className=Sb.EwaSettings.sU()?kd.a.FQh:kd.a.EQh;this.Kea=ca;this.wf(null,null);A.appendChild(ca);id.a.instance.ta(yc.a.pointerDown,this.Kea,this.onPointerDown);Ib.a.instance.ta(yc.a.ym,
this.Kea,this.Mga);this.gridView.$.Zm(this.wf);this.gridView.$.yd.b6c(this.LDa);this.gridView.$.yd.a6c(this.KDa);this.gridView.IBe(this.yNb);this.gridView.cellTextEditBox.Gp(this.BPf);this.gridView.cellTextEditBox.Mq(this.APf)}dispose(){id.a.instance.Aa(yc.a.pointerDown,this.Kea,this.onPointerDown);Ib.a.instance.Aa(yc.a.ym,this.Kea,this.Mga);this.gridView.$&&(this.gridView.ha.Kha(this.gv),this.gridView.ha.xaa(this.Mh),this.gridView.$.co(this.wf),this.gridView.$.yd.tWd(this.LDa),this.gridView.$.yd.sWd(this.KDa),
this.gridView.D6f(this.yNb),this.gridView.cellTextEditBox.zp(this.BPf),this.gridView.cellTextEditBox.$p(this.APf));super.dispose()}}Object(l.a)(Ri,"FillHandleClickBehavior",sf,[]);class Jg extends aa{constructor(A,ca){super(A);this.jej=Ra=>{const Zb=dd.HelperMethods.pt(Ra);var wc=this.zAa.Abe(Ra.clientPoint);if(!wc)return!1;var Jc=wc.pg,fd=this.zAa.ya.DDb(Jc.hashCode).Sza(wc.dM);if(!fd)return!1;Ra=Jc.pl.domElement;wc=dd.HelperMethods.JAe(dd.HelperMethods.cEb(Jc.domElement,Ra),wc.dM);Jc=0;fd=this.zAa.Hd(fd.getRange());
for(let Be=0,Re=Jg.hMe.length;Be<Re;++Be){const lf=Jg.hMe[Be];if((128===lf||64===lf)&&this.zAa.$.isEditMode)continue;var $d=fd.UPa(lf);if(!$d||!$d.Oab||"none"===$d.Oab.style.display)continue;$d=$d.Oab;const xf=dd.HelperMethods.cEb($d,Ra);$d=new Sys.UI.Bounds(xf.x,xf.y,$d.offsetWidth,$d.offsetHeight);if(yf.a.tU($d,wc)){Jc=lf;break}}return 0!==Jc?(fd.invoke(Jc,Zb),!0):!1};this.XJg=ca;Ib.a.instance.ta(yc.a.click,A,this.jej)}get zAa(){return this.XJg}}Jg.hMe=[1,2,32,256,128,64];Object(l.a)(Jg,"IPadSelectionClickThroughBehavior",
aa,[]);class hj{constructor(A){this.cof=ca=>{this.mMc(ca.$d,1);return!0};this.dof=ca=>{this.mMc(ca.$d,-1);return!0};this.Mh=()=>{this.$Ad=!1};this.gv=()=>{this.$Ad=!0};this.gridView=A;this.nab=0;this.$Ad=this.Dqc=!1;this.Y9=Number.NaN;this.gridView.ha.gla(this.gv);this.gridView.ha.fla(this.Mh);this.gridView.ha.PCe(this.Mh)}dispose(){this.gridView.ha.Kha(this.gv);this.gridView.ha.xaa(this.Mh);this.gridView.ha.p7f(this.Mh)}p4(){this.nab=0;this.Dqc=!1;this.Y9=Number.NaN}iZe(A){this.Dqc=!0;this.mMc(A,
1)}jZe(A){this.Dqc=!1;this.mMc(A,-1)}mMc(A,ca){if(A)if(A.parentNode)if(this.$Ad)isNaN(this.Y9)||(this.CMc(this.Y9,!1),this.Y9=Number.NaN);else if(A=parseInt(A.parentNode.getAttribute(Hc.a.Fab),10),isNaN(A))n.ULS.shipAssertTag(537159366,0,!1,"MarqueeHoveringManager.UpdateMarqueeStyle: indexInMarqueeCollection is not a valid number.");else{if(!isNaN(this.Y9)&&A!==this.Y9){if(this.Dqc)return;this.CMc(this.Y9,!1)}if(isNaN(this.Y9)||A!==this.Y9)this.Y9=A,this.nab=0;!this.nab&&0<ca&&this.CMc(A,!0);this.nab=
Math.max(this.nab+ca,0);!this.nab&&0>ca&&(this.CMc(A,!1),this.Y9=Number.NaN)}else n.ULS.shipAssertTag(537159367,0,!!A.parentNode,"MarqueeHoveringManager.UpdateMarqueeStyle: handle.ParentNode is null.");else n.ULS.shipAssertTag(537159368,0,!!A,"MarqueeHoveringManager.UpdateMarqueeStyle: handle is null.")}CMc(A,ca){var Ra=this.gridView.jd.QNc;for(const Zb of Ra)for(Ra=this.gridView.Kd.RF(3,Zb,A).Qg,Te.DOMElementExtensions.toggleCssClass(Ra,ff.hQh,ca),Ra=Ra.firstChild;Ra;Ra=Ra.nextSibling)Rd.a.contains(Ra.className,
"resizemarqueehandle",!0)&&Te.DOMElementExtensions.toggleCssClass(Ra,ff.lQh,ca)}}Object(l.a)(hj,"MarqueeHoveringManager",null,[]);var Ci=a(182),ij=a(871),yi=a(1192);class Th extends aa{constructor(A,ca){super(A);this.Ymc=!1;this.Dyc=()=>{if(!this.hu)return n.ULS.shipAssertTag(537159364,0,!1,"RangeCatchUpActivityHighlightBehavior.OnPointerEnter: highlightController is null"),!1;this.hu.Asj(this.qfa);this.hu.QFh(this.rfa);if(3===this.hu.model.state)return!0;this.hu.Awd(!0);return!0};this.Sga=()=>{if(!this.hu)return!1;
this.hu.l1f(!1);this.hu.JXd(this.rfa,!1);if(3===this.hu.model.state)return!0;this.hu.Awd(!1);return!0};this.onPointerDown=Ra=>this.hu?2===Ra.Gd&&Ra.yq===Sys.UI.MouseButton.leftButton?!0:!1:!1;this.ZNb=()=>{if(!this.hu)return!1;this.hu.JXd(this.rfa,!0);this.hu.Awd(!1);this.hu.Hya();return!0};this.onDoubleClick=Ra=>{if(Ra.Ba)return Ra.Ba.stopPropagation(),!0;n.ULS.sendTraceTag(537159363,0,50,"CatchUpActivityHighlightBehavior::OnDoubleClick Double click event handled on Pill.");return!0};this.container=
A;this.hu=Object(G.a)(yi.a,ca.metadata);this.njg(ca)&&this.gqf(ca.isVisible)}dispose(){this.t5f();this.hu=null;super.dispose()}X3a(A){this.hu=Object(G.a)(yi.a,A.metadata);this.njg(A)?this.gqf(A.isVisible):this.t5f();!Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:7800556_DisableRangeHighlightAdjustBehaivor")&&A.isVisible!==A.lCa&&this.hu&&(this.hu.oUj(A.isVisible?1:0),Te.DOMElementExtensions.setVisible(this.rfa,A.isVisible))}gqf(A){this.Ymc||(this.Ymc=!0,this.rfa=document.createElement("div"),this.rfa.id=
`${this.container.id}-${Hc.a.aMe}`,this.rfa.className=ij.a.veh,this.qfa=document.createElement("div"),this.qfa.id=`${this.container.id}-${Hc.a.M$c}`,this.qfa.className=ij.a.M$c,this.iU=document.createElement("div"),this.iU.appendChild(this.qfa),this.iU.className=ij.a.ueh,this.rfa.appendChild(this.iU),this.container.appendChild(this.rfa),n.ULS.sendTraceTag(537159365,0,50,"RangeCatchUpActivityHighlightBehavior::RangeCatchUpActivityHighlightBehavior: An activity indicator has been created."),id.a.instance.ta(yc.a.FZ,
this.iU,this.Dyc),id.a.instance.ta(yc.a.oE,this.iU,this.Sga),id.a.instance.ta(yc.a.pointerDown,this.iU,this.onPointerDown),Ci.a.instance.ta(yc.a.click,this.iU,this.ZNb),Ci.a.instance.ta(yc.a.ym,this.iU,this.onDoubleClick),Te.DOMElementExtensions.setVisible(this.iU,A))}t5f(){this.Ymc&&(this.Ymc=!1,id.a.instance.Aa(yc.a.FZ,this.iU,this.Dyc),id.a.instance.Aa(yc.a.oE,this.iU,this.Sga),id.a.instance.Aa(yc.a.pointerDown,this.iU,this.onPointerDown),Ci.a.instance.Aa(yc.a.click,this.iU,this.ZNb),Ci.a.instance.Aa(yc.a.ym,
this.iU,this.onDoubleClick),Te.DOMElementExtensions.Oh(this.qfa),this.qfa=null,Te.DOMElementExtensions.Oh(this.rfa),this.rfa=null)}njg(A){A=new gd.a(A.range,A.sheetId);return!!this.hu&&(!this.hu.DN()||this.hu.mpc(A))}}Object(l.a)(Th,"RangeCatchUpActivityHighlightBehavior",aa,[]);class Uh extends Ae{constructor(A,ca,Ra,Zb){super(A,ca,Ra,Zb)}get c9(){return 16}get fjb(){return this.gridView.ha.rangePicker.qod(!1)}kYa(){return(this.gridView.inRangePicker||this.gridView.fl)&&super.kYa()}}Object(l.a)(Uh,
"RangePickerTouchGrippiesBehavior",Ae,[]);class lj extends aa{constructor(A,ca){super(A);const Ra=document.createElement("div"),Zb=document.createElement("div");Ra.className=ca?ff.PQh:ff.RQh;Zb.className=ca?ff.QQh:ff.OQh;A.appendChild(Ra);A.appendChild(Zb)}}Object(l.a)(lj,"RearrangeHighlightBehavior",aa,[]);var pi;(function(A){A[A.topLeft=0]="topLeft";A[A.topRight=1]="topRight";A[A.bottomLeft=2]="bottomLeft";A[A.bottomRight=3]="bottomRight";A[A.error=4]="error"})(pi||(pi={}));Object(l.b)("Corner",
pi);class jh extends aa{constructor(A,ca,Ra,Zb,wc){super(A);this.Ie=this.SI=null;this.G7=0;this.Md=this.sourceRange=null;this.RYa=!1;this.onPointerDown=Jc=>{Jc=za.a(this.$).yg(Jc);if(this.Qig(Jc)&&!this.RYa){this.BDf();this.Ie=this.mr.yjc();this.SI=this.mr.whf(Jc);if(!this.Ie||!this.SI||!this.SI.range)return n.ULS.shipAssertTag(537159361,0,!!this.Ie,"ResizeMarqueeBehaviorBase.OnPointerDown: cellContentEditor is null"),n.ULS.shipAssertTag(537159360,0,!!this.SI,"ResizeMarqueeBehaviorBase.OnPointerDown: selectedHighlightState is null"),
n.ULS.shipAssertTag(537159331,0,!!this.SI.range,"ResizeMarqueeBehaviorBase.OnPointerDown: selectedHighlightState.Range is null"),!1;this.Md=this.SI.range.clone();this.sourceRange=this.Md.clone();this.G7=this.Zcf(Jc);if(4===this.G7)return n.ULS.shipAssertTag(537159330,0,!1,"ResizeMarqueeBehaviorBase.OnPointerDown: currentFixedCorner is not valid"),!1;const fd=this.aff(Jc,!0);if(!fd)return n.ULS.shipAssertTag(537159329,0,!1,"ResizeMarqueeBehaviorBase.OnPointerDown: mouseSelection is null. Not expect when clicking on handler."),
!1;if(!this.ATe(fd))return n.ULS.shipAssertTag(537159328,0,!1,"ResizeMarqueeBehaviorBase.OnPointerDown: currentFixedCorner is not valid"),!1;this.gridView.jRa=!0;this.Ie.sH(!1);this.tI.iZe(Jc.$d);this.mr.y1f(!0,this.JK.sX);this.Ie.textBox.removeSelection();this.Ie.W7b(this.alf);this.J4f();this.RYa=!0;cg.b(this.$,!0)}return!0};this.gl=Jc=>{Jc=za.a(this.$).yg(Jc);Jc=this.aff(Jc,!1);if(!Jc)return!0;Jc=this.ATe(Jc);if(!Jc)return n.ULS.shipAssertTag(537159327,0,!1,"ResizeMarqueeBehaviorBase.OnPointerMove: newMarqueeRange is null"),
this.yic(!0),!1;if(this.Md.equals(Jc))return!0;this.Md=Jc;Jc=this.OV();Jc||(n.ULS.shipAssertTag(537159326,0,!1,"ResizeMarqueeBehaviorBase.OnPointerMove: UpdateHighlightOnMove failed"),this.yic(!0));return Jc};this.Yi=Jc=>{za.a(this.$).yg(Jc);Jc=this.i_();n.ULS.shipAssertTag(537159325,0,Jc,"ResizeMarqueeBehaviorBase.OnPointerUp: SetSelectedRange failed");this.yic(!Jc);return Jc};this.alf=()=>{this.yic(!0)};this.gridView=ca;this.$=ca.$;this.nO=[];this.ha=this.gridView.ha;this.tI=Ra;this.mr=Zb;this.JK=
wc;this.coloredReferencesManager=this.$.ga.Da(281);n.ULS.shipAssertTag(537159362,0,!!this.coloredReferencesManager,"ResizeMarqueeBehaviorBase Ctor: coloredReferencesManager is null. We already have marquee highlights so it shouldn't happen.");if(this.sQ=he.a.cG())ca=this.$.ga.Da(464),n.ULS.shipAssertTag(510255176,0,!!ca,"ResizeMarqueeBehaviorBase Ctor: formulaAssistanceManager is null. We already have marquee highlights so it shouldn't happen."),this.RD=ca.RD;for(const Jc of this.a$f())ca=this.mr.ISe(A,
Jc,this.mDe(),this.onPointerDown),this.nO.push(ca);for(const Jc of this.nO)id.a.instance.ta(yc.a.FZ,Jc,this.tI.cof),id.a.instance.ta(yc.a.oE,Jc,this.tI.dof);this.X3a(wc)}dispose(){this.nO.forEach(A=>{id.a.instance.Aa(yc.a.pointerDown,A,this.onPointerDown)});this.nO.length=0;super.dispose()}X3a(A){this.JK=A;this.vDe(A);this.mr.vUb(A,this.nO,this.s3d());this.tI.p4()}aff(A,ca){const Ra=A.$d;A=A.clientPoint;if(!Ra||!A)return n.ULS.shipAssertTag(537159324,0,!!Ra,"ResizeMarqueeBehaviorBase.GetMouseSelectionRange: source is null"),
n.ULS.shipAssertTag(537159323,0,!!A,"ResizeMarqueeBehaviorBase.GetMouseSelectionRange: point is null"),null;ca&&(A=this.NHf(A));ca=this.ha.As(A,Ra,0,!0,!1,!0);ca||(A=this.NHf(A),ca=this.ha.As(A,Ra,0,!0,!1,!0));return ca}NHf(A){A.y+=0===this.G7||1===this.G7?2:-2;A.x+=0===this.G7||2===this.G7?2:-2;return A}ATe(A){if(!A||!this.sourceRange)return n.ULS.shipAssertTag(537159322,0,!!A,"ResizeMarqueeBehaviorBase.CreateNewRange: newCorner is null"),n.ULS.shipAssertTag(537159321,0,!!this.sourceRange,"ResizeMarqueeBehaviorBase.CreateNewRange: sourceRange is null"),
null;if(0===this.G7)return new Kb.Range(A.top,A.left,this.sourceRange.bottom,this.sourceRange.right,!0,!1);if(1===this.G7)return new Kb.Range(A.top,this.sourceRange.left,this.sourceRange.bottom,A.right,!0,!1);if(2===this.G7)return new Kb.Range(this.sourceRange.top,A.left,A.bottom,this.sourceRange.right,!0,!1);if(3===this.G7)return new Kb.Range(this.sourceRange.top,this.sourceRange.left,A.bottom,A.right,!0,!1);n.ULS.shipAssertTag(537159320,0,!1,`ResizeMarqueeBehaviorBase.CreateNewRange: currentFixedCorner is not valid: ${pi[this.G7]}`);
return null}i_(){return this.sQ?this.RD.pMb(this.Ie,this.SI,this.Md):this.coloredReferencesManager.pMb(this.Ie,this.SI,this.Md)}OV(){return this.i_()}yic(A){A&&n.ULS.sendTraceTag(537159319,0,10,"ResizeMarqueeBehaviorBase.FinishOrAbortOperation: Aborting operation, will try to recalculate colored references as a fallback.");this.tI.jZe(this.nO[0]);this.mr.y1f(!1,this.JK.sX);this.Ie.textBox.setCaretPositionToEnd();this.Ie.mDc(this.alf);this.gug();this.RYa=this.gridView.jRa=!1;cg.b(this.$,!1);this.mr.g3f()}}
Object(l.a)(jh,"ResizeMarqueeBehaviorBase",aa,[]);class Qe extends jh{constructor(A,ca,Ra,Zb,wc){super(A,ca,Ra,Zb,wc)}a$f(){return[ff.VQh,ff.WQh,ff.TQh,ff.UQh]}mDe(){return[ff.SQh]}Zcf(A){A=A.$d;if(A===this.nO[0])return 0;if(A===this.nO[1])return 1;if(A===this.nO[2])return 2;if(A===this.nO[3])return 3;n.ULS.shipAssertTag(537159318,0,!1,"ResizeMarqueeMouseBehavior.GetFixedCorner: source doesn't match any resize handle.");return 4}J4f(){this.mr.pR(this.gl,this.Yi,!0)}gug(){this.mr.S9d(this.gl,this.Yi,
!0)}Qig(A){return 2===($a.a.Bd=A.Gd)&&A.yq===Sys.UI.MouseButton.leftButton}s3d(){return!0}BDf(){n.ULS.sendTraceTag(537159317,0,50,"ResizeMarqueeMouseBehavior.LogStartOperation: Starting resize marquee operation with mouse.")}vDe(A){for(const ca of this.nO)ca.style.backgroundColor=A.Qg.style.borderColor}}Object(l.a)(Qe,"ResizeMarqueeMouseBehavior",jh,[]);class F extends jh{constructor(A,ca,Ra,Zb,wc){super(A,ca,Ra,Zb,wc);this.TNb=()=>{const Jc=3===$a.a.Bd;this.TEd&&!Jc?this.mr.vUb(this.JK,this.nO,!1):
!this.TEd&&Jc&&this.mr.vUb(this.JK,this.nO,!0);this.TEd=Jc};this.qdj=(Jc,fd)=>{fd.Fab===this.JK.sX&&this.mr.vUb(this.JK,this.nO,!fd.start&&this.s3d())};$a.a.mCe(this.TNb);this.TEd=3===$a.a.Bd;this.mr.n_g(this.qdj)}dispose(){$a.a.b7f(this.TNb);super.dispose()}a$f(){return[kd.a.aQh,kd.a.$Ph]}mDe(){const A=!Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:5858804_CanvasHitTest");return[A?kd.a.M4e:kd.a.L4e,kd.a.shc,A?kd.a.ZPh:kd.a.qhc]}Zcf(A){A=A.$d;if(A===this.nO[0])return 0;if(A===this.nO[1])return 3;
n.ULS.shipAssertTag(537159316,0,!1,"ResizeMarqueeTouchBehavior.GetFixedCorner: source doesn't match any resize handle.");return 4}J4f(){Y.a.fC?this.mr.pR(this.gl,this.Yi,!1):this.mr.Ywj(this.gl,this.Yi)}gug(){Y.a.fC?this.mr.S9d(this.gl,this.Yi,!1):this.mr.xfk(this.gl,this.Yi)}Qig(A){return 3===($a.a.Bd=A.Gd)}s3d(){return 3===$a.a.Bd}BDf(){n.ULS.sendTraceTag(537159315,0,50,"ResizeMarqueeTouchBehavior.LogStartOperation: Starting resize marquee operation with touch.")}vDe(){}}Object(l.a)(F,"ResizeMarqueeTouchBehavior",
jh,[]);class ea extends aa{constructor(A,ca){super(A);ea.yyb(A,db.a.qQh+" "+kd.a.hza,null===ca||void 0===ca?void 0:ca.horizontal);ea.yyb(A,db.a.pQh+" "+kd.a.hza,null===ca||void 0===ca?void 0:ca.vertical);ea.yyb(A,db.a.mQh+" "+kd.a.hza,null===ca||void 0===ca?void 0:ca.horizontal);ea.yyb(A,db.a.oQh+" "+kd.a.hza,null===ca||void 0===ca?void 0:ca.vertical);ea.yyb(A,kd.a.nQh)}static yyb(A,ca,Ra){const Zb=document.createElement("div");Zb.className=ca;Ra&&(Zb.style.backgroundImage=`url("${Ra}")`);A.appendChild(Zb)}}
Object(l.a)(ea,"SelectionCutCopyBehavior",aa,[]);class Ma extends aa{constructor(A){super(A);appChrome.renderSpinner(A)}}Object(l.a)(Ma,"SelectionPasteBehavior",aa,[]);class Cb extends aa{constructor(A,ca){super(A);Cb.Ryb(A,db.a.LQh+" "+kd.a.hza,null===ca||void 0===ca?void 0:ca.horizontal);Cb.Ryb(A,db.a.KQh+" "+kd.a.hza,null===ca||void 0===ca?void 0:ca.vertical);Cb.Ryb(A,db.a.HQh+" "+kd.a.hza,null===ca||void 0===ca?void 0:ca.horizontal);Cb.Ryb(A,db.a.JQh+" "+kd.a.hza,null===ca||void 0===ca?void 0:
ca.vertical);Cb.Ryb(A,kd.a.IQh)}static Ryb(A,ca,Ra){const Zb=document.createElement("div");Zb.className=ca;Ra&&(Zb.style.backgroundImage=`url("${Ra}")`);A.appendChild(Zb)}}Object(l.a)(Cb,"SelectionRangePickerBehavior",aa,[]);class mc extends Ae{constructor(A,ca,Ra,Zb){super(A,ca,Ra,Zb)}get c9(){return 0}get fjb(){return this.gridView.ha.ra.lf}kYa(){const A=this.gridView.fl||this.gridView.ld;return this.gridView.ha.ra.Ij&&!A&&super.kYa()}}Object(l.a)(mc,"SelectionTouchGrippiesBehavior",Ae,[]);let Pc=
class extends zc.a{constructor(A,ca){super();this.Lvb=(Ra,Zb)=>{Ra=Zb.c9;const wc=this.gridView;Zb=Zb.msi;const Jc=Zb.Qg,fd=Zb.$0;Y.a.Xi&&fd.push(new Jg(Jc,wc));switch(Ra){case 24:Zb.$0.push(new Th(Jc,Zb));break;case 0:Zb.$0.push(new Ri(Jc,wc));Y.a.ls||(fd.push(new Wi(Jc,this.gridView.$,Zb.paneType,this.tableManager,this.mr)),fd.push(new Qi(Jc,this.gridView.$,Zb.paneType,this.tableManager,this.mr)));fd.push(new mc(Zb,Jc,wc,Zb.paneType));break;case 3:fd.push(new sf(Jc));Y.a.ls||(fd.push(new pg(Jc,
this.gridView.$,Zb.paneType,this.tI,this.mr,Zb)),fd.push(new Qe(Jc,this.gridView,this.tI,this.mr,Zb)),fd.push(new F(Jc,this.gridView,this.tI,this.mr,Zb)));break;case 4:case 5:fd.push(new ea(Jc,this.IEe));break;case 30:fd.push(new Ma(Jc));break;case 16:fd.push(new Cb(Jc,this.IEe));fd.push(new Uh(Zb,Jc,wc,Zb.paneType));break;case 11:case 12:fd.push(new lj(Jc,11===Ra));break;case 17:fd.push(new sf(Jc));break;case 19:fd.push(new sf(Jc)),fd.push(new Oe(Zb,Jc,wc,Zb.paneType))}Zb.Y9b=!0};this.$=A;this.gridView=
U.h(A);this.tableManager=ca;this.tI=new hj(this.gridView);this.mr=new Ze(this.gridView);this.gridView.Kd&&(this.gridView.Kd.GZg(this.Lvb),this.gridView.Kd.update(!1));Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Migrate2GridHighlightsBehaviorManager",!1)||A.ga.Qa(64,this)}get IEe(){Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:6809974_DancingAnts1Cdn")&&!this.HEe&&(this.HEe={vertical:De.a.current.tq(103),horizontal:De.a.current.tq(104)});return this.HEe}dispose(){this.gridView.Kd.yBj(this.Lvb);
this.tI&&(this.tI.dispose(),this.tI=null);super.dispose()}};Pc=Object(vb.a)([Object(ab.d)(Wb.vb),Object(vb.b)(0,Object(Wb.W)()),Object(vb.b)(1,Object(Wb.Vc)())],Pc);Object(l.a)(Pc,"GridHighlightsBehaviorManager",zc.a,[]);class Rc extends Ob.a{constructor(A){super();this.$=A;this.je()}create(){const A=ca=>{this.Ld(this.$.ga.Da(64)||new Pc(this.$,ca))};Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:8111699_MigrateTableManager")?void ab.a.resolve(Wb.Vc,{Ja:this.Ta}).then(A):Jd.TaskExtensions.za($c.GetServiceTaskFactory.create(this.$.ga,
134,this.ka,this.Ta),ca=>A(ca.result),this.ka,3)}static la(A){A.ga.Qa(149,new Rc(A))}}Object(l.a)(Rc,"GridHighlightsBehaviorManagerFactory",Ob.a,[]);var ud=a(562);class od{constructor(){this.aPc={}}JTg(A){this.aPc[A.id.toString()]=A}T0i(A){const ca=this.aPc;for(const Ra in ca)ca[Ra].notify(A,!1);this.aPc={}}Bqj(A,ca){ca&&this.JTg(ca);return this.cTf(A,ca)}Nid(A){this.T0i(A)}t_e(A,ca){A.notify(ca,!0)}}Object(l.a)(od,"AEventEmitter",null,[317]);var Ed;(function(A){A[A.notStarted=0]="notStarted";A[A.waiting=
1]="waiting";A[A.shouldRetry=2]="shouldRetry";A[A.complete=3]="complete"})(Ed||(Ed={}));Object(l.b)("EventResultState",Ed);class oe{constructor(){this._state=0}get state(){return this._state}set state(A){n.ULS.sendTraceTag(5849616,202,50,"Changing event result state. {0}",{["OldState"]:Ed[this._state],["NewState"]:Ed[A]},"ResultType",this.Vgf());this._state=A}}Object(l.a)(oe,"AEventResult",null,[362]);class Ne extends oe{constructor(){super();this.E1c=this.Drb=null;this.state=0;this.qVc=this.Gle=
!1}get aV(){return this.Drb}get Wsa(){return this.E1c}get Zyi(){return this.Gle}Vgf(){return"GetMoreInfo Result"}}Object(l.a)(Ne,"GetMoreInfoResult",oe,[361,362]);var ef=a(714),Mf=a(385),nf=a(665),Df=a(586);class wg{constructor(A,ca,Ra,Zb,wc,Jc,fd,$d){this.Na=A;this.Qi=ca;this.kFg=Ra;this.u5=Zb;this.fg=wc;this.UTc=Jc;this.bKg=fd;this.B5b=$d}uwj(){this.Heb.ae(Ua.a.openUrlInNewTab,Sh.a.frame,Object(B.a)(this,this.openUrlInNewTab,"openUrlInNewTab"));this.Heb.ae(Ua.a.OUa,Sh.a.frame,Object(B.a)(this,this.OUa,
"openDocumentUrl"));O.AFrameworkApplication.PP?this.dDf():this.Heb.Rg(Ua.a.Lfc,Sh.a.frame,Object(B.a)(this,this.Lfc,"documentLoaded"),96)}openUrlInNewTab(A,ca,Ra,Zb,wc){wc&&wc.MenuItemId&&(n.ULS.sendTraceTag(5849678,202,50,"Opening new tab {0}",{["Id"]:wc.SourceControlId,["AppType"]:Df.a[this.IQ]}),yf.a.Sg(wc.MenuItemId.toString(),"_blank",void 0,"NewAndOpenCommonHelpers:OpenUrlInNewTab"));return 32}OUa(A,ca,Ra,Zb,wc){if(wc&&wc.MenuItemId){const Jc=O.AFrameworkApplication.da.pa("WacInTabOpenMRUIsEnabledForUiHost"),
fd=O.AFrameworkApplication.da.pa("UiHostSupportsDocRebootFeatures");n.ULS.sendTraceTag(592237459,202,50,"[InTabOpenMRUIsEnabledForUiEmbed: {0}][UiEmbedSupportsDocReboot: {1}]",Jc,fd);if(Jc&&fd){n.ULS.sendTraceTag(592237458,202,50,"Opening new tab {0}",{["Id"]:wc.SourceControlId,["AppType"]:Df.a[this.IQ]});A=wc.MenuItemId.toString();const $d={};$d[Mf.a.UVa]="1";$d[Mf.a.documentUrl]=A;$d[Mf.a.reason]=nf.a.open;n.ULS.sendTraceTag(592237460,202,50,"Send PostMessage to the Ui host to reboot a document");
O.AFrameworkApplication.fU().execute(Be=>{Be.sendMessage(sa.a.L1,$d)})}else this.openUrlInNewTab(A,ca,Ra,Zb,wc)}return 32}Lfc(){this.dDf();return 32}nga(A,ca,Ra){Ra=void 0===Ra?"":Ra;if(ca&&ca.$F){const Zb=ef.a[ca.status];ca=ca.$F.getTime();const wc=this.Yy()-ca;n.ULS.sendTraceTag(5849679,202,50,"Making request to the WAC server {0}",{["Caller"]:A,["RequestStatus"]:Zb,["ElapsedMs"]:wc,["StartTime"]:ca,["Notes"]:Ra})}else n.ULS.sendTraceTag(5849680,202,50,"Attempted to make a request to the WAC server with null request item {0}",
{["Caller"]:A})}dDf(){var A=O.AFrameworkApplication.da.pa("QPGVCI"),ca=R.a.gw(document.URL,"wdNewAndOpenCt",A);if(ca){ca=parseInt(ca);var Ra=R.a.gw(document.URL,"wdPreviousSession",A);A=R.a.gw(document.URL,"wdPreviousCorrelation",A);var Zb=O.AFrameworkApplication.da.pa("NAOPLP");if(O.AFrameworkApplication.PP){var wc=O.AFrameworkApplication.PP.getTime();!ca||ca>wc?n.ULS.sendTraceTag(5849682,202,15,"NewAndOpenCommonHelpers.LogNewAndOpenPerfStats: Invalid timestamp {0}",{["ClickTimestamp"]:ca,["DocumentLoadedTime"]:wc,
["SessionId"]:Ra,["Correlation"]:A}):n.ULS.sendTraceTag(5849683,202,Zb?15:50,"NewAndOpenCommonHelpers.LogNewAndOpenPerfStats: Click-to-load perf {0}",{["ClickToLoadTime"]:wc-ca,["ClickTimestamp"]:ca,["SessionId"]:Ra,["Correlation"]:A})}else n.ULS.sendTraceTag(5849681,202,Zb?15:50,"NewAndOpenCommonHelpers.LogNewAndOpenPerfStats: Not logging because document loaded time has not been set {0}",{["ClickTimestamp"]:ca,["SessionId"]:Ra,["Correlation"]:A})}}get Heb(){return this.Na.value}get IMb(){return this.Qi.value}get IIf(){return this.kFg.value}get IQ(){return this.u5.value}get qwc(){return this.fg.value}get Yy(){return this.UTc}get rZ(){return this.bKg.value}get supportsGetMoreInfoForPersonalStorage(){return this.B5b.value}static get instance(){return wg.La||
(wg.La=wg.$P())}static $P(){return new wg(new ud.a(()=>O.AFrameworkApplication.Dd),new ud.a(()=>O.AFrameworkApplication.tf),new ud.a(()=>O.AFrameworkApplication.sa),new ud.a(()=>O.AFrameworkApplication.sa.Ra.kj),new ud.a(()=>O.AFrameworkApplication.Vj),()=>(new Date).getTime(),new ud.a(()=>O.AFrameworkApplication.sa.Ra.rZ),new ud.a(()=>O.AFrameworkApplication.supportsGetMoreInfoForPersonalStorage))}}wg.La=null;Object(l.a)(wg,"NewAndOpenCommonHelpers",null,[316]);class Sf{constructor(A,ca,Ra){this.L4b=
this.Yk=null;this.R_c=0;this.VPg=A;this.fg=ca;this.The=Ra}S1g(){this.R_c=this.Lib+1}OXd(A){this.Yk&&(this.fg.rr(this.Yk),this.Yk=null);A&&(this.R_c=0)}e5j(A){const ca=this.w$j;0<=ca?(this.S1g(),this.OXd(!1),this.Yk=new Ue.a(4,1,ca,A,107),this.fg.Sh(this.Yk)):(this.OXd(!0),n.ULS.sendTraceTag(5849676,202,50,"Retries exhausted {0}",{["Action"]:this.The}))}get Lib(){return this.R_c}get w$j(){return this.Lib>=this.Vdg.length?-1:this.Vdg[this.Lib]}get Vdg(){if(!this.L4b){const A=(this.VPg.value||"0").split(",");
this.L4b=[];for(let ca=0;ca<A.length;ca++){const Ra=parseInt(A[ca]);isNaN(Ra)?n.ULS.sendTraceTag(5849677,202,15,"Retry interval list contains non-number element {0}",{["Action"]:this.The,["Entry"]:A[ca]}):Array.add(this.L4b,Ra)}}return this.L4b}}Object(l.a)(Sf,"RetryHelper",null,[]);class gg extends od{constructor(A,ca){super();this.d6=A;this.csb=new Sf(ca,this.jMb.qwc,"GetMoreInfo");this.gr=new Ne}NVi(){this.qId("Document opened")}Brh(A){return()=>{this.qId(A,!0)}}cTf(A,ca){ca=void 0===ca?null:ca;
n.ULS.sendTraceTag(5849617,202,50,"Attempting to get GetMoreInfo properties {0}",{["Trigger"]:A});3===this.gr.state?(ca&&this.t_e(ca,this.gr),n.ULS.sendTraceTag(5849619,202,50,"GetMoreInfo already populated. {0}",{["Trigger"]:A})):this.qId(A);return this.gr}qId(A,ca){this.csb.OXd(!(void 0===ca?0:ca));1===this.gr.state?n.ULS.sendTraceTag(5849620,202,50,"Not starting new request, because one is already in progress {0}",{["Trigger"]:A,["RetryIndex"]:this.csb.Lib}):(n.ULS.sendTraceTag(5849621,202,50,
"Making GetMoreInfo request {0}",{["Trigger"]:A,["RetryIndex"]:this.csb.Lib}),this.gr.state=1,ca=String.format("{0}GetMoreInfoHandler.ashx?{1}",this.jMb.rZ,O.AFrameworkApplication.Ak),this.jMb.IMb.D6(ca,1,null,null,[gg.bse,gg.cwe],!1,5,this.Hqh(),this.Gqh(A),null))}Hqh(){return A=>{var ca=!1;let Ra=!1;var Zb=!1,wc;if(O.AFrameworkApplication.da.pa("GetMoreInfoDataFromResponseBody"))if(A.data.Tf){let Jc=T.d(A.data.Tf);({Mu:wc}=Jc);Jc.returnValue?wc?(Zb=!0,this.gr.E1c=wc.StorageServiceDisplayName,this.gr.Drb=
gg.yyf(wc.PersonalFileStorageUrl)?wc.PersonalFileStorageUrl:"",""===this.gr.aV&&"SharePointOnlineConsumer"===O.AFrameworkApplication.da.Sa("FileSource")&&(this.gr.Drb=R.a.j4(O.AFrameworkApplication.breadcrumbFolderUrl)),ca=""===this.gr.aV&&""!==this.gr.Wsa):n.ULS.sendTraceTag(25298113,202,15,"Response body could not be casted into a GetMoreInfoResponseData type. Will fallback to reading the data from the headers"):n.ULS.sendTraceTag(25298112,202,15,"Failed to deserialize GetMoreInfo response body. Will fallback to reading the data from the headers")}else n.ULS.sendTraceTag(25298083,
202,15,"Could not find GetMoreInfo data on the response body. Will fallback to reading the data from the headers");Zb||((wc=A.data.responseHeaders)?(this.gr.E1c=(wc[gg.cwe]||"").toString(),ca=(wc[gg.bse]||"").toString(),this.gr.Drb=gg.yyf(ca)?ca:"",""===this.gr.aV&&"SharePointOnlineConsumer"===O.AFrameworkApplication.da.Sa("FileSource")?(this.gr.Drb=R.a.j4(O.AFrameworkApplication.breadcrumbFolderUrl),ca=""===this.gr.aV&&""!==this.gr.Wsa):ca=""===ca&&""!==this.gr.Wsa):(n.ULS.sendTraceTag(5849622,202,
50,"Null response headers received."),Ra=!0));Zb=String.format("Success at RetryIndex: {0}, InvalidResponse: {1}, InstantiatingPersonalStorage: {2}, InfoFoundInResponseBody: {3}",this.csb.Lib,Ra,ca,Zb);this.jMb.nga("GetMoreInfoActor.CreateGetMoreInfoFromServerSuccessCallback",A.data,Zb);this.leg(3,ca,Ra)}}Gqh(A){return ca=>{this.jMb.nga("GetMoreInfoActor.CreateGetMoreInfoFromServerFailureCallback",ca.data,"Failure");this.leg(2);this.csb.e5j(this.Brh(A))}}leg(A,ca,Ra){this.gr.state=A;this.gr.Gle=void 0===
ca?!1:ca;this.gr.qVc=void 0===Ra?!1:Ra;this.Nid(this.gr)}get jMb(){return this.d6.value}static get instance(){return gg.La||(gg.La=gg.$P())}static $P(){return new gg(new ud.a(()=>wg.instance),new ud.a(()=>O.AFrameworkApplication.nbi))}static yyf(A){if(!A)return n.ULS.sendTraceTag(5849624,202,50,"Attempted to check an empty url for validity as a StorageHostUrl."),!1;if(kb.a.Tm(A).startsWith("https://"))return!0;n.ULS.sendTraceTag(5849625,202,10,"StorageUrl has invalid scheme.");return!1}}gg.bse="PersonalFileStorageUrl";
gg.cwe="StorageServiceDisplayName";gg.La=null;Object(l.a)(gg,"GetMoreInfoActor",od,[]);class dg{constructor(A,ca,Ra,Zb,wc){this.HKg=6E4;this.Rof="inactive";this.Vye="active";this.vS=!0;this.fg=A;this.IJg=ca;this.UTc=Ra;this.R5b=Zb;this.$a=new Ag.a;wc&&this.W4j();this.Nne=this.xef()}Nze(A){this.$a.addHandler(this.Vye,A)}mWg(A){this.$a.addHandler(this.Rof,A)}W4j(){const A=new Ue.a(5,2,this.HKg,Object(B.a)(this,this.Kti,"inactiveLoop"),108);this.Lti.Sh(A)}Kti(){const A=this.xef(),ca=this.Yy()-A;ca>this.MKc&&
this.vS&&(n.ULS.sendTraceTag(5849626,202,50,"User went inactive {0}",{["TimeSinceLastActive"]:ca}),this.vS=!1,this.$a.raiseEvent(this.Rof));A-this.Nne>this.MKc&&(this.vS=!0,this.$a.raiseEvent(this.Vye));this.Nne=A}get Lti(){return this.fg.value}get xef(){return this.IJg}get Yy(){return this.UTc}get MKc(){return this.R5b.value}static get instance(){return dg.La||(dg.La=dg.$P())}static $P(){return new dg(new ud.a(()=>Ac.a.instance),()=>O.AFrameworkApplication.nFd.getTime(),()=>(new Date).getTime(),
new ud.a(()=>O.AFrameworkApplication.MKc),!0)}}dg.La=null;Object(l.a)(dg,"InactivityManager",null,[]);var kg=a(975);class Zf extends oe{constructor(){super();this.Xpe=this.Zpe=this.Ype=null;this.state=this.Uwe=0;this.qVc=!1}get LJd(){return this.Ype}get RHf(){return this.Zpe}get KJd(){return this.Xpe}get C$j(){return this.Uwe}Vgf(){return"MruActor Result"}}Object(l.a)(Zf,"MruResult",oe,[375,362]);class qd{constructor(A,ca,Ra){this.task=null;this.voc=A;this.DXi=ca;this.taskManager=Ra;this.retryCount=
this.QGb=0;this.d_c=this.mKb=null}THi(A,ca){return A===X.a.fnd||20===ca||18===ca||3===ca}jJi(A){return 3===A||5===A||6===A||7===A||9===A||10===A||11===A||12===A||13===A||14===A||15===A||16===A||23===A||26===A||27===A||28===A}get $Ac(){return this.d_c}reset(){this.QGb=this.retryCount=0;this.d_c=this.mKb=null;this.task&&(this.taskManager.rr(this.task),this.task=null)}byi(A,ca,Ra,Zb){this.d_c=String.format("{0}_{1}",Ra,Zb);if(this.retryCount>=this.DXi)return n.ULS.sendTraceTag(562656907,202,50,"Max retries exceeded"),
!1;if(this.THi(Ra,Zb))return n.ULS.sendTraceTag(562656908,202,50,"Encountered permanent error. Not retrying"),!1;if(this.jJi(Zb)&&1<=this.QGb)return this.mKb=Ra,!1;ca=Math.max(ca,this.voc*Math.pow(2,this.QGb));if(26===Zb)ca=Math.max(ca,3E4);else if(27===Zb||28===Zb)ca=Math.max(ca,6E4);9===Zb||412===Ra&&(null==this.mKb||412!==this.mKb)?ca=500:this.QGb+=1;this.mKb=Ra;this.retryCount+=1;this.task&&this.taskManager.rr(this.task);n.ULS.sendTraceTag(562656909,202,50,"Scheduling next retry after {0} ms.",
ca);this.task=new Ue.a(2,1,ca,A,107);this.taskManager.Sh(this.task);return!0}}Object(l.a)(qd,"RetryManager",null,[]);class ie{constructor(){this.mruItemId=this.app=this.documentExt=this.documentName=this.folderName=this.documentUrl=null}}Object(l.a)(ie,"WriteOptions",null,[]);class og extends od{constructor(A,ca,Ra,Zb,wc,Jc,fd){super();this.d6=A;this.CMg=ca;this.Yva=new qd(O.AFrameworkApplication.da.getIntFeatureGate("Microsoft.Office.SharedOnline.MruReadRetryIntervalMs",5E3),O.AFrameworkApplication.da.getIntFeatureGate("Microsoft.Office.SharedOnline.MruMaxReadRetry",
3),this.vz.qwc);this.Awa=new qd(O.AFrameworkApplication.da.getIntFeatureGate("Microsoft.Office.SharedOnline.MruWriteRetryIntervalMs",15E3),O.AFrameworkApplication.da.getIntFeatureGate("Microsoft.Office.SharedOnline.MruMaxWriteRetry",3),this.vz.qwc);this.UOg=Ra;this.qye=Zb;this.fTg={};this.sW=new Zf;this.EJg=wc;this.a3b="";this.Ay=Jc;this.Wie=fd;this.VOg=O.AFrameworkApplication.da.Hf("WordRecentLinksCount",25)}get iOc(){return this.fTg}uyj(){this.vz.Heb.ae(Ua.a.renameMostRecentlyUsedFileEntry,Sh.a.frame,
Object(B.a)(this,this.yDj,"renameMruEntry"))}yDj(){return this.uce("Rename")}XVi(){this.TFf("File Opened")}YVi(){this.TFf("IntervalUpdate")}TFf(A){n.ULS.sendTraceTag(5849670,202,50,"Starting update of MRU entry {0}",{["Trigger"]:A});this.uce(A)}H8(A){(A=kb.a.H8(A))&&A.startsWith(".")&&(A=A.substring(1,A.length));return A}Ijc(){switch(this.vz.IQ){case 3:return"Word";case 1:return"Excel";case 2:return"PowerPoint";case 5:return"Visio";case 4:return"OneNote";default:return"Unknown"}}cki(A){var ca=this.EJg();
if(!ca)return null;const Ra=new ie;Ra.documentUrl=this.Wie.value?encodeURI(ca):ca;Ra.mruItemId=this.a3b;Ra.app=this.Ijc();if(ca=this.Ay())Ra.folderName=ca.breadcrumbFolderName,ca=ca.Ip,Ra.documentName=kb.a.ds(ca),Ra.documentExt=this.H8(ca);A&&(Ra.documentName?Ra.documentName.length?255<=Ra.documentName.length?A.set("DocumentNameLength","Long"):2084<=Ra.documentName.length&&A.set("DocumentNameLength","VeryLong"):A.set("DocumentNameLength","0"):A.set("DocumentNameLength","Null"));return JSON.stringify(Ra)}uce(A,
ca){ca=void 0===ca?!1:ca;if(4===this.vz.IQ&&!O.AFrameworkApplication.Jya)return 2;var Ra=ba.a.Zt();Ra&&(Ra.set("Trigger",A),Ra.set("IsRetry",ca?"true":"false"),Ra.set("MruIdSent",this.a3b?"true":"false"),Ra.set("URLEncoded",this.Wie.value?"true":"false"));I.Health.instance.recordKpiUsage("WriteMru",0,"smartfio",Ra);A=this.cki(Ra);if(!A)return ca=!O.AFrameworkApplication.webEditingEnabled,Ra&&(Ra.set("WebEditingIsEnabled",O.AFrameworkApplication.webEditingEnabled?"true":"false"),Ra.set("ProtectedFile",
O.AFrameworkApplication.mBc?"true":"false")),I.Health.instance.recordKpiFailure("WriteMru","MissingDocumentUrl",ca,!1,Object.assign(new ka.a,{extendedProperties:Ra})),2;this.Awa&&!ca&&this.Awa.reset();Ra=String.format("{0}MruV2ServiceHandler.ashx?rs={1}",this.vz.rZ,this.localeName);this.qye?this.iOc["X-FileId"]=O.AFrameworkApplication.Ak:Ra+=String.format("&{0}",O.AFrameworkApplication.Ak);O.AFrameworkApplication.Yd&&(this.iOc["X-Office-AudienceGroup"]=Object(G.a)(String,O.AFrameworkApplication.Yd.AudienceGroup)||
"");this.iOc["X-Timeout"]=15E3;return this.vz.IMb.Ho(Ra,2,A,this.iOc,!0,5,Object(B.a)(this,this.ppk,"writeMruV2EntryOnServerSuccessCallback"),Object(B.a)(this,this.$uh,"createWriteMruV2EntryOnServerFailureCallback"),null,void 0,void 0,void 0,void 0,"4")}ppk(A){this.flf(A.data)}flf(A){const ca=ba.a.Zt();this.Awa&&(ca&&this.Awa.$Ac&&(ca.set("LastError",this.Awa.$Ac),ca.set("NumRetries",this.Awa.retryCount.toString())),this.Awa.reset());const Ra=kg.c(A.Tf);Ra&&Ra.diagnostics_data&&(this.a3b=Ra.diagnostics_data.mru_id);
A=+A.q1-+A.$F;ca&&ca.set("RequestDuration",A.toString());I.Health.instance.recordKpiSuccess("WriteMru",Object.assign(new ka.a,{extendedProperties:ca}))}$uh(A){if(A.data.httpStatus===X.a.Wyb)this.flf(A.data);else{var ca=A.data.httpStatus===X.a.LPb,Ra=ba.a.Zt();this.slf(this.Awa,A,this.Ouh(),Ra);Ra&&(Ra.set("StatusCode",A.data.httpStatus.toString()),ca||this.v4c(A.data,Ra));I.Health.instance.recordKpiFailure("WriteMru",String.format("RequestFailed_{0}",A.data.httpStatus),ca,!1,Object.assign(new ka.a,
{extendedProperties:Ra}))}}Ouh(){return()=>{this.uce("Retry",!0)}}wbi(){this.ivc("Polling")}vbi(){this.ivc("Retry",!0)}PVi(){this.ivc("Open")}OVi(){this.ivc("Activity")}ivc(A,ca){ca=void 0===ca?!1:ca;var Ra=void 0===Ra?!1:Ra;n.ULS.sendTraceTag(5849674,202,50,"Making GetMru request {0}",{["Trigger"]:A});const Zb=ba.a.Zt();Zb&&(Zb.set("Trigger",A),Zb.set("IsRetry",ca?"true":"false"),Ra&&Zb.set("RecentLinks","true"));I.Health.instance.recordKpiUsage("GetMru",0,"smartfio",Zb);this.Yva&&!ca&&this.Yva.reset();
Ra?this.bTe(Object(B.a)(this,this.xbi,"getMruV2ForRecentLinksFromServerSuccessCallback"),Object(B.a)(this,this.tbi,"getMruForRecentLinksFromServerFailureCallback"),!0):this.bTe(Object(B.a)(this,this.ybi,"getMruV2FromServerSuccessCallback"),Object(B.a)(this,this.ubi,"getMruFromServerFailureCallback"))}v4c(A,ca){A&&A.responseHeaders&&(A=A.responseHeaders["X-CorrelationId"])&&ca.set("ServerCorrelationId",A)}DSi(A,ca){A&&(ca&&ca.set("RequestDuration",(+A.q1-+A.$F).toString()),I.Health.instance.recordKpiSuccess("GetMru",
Object.assign(new ka.a,{extendedProperties:ca})))}ybi(A){this.cff(A)}cff(A,ca){ca=void 0===ca?!1:ca;var Ra="";let Zb=null,wc=null,Jc=null;const fd=kg.c(A.data.Tf);fd&&(Zb=fd.places?fd.places.items:[],wc=fd.documents?fd.documents.items:[],(Jc=kg.a(fd,ca))&&(Ra=T.c(Jc)));O.AFrameworkApplication.sa&&O.AFrameworkApplication.sa.Ra.k3&&xa.c()&&!ca&&appChrome.api.dispatch(appChrome.actions.setFileMenuMRUJson(Ra,!0));Ra=ba.a.Zt();this.Yva&&(Ra&&this.Yva.$Ac&&(Ra.set("LastError",this.Yva.$Ac),Ra.set("NumRetries",
this.Yva.retryCount.toString())),this.Yva.reset());ca&&Ra&&Ra.set("RecentLinks","true");Jc||Zb||wc?(ca?this.vz.nga("MruActor.GetMruV2ForRecentLinksFromServerSuccessCallback",A.data,"Success"):this.vz.nga("MruActor.GetMruV2FromServerSuccessCallback",A.data,"Success"),this.IMc(3,Jc,Zb,wc),this.DSi(A.data,Ra)):(ca?this.vz.nga("MruActor.GetMruV2ForRecentLinksFromServerSuccessCallback",A.data,"Failure: Invalid JSON"):this.vz.nga("MruActor.GetMruV2FromServerSuccessCallback",A.data,"Failure: Invalid JSON"),
Ra&&this.v4c(A.data,Ra),I.Health.instance.recordKpiFailure("GetMru","JsonParseFailed",!1,!1,Object.assign(new ka.a,{extendedProperties:Ra})),this.IMc(3,null,null,null,!0));this.Nid(this.sW)}xbi(A){this.cff(A,!0)}slf(A,ca,Ra,Zb){let wc=0,Jc=0;const fd=kg.c(ca.data.Tf);fd&&(null!=fd.response_code&&(wc=fd.response_code,Zb&&Zb.set("MruResponseCode",wc.toString()),9===wc&&(this.a3b="")),fd.error_data&&null!=fd.error_data.retry_after_ms&&(Jc=fd.error_data.retry_after_ms,Zb&&Zb.set("ExpectedRetryAfter",
Jc.toString())));A&&(ca=A.byi(Ra,Jc,ca.data.httpStatus,wc),Zb&&(Zb.set("CurrentRetryCount",A.retryCount.toString()),Zb.set("RetryScheduled",ca?"true":"false")))}ubi(A){this.bff(A)}bff(A,ca){ca=void 0===ca?!1:ca;const Ra=A.data.httpStatus===X.a.LPb,Zb=ba.a.Zt();Zb&&(Zb.set("StatusCode",A.data.httpStatus.toString()),ca&&Zb.set("RecentLinks","true"),Ra||this.v4c(A.data,Zb));ca?this.vz.nga("MruActor.GetMruForRecentLinksFromServerFailureCallback",A.data,"Failure"):this.vz.nga("MruActor.GetMruFromServerFailureCallback",
A.data,"Failure");this.IMc(2);this.slf(this.Yva,A,Object(B.a)(this,this.vbi,"getMruFromServerRetryTask"),Zb);I.Health.instance.recordKpiFailure("GetMru",String.format("RequestFailed_{0}",A.data.httpStatus),Ra,!1,Object.assign(new ka.a,{extendedProperties:Zb}));this.Nid(this.sW);O.AFrameworkApplication.sa&&O.AFrameworkApplication.sa.Ra.k3&&xa.c()&&(appChrome.api.dispatch(appChrome.actions.setFileMenuMRUJson("",!1)),ca||appChrome.api.dispatch(appChrome.actions.setFileMenuMRUJson("",!1)))}tbi(A){this.bff(A,
!0)}IMc(A,ca,Ra,Zb,wc){if(3!==this.sW.state||3===A)this.sW.Ype=void 0===ca?null:ca,this.sW.Zpe=void 0===Ra?null:Ra,this.sW.Xpe=void 0===Zb?null:Zb,this.sW.state=A,this.sW.qVc=void 0===wc?!1:wc,this.sW.Uwe=this.vz.Yy()}cTf(A,ca){n.ULS.sendTraceTag(6029918,202,50,"MRU result requested {0}",{["Trigger"]:A,["ResultState"]:this.sW.state});ca&&3===this.sW.state&&this.t_e(ca,this.sW);return this.sW}bTe(A,ca,Ra){Ra=void 0===Ra?!1:Ra;this.IMc(1);let Zb;const wc={};Zb=Ra?String.format(this.vz.rZ+"MruV2ServiceHandler.ashx?sort=Date&show={0}&apps={1}&rs={2}&cap={3}",
this.VOg,"OfficeSuite",this.localeName,"ClassicMru"):String.format(this.vz.rZ+"MruV2ServiceHandler.ashx?sort=Date&show={0}&apps={1}&rs={2}",10,this.Ijc(),this.localeName);this.UOg.value||(Zb+="&entity=docs");O.AFrameworkApplication.Yd&&(wc["X-Office-AudienceGroup"]=Object(G.a)(String,O.AFrameworkApplication.Yd.AudienceGroup)||"");Ra&&(wc["X-Office-Application"]="147");this.qye?wc["X-FileId"]=O.AFrameworkApplication.Ak:Zb+=String.format("&{0}",O.AFrameworkApplication.Ak);this.vz.IMb.Ho(Zb,1,null,wc,
!0,5,A,ca,null)}get vz(){return this.d6.value}get localeName(){return this.CMg.value}static get instance(){return og.La||(og.La=og.$P())}static $P(){return new og(new ud.a(()=>wg.instance),new ud.a(()=>Dg.a.pN(O.AFrameworkApplication.lcid).name),new ud.a(()=>O.AFrameworkApplication.sa.Ra.hy),O.AFrameworkApplication.da.pa("MruWriteFileIdInHeader"),()=>O.AFrameworkApplication.sa.Ra.Ju,()=>O.AFrameworkApplication.Lo,new ud.a(()=>O.AFrameworkApplication.da.pa("OICEncodeUrlIsEnabled")))}}og.La=null;Object(l.a)(og,
"MruActor",od,[]);class ah{constructor(){this.jtb=this.cte=this.hd=null;this.$o=!1}get name(){return"Common.App.NewAndOpen.Core"}Xj(A){this.hd=A;A.register(316,"Common.INewAndOpenCommonHelpers").Ee().Le(()=>wg.instance);A.register(317,"Common.IEventEmitter<Common.IGetMoreInfoResult>").Ee().Le(()=>gg.instance);A.register(317,"Common.IEventEmitter<Common.IMruResult>").Ee().Le(()=>og.instance)}init(){O.AFrameworkApplication.da.qx(()=>{this.yGb()})}yGb(){this.hd.resolve("Common.INewAndOpenCommonHelpers");
this.hd.resolve("Common.IEventEmitter<Common.IGetMoreInfoResult>");this.hd.resolve("Common.IEventEmitter<Common.IMruResult>");var A=!1;wg.instance.uwj();O.AFrameworkApplication.oqa&&(A=!0);O.AFrameworkApplication.O2f&&(og.instance.PVi(),0<O.AFrameworkApplication.SHf&&this.pAe(),this.oVj(),A=!0);O.AFrameworkApplication.supportsGetMoreInfoForPersonalStorage&&A&&gg.instance.NVi();O.AFrameworkApplication.Nik&&(A=og.instance,A.uyj(),A.XVi(),Ac.a.instance.Sh(this.Oik))}oVj(){dg.instance.Nze(Object(B.a)(og.instance,
og.instance.OVi,"makeGetMruRequestActivityTrigger"));dg.instance.Nze(Object(B.a)(this,this.pAe,"addGetMruFromServerTask"));dg.instance.mWg(Object(B.a)(this,this.byh,"deleteGetMruFromServerTask"))}byh(){Ac.a.instance.rr(this.THf)}pAe(){Ac.a.instance.Sh(this.THf)}get THf(){return this.cte||(this.cte=new Ue.a(5,2,O.AFrameworkApplication.SHf,Object(B.a)(og.instance,og.instance.wbi,"getMruFromServerTask"),109))}get Oik(){return this.jtb||(this.jtb=new Ue.a(2,2,6E4*O.AFrameworkApplication.da.getIntFeatureGate("Microsoft.Office.SharedOnline.MruUpdateIntervalInMinutes",
1440),Object(B.a)(og.instance,og.instance.YVi,"makeUpdateMruTask"),197))}dispose(){this.$o||(this.$o=!0,this.jtb&&(Ac.a.instance.rr(this.jtb),this.jtb=null))}}Object(l.a)(ah,"CorePackageManager",null,[2,3,5]);var vi=a(808);class Xg{constructor(A,ca){this.V0c=this.U0c=null;this.E2a=new Rb.a;this.Qi=A;this.zKa=ca.appSettings[Xg.sok]||""}get oWj(){return this.E2a.task}get l7(){return this.Qi.value}OFj(){const A={};A[Xg.Npi]=O.AFrameworkApplication.Ak;A["Content-Type"]="application/json; charset=utf-8";
n.ULS.sendTraceTag(6612806,215,50,"Client is sending a request to get the code for the O365 switcher");const ca=R.a.um(this.zKa+Xg.pWj,Xg.s2i,O.AFrameworkApplication.sa.Ra.kj.toString());this.l7.Ho(ca,1,"",A,!0,2,Object(B.a)(this,this.zOb,"onSuccessCallback"),Object(B.a)(this,this.GNb,"onFailureCallback"),null,void 0,void 0,void 0,void 0,"20")}eTi(A){try{const ca={};ca.FlightName=A.FlightName;ca.SessionID=A.SessionID;n.ULS.sendTraceTag(594883776,215,50,T.c(ca))}catch(ca){n.ULS.sendTraceTag(594883747,
215,10,"Unable to log NavBarData")}}zOb(A){let ca=null;ca&&ca.length||!A||!A.data||(ca=A.data.Tf);if(ca&&ca.length)try{const Ra=T.a(ca);this.U0c=Ra.NavBarDataJson;n.ULS.sendTraceTag(41551899,215,50,"Skipping call to TryLoadResources for React Shared Header.");this.U0c?(()=>{let Zb=T.d(Ra.NavBarDataJson);({Mu:this.V0c}=Zb);return Zb})().returnValue?(this.eTi(this.V0c),this.E2a.setResult(this.V0c)):(n.ULS.sendTraceTag(7660113,215,10,"Failed to deserialize : {0}",{["ShellData"]:vi.a.Llb(this.U0c)}),
this.E2a.ww()):(n.ULS.sendTraceTag(9000737,215,15,"ShellData is null"),this.E2a.ww())}catch(Ra){n.ULS.sendTraceTag(6362370,215,10,"Unable to parse the response from O365ShellServiceProxy."),this.E2a.ww()}else n.ULS.sendTraceTag(6362369,215,10,"Response from O365ShellServiceProxy is null.")}GNb(){this.E2a.ww();n.ULS.sendTraceTag(7608091,215,10,"Call to O365ShellServiceProxy failed.")}static get instance(){return Xg.La||(Xg.La=Xg.Ina())}static Ina(){return new Xg(new ud.a(()=>O.AFrameworkApplication.tf),
O.AFrameworkApplication.da,O.AFrameworkApplication.sa.Ra.kj)}}Xg.Npi="X-qs";Xg.s2i="at";Xg.pWj="O365ShellServiceProxy.ashx";Xg.La=null;Xg.sok="ShellWebServiceBase";Object(l.a)(Xg,"O365ShellActor",null,[318]);class wi{constructor(){this.hd=null}get name(){return"Common.App.O365Shell"}Xj(A){this.hd=A;this.hd.register(Xg,"Common.App.O365Shell.O365ShellActor").as("Common.App.O365Shell.IO365ShellActor").Ee().Le(()=>new Xg(new ud.a(()=>O.AFrameworkApplication.tf),O.AFrameworkApplication.da,O.AFrameworkApplication.sa.Ra.kj))}init(){O.AFrameworkApplication.da.qx(Object(B.a)(this,
this.iE,"onFullAppSettingsReady"))}iE(){O.AFrameworkApplication.useO365ShellService&&O.AFrameworkApplication.sa.Ra.kw&&this.hd.resolve("Common.App.O365Shell.O365ShellActor").OFj()}dispose(){}static main(){va.a.instance.Tk(new wi)}}Object(l.a)(wi,"PackageManager",null,[2,3]);var uh=a(488),Ai=a(532),gj=a(183),xi=a(190),nj=a(75);class jj extends Lf.a{constructor(A,ca,Ra,Zb){super(A);this.npg=[6];this.kpg=[26];this.Ys=null;this.GIb=this.Esc=!1;this.Zu=this.jfa=null;this.onPointerDown=wc=>{if(1!==this.$.Ha.wK())return!0;
wc=za.a(this.$).yg(wc);if(this.aE)return!0;var Jc=ai.a(this.$).XAd||ai.a(this.$).Br();if(this.UCd||Jc)return this.yib(),!0;this.Zu=this.Bp;this.XUd();this.dwd();Jc=2===wc.Gd&&wc.yq===Sys.UI.MouseButton.leftButton;const fd=3===wc.Gd;if(Jc||fd)wc=this.ha.As(wc.clientPoint,wc.$d,5,void 0,void 0,!0),wc||(wc=this.Zu),this.GIb=Jc,this.Esc=fd,this.Zu=this.Xif(wc),this.dwd(),Jc?this.sxj():fd&&this.kyj(),cg.b(this.$,!0);return!0};this.gl=wc=>{wc=za.a(this.$).yg(wc);if(!this.aE)return!1;let Jc=this.GIb?this.ha.As(wc.clientPoint,
wc.$d,5,void 0,void 0,!0):this.ha.As(wc.clientPoint,wc.$d,5,!0,!1,!0);Jc||(Jc=this.ha.qvb(wc.clientPoint,wc.$d,5));Jc&&(wc=this.Xif(this.Rub(Jc)),this.t$b(wc.bottomRight),this.Zu.equals(wc)||(this.Zu=wc,this.lRb(!1),this.XUd(!1),this.dwd(!1),this.gsi(),this.Kd.update(!1)),this.qhk(this.Zu));return!0};this.Yi=wc=>{za.a(this.$).yg(wc);if(!this.aE)return!1;this.resizeTable();this.yib();return!0};this.EOb=wc=>{za.a(this.$).yg(wc);if(!this.aE)return n.ULS.shipAssertTag(537151233,0,!0,"TableResizeBehavior.OnTouchUp - OnTouchUp Called without Operation in Progress"),
!1;this.resizeTable();this.yib();return!0};this.Sga=wc=>{za.a(this.$).yg(wc);this.yib();return!0};this.ZLf=()=>{this.aE&&this.yib()};this.gridView=ca;this.$=ca.$;this.tableManager=Zb;this.ha=ca.ha;this.Kd=ca.Kd;this.parentElement=A;this.Hah();Y.a.ls||Y.a.e3||id.a.instance.ta(yc.a.pointerDown,this.jfa,this.onPointerDown);this.Bp=Ra;this.BWc=this.UCd=!1;this.tableManager.yYg(this.ZLf)}get aE(){return this.GIb||this.Esc}get Nxf(){return this.BWc}dispose(){this.yib();this.tableManager.zAj(this.ZLf);this.Nxf||
Y.a.ls||Y.a.e3||id.a.instance.Aa(yc.a.pointerDown,this.jfa,this.onPointerDown);if(this.aE){cg.b(this.$,!1);try{this.vy()}catch(A){n.ULS.sendTraceTag(537151236,0,10,`TableResizeBehavior.Dispose: Unregistering of Handlers failed with Exception ${A}`)}}this.parentElement&&this.parentElement.contains(this.jfa)&&this.parentElement.removeChild(this.jfa);this.jfa=this.parentElement=null;super.dispose()}Xif(A){const ca=A.bottom-this.Bp.topLeft.bottom-1;return 0<=A.right-this.Bp.topLeft.right+1&&0<=ca&&A.bottom>=
this.Bp.top&&A.right>=this.Bp.left?new Kb.Range(this.Bp.top,this.Bp.left,A.bottom,A.right,!1,!1):this.Zu}dwd(A){this.EGc([this.Zu],6,void 0===A?!0:A);this.Kd.Jt(this.npg)}lRb(A){A=void 0===A?!0:A;this.Kd.cm(this.npg);this.EGc([null],6,A)}XUd(A){A=void 0===A?!0:A;this.Kd.cm(this.kpg);this.EGc([null],26,A)}gsi(){var A=!1;A=void 0===A?!0:A;const ca=this.k8j();0<ca.length&&(this.EGc(ca,26,A),this.Kd.Jt(this.kpg))}k8j(){const A=[];this.Bp.contains(this.Zu)&&(this.Bp.right!==this.Zu.right&&A.push(new Kb.Range(this.Bp.top,
this.Zu.right+1,this.Zu.bottom,this.Bp.right,!1,!1)),this.Bp.bottom!==this.Zu.bottom&&A.push(new Kb.Range(this.Zu.bottom+1,this.Bp.left,this.Bp.bottom,this.Bp.right,!1,!1)));return A}resizeTable(){if(!this.Zu.equals(this.Bp)){const A=new Kb.Range(this.Bp.top,this.Bp.left,this.Zu.bottom,this.Zu.right,!1,!1);this.xck(A);this.UCd=!0}}onKeyDown(A){za.a(this.$).yg(A);return!0}NMd(){this.Nxf&&(Y.a.ls||Y.a.e3||(id.a.instance.ta(yc.a.pointerDown,this.jfa,this.onPointerDown),this.jfa.classList.remove("ewr-table-resize-default-cursor"),
this.BWc=this.jfa.disabled=!1),this.BWc=!1)}Hah(){const A=document.createElement("div");A.className="ewr-table-resize-handle";const ca=document.createElement("div");ca.className="ewr-table-resize-fillhandle-higher";const Ra=document.createElement("div");Ra.className="ewr-table-resize-fillhandle-broader";A.appendChild(ca);A.appendChild(Ra);this.jfa=A;this.parentElement.appendChild(this.jfa)}t$b(A){let ca=60;const Ra=this.Zu.contains(A);let Zb=A.top,wc=A.bottom,Jc=A.left,fd=A.right,$d=null;if(Ra){if(this.gridView.dG(this.Bp.topLeft)&&
!this.Bp.JFa)return;A.bottom<this.Zu.bottom?(Zb=Math.max(1,wc-2,this.Bp.top),ca=16):(Jc=Math.max(1,fd-2,this.Bp.left),ca=4);wc=Zb;fd=Jc;$d=new Kb.Range(Zb,Jc,Zb,Jc,!1,!1)}else A.right>=this.Bp.right?(fd+=2,ca=8):A.bottom>=this.Bp.bottom&&(wc+=2,ca=32),Zb=wc,Jc=fd,$d=new Kb.Range(wc,fd,wc,fd,!1,!1),ca=16;this.gridView.dG($d)||(this.Ys?this.Ys.Po||(this.Ys=Yb.a.instance.create(()=>{this.gridView.az($d,ca,"TableResizeBehavior.BringRangeIntoView")},40,Ca.a.lpg)):this.Ys=Yb.a.instance.create(()=>{this.gridView.az($d,
ca,"TableResizeBehavior.BringRangeIntoView")},40,Ca.a.lpg))}Rub(A){let ca=A;if(this.gridView.jd.gQ){if(!this.gridView.Hd(A.topLeft)){const Ra=this.gridView.Kk("TableResizeBehavior.AdjustHiddenRowColumns",this.gridView.UT,this.Zu.top!==A.top?1:2);try{Ra.Km=this.Zu.top<A.top||this.Zu.left<A.left,Ra.iy(A.topLeft),ca=Ra.$$cu().range}finally{Ra&&Ra.dispose()}}ca.right=ca.left+A.width-1;ca.bottom=ca.top+A.height-1}return ca}EGc(A,ca,Ra){Ra=void 0===Ra?!0:Ra;const Zb=[];for(const wc of A)Zb.push(new gd.a(wc,
pd.d(this.$.na)));this.Kd.QC(Zb,[ca],!0,void 0,Ra)}sxj(){id.a.instance.ta(yc.a.Fn,document.documentElement,this.gl);for(const A of this.gridView.Xp)id.a.instance.ta(yc.a.Fn,A.domElement,this.gl);id.a.instance.ta(yc.a.Gi,document.documentElement,this.Yi);this.FXe()}kyj(){Vd.a.instance.ta(yc.a.Ki,document.documentElement,this.gl);for(const A of this.gridView.Xp)Vd.a.instance.ta(yc.a.Ki,A.domElement,this.gl);Vd.a.instance.ta(yc.a.sg,document.documentElement,this.EOb);this.FXe()}vy(){this.GIb&&this.Cfk();
this.Esc&&this.Ofk()}Cfk(){id.a.instance.Aa(yc.a.Fn,document.documentElement,this.gl);for(const A of this.gridView.Xp)id.a.instance.Aa(yc.a.Fn,A.domElement,this.gl);id.a.instance.Aa(yc.a.Gi,document.documentElement,this.Yi);this.N3f()}Ofk(){Vd.a.instance.Aa(yc.a.Ki,document.documentElement,this.gl);for(const A of this.gridView.Xp)Vd.a.instance.Aa(yc.a.Ki,A.domElement,this.gl);Vd.a.instance.Aa(yc.a.sg,document.documentElement,this.EOb);this.N3f()}FXe(){this.gridView.cellTextEditBox.ngc(!0)}N3f(){this.gridView.cellTextEditBox.ngc(!1)}xck(A){this.$.Me(-1400250766,
$a.a.Bd,30,{["ResizeTableRange"]:A,["OriginalTableRange"]:this.Bp})}qhk(A){if(!this.Bp.contains(A)){A=this.j8j();for(const ca of A)if(this.tableManager.vDd(ca)){this.gridView.gj.Hr(Hc.a.G0i);return}}this.gridView.rtl?this.gridView.gj.Hr(Hc.a.M_i):this.gridView.gj.Hr(Hc.a.f2i)}yib(){if(this.aE){cg.b(this.$,!1);try{this.vy()}catch(A){n.ULS.sendTraceTag(537151232,0,10,`TableResizeBehavior.Dispose: Unregistering of Handlers failed with Exception ${A}`)}}this.Ys&&(this.Ys.cancel(),this.Ys.dispose());this.Esc=
this.GIb=!1;this.lRb();this.XUd();cg.b(this.$,!1);this.gridView.gj.Hr(Hc.a.BY)}j8j(){const A=[];this.Bp.right!==this.Zu.right&&A.push(new Kb.Range(this.Bp.top,this.Bp.right+1,this.Zu.bottom,this.Zu.right,!1,!1));this.Bp.bottom!==this.Zu.bottom&&A.push(new Kb.Range(this.Bp.bottom+1,this.Bp.left,this.Zu.bottom,this.Bp.right,!1,!1));return A}static createInstance(A,ca,Ra,Zb){if(!ca)return null;const wc=A.Kd;wc.QC(Ra,[27],!0);wc.Jt(jj.d8j);Ra=wc.RF(27,A.jd.$j(ca.bottomRight),jj.M6h(ca,Ra)).Qg;return new jj(Ra,
A,ca,Zb)}static M6h(A,ca){var Ra;for(let Zb=0;Zb<ca.length;Zb++)if((null===(Ra=ca[Zb])||void 0===Ra?0:Ra.range)&&ca[Zb].range.equals(A))return Zb;return 0}}jj.d8j=[27];Object(l.a)(jj,"TableResizeBehavior",Lf.a,[]);class Yi{}Yi.uNh="ewa-ttrd-buttonarea";Object(l.a)(Yi,"CssClassNames",null,[]);var uj=a(142),oj=a(143),Bh=a(280);class rh extends nc.a{constructor(A){super(document.createElement("div"));this.P3c=this.aAd=this.mXf=this.hU=!1;this.g_d=null;this.Eg=()=>{rf.c(this.$,this.gridView.ha.ra.activeCell)?
(this.wRa=!0,this.uyb(!1)):(this.Z2=this.wRa=!1,this.tug())};this.fv=()=>{this.wRa?this.uyb(!0):this.Z2=!1};this.jDa=()=>{this.P3c=!0;this.wRa&&(this.Z2=!1)};this.onContentReady=()=>{this.$.isEditMode?rf.c(this.$,this.gridView.ha.ra.activeCell)&&(this.wRa=!0,this.uyb(!1)):this.Z2=!1};this.C$=()=>{this.P3c=!1;this.wRa?this.uyb(!1):this.Z2=!1};this.Ng=(ca,Ra)=>{this.wRa&&(ca=this.gridView.lgb(Ra.af.block.dg.BlockCachePosition.PaneType).JE(Ra.af.hash))&&(ca.pWd(this.Fmf),ca.$5c(this.Fmf))};this.Fmf=
()=>{this.U7f()};this.$=A;this.gridView=U.h(this.$);this.parentElement=this.domElement;this.parentElement.className=Yi.uNh;this.AQa=this.gridView.un;this.zmd=Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:7603637_LocalizeSubtotalOfTotalRow");this.wRa=!0;this.Gwi();this.zmd&&this.uui();this.U5g();this.uyb(!1);n.ULS.sendTraceTag(537151201,0,50,"TableTotalRowOptions - React Component Created ")}get Z2(){return this.aAd}set Z2(A){this.aAd!==A&&(this.aAd=this.isVisible=A)}get EJb(){return!!(this.$.If&16)}get pGi(){const A=
this.gridView.ha.ra.activeCell;return A.right===A.maxColumns}get Htb(){const A=this.gridView.Hd(null);return A&&this.gridView.Tfa(A.range)?this.jAa(A):(A&&n.ULS.sendTraceTag(537151200,0,50,"TableTotalRowOptions.ActiveCellOffsetBounds - Active Cell not in viewport area"),null)}dispose(){this.$&&this.Oyh();this.$=this.gridView=this.parentElement=this.AQa=null;super.dispose()}F4h(A){const ca=this.nji(this.gridView.Hd(null).range);return ca?this.zmd?`=${this.rif()}(${A}${this.$.listSeparator}${ca})`:
`=SUBTOTAL(${A},${ca})`:null}rif(){var A,ca,Ra;return null!==(Ra=null===(ca=null===(A=this.calcManager)||void 0===A?void 0:A.localeInfo)||void 0===ca?void 0:ca.getWorksheetFuncName(344))&&void 0!==Ra?Ra:"SUBTOTAL"}nji(A){var ca=U.h(this.$).zd.sh(A);if(!ca)return null;ca=xi.a(ca,!1);ca.right=ca.left=A.left;return ca.toString()}Gwi(){rh.CM={};rh.CM["100"]=Ub.a.instance.ia(1105);rh.CM["101"]=Ub.a.instance.ia(1108);rh.CM["102"]=Ub.a.instance.ia(1107);rh.CM["103"]=Ub.a.instance.ia(1112);rh.CM["104"]=Ub.a.instance.ia(1109);
rh.CM["105"]=Ub.a.instance.ia(1110);rh.CM["109"]=Ub.a.instance.ia(1106);rh.CM["107"]=Ub.a.instance.ia(1113);rh.CM["110"]=Ub.a.instance.ia(1115);rh.CM["111"]=Ub.a.instance.ia(1166)}uui(){(Sb.EwaSettings.ZD()?A=>ab.a.resolve(Wb.n).then(ca=>setTimeout(()=>A(ca),0)):A=>this.$.ga.qd(266,A))(A=>{this.calcManager=A})}kjj(){var A=this.gridView.Hd(null);if(A&&(A=A.dz?A.formulaBarText:null))if(this.zmd){const ca="="+this.rif()+"(",Ra=ca.length;if(A.toUpperCase().startsWith(ca)){if(A=A.substring(Ra,Ra+3),A in
rh.CM)return A}else return"111"}else if("=SUBTOTAL("===A.substring(0,10)){if(A=A.substring(10,13),A in rh.CM)return A}else return"111";return"100"}U5g(){this.gridView.ya.Eu(this.Ng);this.gridView.ha.add_activeCellChanged(this.Eg);this.gridView.Fu(this.onContentReady);this.gridView.cellTextEditBox.Gp(this.jDa);this.gridView.cellTextEditBox.Mq(this.C$)}Oyh(){this.gridView&&(this.gridView.ha&&(this.gridView.ha.remove_activeCellChanged(this.Eg),this.gridView.ya.Ft(this.Ng)),this.gridView.Ax(this.onContentReady),
this.gridView.cellTextEditBox&&(this.gridView.cellTextEditBox.zp(this.jDa),this.gridView.cellTextEditBox.$p(this.C$)),this.tug())}uyb(A){this.Bhk(A);this.EJb&&(this.I6j(),this.Htb?(this.mXf||this.e6g(),this.P3c?this.Z2=!1:(this.Z2=!0,this.U7f())):(n.ULS.sendTraceTag(537151199,0,15,"TableTotalRowOptions.CreateAndShowDropdownInUpdatedPosition : Offset bounds could not be determined"),this.Z2=!1))}U7f(){appChrome.renderTableTotalRowOptions(this.parentElement,rh.CM,rh.CM[this.kjj()].toString(),Math.round(za.a(this.$).Mj(17)),
A=>{n.ULS.sendTraceTag(537151198,0,50,`TableTotalRowOptions.RenderReactTotalRowDropdown - Selected Option : ${A}`);let ca={["SelectedOption"]:rh.CM[A],["FunctionKeyCode"]:A,["Location"]:"canvas"};oj.b(this.$).nf(uj.a.o8j,ca,null,!0);if("111"===A)return this.aAi(),!0;if("100"!==A){this.g_d=this.F4h(A);if(!this.g_d)return n.ULS.sendTraceTag(537151197,0,50,"TableTotalRowOptions.RenderReactTotalRowDropdown - Selected Option was null"),!0;this.GXa(this.g_d)}else this.GXa("");Te.DOMElementExtensions.setFocus(this.gridView.he.textBox.domElement);
return!0})}aAi(){n.ULS.sendTraceTag(537151196,0,50,"TableTotalRowOptions.InvokeMoreFunctionsDialog - More Functions dialog invoked");const A=new jf.a(753860909,0,this.$.isEditMode?2:1,19,null);this.$.Ha.Ad(A)}jAa(A){if(!A)return null;var ca=this.gridView.cellTextEditBox.textBox.domElement;var Ra=0<Te.DOMElementExtensions.getHeight(ca)&&0<Te.DOMElementExtensions.getWidth(ca)&&0<=ca.offsetTop&&0<=ca.offsetLeft;if(Ra)ca=Te.DOMElementExtensions.jAa(ca,this.gridView.un);else{ca=this.gridView.getCellBounds(A.cell);
var Zb=Te.DOMElementExtensions.getBoundingClientRect(this.gridView.un);ca=new Sys.UI.Bounds(ca.x-Zb.x,ca.y-Zb.y,ca.width,ca.height)}if(ca)if(Ra)2<ca.height&&2<ca.height&&(ca.x+=1,ca.y+=1,ca.height-=2,ca.width-=2);else if(Ra=U.h(this.$).nN(A.cell))Ra=Ra.width,Zb=Rd.a.equals(If.a.iDb(A.cell,this.gridView.rtl),"right",!0),this.gridView.rtl&&Zb&&(ca.x=ca.x+ca.width-Ra),A.Dpa&&this.gridView.rtl===Zb&&(ca.width=Ra);else return null;return ca}Bhk(A){var ca=this.Htb;if(ca){var Ra=17>=ca.height?ca.y:ca.y+
ca.height-17-2;ca=this.pGi?this.gridView.rtl?ca.x:ca.x+ca.width-(17<ca.height?17:ca.height):this.gridView.rtl?ca.x-(17<ca.height?17:ca.height):ca.x+ca.width;var Zb=za.a(this.$).eoa(new Sys.UI.Point(ca,Ra));this.parentElement.style.top=dd.HelperMethods.Qe(Zb.y);this.parentElement.style.left=dd.HelperMethods.Qe(Zb.x);za.a(this.$).pSj(this.parentElement);A&&(this.Z2=this.gridView.Qsc(new W.a(ca,Ra)))}else this.Z2=!1}e6g(){this.AQa.insertBefore(this.parentElement,this.AQa.firstChild);this.mXf=!0}I6j(){this.hU||
(this.gridView.view.Rt(this.fv),this.hU=!0)}tug(){this.hU&&this.gridView.view&&(this.gridView.view.Cs(this.fv),this.hU=!1)}GXa(A){const ca=this.gridView.he,Ra=this.gridView.Hd(null);Ra&&(A=Object(jb.a)(new Bh.a,{Text:A}),this.gridView.setCell(A,Ra.range,0,127,null),ca.endEdit(!0,"TableTotalRowOptions.SetCellContent",0))}}rh.n8j="TableTotalRowDropDownIconButtonId";rh.CM=null;Object(l.a)(rh,"TableTotalRowOptions",nc.a,[5]);let Ji=class extends uh.a{constructor(A){super(U.h(A));this.Mwb=this.V4=this.dKc=
this.Kwb=null;this.MEe=!1;this.Mne=null;this.Y_b=0;this.Vdc=null;this.O9b=()=>{const ca={},Ra=this.gsd();for(let wc in Ra){const Jc=Ra[wc];if(!Jc)continue;const fd=this.pii(Jc);if(fd){if(fd in this.HKa){var Zb=this.HKa[fd];if(Zb.aE){Zb.Bp.equals(Jc)||(Zb.Bp=Jc);delete this.HKa[fd];ca[fd]=Zb;continue}}(Zb=jj.createInstance(U.h(this.$),Jc,this.K1h(),this))?ca[fd]=Zb:n.ULS.sendTraceTag(537151239,0,15,`TableManager.AttachTableResizeBehavior - Attaching Grippie Failed for Range ${Jc.EA(!1)}`)}}this.$ac(null,
null);this.FZb=ca};this.$ac=()=>{const ca=this.HKa;for(let wc in ca){var Ra=wc,Zb=ca[wc];Zb&&(Zb.dispose(),delete this.HKa[Ra])}this.FZb={}};this.h2f=()=>{this.$ac(null,null);this.O9b(null,null)};this.onFocus=()=>{this.Mne=U.h(this.$).ha.ra.activeCell};this.z$=()=>{this.$.isEditMode&&this.Eg(null,null)};this.Eg=()=>{!this.MEe&&rf.c(this.$,this.gridView.ha.ra.activeCell)&&this.EQi()};this.oG=()=>{this.EGb(1);this.$.ea.xo(this.oG)};this.FPb=()=>{this.MEe=!0;this.dKc=new rh(this.$)};this.$=A;this.gridView=
U.h(this.$);Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:8111699_MigrateTableManager")||this.$.ga.Qa(66,this);this.FZb={};this.O9b(null,null);this.$.va&&this.$.va.Ri(this.h2f);this.N5c(this.O9b);this.$.ea.N0(this.z$);this.gridView.ha.add_activeCellChanged(this.Eg);this.$.isEditMode&&this.Eg(null,null)}N5c(A){this.addHandler(uh.a.shb,A)}eWd(A){this.removeHandler(uh.a.shb,A)}yYg(A){this.addHandler("tce",A)}zAj(A){this.removeHandler("tce",A)}get HKa(){return this.FZb}get KEd(){return this.Mne}get FNa(){return this.Y_b}get Lu(){const A=
U.h(this.$);return A.zd.sh(A.ha.ra.activeCell,!1)}get NRd(){return this.KEd?U.h(this.$).zd.sh(this.KEd,!1):null}vDd(A){return!!this.Vff(A)}fu(A){return this.Hei(this.Dgf(A))}QCb(A){return this.Dgf(A)}hyj(A){A?(this.Mwb?this.Mwb!==A&&(ub.a.Ma(this.V4),this.V4=null,this.Mwb=A):this.Mwb=A,this.V4||(this.V4=qe.a.instance.kg(this.Mwb)),this.V4.Pk("focusin")||this.V4.la("focusin",this.onFocus)):n.ULS.sendTraceTag(537151245,0,15,"TableManager.RegisterToTextboxFocusEvent empty textBoxDomElement recieved")}huf(A,
ca){return A?A.Aoa&&A.top===ca.top:(n.ULS.shipAssertTag(537151244,0,!!A,"autofilterRange can't be null"),!1)}coa(A){A=this.Kwb?ec.J(A,this.Kwb):this.view.getRangeInformation(A);return 0<A.length&&Object(ih.a)(ki.PivotTableRange,A[0])?A[0]:null}CCi(A,ca){return A?!A.aqc&&!!A.lA&&A.lA.hf(ca):(n.ULS.shipAssertTag(537151243,0,!!A,"Pivot table can't be null"),!1)}rJi(A,ca){return A?!A.aqc&&!!A.KC&&A.KC.hf(ca):(n.ULS.shipAssertTag(537151242,0,!!A,"Pivot table can't be null"),!1)}x7b(A){super.x7b(A);if((A=
dd.HelperMethods.fgf(A))&&0<A.length){this.Kwb=Array(A.length);for(let ca=0;ca<A.length;ca++)this.Kwb[ca]=gj.a.TT(A[ca])}}fRb(){super.fRb();this.Kwb=null}Nnh(A,ca){let Ra;Ra=!1;if(!A||!ca)return{returnValue:!1,a1:Ra};A=A.clone();A.right+=1;A.left=A.right;if(!A.cE)return{returnValue:!1,a1:Ra};if(A.top<ca.jd.Ok){const Zb=A.clone();Zb.bottom>=ca.jd.Ok&&(Zb.bottom=ca.jd.Ok-1);if(!(()=>{let wc=this.NRe(Zb,ca);({a1:Ra}=wc);return wc})().returnValue)return{returnValue:!1,a1:Ra}}if(A.bottom>=ca.jd.Ok){const Zb=
A.clone();Zb.top<=ca.jd.Ok&&(Zb.top=ca.jd.Ok);if(!(()=>{let wc=this.NRe(Zb,ca);({a1:Ra}=wc);return wc})().returnValue)return{returnValue:!1,a1:Ra}}return{returnValue:!0,a1:Ra}}mpg(A){(A=this.fu(A.topLeft))&&A.toString()in this.HKa&&(this.HKa[A.toString()].UCd=!1)}wrj(){this.raiseEvent("tce")}Ml(A,ca){if(!this.dKc)return!1;switch(ca){case -569786022:case 541421805:if(this.dKc.Z2){const Ra=document.getElementById(rh.n8j);Ra&&Yb.a.instance.create(()=>{Te.DOMElementExtensions.Zoc(Ra,null)},0,Ca.a.g8j,
!0,!0)}return!0;default:return!1}}dispose(){this.$ac(null,null);this.eWd(this.O9b);this.$.va.uj(this.h2f);this.$.Hn(this.$ac);this.FZb=null;this.$.ea&&this.$.ea.k4(this.z$);this.gridView.ha.remove_activeCellChanged(this.Eg);this.dKc=null;this.V4&&(ub.a.Ma(this.V4),this.V4=null);super.dispose()}vpi(A,ca,Ra,Zb){var wc=this.gridView.zd.sh(new Kb.Range(ca,Ra,ca,Ra,!1,!1));if(this.Vdc=wc){var Jc=wc.usedRange,fd=A.ctrlKey||Y.a.isMac&&nj.b(A);wc=!A.shiftKey&&fd;A=A.shiftKey&&!fd;U.h(this.$).ha.selectionType=
3;switch(Zb){case 0:this.Y_b=0;ca=this.gfd(A,Jc.top,Ra,Jc.bottom,Ra);this.w1d(ca,wc,A);break;case 1:this.Y_b=1;ca=this.gfd(A,ca,Jc.left,ca,Jc.right);this.w1d(ca,wc,A);break;case 2:this.Y_b=2;ca=this.gfd(A,Jc.top,Jc.left,Jc.bottom,Jc.right);this.w1d(ca,wc,A);break;default:n.ULS.shipAssertTag(537151240,0,!1,`TableManager.HandleTableSelectorsSelection: Table Selector can not be of type: ${Zb.toString()}`);return}U.h(this.$).ha.selectionType=3;n.ULS.sendTraceTag(527212953,0,50,"TableManager.handleTableSelectorsSelection: A table selector was clicked using hover arrows")}else n.ULS.shipAssertTag(537151241,
0,!1,"TableManager.HandleTableSelectorsSelection: Table for table selector selection can't be null")}YWj(A){const ca=this.Vdc.usedRange;return this.hwf(A)||1!==this.FNa&&this.hwf(new Kb.Range(ca.top,A.left,ca.bottom,A.right,!1,!1))?!0:!1}dTd(A){return A.Autofilters}NRe(A,ca){let Ra;Ra=!1;const Zb=ca.jd.$j(A),wc=ca.Xh(Zb).Ol;if(!wc)return n.ULS.sendTraceTag(537151238,0,15,`TableManager.CouldExpandImpl - loadedRange is null. PaneType=${Zb}`),{returnValue:!1,a1:Ra};if(!wc.wg(A))return{returnValue:!0,
a1:Ra};A=ca.Kk("TableManager.CouldExpandImpl",A,2);try{for(;A.$$mn();){if(A.$$cu().text||A.jo.qFb)return Ra=!0,{returnValue:!1,a1:Ra};if(A.$$cu().UK)return{returnValue:!1,a1:Ra}}}finally{A&&A.dispose()}return{returnValue:!0,a1:Ra}}Hei(A){if(!A)return null;const ca=new Ai.AutofilterRange(A.top,A.left,A.bottom,A.right,null,null,null,A.id,A.Aoa);ca.JFa=A.JFa;const Ra=this.gridView.zd.sh(A,!0);if(!Ra)return null;for(let Zb=0,wc=this.rangeList.length;Zb<wc;Zb++){const Jc=this.rangeList[Zb],fd=this.gridView.zd.sh(Jc,
!0);fd&&fd.name===Ra.name&&Jc!==A&&this.tIi(Jc)&&(ca.union(Jc),Jc.JFa&&(ca.JFa=!0))}return ca}tIi(A){return!!U.h(this.$).zd.sh(A)}K1h(){const A=[];for(const ca of this.rangeList){const Ra=new gd.a(this.fu(ca.topLeft),pd.d(this.$.na));A.push(Ra)}return A}gsd(){const A={};for(const ca of this.rangeList){if(!ca)continue;const Ra=this.fu(ca.topLeft);Ra&&(A[Ra.toString()]=this.fu(ca.topLeft))}return A}EQi(){this.$.ea.nh?this.EGb(0):this.$.ea.Fl(this.oG)}EGb(A){this.$.DK(ca=>{ca.B8(A).then(this.FPb)})}pii(A){const ca=
this.gridView.zd.sh(A);return ca?ca.name:A.toString()}w1d(A,ca,Ra){A&&(Ra=Ra?U.h(this.$).ha.ra.activeCell:A.topLeft,ca?this.gridView.ha.updateSelection(A,Ra,0,1):this.gridView.ha.WI([A],0,Ra,0))}gfd(A,ca,Ra,Zb,wc){const Jc=xi.d(this.Vdc),fd=xi.g(this.Vdc),$d=ca+(1!==this.FNa&&Jc?1:0),Be=Zb-(1!==this.FNa&&fd?1:0),Re=this.gridView.inRangePicker||this.gridView.fl;if(A){var lf=Re&&!gd.a.ndc(this.gridView.ha.rangePicker.dO).length?new Kb.Range($d,Ra,Be,wc,!1,!1):Re?this.gridView.ha.rangePicker.activeCell:
this.gridView.ha.ra.activeCell;lf=new Kb.Range(lf.top<$d?lf.top:$d,lf.left<Ra?lf.left:Ra,lf.bottom>Be?lf.bottom:Be,lf.right>wc?lf.right:wc,!1,!1)}else lf=new Kb.Range($d,Ra,Be,wc,!1,!1);if(1!==this.FNa&&(Jc||fd)&&(!A||A&&this.pcd(lf,$d,Ra,Be,wc))){A=Re?gd.a.ndc(this.gridView.ha.rangePicker.dO):this.gridView.ha.ra.selectedRanges;for(const xf of A)if(this.pcd(xf,$d,Ra,Be,wc)){lf.top=ca;lf.bottom=Zb;break}}return lf}hwf(A){const ca=this.gridView.inRangePicker||this.gridView.fl?gd.a.ndc(this.gridView.ha.rangePicker.dO):
this.gridView.ha.ra.selectedRanges;for(const Ra of ca)if(this.pcd(Ra,A.top,A.left,A.bottom,A.right))return!0;return!1}pcd(A,ca,Ra,Zb,wc){return!!A&&A.top===ca&&A.bottom===Zb&&A.left===Ra&&A.right===wc}};Ji=Object(vb.a)([Object(ab.d)(Wb.Vc),Object(vb.b)(0,Object(Wb.W)())],Ji);Object(l.a)(Ji,"TableManager",uh.a,[221,5]);class Ki extends Ob.a{constructor(A){super();this.tableManager=null;this.$=A;this.je()}create(){this.Ld(this.tableManager||(this.tableManager=new Ji(this.$)))}}Object(l.a)(Ki,"TableManagerFactory",
Ob.a,[]);var Ig=a(260),Ti=a(666),ii=a(275),di=a(180),ng=a(86),Zi=a(584);class Rh extends Lf.a{constructor(A,ca){super(A);this.rW=[];this.Ine=null;this.xSb=Ra=>{let Zb="forward";Ra.Values[Mf.a.direction]?Zb=Ra.Values[Mf.a.direction].toLowerCase():n.ULS.sendTraceTag(537166664,0,15,"Didn't find direction in message values");Ra=0;let wc=!0;"backward"===Zb?(Ra=this.FEd.length-1,wc=!1):"forward"===Zb?(Ra=0,wc=!0):n.ULS.sendTraceTag(537166663,0,15,`Received unknown direction to resume focus: ${Zb}`);this.LHf(wc,
Ra,!1)};this.tQf=()=>{this.rW=[]};this.uUa=Ra=>{-411645385===this.$.shortcutKeyManager.eu(Ra,!0)&&this.Ouf()&&(this.$.Ha.Ad(new jf.a(-411645385,1,this.$.se,6,null),{["event"]:Ra},Ra),Ra.stopPropagation())};this.oaj=Ra=>{this.Lqa(Ra)};this.vd=ca;this.Dv=U.h(this.vd);this.Xe.la("keydown",this.oaj);this.Xe.la("keyup",this.uUa);ii.a(ca).t0g(this.tQf);ng.a(ca.xa,27)&&Jd.TaskExtensions.za($c.GetServiceTaskFactory.ud(ca.ga,21,137,1),Ra=>{Ra=Ra.result;Ra.Rn(sa.a.Jnf);Ra.fm(sa.a.Jnf,this.xSb)},ca.ka)}get $(){return this.vd}get FEd(){this.rW.length||
(this.rW=this.tef());return this.rW}get Lpa(){return this.Ine}set Lpa(A){this.Ine=A;this.rW=this.tef()}dispose(){this.$&&ii.a(this.$).SCj(this.tQf);this.vd=null;this.rW.length=0;super.dispose()}kpj(A){this.Lqa(A)}LHf(A,ca,Ra,Zb){Zb=void 0===Zb?null:Zb;var wc=this.B7j(A,ca,void 0===Ra?!0:Ra,Zb);if(!wc){Ra=ca;var Jc=A?1:-1,fd=this.FEd;do{wc=!1;if(ng.a(this.$.xa,27)){if(Ra+=Jc,Ra>=fd.length||0>Ra)wc=!0}else Ra=(Ra+Jc+fd.length)%fd.length;if(wc){this.OUi(A,ca,Zb);break}else if(wc=this.Yog(A,ca,Ra,!1,
Zb))break}while(Ra!==ca)}}B7j(A,ca,Ra,Zb){Zb=void 0===Zb?null:Zb;let wc=null;0<=ca&&(wc=this.rW[ca]);return(null===wc||void 0===wc?0:wc.zi)&&wc.Pi(A,void 0===Ra?!0:Ra)?(Zb&&nj.g(Zb),n.ULS.sendTraceTag(537166669,0,50,`Switched focus inside current section ${wc.jg} into a sub region`),wc.Ll(),!0):!1}Yog(A,ca,Ra,Zb,wc){wc=void 0===wc?null:wc;Ra=this.rW[Ra];if(Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ObjectLayerFixes",!1)){const Jc=ii.a(this.vd).$y(Ig.a.xza),fd=ii.a(this.vd).$y(Ig.a.SEb),
$d=this.Dv.ha.Va.rU;if(Ra===fd&&$d||Ra===Jc&&!Zb&&!$d)return!1}if((null===Ra||void 0===Ra?0:Ra.zi)&&Ra.Pi(A,!1)){wc&&nj.g(wc);Ra.Ll();if(A=this.rW[ca])A.lm(),n.ULS.sendTraceTag(537166668,0,50,`Switched focus from section ${A.jg} to ${Ra.jg}`);return!0}return!1}OUi(A,ca,Ra){(Ra=void 0===Ra?null:Ra)&&nj.g(Ra);if(ca=this.rW[ca])ca.lm(),n.ULS.sendTraceTag(537166666,0,50,`Lost focus from section ${ca.jg}`);Jd.TaskExtensions.za($c.GetServiceTaskFactory.ud(this.$.ga,21,137,0),Zb=>{Zb.result.sendMessage(sa.a.wtb,
{[Mf.a.direction]:A?"forward":"backward"})},this.$.ka)}Lqa(A){var ca=this.$.isEditMode?di.a(this.$):null;if(!this.$.yd.DBa||Rh.SFi(ca))if(117===A.keyCode&&(A.ctrlKey||nj.b(A))){ca=this.shf(A.target);var Ra=!A.shiftKey;n.ULS.sendTraceTag(537166662,0,50,`AccessibilityManager.OnKeyDownHandler: Ctrl+F6 loop. The root index section is: ${ca}`);if(Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ObjectLayerFixes",!1)){var Zb=ii.a(this.vd).$y(Ig.a.DSb);Zb=this.rW.indexOf(Zb);O.AFrameworkApplication.sa.Ra.iz&&
this.$.AU&&-1!==Zb&&ca===Zb&&Ti.ShyRibbon.HM(this.$.qkb,0)}else O.AFrameworkApplication.sa.Ra.iz&&this.$.AU&&1===ca&&Ti.ShyRibbon.HM(this.$.qkb,0);this.LHf(Ra,ca,!0,A)}else if(117!==A.keyCode||Rh.q6e)if(-411645385===this.$.shortcutKeyManager.eu(A))this.Ouf()&&(this.$.Ha.Ad(new jf.a(-411645385,1,this.$.se,6,null),{["event"]:A},A),A.stopPropagation());else if(1588554917===this.$.shortcutKeyManager.eu(A))0===this.mode?(Zi.a(this.$)||this.$.Ha.Ad(new jf.a(1588554917,1,this.$.se,6,null),{["event"]:A},
A),A.preventDefault(),A.stopPropagation()):3===this.mode&&(A.preventDefault(),A.stopPropagation());else if(-1966746939===this.$.shortcutKeyManager.eu(A))A.preventDefault(),A.stopPropagation();else if(Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ObjectLayerFixes",!1)&&1058684758===this.$.shortcutKeyManager.eu(A))ca=this.shf(A.target),Zb=ii.a(this.vd).$y(Ig.a.DSb),Ra=ii.a(this.vd).$y(Ig.a.xza),Zb=this.rW.indexOf(Zb),Ra=this.rW.indexOf(Ra),O.AFrameworkApplication.sa.Ra.iz&&this.$.AU&&
-1!==Zb&&ca===Zb&&1===this.$.qkb&&Ti.ShyRibbon.HM(1,0),-1!==Ra&&ca!==Ra&&this.Yog(!0,ca,Ra,!0,A);else this.oni(A);else A=tb.a.GB.notificationBar.u1(Og.a.I7h(),!1),he.a.ZIb()?A.image=3:A.image=0,tb.a.GB.notificationBar.tD(A),Rh.q6e=!0}shf(A){const ca=this.FEd;for(let Ra=0,Zb=ca.length;Ra<Zb;++Ra){const wc=ca[Ra];if(wc&&wc.Nj(A))return Ra}return-1}tef(){const A=[];for(let ca=0,Ra=this.Lpa.length;ca<Ra;ca++){const Zb=ii.a(this.$).$y(this.Lpa[ca]);Zb&&A.push(Zb)}return A}Ouf(){return 0===this.mode||4===
this.mode}static SFi(A){return A?A.inKeytipMode:!1}}Rh.q6e=!1;Object(l.a)(Rh,"AccessibilityManager",Lf.a,[294,5]);var Lh=a(166);let Xh=class extends Rh{constructor(A){super(document.documentElement,A);this.bF=0;this.s7g=[Ig.a.zRe,Ig.a.ZKd,Ig.a.rnc,Ig.a.p8d,Ig.a.DSb,Ig.a.G9c,Ig.a.und,Ig.a.$jf,Ig.a.R8c,Ig.a.jKc,Ig.a.K2j,Ig.a.SEb,Ig.a.x9e,Ig.a.I$c,Ig.a.xza,Ig.a.y2d,Ig.a.O$c,Ig.a.ung,Ig.a.wBf,Ig.a.i9c];this.vnk=[Ig.a.rnc,Ig.a.qyg,Ig.a.pyg,Ig.a.ryg];this.Noj=[Ig.a.rnc,Ig.a.w_f,Ig.a.x_f,Ig.a.A_f];this.Geh=
[Ig.a.n9e,Ig.a.Zjf,Ig.a.m9e,Ig.a.k9e,Ig.a.yVe];this.ooj=[Ig.a.zRe,Ig.a.ZKd,Ig.a.G9c,Ig.a.und,Ig.a.R8c,Ig.a.jKc,Ig.a.SEb,Ig.a.I$c,Ig.a.xza,Ig.a.y2d,Ig.a.SZf,Ig.a.O$c,Ig.a.i9c];this.Coj=[Ig.a.SEb,Ig.a.u9e];const ca=Ub.a.instance.Ia(253);this.QQj=this.$.shortcutKeyManager.GDb(ca);this.mode=0;Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigrateEwaAccessibilityManager",!1)||A.ga.Qa(15,this);Jd.TaskExtensions.za($c.GetServiceTaskFactory.ud(A.ga,21,137,1),Ra=>{Ra=Ra.result;Ra.Rn(sa.a.wtb);
Ra.fm(sa.a.wtb,this.xSb)},A.ka)}get mode(){return this.bF}set mode(A){this.bF=A;switch(A){case 0:this.Lpa=this.s7g;break;case 2:this.Lpa=this.vnk;break;case 3:this.Lpa=this.Noj;break;case 4:this.Lpa=this.Geh;break;case 5:this.Lpa=this.ooj;break;case 6:this.Lpa=this.Coj;break;default:n.ULS.shipAssertTag(537170759,0,!0,"Accessibility Mode value is not in allowed values")}}Lqa(A){this.$.If&65536&&super.Lqa(A)}oni(A){if(Rd.a.equals(this.QQj,this.$.shortcutKeyManager.Cqd(A),!1)){const ca=Lh.b(this.$);
if(null===ca||void 0===ca?0:ca.zi)nj.g(A),ca.Pi(!0,!1)}}};Xh=Object(vb.a)([Object(ab.d)(Wb.V),Object(vb.b)(0,Object(Wb.W)())],Xh);Object(l.a)(Xh,"EwaAccessibilityManager",Rh,[]);class qi extends Ob.a{constructor(A){super();this.$=A;this.je()}create(){this.Ld(this.$.ga.Da(15)||new Xh(this.$))}static la(A){A.ga.Qa(157,new qi(A))}}Object(l.a)(qi,"AccessibilityManagerFactory",Ob.a,[]);var Tg=a(7),mi=a(128),Ih=a(37);let ei=class extends mi.a{constructor(A,ca){A=void 0===A?Tg.a.CXa:A;ca=void 0===ca?Tg.a.kA:
ca;super(A,ca)}execute(A){const ca=Object(G.a)(8,A.Dg);n.ULS.shipAssertTag(537153921,0,ge.a.svb(A.errors),"SessionReloadActivity.Execute: Only recoverable errors should reach this activity.");ca.HI(!0,!0);A.activityState[Ih.a.X6b]=ca.ea.sessionId;A.activityState[Ih.a.Ptb]=!0;A.activityState[Ih.a.c7b]=!0;n.ULS.sendTraceTag(537153920,0,50,"SessionReloadActivity.Execute: session is going to reopen from cached state");return 3}};ei=Object(vb.a)([Object(ab.d)(Wb.Ec)],ei);Object(l.a)(ei,"SessionReloadActivity",
mi.a,[]);class aj extends Ob.a{constructor(){super();this.je()}create(){this.Ld(new ei(Tg.a.CXa,Tg.a.kA))}static la(A){A.ga.Qa(142,new aj)}}Object(l.a)(aj,"SessionReloadActivityFactory",Ob.a,[]);var vj=a(283),kj=a(49),Nj=a(259),wj=a(130);class Cg extends mi.a{constructor(A,ca,Ra,Zb,wc){super(A,ca);Cg.gId=[-1468309555,611268539,-2087635043,2100961153,810218235,1112506702];Cg.fId=[-1468309555,-315732528,-399065540,810218235,1531005923,1593924569,1112506702,1220851643];Cg.EFf=[-1468309555,611268539,
-1750576502,61029505,-658377927];Cg.DFf=[-1468309555,-315732528,1112506702,-238814601,-1750576502,61029505,-658377927,-1337545025];this.vIc=Ra;this.i2j=Zb;this.Qak=wc}execute(A){var ca=Object(G.a)(8,A.Dg);A.activityState[Ih.a.Kwa]=!0;var Ra=Cg.mhi(A);if(Cg.MWj(A,Ra))return Cg.EWi(A),Ra=50,0<A.errors.length&&(Ra=15),n.ULS.sendTraceTag(537153891,0,Ra,`SessionReloadSilentActivity.ShouldCancelReload: ignore session reload, remaining errors : ${ge.a.ue(A.errors)}`),A.activityState[Ih.a.Kwa]=!1,this.Zi(Tg.a.idle),
3;switch(Ra){case 1:case 3:this.dyi(A,Ra);break;case 2:this.cyi(A);break;case 0:A.activityState[Ih.a.p3a]=null}n.ULS.sendTraceTag(21837003,0,50,`SessionReloadSilentActivity.Execute: silentReloadType:${Ra}. activityName:${this.activityName}. NextActivityName:${this.B3}. TimeFromLastStatefulResponse:${ca.ea.y_}.`);var Zb=qa.a.Li(A.activityState,wj.a.Glb);n.ULS.shipAssertTag(40502925,0,!Zb||Zb&&(1===Ra||3===Ra),`triggerSilentReloadAfterTokenRefresh: ${Zb}, silentReloadType: ${Ra}`);ca=ca.jn.reloadCount;
return 0!==Ra&&0<ca?(Zb=vj.a.iQa(ca,200),n.ULS.sendTraceTag(537153890,0,50,`SessionReloadSilentActivity.Execute: schedule Silent-Type [${Ra}] retryNum [${ca}] delayInMs [${Zb}] activityName [${this.activityName}]`),Yb.a.instance.create(()=>{Cg.iK(A)},Zb,Ca.a.xOj),1):3}dyi(A,ca){n.ULS.sendTraceTag(8438495,0,50,"SessionReloadSilentActivity.InitiateSilentReopen: Silent reopen triggered");const Ra=Object(G.a)(8,A.Dg);A.activityState[Ih.a.Ptb]=!0;Ra.npc||kj.PageLoadTrackingInfo.instance.ol("ReopenOnLoad");
!Cg.isEditMode(A)&&ge.a.svb(A.errors)&&(n.ULS.sendTraceTag(537153889,0,50,"SessionReloadSilentActivity.ShouldAttemptViewSilentReopen: session is going to reopen from cached state"),A.activityState[Ih.a.X6b]=Ra.ea.sessionId,A.activityState[Ih.a.c7b]=!0);A.xId();3===ca?(Ra.ea.ni()||Ra.ea.q1i(),Ra.HI(!0,!0),this.Zi(this.Qak),A.activityState[Ih.a.vze]=Ra.workbookContext.CalcMode):(Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:5678588_FixSilentReopenAfterTokenRefresh")&&1===ca&&Ra.HI(!0,!0),A.activityState[Ih.a.f4c]=
!1,this.Zi(this.vIc))}cyi(A){n.ULS.sendTraceTag(537153888,0,15,"SessionReloadSilentActivity.InitiateSilentRefresh: Silent refresh triggered");A.activityState[Ih.a.p3a]=null;A.xId();this.Zi(this.i2j);A=Object(G.a)(8,A.Dg);A.npc||(kj.PageLoadTrackingInfo.instance.ol("RefreshOnLoad"),A.XRb())}static iK(A){A.iK()}static mhi(A){const ca=Object(G.a)(8,A.Dg),Ra=ca.ea,Zb=Cg.isEditMode(A);var wc=ge.a.nj(A.errors,Zb?Cg.fId:Cg.gId);const Jc=ge.a.nj(A.errors,Zb?Cg.DFf:Cg.EFf),fd=ca.nU,$d=ca.jn.reloadCount,Be=
ca.xa.MaxConsecutiveSilentReloadAllowed,Re=ca.jn.jmf(),lf=ge.a.ue(A.errors),xf=ge.a.ue(A.gEa),$f=0<ge.a.WP(lh=>!lh.triggerSilentReopenOnly,A.errors).length;let tg=wc;const Vf=qa.a.Li(A.activityState,wj.a.Glb);Vf&&(tg=!0);const ug={name:"SessionReloadSilentActivity.GetSilentReloadType"};ug.editMode=Zb;ug.isSilentReopenError=wc;ug.isSilentRefreshError=Jc;ug.reloadSequenceCount=ca.jn.nWa;ug.reloadCount=$d;ug.maxReloads=Be;ug.stopSilentReloads=Re;ug.errorNames=lf;ug.processedErrorNames=xf;ug.isClientDirty=
fd;ug.errorsForSilentReopenOnly=$f;ug.triggerSilentReloadAfterTokenRefresh=Vf;ug.IsReopenDisabled=ca.qSa;wc=bd.a.He(ug);n.ULS.sendTraceTag(21837004,0,50,wc);if(!Re){if(tg&&(Zb?Cg.DWj(A):Cg.FWj(A)))return Nj.a.Aig(A,ca)?3:ca.qSa?2:1;if(Jc&&(Zb||!Ra.Ehb))return 2}return 0}static MWj(A,ca){for(const Ra of A.errors)if(-1337545025===Ra.MessageId||-238814601===Ra.MessageId)return!1;return ge.a.WP(Ra=>!Ra.triggerSilentReopenOnly,A.errors).length?3!==ca:!1}static EWi(A){const ca=ge.a.WP(Ra=>!Ra.triggerSilentReopenOnly,
A.errors);for(const Ra of ca)A.uga(Ra)}static isEditMode(A){const ca=Object(G.a)(8,A.Dg);return ca.ea.oe?ca.ut&&!!(ca.If&64):qa.a.Li(A.activityState,Ih.a.Bu)}static FWj(A){const ca=Object(G.a)(8,A.Dg),Ra=ge.a.l8(A.errors,Cg.gId);if(Cc.b(Ra,Zb=>Zb.ForceVersionUpgrade))return!1;A=ge.a.svb(A.errors);return!ca.ea.Ehb||A?!0:!1}static DWj(A){A=ge.a.l8(A.errors,Cg.fId);return!Cc.b(A,ca=>ca.ForceVersionUpgrade)}}Cg.gId=null;Cg.fId=null;Cg.EFf=null;Cg.DFf=null;Object(l.a)(Cg,"SessionReloadSilentActivity",
mi.a,[]);class Ei extends Ob.a{constructor(A,ca){super();this.activityName=A;this.$M=ca;this.je()}create(){this.Ld(new Cg(this.activityName,this.$M,Tg.a.kA,Tg.a.Gk,Tg.a.oXb))}static la(A){A.ga.Qa(143,new Ei(Tg.a.osa,Tg.a.S9b));A.ga.Qa(144,new Ei(Tg.a.fGc,Tg.a.PUa));A.ga.Qa(145,new Ei(Tg.a.gGc,Tg.a.ZOd));A.ga.Qa(154,new Ei(Tg.a.qjb,Tg.a.fS))}}Object(l.a)(Ei,"SessionReloadSilentActivityFactory",Ob.a,[]);let pj=class extends uh.a{constructor(A){super(Object(U.h)(A))}vhi(A){for(const ca of this.rangeList)if(A.range.contains(ca))return ca;
return null}dTd(A){return A.GridBlockModel&&(A=gridRenderer.CanvasRendererFactoryGlobal.getModelAccessor(A.GridBlockModel))?A.getSparklineRanges():null}};pj=Object(vb.a)([Object(ab.d)(Wb.Tc),Object(vb.b)(0,Object(Wb.W)())],pj);Object(l.a)(pj,"SparklineManager",uh.a,[219]);var Gj=a(654),rj=a(559),Li=a(1168);class Mi extends Eg.a{constructor(A,ca){ca=void 0===ca?!0:ca;super(!1,!1,Mi.Ix);this.d2a=null;this.xje=!1;this.Fp=[];this.Tl=null;this.c6b=A;this.$Pg=ca;this.Qz=this.twe=!1;this.Jka=null;this.jTc=
!1;this.di=this.Fzh;this.ug="InsertFileDialog";this.qe(1,this.w6b);Mi.Ix?(this.d2a={["id"]:this.ug,["bodyControls"]:{["uploadButtonProps"]:{["label"]:CommonUIStrings.l_DialogChooseFile,["onExecute"]:Object(B.a)(this,this.qgj,"onUploadButtonClick")}},["uploadStatusLabel"]:CommonUIStrings.l_DialogNoFileChosen,["onFrameReady"]:Object(B.a)(this,this.$7i,"onFrameReady")},this.initializeAndShow(this.titleText,Object(B.a)(this,this.Loc,"insertDialogHandler"),this.d2a),this.q0b=!0):(this.showDialog(this.titleText,
Object(B.a)(this,this.Loc,"insertDialogHandler")),ca&&this.lhg(),(A=this.lN(1))&&this.Fp.push(A),(A=this.lN(0))&&this.Fp.push(A),this.Uvg(),this.q0b=!1)}get Mkk(){return this.c6b}validate(){this.Tl.TH||n.ULS.sendTraceTag(25798091,322,10,"UploadFrame.FileInputElement is null");return this.Tl.TH.value?!0:(Mi.UC(CommonUIStrings.l_FileUploadNoFileSpecified),!1)}$7i(A){this.$Pg&&(this.Tl=this.khg(A,this.c6b))}qgj(){this.Tl&&this.Tl.TH&&(this.xje||(this.Tl.zxj(Object(B.a)(this,this.RMd,"onFileChosen")),
this.xje=!0),this.Tl.N6e())}RMd(A){this.d2a.uploadStatusLabel=A;this.BGa(this.titleText,Object(B.a)(this,this.Loc,"insertDialogHandler"),this.d2a)}Loc(A){1===A&&this.isEnabled()?Mi.Ix&&this.Tl.TH&&!this.Tl.TH.value?(this.d2a.uploadStatusLabel=CommonUIStrings.l_FileUploadNoFileSpecified,this.BGa(this.titleText,Object(B.a)(this,this.Loc,"insertDialogHandler"),this.d2a)):(this.fab(),this.c6b.finalizeUpload(this.Tl,Object(B.a)(this,this.dispose,"dispose"))):0===A&&this.hide()}lhg(){this.jTc=!1;this.Tl=
this.khg(document.getElementById("uploadFrameContainer"),this.c6b);O.AFrameworkApplication.da.pa("InsertPictureDialogFocusLoopFixIsEnabled")&&(this.Jka=Object(B.a)(this,this.JOd,"onUploadFrameLoad"),Qg.a.addHandler(this.Tl.iFrame,"load",this.Jka));this.Tl.TH||n.ULS.sendTraceTag(25798092,322,15,"UploadFrame.FileInputElement is null");this.$_f()}JOd(){this.$_f()}$_f(){if(this.Tl&&!this.jTc){var A=this.Tl.TH;A&&(Qg.a.addHandler(A,yc.a.me,Object(B.a)(this,this.onKeyDown,"onKeyDown")),A=[A],this.Fp=A.concat.apply(A,
this.Fp),this.Uvg(),this.jTc=!0)}}dispose(){if(this.Tl&&!Mi.Ix){const A=this.Tl.TH;A&&Qg.a.removeHandler(A,yc.a.me,Object(B.a)(this,this.onKeyDown,"onKeyDown"));this.Jka&&Qg.a.removeHandler(this.Tl.iFrame,"load",this.Jka)}this.Tl=null;super.dispose()}Uvg(){if(0<this.Fp.length){const A=new Li.a(this.Fp),ca=e.FocusManager.instance().ZT();ca&&(this.Fp[0].focus(),ca.Cj=A,ca.i$=!0)}}onKeyDown(A){4!==e.FocusManager.instance().c0f(A)&&A.preventDefault()}static get Ix(){return O.AFrameworkApplication.sa.Ra.hy&&
O.AFrameworkApplication.sa.Ra.mwf}static UC(A){const ca=document.getElementById("errorText");ca.innerText=A;ca.style.display="inline-block"}}Object(l.a)(Mi,"InsertFileDialog",Eg.a,[]);class si{static get di(){return Eg.a.sq(si.vn,CommonUIStrings.l_ImageUploadDialogText,CommonUIStrings.l_ImageUploadNoFileSpecified)}}si.vn="<div class='WACDialogRow' id='block1'> <label id='labelText' class='WACDialogLabel' >{0}</label> </div> <div class='WACDialogRowNoBreak' id='block2'> <div id='uploadFrameContainer'></div> <div class='WACDialogError' id='errorText' role='alert'>{1}</div> </div>";
Object(l.a)(si,"InsertImageDialogHtml",null,[]);class bj extends Mi{constructor(A,ca){super(A,void 0===ca?!0:ca)}get w6b(){return CommonUIStrings.l_ImageUploadButtonText}get titleText(){return CommonUIStrings.l_ImageUploadingTitle}get Fzh(){return si.di}validate(){this.Tl.TH||n.ULS.sendTraceTag(25798095,322,10,"UploadFrame.FileInputElement is null");const A=Object(G.a)(bg,this.Mkk),ca=A.Rxg(this.Tl.TH.value);return 0!==ca?(Mi.UC(A.Hcf(ca)),!1):!0}}Object(l.a)(bj,"InsertImageDialog",Mi,[]);var $i=
a(564);const Ni=(A,ca,Ra)=>{if(A){var Zb=0;do{try{A();break}catch(wc){if(n.ULS.sendTraceTag(50946190,306,10,"RetryOnException: [Retries: {0}] [Caller: {1}] [Exception: {2}] [Callstack: {3}].",Zb,Ra,wc.message,wc.stack),Zb>=ca)break}Zb++}while(1)}};var ti=a(114),xj=a(473);class Bg{constructor(A,ca,Ra,Zb,wc,Jc,fd,$d,Be,Re,lf,xf){Be=void 0===Be?!0:Be;lf=void 0===lf?!1:lf;this.U6e="FileUpload.ashx";this.Hq=null;this._initialized=!1;this.dj=this.$ob=this.iTc=this.Jka=this.Q0b=this.Jr=this.Cv=null;this.$o=
!1;this.QG=this.R0b=this.L2c=null;this._parent=A;this.NKg=ca;this.sPg=Ra;this.cke=wc;this.J0c=fd;this.Wde=$d;this.aqe=void 0===xf?null:xf;this.age=void 0===Re?null:Re;this.K2c=!1;this.lLg=Zb.pa("CanaryRenewalForFileUploadIsEnabled");this.ixg=!1;(this.Mva=lf)||this.poh(Jc);Be&&this.Xpf()}get n$f(){return this.sPg}get sessionId(){return this.J0c}get iFrame(){return this.Hq}get TH(){return this.Jr}get Aeb(){return O.AFrameworkApplication.da?O.AFrameworkApplication.da.pa("NativeFileOpenDialogIsEnabled"):
!1}get O6e(){return O.AFrameworkApplication.da?O.AFrameworkApplication.da.pa("FileInputDescriptionAccessibilityIsEnabled"):!1}get Hkk(){return O.AFrameworkApplication.da?O.AFrameworkApplication.da.getBooleanFeatureGate("Microsoft.Office.WordOnline.UploadDocumentFromPCIsEnabled",!1):!1}get yGi(){return this.Mva?!1:ti.b(this.Hq.contentWindow.location.pathname,this.U6e,0)}get D2g(){return!Y.a.ABa&&O.AFrameworkApplication.da.pa("AllowMultipleImageInsertFromLocalDevice")}Xpf(){this.QG=ma.a.create().toString();
this.Mva?this.jjd():this.K3g()}poh(A){this.Hq=document.createElement("iframe");this.Hq.className=A;this.Hq.id=A;this.cke&&(this.Hq.style.visibility="visible",this.Hq.style.height="30px",this.Hq.setAttribute("frameborder","0"));this.Jka=Object(B.a)(this,this.JOd,"onUploadFrameLoad");Qg.a.addHandler(this.Hq,"load",this.Jka)}Bfc(A){A=void 0===A?null:A;O.AFrameworkApplication.sa.NAc();if(!this.Jr)return n.ULS.sendTraceTag(25798093,322,50,"_fileInput is null"),"";Qg.a.addHandler(this.Jr,"change",()=>{this.gUh(A)});
Ni(Object(B.a)(this,this.N6e,"fileInputClick"),1,"DoFileOpenDialog");return this.Jr.value}gUh(A){A&&A(this.Jr.value)}hUh(){this.Q0b&&(this.Q0b.innerText=this.fef())}zxj(A){Qg.a.addHandler(this.Jr,"change",()=>{A(this.fef())})}fef(){let A=null;if(this.Jr.value){const ca=this.Jr.value,Ra=ca.lastIndexOf("\\");0<Ra&&(A=ca.substring(Ra+1,ca.length))}return A?A:""}N6e(){try{n.ULS.sendTraceTag(35939520,322,50,"UploadFrame.FileInputClick - Clicking on File input element."),this.Jr.click()}catch(A){throw n.ULS.sendTraceTag(36783331,
322,10,"UploadFrame.FileInputClick Exception: {0}",A.message),A;}}F6j(){this.UJi()?this.oog():(this.oae(),this.Cv.submit())}UJi(){return(this.lLg||this.Mva)&&!(void 0===window.self.FormData||null===window.self.FormData)}Fdg(A){if(A){const ca=this.URe();this.dj=new XMLHttpRequest;this.dj.open("POST",ca);this.dj.setRequestHeader("X-CorrelationId",this.QG);this.uSi(A);this.dj.onreadystatechange=Object(B.a)(this,this.Pta,"uploadResponseReceived");this.dj.send(A)}}uSi(A){if(!Y.a.ABa&&A.get){var ca=A.get("ImageId");
A=window.self.navigator;ca={["CorrelationId"]:this.QG,["Canary"]:O.AFrameworkApplication.canary,["ImageNodeId"]:ca};A&&(A=A.connection?A.connection:A.mozConnection?A.mozConnection:A.webkitConnection?A.webkitConnection:null)&&(ca.effectiveType=A.effectiveType,ca.downlink=A.downlink,ca.type=A.type,ca.rtt=A.rtt);n.ULS.sendTraceTag(573345858,322,50,"LogFileUploadStatistics: FileUpload {0}",ca)}}oog(){try{this.oae();n.ULS.sendTraceTag(594888409,322,50,"SubmitFormWithRequest is preparing to send an upload request");
const A=new (Type.parse("FormData"))(this.Cv);this.Fdg(A)}catch(A){n.ULS.sendTraceTag(594888407,322,10,"SubmitFormWithRequest failed to send the request with exception "+A.message),this.Ofb(null)}}nog(A){try{if(this.oae(),n.ULS.sendTraceTag(594888406,322,50,"SubmitFormWithBlob is preparing to send an upload request"),this.Gmk(A)){this.R0b=A;this.Cv.contains(this.Jr)&&this.Cv.removeChild(this.Jr);var ca=new (Type.parse("FormData"))(this.Cv);ca.append("applicationfileInput",A.blob,A.filename);this.Fdg(ca)}else this.Ofb(null)}catch(Ra){n.ULS.sendTraceTag(591267743,
322,10,"SubmitFormWithBlob failed to send the request with exception "+Ra.message),this.Ofb(null)}}Gmk(A){return A&&void 0!==A.blob&&null!==A.blob&&void 0!==A.filename&&null!==A.filename&&""!==A.filename?void 0===window.self.FormData||null===window.self.FormData?(n.ULS.sendTraceTag(578380442,322,10,"FormData isn't supported"),!1):!0:(A=A?String.format("[isNull: false] [blobIsNullorEmpty: {0}] [filenameIsNullOrEmpty: {1}]",void 0===A.blob||null===A.blob,void 0===A.filename||null===A.filename||""===
A.filename):"[isNull: true] [blobIsNullorEmpty: false] [filenameIsNullOrEmpty: false]",n.ULS.sendTraceTag(578380441,322,10,String.format("Content of the blob is empty {0}",A)),!1)}Pta(){if(4===this.dj.readyState)if(200===this.dj.status){n.ULS.sendTraceTag(594888405,322,50,"UploadResponseReceived received a successful response. CorrelationId: {0}",this.QG);const A=this.dj.getResponseHeader("X-NewKey"),ca=this.WBi(this.dj);let Ra=!1;if(void 0!==A&&null!==A&&ca&&(Ra=this.wmk(A),!this.K2c&&Ra)){n.ULS.sendTraceTag(594888404,
322,50,"UploadResponseReceived resubmitting the upload request with a fresh canary. correlationId: {0}",this.QG);this.K2c=!0;void 0!==this.R0b&&null!==this.R0b?this.nog(this.R0b):this.oog();return}n.ULS.sendTraceTag(594888403,322,50,"UploadResponseReceived processing the response [retried: {0}] [canaryInvalid: {1}] [gotNewCanary: {2}] [canaryRenewed: {3}] [CorrelationId: {4}]",this.K2c,ca,!(void 0===A||null===A),Ra,this.QG);this.Ofb(this.dj.responseText)}else n.ULS.sendTraceTag(42874946,322,15,"Upload request failed with status: {0} [isResponseNull: {1}] [correlationId: {2}]",
this.dj.status,this.dj.responseText?!1:!0,this.QG),this.Ofb(null)}WBi(A){try{const ca=T.a(A.responseText).Responses;if(void 0!==ca&&null!==ca&&1===ca.length){const Ra=ca[0];if(void 0!==Ra&&null!==Ra&&2===Ra.length&&28===Ra[1].StatusCode)return!0}}catch(ca){}return!1}wmk(A){xj.a.Mug(A);return O.AFrameworkApplication.canary!==A?!1:!0}oae(){this.L2c||(this.L2c=new Date)}dispose(){this.$o||(this.Mva?this._parent.removeChild(this.Cv):(this._parent.removeChild(this.Hq),Qg.a.removeHandler(this.Hq,"load",
this.Jka),this.Jka=null),this.iTc&&(Qg.a.removeHandler(this.Jr,"change",this.iTc),this.iTc=null),this.O6e&&(this.$ob&&(Qg.a.removeHandler(this.Jr,"change",this.$ob),this.$ob=null),this.Q0b=null),this.Jr=this.Cv=this._parent=this.Hq=null,this.$o=!0,this.L2c=null,n.ULS.sendTraceTag(25798094,322,50,"UploadFrame disposed"))}delayedDispose(){this.dispose()}Uqh(A){if(this.Cv){var ca;(ca=this.Cv.querySelector("input[name=__REQUESTDIGEST]"))?ca.value=A:(ca=this.ued(),ca.type="hidden",ca.id="__REQUESTDIGEST",
ca.name="__REQUESTDIGEST",ca.value=A,this.Cv.appendChild(ca))}}ued(){return this.Mva?document.createElement("input"):this.Hq.contentWindow.document.createElement("input")}JOd(){try{if(!this.Hq.contentWindow.document.body)return}catch(ca){this.Epi();return}if(!(this._initialized||this.Aeb&&Y.a.dE))this.jjd();else if(!this.Aeb||!Y.a.dE||this.yGi){let ca;ca=Y.a.gy?this.Hq.contentWindow.document.body.innerText:this.ixg?this.Hq.contentWindow.document.body.firstChild.innerText:this.Hq.contentWindow.document.body.firstChild.innerHTML;
var A=this.Hq.contentWindow.document.body.innerText.toLowerCase();const Ra=0<=A.indexOf("responses")||0<=A.indexOf("wopisrc");A=0<=A.indexOf("http error");!Ra&&A&&n.ULS.sendTraceTag(42551183,322,15,"Couldn't obtain a valid response but the frame contains: "+this.Hq.contentWindow.document.body.innerText);this.Ofb(ca)}}jjd(){if(!this._initialized){var A=this.ia("uploadForm");const ca=this.ia("fileInput"),Ra=this.URe();this.Aqh();this.Cv.id=A;this.Cv.method="post";this.Cv.encoding="multipart/form-data";
this.Cv.action=Ra;this.Jr.type="file";this.Wde&&(this.Jr.accept=this.Wde,this.age&&(this.Jr.capture=this.age));this.Jr.id=ca;this.Jr.name=ca;this.D2g&&(this.Jr.multiple=!0);this.Hkk&&("true"===this.aqe?this.Jr.multiple=!0:"false"===this.aqe&&(this.Jr.multiple=!1));!this.O6e||Y.a.gy||Y.a.TK||(this.$ob=Object(B.a)(this,this.hUh,"fileInputChangedHandleAccessibility"),Qg.a.addHandler(this.Jr,"change",this.$ob),this.Q0b=Og.a.kFe(this.Cv,this.Jr,"InputFileDescription"));this.cke&&(this.Mva||(A=this.Hq.contentWindow.document.body,
A.style.margin="0",A.style.overflow="hidden"),A=O.AFrameworkApplication.sa,this.Jr.style.fontFamily=A.b5,this.Jr.style.fontSize=A.z9d,this.Jr.style.margin="0");(A=document.getElementById("__REQUESTDIGEST"))&&this.Uqh(A.value);this.Cv.appendChild(this.Jr);this._initialized=!0;this.NKg(this)}}Aqh(){if(this.Mva)this.Cv=document.createElement("form"),this._parent.appendChild(this.Cv),this.Jr=document.createElement("input");else{this.Cv=this.Hq.contentWindow.document.createElement("form");const A=this.Hq.contentWindow.document;
A.body.appendChild(this.Cv);this.Jr=A.createElement("input")}}K3g(){this._parent.appendChild(this.Hq);this.Aeb&&Y.a.dE&&this.jjd()}URe(){var A=new na.QueryStringBuilder(this.U6e);O.AFrameworkApplication.s3a(A);this.SOj(A);A=A.toString();if(Y.a.vh||Y.a.dE||Y.a.TK)A=R.a.vjc(A);return A}cAe(){const A=new Ue.a(2,1,0,Object(B.a)(this,this.delayedDispose,"delayedDispose"),4);O.AFrameworkApplication.Vj.Sh(A)}}Object(l.a)(Bg,"UploadFrame",null,[5]);class sh extends Bg{constructor(A,ca,Ra,Zb,wc,Jc,fd,$d){$d=
void 0===$d?!1:$d;super(A,ca,Ra,Zb,wc,"UploadFrame",Jc.ea.sessionId,"image/*",!1,null,void 0===fd?!1:fd);this.$=Jc;this.ixg=!0;this.cCi=$d;this.Xpf()}ia(A){return A}SOj(A){n.ULS.shipAssertTag(526399105,0,!!this.sessionId,"SessionId shouldn't be null.");Od.a.X6c(A,this.$.xa);A.C6(Eb.a.sessionId,this.sessionId);var ca=U.h(this.$).ha;ca=ec.o(ca.ra.x8,this.$);A.C6(Eb.a.uqj,this.$.va.na.name);A.C6(Eb.a.tqj,ca.FirstRow.toString());A.C6(Eb.a.sqj,ca.FirstColumn.toString());A.C6(Eb.a.Dyi,this.cCi.toString())}Epi(){this.n$f("ServerUploadError")}Ofb(A){this.n$f(A)}static kEi(A){return!A||
Rd.a.equals(A,"ServerUploadError",!1)}}Object(l.a)(sh,"UploadFrameWrapper",Bg,[]);class Oi extends bj{constructor(A,ca,Ra,Zb){super(A,!1);this.aY=null;this.SFa=!1;this.Zd=null;this.yxc=()=>{this.s$d("");this.QLc();return!1};this.$=ca;this.YMc=A;this.jU=$i.a.instance;this.da=Ra;this.Zd=Zb;this.lhg();this.Lxd();this.$.yd.TA=!0}khg(A,ca){return new sh(A,Object(B.a)(ca,ca.HOb,"onUploadFrameInitialized"),Object(B.a)(ca,ca.Pta,"uploadResponseReceived"),this.da,!0,this.$)}dispose(){this.QLc();this.jU=this.YMc=
null;super.dispose()}hide(){super.hide();this.$.yd.TA=!1}validate(){var A=this.YMc.Yae(this.Tl.TH.value,this.YMc.zsg(this.Tl));return 0!==A?(A=this.YMc.Spd(A).Description,this.s$d(A),this.u6d(),!1):!0}isEnabled(){return!0}s$d(A){var ca;null===(ca=this.Zd)||void 0===ca?void 0:ca.mfg(this.aY,A)}Lxd(){this.aY=document.getElementById("errorText");this.aY.style.display="inline-block";this.SFa=!1;this.s$d("");this.QNa.style.maxWidth=this.QNa.currentStyle.minWidth}u6d(){this.jU.ta(yc.a.click,this.Tl.TH,
this.yxc);this.jU.ta(yc.a.me,this.Tl.TH,this.yxc);this.SFa=!0}QLc(){this.SFa&&(this.jU.Aa(yc.a.click,this.Tl.TH,this.yxc),this.jU.Aa(yc.a.me,this.Tl.TH,this.yxc),this.SFa=!1)}}Object(l.a)(Oi,"InsertImageDialogWrapper",bj,[]);class ji extends bg{constructor(A,ca,Ra,Zb,wc){wc=void 0===wc?!0:wc;super(null,ca,Ra);this.ina=this.cJ=null;this.rzd=this.Lcb=!1;this.hQd=null;this.Pta=Jc=>{this.Zbe.stop();this.I9b.cancel();if(sh.kEi(Jc))this.PKc?this.Ekf(4):(Jc=new Gj.a(0,2,null,null,!1,null,null,null),Jc.status=
8,this.S8d(new rj.a(Jc),null,"InsertPictureWebMethod")),n.ULS.sendTraceTag(526399121,0,50,`Http Error occurred, isTimeoutError: ${this.PKc}`);else{const fd=ji.Smk(Jc);0!==fd?(n.ULS.sendTraceTag(526399122,0,50,`Server returned error, response: ${Jc}`),this.Ekf(fd)):this.qpi(Jc)}this.izc();this.dispose()};this.t7i=Jc=>{this.VGa(Jc,this.Tl)&&this.finalizeUpload(this.Tl,null)};this.HOb=Jc=>{n.ULS.sendTraceTag(526399120,0,50,"Upload frame initialized");this.Tl=Jc;if(!this.z7a){if(this.vae){if(this.aLe()||
this.Aeb&&Y.a.dE){Jc.Bfc(this.t7i);return}const fd=Jc.Bfc(null);if(!this.VGa(fd,Jc))return}this.finalizeUpload(Jc,null)}};this.Nfj=()=>{this.PKc=!0};this.vd=A;this.Zbe=A.Sd.fi("WebServiceCall","InsertPictureOperation");this.I9b=Yb.a.instance.create(this.Nfj,1E5,Ca.a.t7g,!1);this.PKc=!1;this.rvc=this.$.xa.InsertPictureMaxFileSizeBytes;Zb&&(this.Lcb="TestOnly"in Zb);Zb&&(this.rzd="IsCellPicture"in Zb);wc&&this.showDialog()}get $(){return this.vd}get SWi(){return this.rvc/1024/1024}dispose(){ub.a.Ma(this.I9b);
this.Tl&&this.Tl.cAe();this.Tl=this.I9b=this.vd=null}luj(A){if(!this.$)return n.ULS.sendTraceTag(526399119,0,50,"ReadPictureAsDataURLTask: EwaControl is null"),Aa.Task.Wa(!0);if(!this.$.A9)return Aa.Task.Wa(!0);const ca=new Rb.a,Ra=new FileReader;A=A.TH.files[0];const Zb=()=>{ca.uy(!0)};Ra.onload=()=>{this.hQd=Ra.result;ca.uy(!0)};Ra.onerror=Zb;Ra.onabort=Zb;Ra.readAsDataURL(A);return ca.task}zsg(A){let ca=-1;A=A.TH;(null===A||void 0===A?0:A.files)&&0<A.files.length&&(ca=A.files[0].size);return ca}Yae(A,
ca){let Ra=ji.knh(bg.VGa(A));0===Ra?-1!==ca&&(n.ULS.sendTraceTag(526399118,0,50,`Validating picture, pictureSize: ${ca}, maxAllowedSize: ${this.rvc}, remainingWorkbookSize: ${this.$.ea.qAf}`),ca>this.rvc?Ra=3:ca>this.$.ea.qAf&&(Ra=7)):6===Ra&&this.xUi(A);n.ULS.sendTraceTag(526399117,0,50,`Validated file on client, validation result: ${Ra}`);return Ra}VGa(A,ca){A=this.Yae(A,this.zsg(ca));return 0!==A?(this.z7a||1===A||this.c4d(A),!1):!0}Urg(A){A.F6j()}Spd(A){let ca=0,Ra=1,Zb=-1100324317,wc="InsertPictureUnknownError",
Jc=null;switch(A){case 1:ca=1758;Ra=0;Zb=940870981;wc="InsertPictureNoFileSelected";break;case 3:Ra=0;Zb=1250467391;wc="InsertPicturePictureTooBig";Jc=String.format(Ub.a.instance.xd(181),this.SWi.toLocaleString());break;case 6:ca=1762;Ra=0;Zb=1380041209;wc="InsertPictureUnsupportedFormat";break;case 7:ca=1759;Ra=0;Zb=-903115058;wc="InsertPictureExceedWorkbookSize";break;case 4:ca=1760;Ra=0;Zb=1218352119;wc="InsertPictureUploadTimeout";break;case 5:ca=1761,Ra=0,Zb=1979899005,wc="InsertPictureServiceNonDeterministicError"}A=
ji.qf(ca,Ra,Zb,wc);Jc&&(A.Description=Jc);return A}showDialog(){if(this.aLe())this.z7a=!1,this.Tl=new sh(this.$.domElement,this.HOb,this.Pta,this.da,!1,this.$,!0,this.rzd);else if(n.ULS.sendTraceTag(526399115,0,50,"Showing Insert Picture dialog"),!this.Lcb&&(Y.a.fC||Y.a.dE&&72>Y.a.jNe))this.z7a=!1,this.Tl=new sh(this.$.domElement,this.HOb,this.Pta,this.da,!1,this.$);else{this.z7a=!0;const A=Object(Bc.d)(ab.a.resolve(Wb.Ab,{Ja:0}));Jd.TaskExtensions.za(A,()=>{this.Tl=(new Oi(this,this.$,this.da,A.result)).Tl},
this.$.ka,3)}}qpi(A){let ca={};try{if(ca=bd.a.Fk(A),vc.b().uD(this.Zbe.id,ca.ServerCorrelationId,"actions","ServerActions"),!ge.a.ph(ca.Errors)&&ca.Result&&(this.$.ea.D_(ca.StateId,"BasePictureUploaderWrapper.UploadResponseReceived"),!this.rzd)){const Ra=ca.Result;mf.a(this.$).Iaa(1,Ra);const Zb=Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigrateValidationTelemetryManager",!1)?ab.a.zg(Wb.cd):this.$.ga.Da(277);Zb&&Zb.E4c(this.$,1,ca.Result,ca,"InsertPicture");n.ULS.sendTraceTag(526399114,
0,50,"Insert picture completed successfully :)")}}catch(Ra){n.ULS.sendTraceTag(526399113,0,50,`BasePictureUploaderWrapper.HandleSuccessCallback: got exception while try to JSON.Parse string length: ${A?A.length:-1}, errror: ${Ra}`)}this.rLc(ca,null,"InsertPictureWebMethod")}Ekf(A){A=this.Spd(A);const ca={};ca.Errors=[A];this.rLc(ca,null,"InsertPictureWebMethod")}rLc(A,ca,Ra){this.cJ(A,ca,Ra)}S8d(A,ca,Ra){this.ina(A,ca,Ra)}c4d(A){A=this.Spd(A);Sb.EwaSettings.gC()?new ce.a(this.$,A):(new Kd.ErrorDialog(this.$,
A)).Ji()}xUi(A){const ca=this.$.xa.InsertPicturUnsupportedExtensionsForLogging;A=kb.a.Tm(A);for(let Ra=0;Ra<ca.length;++Ra)if(A.endsWith(ca[Ra])){n.ULS.sendTraceTag(526399112,0,50,`Insert picture blocked invalid extension: ${ca[Ra]}`);break}}static Smk(A){return!A||Rd.a.equals(A,Eb.a.insertPictureUnknownError,!0)?2:Rd.a.equals(A,Eb.a.insertPictureNoFileSelectedError,!0)?1:Rd.a.equals(A,Eb.a.Cyi,!0)?3:Rd.a.equals(A,Eb.a.Fyi,!0)?5:0}static qf(A,ca,Ra,Zb){return ge.a.qf(1,0,0,A,ca,Ra,Zb)}static knh(A){switch(A){case 1:return 1;
case 2:return 6}return 0}aLe(){return this.Lcb||void 0===window.self.FormData||null===window.self.FormData?!1:!0}}Object(l.a)(ji,"BasePictureUploaderWrapper",bg,[5]);class ui extends ji{constructor(A,ca,Ra,Zb,wc,Jc){Jc=void 0===Jc?!0:Jc;super(A,ca,Ra,Zb,!1);this.mUh=wc;this.hic=A.Sd.fi("LoadResource","FileReaderUploaderLoadResource");Jc&&this.showDialog()}V_j(){this.rvc=28E5;this.c4d(3)}Vld(A){n.ULS.sendTraceTag(526399111,0,50,"FileReaderUploaderWrapper.finalizeUploadImpl - Start function.");const ca=
new FileReader;A=A.TH.files;if(0==A.length)n.ULS.sendTraceTag(526399110,0,15,"FileReaderUploaderWrapper.finalizeUploadImpl - No image file found.");else{var Ra=A[0];ca.onload=()=>{this.hic.stop();this.mUh.jfj(ca.result,this);n.ULS.sendTraceTag(526399109,0,50,`FileReaderUploaderWrapper.finalizeUploadImpl - End function. Type:${Ra.type}, Size:${Ra.size.toString()}`)};ca.onerror=()=>{this.hic.stop();n.ULS.sendTraceTag(526399108,0,10,`FileReaderUploaderWrapper.finalizeUploadImpl - Can't read image. Type:${Ra.type}, Size:${Ra.size.toString()}`)};
ca.onabort=()=>{this.hic.stop();n.ULS.sendTraceTag(526399107,0,10,`FileReaderUploaderWrapper.finalizeUploadImpl - Aborted read image. Type:${Ra.type}, Size:${Ra.size.toString()}`)};this.hic.start();ca.readAsDataURL(Ra)}}finalizeUpload(A,ca){this.Vld(A,ca)}}Object(l.a)(ui,"FileReaderUploaderWrapper",ji,[293]);class fi{constructor(A,ca){this.dataUri=this.sheetName=null;this.sheetName=A;this.dataUri=ca}getSheetName(){return this.sheetName}}Object(l.a)(fi,"MacroRecorderPictureInsertedPayload",null,[135]);
class ri extends ji{constructor(A,ca,Ra,Zb,wc,Jc){Jc=void 0===Jc?!0:Jc;super(A,Ra,Zb,wc,!1);this.Bf=ca;Jc&&this.showDialog()}Vld(A,ca){super.finalizeUpload(A,ca);Ld.a(this.$.userOperationManager,(Ra,Zb)=>{this.cJ=Ra;this.ina=Zb;this.Zbe.start();this.I9b.Es();this.PKc=!1;this.Urg(A);return this.luj(A)},Ra=>{const Zb={};this.$.Kl(Zb);const wc=Zb.SheetName;Ra=new Zc.a(510,0,Ra,72,()=>new fi(wc,this.hQd?this.hQd:""));Ra.rFa(()=>!0);Ra.Bf=this.Bf;return Ra},this.Bf)}finalizeUpload(A,ca){this.Vld(A,ca)}}
Object(l.a)(ri,"PictureUploaderWrapper",ji,[]);class sj{constructor(A,ca){this.filename=A;this.blob=ca}}Object(l.a)(sj,"UploadBlobParameters",null,[]);class cj extends ri{constructor(A,ca,Ra,Zb,wc,Jc,fd){super(A,ca,Ra,Zb,wc,!1);this.vae=!1;this.UL=fd;this.doc=cj.i_h(Jc);A=this.Yae(this.doc.name,this.doc.size);0!==A?(this.c4d(A),this.UL.setException(Error.create("DataUrlUploaderWrapper: Invlid data url")),this.dispose()):this.Tl=new sh(this.$.domElement,this.HOb,this.Pta,Zb,!1,this.$)}S8d(A,ca,Ra){super.S8d(A,
ca,Ra);this.UL.setException(Error.create("DataUrlUploaderWrapper.TriggerFailedCallback: File upload request failed"))}rLc(A,ca,Ra){super.rLc(A,ca,Ra);ge.a.ph(A.Errors)?this.UL.setException(Error.create(`DataUrlUploaderWrapper.TriggerSuccessCallback: File upload request returned with errors: ${ge.a.ue(A.Errors)}`)):this.UL.setResult(!0)}Urg(A){const ca=new sj(this.doc.name,this.doc);A.nog(ca)}static i_h(A){var ca=A.split(",");A=ca[0].includes("base64")?window.self.atob(ca[1]):window.self.decodeURI(ca[1]);
ca=ca[0].split(":")[1].split(";")[0];const Ra=new Uint8Array(A.length);for(let Zb=0;Zb<A.length;Zb++)Ra[Zb]=A.charCodeAt(Zb);A=new Blob([Ra],{type:ca});A.name="Image.png";return A}}Object(l.a)(cj,"DataUrlUploaderWrapper",ri,[]);let Gi=class{constructor(){}ixi(A,ca,Ra,Zb,wc){-2060689045===ca.command&&(wc.IsCellPicture=!0);new ri(A,ca,Ra,Zb,wc,!0)}iwi(A,ca,Ra,Zb,wc,Jc){new cj(A,null,ca,Ra,Zb,wc,Jc)}twi(A,ca,Ra,Zb,wc){new ui(A,ca,Ra,Zb,wc,!0)}};Gi=Object(vb.a)([Object(ab.d)(Wb.bd)],Gi);Object(l.a)(Gi,
"UploaderCreator",null,[218]);class xh{constructor(A,ca){this.$=ca;this.ariaLiveNotifier=A}W2f(){const A=this.k2h();this.ariaLiveNotifier.RVa(A,Hc.a.FLa)}k2h(){const A=new Sys.StringBuilder;this.$.workbookContext&&ta(A,this.$.workbookContext.WorkbookFileName);ta(A,Ub.a.instance.ia(855));ta(A,this.m2h());ta(A,this.l2h());ta(A,Ub.a.instance.ia(856));return A.toString()}m2h(){return this.$.isEditMode?Ub.a.instance.ia(860):Ub.a.instance.ia(861)}l2h(){var A=this.Tnk();const ca=this.$.va.na;A=1!==A?String.format(Ub.a.instance.xd(32),
A):Ub.a.instance.ia(854);A=new Sys.StringBuilder(A);ca&&ca.sheetName&&(A.append(Ef.tHd),A.append(String.format(Ub.a.instance.xd(33),ca.sheetName)));return A.toString()}Tnk(){let A=0;for(const ca of this.$.va.items)ca.visible&&A++;return A}}Object(l.a)(xh,"WorkbookReadout",null,[]);let tj=class{constructor(A,ca){this.vZ=()=>{this.Pf||this.EEe()};this.Pf=!1;this.y1=ca.BX;this.ariaLiveNotifier=A;this.nce=new xh(A,ca);this.y1&&this.y1.oU?this.EEe():this.il()}dispose(){this.Jk();this.ariaLiveNotifier=
this.y1=null;this.Pf=!0}il(){if(this.y1){this.y1.Fu(this.vZ);this.y1.ya.Ws(this.vZ);this.y1.iH(this.vZ);var A=Object(G.a)(207,this.y1);A&&(A.he.Gp(this.vZ),A.ha.kr(this.vZ),A.ha.add_activeCellChanged(this.vZ),A.ha.Va.ZW(this.vZ))}else n.ULS.sendTraceTag(537153923,0,15,"WorkbookReadoutHandler.RegisterEvents: Can't register to view events")}Jk(){if(this.y1){this.y1.ya.Bs(this.vZ);this.y1.NI(this.vZ);const A=Object(G.a)(207,this.y1);A&&(A.he.zp(this.vZ),A.ha.Fr(this.vZ),A.ha.remove_activeCellChanged(this.vZ),
A.ha.Va.taa(this.vZ))}}EEe(){this.nce.W2f();this.ariaLiveNotifier.setEnabled(!0);this.ariaLiveNotifier.oQj();this.dispose()}};tj=Object(vb.a)([Object(ab.d)(Wb.ed),Object(vb.b)(0,Object(Wb.f)()),Object(vb.b)(1,Object(Wb.W)())],tj);Object(l.a)(tj,"WorkbookReadoutHandler",null,[5]);let Mh=class{constructor(A,ca,Ra){this.vQf=()=>{this.nce.W2f();this.ariaLiveNotifier.setEnabled(!0)};this.$=ca;this.ariaLiveNotifier=A;this.nce=new xh(A,ca);this.Qic=Ra.Frd(this.$);this.Qic.$Zg(this.vQf)}dispose(){this.Qic&&
this.Qic.NBj(this.vQf);this.Qic=this.ariaLiveNotifier=this.$=null}};Mh=Object(vb.a)([Object(ab.d)(Wb.U),Object(vb.b)(0,Object(Wb.f)()),Object(vb.b)(1,Object(Wb.W)()),Object(vb.b)(2,Object(Wb.Hc)())],Mh);Object(l.a)(Mh,"EmbeddedWorkbookReadoutHandler",null,[5]);Type.registerNamespace("Common");Type.registerNamespace("Common.App.ApplicationFeatureHelper");Pa.main();Type.registerNamespace("Common.App.InsertFile");Type.registerNamespace("Common.App.InsertPicture");(()=>{tf.a.Ga(A=>{$e.la(A)})})();(()=>
{tf.a.Ga(A=>{Me.la(A)})})();(()=>{tf.a.Ga(A=>{Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigrateServices7",!1)||Pe.la(A)})})();ze.a.Dk(".insert-media-dialog-old{width:870px;float:left;margin-top:7px}.insert-media-dialog{width:870px;width:clamp(400px,870px,80vw);float:left;margin-top:7px}.app-rtl .insert-media-dialog{float:right}.insert-media-frame{width:100%;height:100%;visibility:visible}.insert-media-panel-old{height:550px}.insert-media-panel{height:550px;height:clamp(300px,550px,90vh)}.keep-focus-start{position:absolute;width:-1000px;top:-1000px}.keep-focus{position:absolute;width:-1000px;top:1000px}.display-none{display:none}.padding-zero{padding:0}");
(()=>{tf.a.Ga(A=>{Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigrateServices7",!1)||Jh.la(A)})})();Type.registerNamespace("Common.App.GestureManager");wh.main();Type.registerNamespace("Common.App.AccessibilitySettings");Zd.main();(()=>{tf.a.Ga(A=>{Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Migrate2AriaLiveNotifier",!1)||Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Migrate2AriaLiveNotifier",!1)||me.la(A);Sb.EwaSettings.Fd()?Le.la(A):Xc.la(A);ya.la(A)})})();
ze.a.Dk(".ewr-selection-draghandle,.ewr-selection-draghandle-grab{position:absolute;cursor:move;background-color:#fff;opacity:.01;z-index:15;pointer-events:auto}.ewr-selection-draghandle-grab{cursor:grab}.ewr-selection-draghandle-top-ie,.ewr-selection-draghandle-top-ie-enhanced{top:-2px;left:-2px;right:-2px;height:5px}.ewr-selection-draghandle-top-ie-enhanced{border-top:1.25px solid transparent}.ewr-selection-draghandle-top,.ewr-selection-draghandle-top-enhanced{top:-2px;left:-2px;right:-2px;height:calc(5px/var(--zoom-level-canvas,1))}.ewr-selection-draghandle-top-enhanced{border-top:1.25px solid transparent}.ewr-selection-draghandle-bottom-ie,.ewr-selection-draghandle-bottom-ie-enhanced{right:0;left:-2px;bottom:-2px;height:5px}.ewr-selection-draghandle-bottom-ie-enhanced{border-top:1.25px solid transparent}.ewr-selection-draghandle-bottom,.ewr-selection-draghandle-bottom-enhanced{right:0;left:-2px;bottom:-2px;height:calc(5px/var(--zoom-level-canvas,1))}.ewr-selection-draghandle-bottom-enhanced{border-top:1.25px solid transparent}.ewr-selection-draghandle-left-ie,.ewr-selection-draghandle-left-ie-enhanced{top:0;left:-2px;bottom:0;width:5px}.ewr-selection-draghandle-left-ie-enhanced{border-top:1.5px solid transparent}.ewr-selection-draghandle-left,.ewr-selection-draghandle-left-enhanced{top:0;left:-2px;bottom:0;width:calc(5px/var(--zoom-level-canvas,1))}.ewr-selection-draghandle-left-enhanced{border-left:1.5px solid transparent}.ewr-selection-draghandle-right-ie,.ewr-selection-draghandle-right-ie-enhanced{top:0;right:-2px;bottom:0;width:5px}.ewr-selection-draghandle-right-ie-enhanced{border-right:1.5px solid transparent}.ewr-selection-draghandle-right,.ewr-selection-draghandle-right-enhanced{top:0;right:-2px;bottom:0;width:calc(5px/var(--zoom-level-canvas,1))}.ewr-selection-draghandle-right-enhanced{border-right:1.5px solid transparent}.ewr-selection-dragtooltip{position:absolute;background-color:#fff;z-index:UndefinedLessParam;border:1px solid #6e7b8a;height:18px;font-size:12px;padding-left:2px;padding-right:2px}.ewr-selection-dragtooltip-updated{position:absolute;background-color:#fff;z-index:UndefinedLessParam;border:1px solid #6e7b8a;height:fit-content;width:max-content;font-size:10px;padding-left:2px;padding-right:2px}.ewr_selection_rearrangeleft{border-left:3px solid #107c41;position:absolute;height:10px;width:0;left:-2px;top:-4px}.ewr_selection_rearrangeright{border-right:3px solid #107c41;position:absolute;height:10px;width:0;right:-5px;top:-4px}.ewr_selection_rearrangetop{border-top:3px solid #107c41;position:absolute;width:10px;height:0;top:-2px;left:-4px}.ewr_selection_rearrangebottom{border-bottom:3px solid #107c41;position:absolute;width:10px;height:0;bottom:-5px;left:-4px}.ewr-cell-selection-highlight-all.selecting .ewr-selection-draghandle{cursor:unset}.ewr-selection-resizemarqueehandle{position:absolute;width:5px;height:5px;background-color:#107c41;border:solid 1px #fff;z-index:16;pointer-events:auto}.ewr-selection-resizemarqueehandle-topleft,.ewr-selection-resizemarqueehandle-topright{top:-4px}.ewr-selection-resizemarqueehandle-bottomleft,.ewr-selection-resizemarqueehandle-bottomright{bottom:-4px}.ewr-grdcontarea-ltr .ewr-selection-resizemarqueehandle-topleft,.ewr-grdcontarea-ltr .ewr-selection-resizemarqueehandle-bottomright{cursor:nwse-resize}.ewr-grdcontarea-rtl .ewr-selection-resizemarqueehandle-topleft,.ewr-grdcontarea-rtl .ewr-selection-resizemarqueehandle-bottomright{cursor:nesw-resize}.ewr-grdcontarea-ltr .ewr-selection-resizemarqueehandle-bottomleft,.ewr-grdcontarea-ltr .ewr-selection-resizemarqueehandle-topright{cursor:nesw-resize}.ewr-grdcontarea-rtl .ewr-selection-resizemarqueehandle-bottomleft,.ewr-grdcontarea-rtl .ewr-selection-resizemarqueehandle-topright{cursor:nwse-resize}.ewr-grdcontarea-ltr .ewr-selection-resizemarqueehandle-topleft,.ewr-grdcontarea-ltr .ewr-selection-resizemarqueehandle-bottomleft,.ewr-grdcontarea-rtl .ewr-selection-resizemarqueehandle-topright,.ewr-grdcontarea-rtl .ewr-selection-resizemarqueehandle-bottomright{left:-4px}.ewr-grdcontarea-rtl .ewr-selection-resizemarqueehandle-topleft,.ewr-grdcontarea-rtl .ewr-selection-resizemarqueehandle-bottomleft,.ewr-grdcontarea-ltr .ewr-selection-resizemarqueehandle-topright,.ewr-grdcontarea-ltr .ewr-selection-resizemarqueehandle-bottomright{right:-4px}.ewr-marquee-thick{z-index:calc(10 + 1) !important;border-width:3px !important}.ewr-grdcontarea-ltr .ewr-marquee-thick{margin:-3px 0 0 -3px !important}.ewr-grdcontarea-rtl .ewr-marquee-thick{margin:-3px -3px 0 0 !important}.ewr-resizemarqueehandle-thick{height:6px !important;width:6px !important}");
(()=>{tf.a.Ga(A=>{Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Migrate2GridHighlightsBehaviorManager",!1)||Rc.la(A)});tf.a.Ga(A=>{Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Migrate2GridHighlightBehaviorEventManager",!1)||lc.la(A)})})();Type.registerNamespace("Common.App.NewAndOpen.Core");va.a.instance.Tk(new ah);Type.registerNamespace("Common.App.O365Shell");wi.main();ze.a.Dk(".ewa-ttrd-buttonarea{position:absolute;z-index:31}.ewr-table-resize-fillhandle-broader{position:absolute;width:6px;height:3px;bottom:0;background-color:#003960;z-index:17;pointer-events:auto}.ewr-table-resize-fillhandle-higher{position:absolute;width:3px;height:6px;bottom:0;background-color:#003960;z-index:17;pointer-events:auto}.ewr-grdcontarea-ltr .ewr-table-resize-fillhandle-higher{right:-6px}.ewr-grdcontarea-rtl .ewr-table-resize-fillhandle-higher{left:-6px}.ewr-grdcontarea-ltr .ewr-table-resize-handle{cursor:nwse-resize;right:6px;bottom:0}.ewr-grdcontarea-rtl .ewr-table-resize-handle{cursor:nesw-resize;left:6px;bottom:0}.ewr-grdcontarea-ltr .ewr-table-resize-handle .ewr-table-resize-default-cursor{cursor:default}.ewr-grdcontarea-rtl .ewr-table-resize-handle .ewr-table-resize-default-cursor{cursor:default}.ewr-cell-selection-highlight-all.Selecting .ewr-table-resize-handle{cursor:nesw-resize}@media screen and (-ms-high-contrast:active),(forced-colors:active){.ewr-table-resize-fillhandle-higher{forced-color-adjust:none;position:absolute;width:3px;height:6px;bottom:0;background-color:#fff;z-index:17;pointer-events:auto}.ewr-table-resize-fillhandle-broader{forced-color-adjust:none;position:absolute;width:6px;height:3px;bottom:0;background-color:#fff;z-index:17;pointer-events:auto}}@media screen and (-ms-high-contrast:black-on-white),(forced-colors:active) and (prefers-color-scheme:light){.ewr-table-resize-fillhandle-higher{background-color:#000}.ewr-table-resize-fillhandle-broader{background-color:#000}}");
(()=>{tf.a.Ga(A=>{Sb.EwaSettings.isChangeGateEnabled("OfficeVSO:8111699_MigrateTableManager")||A.ga.Qa(134,new Ki(A))})})();(()=>{tf.a.Ga(A=>{Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigrateEwaAccessibilityManager",!1)||qi.la(A)})})();(()=>{tf.a.Ga(A=>{Sb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigrateSessionReloadActivity",!1)||aj.la(A);Ei.la(A)})})();String(c);String(b);String(f);String(t);String(k);String(d);String(h);String(r);String(u);String(v);String(x);
String(m);window.___1689695406659_closurehack=c;window.___1689695406659_closurehack=b;window.___1689695406659_closurehack=f;window.___1689695406659_closurehack=t;window.___1689695406659_closurehack=k;window.___1689695406659_closurehack=d;window.___1689695406659_closurehack=h;window.___1689695406659_closurehack=r;window.___1689695406659_closurehack=u;window.___1689695406659_closurehack=v;window.___1689695406659_closurehack=x;window.___1689695406659_closurehack=m}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.frs.js.map/46845fcc52fbb5d910ca4d96fa5d3433/EwaTS.frs.js.map
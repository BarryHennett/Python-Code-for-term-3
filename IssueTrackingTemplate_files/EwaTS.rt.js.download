'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[46],{1358:function(w,C,a){a.r(C);w=a(0);var b=a(14),c=a(79);class h extends Sys.EventArgs{constructor(){super()}}Object(w.a)(h,"RtcHostNotificationEventArgs",Sys.EventArgs,[]);var k;(function(da){da[da.notYetStarted=0]="notYetStarted";da[da.polling=1]="polling";da[da.subscribed=2]="subscribed";da[da.blocked=3]="blocked";da[da.permanentlyStopped=4]="permanentlyStopped"})(k||(k={}));Object(w.b)("RtcHostNotificationSubscriptionState",
k);var d=a(112);class f extends Sys.EventArgs{constructor(da,ba,na,Y){super();this.fBc=da;this.newState=ba;this.Foj=na;this.Goj=Y}}Object(w.a)(f,"StateChangedEventArgs",Sys.EventArgs,[]);var u=a(105);class r{constructor(da){this.$a=new u.a;this.Uve=new Date;this.phe=da;this.USc=0}get currentState(){return this.phe}get Y0e(){return this.USc}event(da,ba=null){this.currentState!==da&&(this.nWh(this.currentState,da,this.Y0e,ba),this.USc=0,this.Uve=new Date);this.phe=da;this.USc=this.Y0e+1}nWh(da,ba,na,
Y){da=new f(da,ba,na,this.Uve,Y);this.$a.raiseEvent("c",da)}j8b(da){this.$a.addHandler("c",da)}x7f(da){this.$a.removeHandler("c",da)}}Object(w.a)(r,"StateMachine",null,[158]);class t{constructor(da,ba,na,Y,Ga,ma,fa,Xa,Ua){this.$o=!1;this.O4b=this.f2a=this.IS=this.nka=null;this.Osb=t.LOc;this.$a=new u.a;this.mwa=new r(0);this.mwa.j8b(Object(c.a)(this,this.dfj,"onStateMachineChanged"));this.KPg=da;this.z4b=ba;this.JPg=na;this.i0c=Y;this.fg=Ga;this.FW=ma;fa.execute(ka=>{this.$o||(this.f2a=ka,this.f2a.O3a(Object(c.a)(this,
this.Vga,"onUpdateNotificationReceived")),this.start())});Xa.execute(ka=>{this.$o||(this.O4b=ka,ka.Aub(Object(c.a)(this,this.JUa,"onTokenRefreshed")))});this.Qwe=Ua}get Mkb(){return this.mwa.currentState}get ixf(){return!this.FW||this.FW.Ayf}get R9(){return 2===this.Mkb&&this.Qwe()<this.Osb}start(){0!==this.Mkb?b.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",k[this.Mkb]):(this.mwa.event(1),this.D_d(null))}D_d(){this.nka=null;if(this.ixf){b.ULS.sendTraceTag(573100181,
502,50,"HostNotifications: Send event when connected.  Current state: {0}",k[this.Mkb]);let da=null;this.i0c&&this.i0c.length&&(da={},da.etts=this.i0c);this.f2a.Qaa(14,da,!0);this.ncg(this.KPg)}else this.mwa.event(3)}ncg(da){this.nka=d.a.kdc(1E3*da,Object(c.a)(this,this.D_d,"sendSubscribeEvent"),this.z4b,192,"RtcHostNotificationSubscribe");this.fg.Sh(this.nka)}YKj(da){da=1E3*(da+this.JPg);const ba=this.Qwe().getTime()+da;this.Osb=new Date(ba);da-=this.z4b;this.IS?this.fg.Ura(this.IS,da):(this.IS=
d.a.kdc(da,Object(c.a)(this,this.zbk,"transitionToPollingEvent"),this.z4b/2,194,"RtcHostNotificationTransitionToPolling"),this.fg.Sh(this.IS))}zbk(){this.IS=null;2===this.Mkb&&(this.mwa.event(1),b.ULS.shipAssertTag(573100185,502,!!this.nka,"Missing task to ensure that we re-subscribe."))}JUa(){this.Dmi()}Dmi(){3===this.Mkb&&this.ixf&&(this.mwa.event(this.R9?2:1),this.D_d(null))}Vga(da,ba){if(13===ba.type&&(da=ba.Aba,b.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",
{["SerializableHostNotificationSubscription"]:da,["DurationBeforeExpirationToResubscribeInSec"]:this.z4b}),ba=da.cts,!this.Pdk(ba))){if(da.sb){var na=2;this.YKj(da.cts)}else na=1,this.Osb=t.LOc,this.IS&&(this.fg.rr(this.IS),this.IS=null);this.mwa.event(na);this.nka?this.fg.Ura(this.nka,1E3*ba):this.ncg(ba)}}Pdk(da){if(!isNaN(da)&&isFinite(da)&&0<da)return!1;this.Kng(!1);return!0}Kng(da){this.nka&&(this.fg.rr(this.nka),this.nka=null);this.IS&&(this.fg.rr(this.IS),this.IS=null);this.f2a&&(this.f2a.MRb(Object(c.a)(this,
this.Vga,"onUpdateNotificationReceived")),this.f2a=null);this.O4b&&(this.O4b.sDc(Object(c.a)(this,this.JUa,"onTokenRefreshed")),this.O4b=null);da||this.mwa.event(4)}dfj(da,ba){da=ba.newState;const na=ba.fBc,Y={};Y.NewState=k[da];Y.PreviousState=k[na];Y.PreviousStateHits=ba.Foj;Y.PreviousStateTransitionTime=ba.Goj.toISOString();Y.IsSubscribed=this.R9;this.Osb!==t.LOc&&(Y.SubscriptionExpiringTime=this.Osb.toISOString());b.ULS.sendTraceTag(572346515,502,4===da?15:50,"HostNotificationChanged: {0}",Y);
this.$a.raiseEvent("HN",new h(na,da))}dispose(){this.$o||(this.$o=!0,this.Kng(!0),this.IS&&(this.fg.rr(this.IS),this.IS=null))}}t.LOc=new Date(0);Object(w.a)(t,"RtcHostNotificationSubscriptionManager",null,[503,5]);var v=a(5),x=a(261),m=a(663),l=a(84);class n{constructor(){this.Rz=this.$o=!1}get name(){return"RtcHostNotificationSubscription"}Xj(da){da.register(t,"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").Ee().Le(()=>
{const ba=v.AFrameworkApplication.da;return new t(ba.Hf("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),ba.Hf("RtcHostNotificationRetryIntervalBufferInSeconds",120),ba.Hf("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.agi(ba),v.AFrameworkApplication.Vj,m.SessionStatusManager.instance,da.Qd("Common.IRealtimeChannelBasic"),da.Qd("Common.ISessionExpirationManager"),()=>new Date)})}init(){v.AFrameworkApplication.da.qx(()=>{!this.$o&&v.AFrameworkApplication.da.pa("RtcHostNotificationEnabled")&&
(this.Rz=!0,l.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.$o||(this.$o=!0,this.Rz&&l.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}agi(da){return da.Ur("RtcEventTypesToSubscribe")?da.ay("RtcEventTypesToSubscribe"):null}static main(){x.a.instance.Tk(new n)}}Object(w.a)(n,"RtcHostNotificationSubscriptionPackage",null,[2,3]);var z=a(116),y=a(27);class B{constructor(da,
ba){this.Na=da;this.F1a=ba}tj(){this.Na.ae(y.a.xBf,z.a.frame,Object(c.a)(this,this.yBf,"livePersonaCardActionHandler"))}KLc(){this.Na.FC(y.a.xBf,z.a.frame,Object(c.a)(this,this.yBf,"livePersonaCardActionHandler"))}yBf(da,ba,na,Y,Ga){if(!Ga||3===na)return 2;if(1===na)return this.f3a(this.F1a.lLe(Ga.upn||Ga.aadObjectId));if(!this.GGh(Ga))return 8;switch(Ga.action){case 0:return this.f3a(this.F1a.IUg(Ga));case 1:return this.f3a(this.F1a.HUg(Ga));case 2:return this.f3a(this.F1a.JUg(Ga));case 3:return this.f3a(this.F1a.openCard(Ga));
case 4:return this.f3a(this.F1a.Yyj(Ga));default:return 2}}GGh(da){const ba=da.upn||da.aadObjectId;return da.targetElement&&(4===da.action||ba&&""!==ba)?!0:!1}f3a(da){return da?32:8}}Object(w.a)(B,"LivePersonaCardActor",null,[]);var G=a(179),E=a(138);class J{}Object(w.a)(J,"BootstrapperConfig",null,[]);class I{}Object(w.a)(I,"LivePersonaCardInitializerResult",null,[]);class R{}R.VIe=null;Object(w.a)(R,"LivePersonaCardModule",null,[]);var X=a(567);class H{constructor(da,ba,na,Y=null){this.Gm=new G.a;
this.PNg=da;this.IMg=ba;this.Oa=na;this.rpb=Y}init(){this.avf()?this.PNg.AQi().continueWith(Object(c.a)(this,this.Zbj,"onPackageLoaded")):this.Gm.setResult(Object.assign(new I,{isInitialized:!1,isEnabled:!1,failureMessage:"LivePersonaCard is not enabled."}));return this.Gm.task}Zbj(){const da=R.VIe;if(da){const ba=this.X2h();try{da.initializeLivePersonaCardAsync(ba).then(()=>{this.Gm.setResult(Object.assign(new I,{isInitialized:!0,isEnabled:!0}))}).catch(na=>{const Y=Object(E.a)(String,na);Y?this.Gm.setException(Error.create(Y)):
this.Gm.setException(Error.create(JSON.stringify(na)))})}catch(na){this.Gm.setException(na)}}else this.Gm.setResult(Object.assign(new I,{isInitialized:!1,isEnabled:!0,failureMessage:"LivePersonaCardBootstrapper package is not loaded."}))}X2h(){const da=X.a.pN(v.AFrameworkApplication.lcid);return Object.assign(new J,{culture:da?da.name.toLocaleLowerCase():"en-us",clientType:this.Oa.Sa("LivePersonaCardClientType"),clientContextType:"Generic",clientCorrelationId:v.AFrameworkApplication.userSessionId,
complianceEnvironment:this.T4h(),logMessage:Object(c.a)(this,this.logMessage,"logMessage"),getAuthToken:Object(c.a)(this,this.getAuthToken,"getAuthToken")})}avf(){if(!this.Oa.pa("LivePersonaCardIsEnabled")||!this.g3g())return!1;const da=this.Oa.Sa("SovereignEnvironmentName");return da&&""!==da?da.toLocaleLowerCase()==="USGov".toLocaleLowerCase()||da.toLocaleLowerCase()==="Blackforest".toLocaleLowerCase()?!0:!1:!0}g3g(){return this.Oa.pa("CoauthorGalleryLivePersonaCardIsEnabled")||!!v.AFrameworkApplication.sa&&
v.AFrameworkApplication.sa.Ra.iYa}T4h(){return this.Oa.Sa("LivePersonaCardComplianceEnvironment")}logMessage(da,ba,na){da=JSON.stringify({["Log Type"]:da,["Log Result Type"]:ba,["Message"]:na});b.ULS.sendTraceTag(50431106,3006,50,da)}getAuthToken(da,ba){v.AFrameworkApplication.da.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.LokiFutureObject")?this.rpb.continueWith(na=>{na.qj||na.Kh?ba("LokiTokenManagerTask is either canceled or faulted.",v.AFrameworkApplication.userSessionId):this.rpb.result.frd().then(Y=>
{Y.isSuccess&&Y.token&&Y.token.length?da(Y.token,v.AFrameworkApplication.userSessionId):ba(Y.errorMessage,v.AFrameworkApplication.userSessionId)}).catch(Y=>b.ULS.sendTraceTag(539617039,3006,10,"Unexpected exception received from GetLokiToken: {0}",JSON.stringify(Y)))}):this.IMg.frd().then(na=>{na.isSuccess&&na.token&&na.token.length?da(na.token,v.AFrameworkApplication.userSessionId):ba(na.errorMessage,v.AFrameworkApplication.userSessionId)}).catch(na=>b.ULS.sendTraceTag(50431107,3006,10,"Unexpected exception received from GetLokiToken: {0}",
JSON.stringify(na)))}}Object(w.a)(H,"LivePersonaCardInitializer",null,[]);class M{}Object(w.a)(M,"Behavior",null,[]);class O{}Object(w.a)(O,"Identifiers",null,[]);class L{}Object(w.a)(L,"LivePersonaCardParameters",null,[]);class S{}Object(w.a)(S,"PersonaInfo",null,[]);class T{constructor(da){this.OKg=da}lLe(da){return this.OKg.avf()&&da&&""!==da?!!window.self.LPC:!1}IUg(da){return this.AXb("addedPersonaToPageV2",da,0)}HUg(da){return this.AXb("addedPersonaToPageV2",da,1)}JUg(da){return this.AXb("addedPersonaToPageV2",
da,2)}openCard(da){return this.AXb("openCard",da)}Yyj(da){return this.AXb("removedPersonaFromPage",da)}vdh(da){return!!da.targetElement&&(this.lLe(da.upn||da.aadObjectId)||4===da.action)}AXb(da,ba,na=3){if(!this.vdh(ba))return!1;na=4!==ba.action?this.wrh(ba,na):null;const Y=window.self.LPC;if(Y&&Y[da]){if(na)Y[da](ba.targetElement,na);else Y[da](ba.targetElement);return!0}return!1}wrh(da,ba=3){const na=Object.assign(new O,{PersonaType:"User",Upn:da.upn,AadObjectId:da.aadObjectId});return Object.assign(new L,
{personaInfo:Object.assign(new S,{identifiers:na,displayName:da.name,personaCoinColor:da.color}),behavior:Object.assign(new M,{onCardOpen:()=>{b.ULS.sendTraceTag(595067869,3006,100,"LivePersonaCard opened");if(da.onCardOpen)da.onCardOpen()},onCardClose:da.onCardClose,disableClick:2===ba||3===ba,disableHover:0===ba||3===ba})})}}Object(w.a)(T,"LivePersonaCardManager",null,[]);class V{constructor(da){this.cQg=da}AQi(){const da=v.AFrameworkApplication.qV("midgardbootstrapper.js",5);return this.cQg.kGd(da).continueWith(()=>
{R.VIe=window.self.MidgardBootstrapper})}}Object(w.a)(V,"LivePersonaCardPackageLoader",null,[691]);var la=a(528);class Z{constructor(){this.hd=null}get name(){return"Common.App.LivePersonaCard"}init(){v.AFrameworkApplication.da&&v.AFrameworkApplication.da.qx(Object(c.a)(this,this.iE,"onFullAppSettingsReady"))}dispose(){}Xj(da){this.hd=da}iE(){let da;da=v.AFrameworkApplication.da.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.LokiFutureObject")?new H(new V(this.hd.resolve("Common.ISharedDependencyLoader")),
null,v.AFrameworkApplication.da,la.a.ar(this.hd.Qd("Common.ILokiTokenManager"))):new H(new V(this.hd.resolve("Common.ISharedDependencyLoader")),this.hd.resolve("Common.ILokiTokenManager"),v.AFrameworkApplication.da);da.init().continueWith(ba=>{ba.Kh&&ba.exception?b.ULS.sendTraceTag(50431108,3006,15,"Failed to initialize LivePersonaCard, exception: [{0}]",ba.exception.message):((ba=ba.result)||b.ULS.sendTraceTag(595067868,3006,15,"LivePersonaCardInitializer did not return a result"),ba.isInitialized?
b.ULS.sendTraceTag(50431109,3006,100,"Successfully initialized LivePersonaCard"):b.ULS.sendTraceTag(595067867,3006,ba.isEnabled?15:100,"Failed to initialize LivePersonaCard, failure message: [{0}]",ba.failureMessage))});(new B(v.AFrameworkApplication.Dd,new T(da))).tj()}static main(){x.a.instance.Tk(new Z)}}Object(w.a)(Z,"LivePersonaCardPackage",null,[2,3]);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");n.main();Type.registerNamespace("Common.App.LivePersonaCard.Contracts");
Type.registerNamespace("Common.App.LivePersonaCard");Z.main();Type.registerNamespace("AppRealtimeChannel")}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.rt.js.map/057fa7725dc4b62b46af343909cfb0ae/EwaTS.rt.js.map
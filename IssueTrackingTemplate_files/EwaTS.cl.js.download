'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[8],{1007:function(w,C,a){w=a(0);class b{constructor(){this.Pfe=this.ERc=!1;this.callback=null}ifb(h){this.callback=h;this.Qrg()}YFf(h){this.ERc||(this.ERc=!0,this.eHg=h,this.Qrg())}Qrg(){this.ERc&&this.callback&&!this.Pfe&&(this.Pfe=!0,this.callback(this.eHg))}}Object(w.a)(b,"CompletionTask",null,[]);a.d(C,"a",function(){return c});class c{constructor(){this.Hpe=new b;this.Fpe=new b}nyc(h){this.Hpe.ifb(h)}myc(h){this.Fpe.ifb(h)}MLb(h){this.Hpe.YFf(h)}ICa(h){this.Fpe.YFf(h)}AId(){this.MLb(2);
this.ICa(2)}}Object(w.a)(c,"MessageStatus",null,[975])},1040:function(w,C,a){a.r(C);a.d(C,"MaxOutstandingThrottler",function(){return k});w=a(0);var b=a(79),c=a(105);C=a(1041);var h=a(1007);class k extends C.a{constructor(d,f=""){super(d,f);this.jeb=this.gGa=0;this.$a=new c.a;this.o1a=!1;this.i3b=this.Q_b=this.E_b=this.h2c=0;this.S5b=[];this.clearTimeout=k.sgd}add(d){this.p1a||this.init(k.kWe,k.aWe);this.oKa++;const f=new h.a;this.Sbb?this.YGc(d,f):this.i3b<this.jeb?this.ATb(d,f):(this.YGc(d,f),this.o1a=
!1);return f}ATb(d,f){d=this.Nue(d);const u=this.setTimeout(Object(b.a)(this,this.gbj,"onMessageWaitTimeExpired"),this.gGa);++this.i3b;Array.add(this.S5b,u);const r=this.E_b;d.nyc(t=>{f.MLb(t)});d.myc(t=>{this.E_b===r&&(this.fbj(r,u),f.ICa(t))})}fbj(d,f){this.E_b===d&&(--this.i3b,this.clearTimeout(f),Array.remove(this.S5b,f),this.Sbb&&this.FNj())}FNj(){this.Sbb&&!this.o1a&&(this.h2c=this.setTimeout(Object(b.a)(this,this.GNj,"sendThrottledMessageFromTimer"),0),this.o1a=!0)}GNj(){this.o1a=!1;if(this.Sbb){const d=
this.N5b,f=this.Q2a;this.Bxb(!1);this.ATb(d,f)}}gbj(){++this.Q_b;this.Q_b>Math.floor(this.jeb/2)&&(this.Q_b=-1E9,this.$a.raiseEvent("TMUDM"))}m8b(d){this.$a.addHandler("TMUDM",d)}reset(){this.oKa=this.Zsb=this.Job=this.Q_b=0;++this.E_b;for(const d of this.S5b)this.clearTimeout(d);this.i3b=0;this.S5b=[];this.Bxb(!0);this.o1a&&(this.clearTimeout(this.h2c),this.h2c=0,this.o1a=!1)}init(d,f){this.p1a||(this.gGa=d,this.jeb=f,this.p1a=!0)}static createInstance(d,f=""){return new k(d,f)}static sgd(d){window.clearTimeout(d)}}
k.kWe=15E3;k.aWe=5;Object(w.a)(k,"MaxOutstandingThrottler",C.a,[971,972])},1041:function(w,C,a){a.d(C,"a",function(){return c});w=a(0);var b=a(14);class c{constructor(h,k=""){this.Job=this.Zsb=0;this.fWc=!1;this.Q2a=this.N5b=null;this.p1a=!1;this.Nue=h;this.rqg=k;this.setTimeout=c.Cgd;this.oKa=this.Zsb=this.Job=0}XTd(){0<this.oKa&&0<this.Job&&b.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.rqg,this.Job,this.oKa);0<this.oKa&&0<this.Zsb&&b.ULS.sendTraceTag(36545634,
500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.rqg,this.Zsb,this.oKa)}get Sbb(){return this.fWc}YGc(h,k){this.Zsb++;this.Bxb(!0);this.fWc=!0;this.N5b=h;this.Q2a=k}Bxb(h){this.fWc=!1;this.Q2a&&h&&(this.Job++,this.Q2a.AId());this.Q2a=this.N5b=null}static Cgd(h,k){return window.setTimeout(h,k)}}Object(w.a)(c,"ThrottlerBase",null,[])},1042:function(w,C,a){a.r(C);a.d(C,"MaxRateThrottler",function(){return h});w=a(0);var b=a(79);C=a(1041);var c=a(1007);class h extends C.a{constructor(k,
d=""){super(k,d);this.reb=0;this.pqb=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(k){this.p1a||(this.reb=k,this.p1a=!0)}add(k){this.p1a||this.init(h.RVe);this.oKa++;const d=this.currentTime(),f=new c.a;this.pqb>d&&(this.pqb=d);this.Sbb?(this.Bxb(!0),this.YGc(k,f)):this.pqb+this.reb<=d?this.ATb(k,f):(this.YGc(k,f),this.setTimeout(Object(b.a)(this,this.ENj,"sendThrottledMessage"),this.pqb+this.reb-d));return f}ENj(){if(this.Sbb){const k=this.N5b,d=this.Q2a;this.Bxb(!1);this.ATb(k,
d)}}ATb(k,d){this.pqb=this.currentTime();k=this.Nue(k);k.nyc(f=>{d.MLb(f)});k.myc(f=>{d.ICa(f)})}static createInstance(k,d=""){return new h(k,d)}}h.RVe=200;Object(w.a)(h,"MaxRateThrottler",C.a,[974,972])},1043:function(w,C,a){a.d(C,"a",function(){return b});w=a(0);class b extends Sys.EventArgs{constructor(c,h,k,d){super();this.type=c;this.Aba=h;this.nyh=k;this.gta=d}}Object(w.a)(b,"SendUpdateNotificationEventArgs",Sys.EventArgs,[])},1044:function(w,C,a){a.d(C,"a",function(){return b});w=a(0);class b{}
b.XYd="rr";b.WIj="rd";b.UIj="rbp";b.p_d="sa";Object(w.a)(b,"RtcReconnectParams",null,[])},1045:function(w,C,a){a.d(C,"a",function(){return b});w=a(0);class b{constructor(c,h,k,d){this.oYi=c;this.gGa=h;this.uXi=k;this.tli=d}}Object(w.a)(b,"ThrottlerManagerSettings",null,[])},1175:function(w,C,a){w=a(0);class b extends Sys.EventArgs{constructor(E,J){super();this.newState=E;this.oldState=J}}Object(w.a)(b,"ChangedConnectionStateEventArgs",Sys.EventArgs,[]);class c extends Sys.EventArgs{constructor(E,
J){super();this.Ihh=E;this.gta=J}}Object(w.a)(c,"ClientInfoEventArgs",Sys.EventArgs,[]);class h extends Sys.EventArgs{constructor(E){super();this.presence=E}}Object(w.a)(h,"MyPresenceUpdatedEventArgs",Sys.EventArgs,[]);class k extends Sys.EventArgs{constructor(E){super();this.lbd=E}}Object(w.a)(k,"PersistentStateClearedEventArgs",Sys.EventArgs,[]);class d extends Sys.EventArgs{constructor(E,J){super();this.type=E;this.cM=J}}Object(w.a)(d,"PersistentStateUpdateEventArgs",Sys.EventArgs,[]);var f=a(1243);
class u extends Sys.EventArgs{constructor(E,J=null){super();this.RJ=E;this.vSg=J}get type(){return this.RJ}get Aba(){return this.vSg}}Object(w.a)(u,"UpdateNotificationEventArgs",Sys.EventArgs,[]);class r extends Sys.EventArgs{constructor(){super()}}Object(w.a)(r,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class t extends Sys.EventArgs{constructor(E,J,I,R,X,H){super();this.Dmb=E;this.Gcd=J;this.ilh=I;this.Q5e=X;this.Lad=R;this.stopwatch=H}}Object(w.a)(t,"RefreshAllPersistentStateEventArgs",
Sys.EventArgs,[]);class v extends Sys.EventArgs{constructor(E){super();this.hubConnection=E}}Object(w.a)(v,"RefreshProxyEventArgs",Sys.EventArgs,[]);class x extends Sys.EventArgs{constructor(E,J){super();this.errorMessage=J}}Object(w.a)(x,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class m extends Sys.EventArgs{constructor(E,J,I){super();this.type=E;this.presence=J;this.gta=I}}Object(w.a)(m,"SendPersistentStateEventArgs",Sys.EventArgs,[]);var l=a(1043);class n extends Sys.EventArgs{constructor(){super()}}
Object(w.a)(n,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class z extends Sys.EventArgs{constructor(E){super();this.lbd=E}}Object(w.a)(z,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class y extends Sys.EventArgs{constructor(E,J){super();this.type=E;this.Ekk=J}}Object(w.a)(y,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var B=a(105);a.d(C,"a",function(){return G});class G{constructor(){this.$a=new B.a}zrj(E,J){this.$a.raiseEvent("CSC",new b(E,J))}rsj(E){this.$a.raiseEvent("RP",
new v(E))}EBc(E){this.$a.raiseEvent("RC",E)}tsj(){this.$a.raiseEvent("RMID")}qsj(E,J,I,R,X,H){this.$a.raiseEvent("RPS",new t(E,J,I,R,X,H))}Z1f(E,J){this.$a.raiseEvent("UPSR",new y(E,J))}I1f(E,J){this.$a.raiseEvent("PU",new f.a(E,J))}csj(E){this.$a.raiseEvent("MPU",new h(E))}$Sd(E,J,I,R){this.$a.raiseEvent("SUN",new l.a(E,J,I,R))}Isj(E,J){this.$a.raiseEvent("UNR",new u(E,J))}R1f(E,J,I){this.$a.raiseEvent("SP",new m(E,J,I))}H1f(E,J){this.$a.raiseEvent("PSU",new d(E,J))}ksj(E){this.$a.raiseEvent("PSC",
new k(E))}Xrj(E){this.$a.raiseEvent("IPSC",new k(E))}Jsj(E){this.$a.raiseEvent("UPSC",new z(E))}xsj(E,J){this.$a.raiseEvent("SPC",new n(E,J))}O1f(E,J){this.$a.raiseEvent("RCF",new x(E,J))}Qrj(E){this.$a.raiseEvent("CPSWM",new r(E))}Hsj(E,J){this.$a.raiseEvent("UCI",new c(E,J))}E6(E){this.$a.addHandler("CSC",E)}saa(E){this.$a.removeHandler("CSC",E)}e0g(E){this.$a.addHandler("RP",E)}d0g(E){this.$a.addHandler("RC",E)}i0g(E){this.$a.addHandler("RMID",E)}c0g(E){this.$a.addHandler("RPS",E)}Y0g(E){this.$a.addHandler("UPSR",
E)}M3a(E){this.$a.addHandler("PU",E)}CWa(E){this.$a.removeHandler("PU",E)}PZg(E){this.$a.addHandler("IPU",E)}W0g(E){this.$a.addHandler("UCI",E)}z0g(E){this.$a.addHandler("SUN",E)}QZg(E){this.$a.addHandler("IUNR",E)}O3a(E){this.$a.addHandler("UNR",E)}MRb(E){this.$a.removeHandler("UNR",E)}d8b(E){this.$a.addHandler("PSU",E)}wDc(E){this.$a.removeHandler("PSU",E)}OZg(E){this.$a.addHandler("IPSU",E)}NZg(E){this.$a.addHandler("IPSC",E)}X0g(E){this.$a.addHandler("UPSC",E)}y0g(E){this.$a.addHandler("SP",E)}B0g(E){this.$a.addHandler("SPC",
E)}static getInstance(){return G.La||(G.La=new G)}}G.La=null;Object(w.a)(G,"RtcEventHub",null,[903])},1179:function(w,C,a){a.r(C);w=a(0);var b=a(14),c=a(79),h=a(198),k=a(931);class d{}d.reb="throttling_messageDelay";d.UIb="enabled";d.gGa="throttling_timeToWaitForResponse";d.jeb="throttling_maxNumberOfOutstandingMessages";d.Mjf="throttling_globalMaxNumberOfOutstandingMessages";d.errorMessage="errorMessage";d.Olg="url";d.iaa="queryString";d.yF="connectionString";Object(w.a)(d,"RtcFindSessionOutputFieldNameConstants",
null,[]);var f=a(5),u=a(64),r=a(41),t=a(473),v=a(714),x=a(113),m=a(31),l=a(175);class n{constructor(){this.Njf=this.qGf=this.rGf=this.yGf=0;this.$rc=!1;this.correlationId=this.yF=this.iaa=this.Hcd=this.errorMessage=null}get pkh(){return this.Hcd+"?"+this.iaa}}Object(w.a)(n,"FindSessionResponse",null,[]);class z{}z.clientId="ClientId";z.clk="UserApp";z.userSessionId="usid";z.userType="UserType";z.vlk="UserVersion";z.lQb="qs";z.Mhh="clientProtocol";z.m0i="NoAuth";Object(w.a)(z,"RtcFindSessionInputQueryParamConstants",
null,[]);class y{constructor(O,L,S,T,V,la){this.NJa=null;const {FindSessionStrategy:Z}=a(1179);this.MOg=O;O=String.format("{0}={1}",z.clientId,m.a.$g(T));O=String.format("{0}&{1}={2}",O,z.userSessionId,m.a.$g(V));O=String.format("{0}&{1}={2}",O,z.clk,m.a.$g(S.toString()));O=String.format("{0}&{1}={2}",O,z.userType,m.a.$g("1"));O=String.format("{0}&{1}={2}",O,z.vlk,m.a.$g(L));O=String.format("{0}&{1}={2}",O,z.Mhh,m.a.$g(Z.Khh));(L=y.s2h(S,la))&&(O=String.format("{0}&{1}",O,L));this.jHg=O}g4f(){this.NJa=
this.MOg()}Vnd(){this.NJa&&""!==this.NJa||(this.g4f(),b.ULS.sendTraceTag(575784194,500,this.NJa&&""!==this.NJa?50:15,"Query signature delegate called for refresh returned: {0} ",this.NJa));const O=String.format("{0}={1}",z.lQb,m.a.$g(this.NJa));return String.format("{0}&{1}",O,this.jHg)}static s2h(O,L){return 4===O?String.format("{0}={1}",z.m0i,"1"):L?L.aki():null}}Object(w.a)(y,"FindSessionQueryStringGenerator",null,[]);var B=a(788),G=a(930),E=a(756),J=a(1045);class I{}I.VVh="FSType";Object(w.a)(I,
"RtcFindSessionRequestHeaders",null,[]);class R{}R.iuj="polling";Object(w.a)(R,"RtcFindSessionTypes",null,[]);var X=a(1044);class H{}H.Ymk="RTC-TokenProofkey";H.sMi="RTC-IsWacJsBootFsRequest";Object(w.a)(H,"RtcRequestHeaders",null,[]);a.d(C,"FindSessionStrategy",function(){return M});class M{constructor(O,L,S,T,V,la,Z,da,ba,na,Y,Ga,ma=null){this.$ne=(new Date(0)).getTime();this.ipe=0;this.L2b=!1;this.Sue=null;this.fUd=36E5;this.m0a=M.Apf;this.Uob=0;this.QWa=null;this.Tha=0;this.Wib=this.AQe=null;
this.qPg=[d.UIb,d.errorMessage,d.Olg,d.yF,d.iaa,d.Mjf,d.jeb,d.gGa,d.reb];this.pPg=[d.UIb,d.errorMessage];this.yF=this.JTa=null;this.Dje=new y(Y?Y:()=>f.AFrameworkApplication.Ak,V,la,Z,O,L);this.Cnb=Ga;this.Hj=T;this.Qi=L;this.kJg=S;this.Wm=da;this.ej=ba;this.dpb=ma;this.Eje=!1;this.xic=9E4;na&&na.execute(fa=>{fa.Aub(()=>{b.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.Wm);this.Dje.g4f()})});2>=100*Math.random()&&(this.fUd=3E5);B.FrequentLoggingMetrics.instance&&
(B.FrequentLoggingMetrics.instance.F9e=this.fUd)}nTj(O){this.Wib=O}init(){this.ej.i0g(Object(c.a)(this,this.jGj,"resetGetMachineIdDelay"));this.ej.E6(Object(c.a)(this,this.tZ,"onConnectionStateChanged"))}tZ(O,L){this.Tha=L.newState;2===L.newState&&(this.Uob=0)}Tcf(){let O;O=this.QWa.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.QWa.iaa,M.KRe,m.a.$g(O)),correlationId:O}}Tfi(O,L,S,T,V){this.ZMj(()=>{T(V,"GetMachineIdSuccess")&&(b.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",
this.yF,this.Wm),O(this.Sue),S(this.Mii()))},la=>{T(V,"GetMachineIdFailure")&&(b.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.Wm),L(la))},T,V)}sBh(){this.ONe();this.Qti()}ZMj(O,L,S,T){b.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",this.yF);if(this.yF)O();else{var V=this.Bch();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(O,L,S,T)},V)}}sendFindSessionRequestToServerInternal(O,
L,S,T){S(T,"RequestMachineId")&&(this.$ne=(new Date).getTime(),S=r.a.Of(),this.Ucf(V=>{const la=r.a.Of();this.nXf(V);this.X0d();O();V=r.a.Of()-la;b.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",V)},V=>{const la=r.a.Of();this.ONe();B.FrequentLoggingMetrics.instance&&B.FrequentLoggingMetrics.instance.KA(2,3);L(V);V=r.a.Of()-la;b.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",V)},!1),S=r.a.Of()-S,b.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",
S))}Qti(){this.m0a+=M.Lai;this.m0a=Math.min(this.m0a,M.gXi)}Bch(){var O=(new Date).getTime();O=this.$ne+this.m0a-O;0>O&&(O=0);return O}nXf(O){try{this.QWa=O,this.JTa=O.pkh,this.yF=O.yF,this.AQe=O.iaa,this.Sue=O.Hcd}catch(L){b.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",L.toString())}}ONe(){this.yF=null;this.PNe()}X0d(){this.PNe();this.L2b=!0;this.ipe=window.setTimeout(Object(c.a)(this,this.cwj,"refreshMachineId"),this.fUd)}PNe(){this.L2b&&
(window.clearTimeout(this.ipe),this.L2b=!1)}cwj(){this.L2b=!1;this.Ucf(O=>{const L=this.AQe!==O.iaa,S=this.yF!==O.yF,T=this.yF;this.nXf(O);0!==this.Tha&&(S?(b.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",T||"null",O.yF),this.ej.EBc()):(this.ej.xsj(L,S),this.X0d()))},()=>{B.FrequentLoggingMetrics.instance&&B.FrequentLoggingMetrics.instance.KA(2,3);this.X0d()},!0)}jGj(){this.m0a=M.Apf}Mii(){return new J.a(this.QWa.yGf,this.QWa.rGf,this.QWa.qGf,
this.QWa.Njf)}Ibk(O){if(Object.getType(O)!==Object)return null;for(let L in O);return this.pqh(O)}pqh(O){if(!(d.UIb in O))return null;const L=O[d.UIb];var S=L?this.qPg:this.pPg;for(const T of S)if(!(T in O))return null;S=Object.assign(new n,{$rc:O[d.UIb],errorMessage:O[d.errorMessage],correlationId:l.a.create().toString()});L&&(S.Hcd=O[d.Olg],S.iaa=O[d.iaa],S.yF=O[d.yF],S.Njf=O[d.Mjf],S.qGf=O[d.jeb],S.rGf=O[d.gGa],S.yGf=O[d.reb]);return S}k8h(O,L){b.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");
this.dpb.TVh.continueWith(()=>{this.dpb.TVh.result?(b.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),O(this.dpb.UVh)):(b.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),L(this.dpb.UVh))})}s9f(O,L,S,T,V=!1){return la=>{G.a.instance.GQb(0,1);O&&O.stop();this.Cnb=this.Wib=null;this.vDf(la.data,!0,L);var Z=E.RtcUtils.deserialize(la.data.Tf,"FindSession",null);if(Z)if(Z=this.Ibk(Z)){if(Z.$rc&&Z.iaa&&Z.yF){b.ULS.sendTraceTag(4317446,
500,50,"Successfully retrieved MachineId from server for [{0}]",this.Wm);this.aSi(la.data);S(Z);return}L.FindSessionFailureReason="FindSessionInvalidResponse";L.IsRtcEnabled=Z.$rc;L.IsQueryStringEmpty=!Z.iaa;L.IsConnectionStringEmpty=!Z.yF;b.ULS.sendTraceTag(4290720,500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",this.Wm,Z.$rc,!Z.iaa,!Z.yF)}else L.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",
b.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.Wm);else L.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",b.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",this.Wm);this.P1f(L,V);T(null)}}m9f(O,L,S,T=!1){return V=>{G.a.instance.GQb(0,1);O&&O.stop();this.Cnb=this.Wib=null;this.vDf(V.data,!1,L);let la=null;var Z="unknown";let da="unknown";V.data&&((Z=V.data.responseHeaders)&&M.RSb in
Z&&(la=Z[M.RSb].toString()),Z=v.a[V.data.status],da=V.data.httpStatus.toString());L.FindSessionFailureReason="FindSessionRequestFailed";L.HttpErrorCode=da;L.HttpErrorStatus=Z;L[M.RSb]=la;b.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",Z,da,this.Wm,la,T);this.P1f(L,T);S(da)}}Ucf(O,L,S=!1){let T=null;b.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.Wm);const V={};var la=
this.Dje.Vnd();V[t.a.lK]=l.a.create().toString();this.Wib&&""!==this.Wib?la=String.format("{0}&{1}={2}",la,X.a.XYd,this.Wib):this.Cnb&&""!==this.Cnb&&(la=String.format("{0}&{1}={2}",la,X.a.XYd,this.Cnb),V[H.Ymk]="True",V[H.sMi]="True");la=this.kJg+"?"+la;S&&(V[I.VVh]=R.iuj);const Z={};Z.IsNetworkOfflineBeforeSendRequest=this.Qi.Xbb;Z.HasAvailableConnectionsBeforeSendRequest=this.Qi.Klf;Z.MaxConnectionsAllowed=this.Qi.uvc;Z.IsRefreshMachineId=S;this.dpb&&!this.Eje?(this.k8h(this.s9f(null,Z,O,L,S),
this.m9f(null,Z,L,S)),this.Eje=!0):(this.Hj&&(T=this.Hj.Ze("WebServiceCall","GetMachineIdFromTheServer")),B.FrequentLoggingMetrics.instance&&B.FrequentLoggingMetrics.instance.KA(2,0),0>this.Qi.D6(la,1,null,V,[M.Hcc,M.RSb,M.gNb,M.WYd,M.UHf,M.kKf,M.jKf],!1,1,this.s9f(T,Z,O,L,S),this.m9f(T,Z,L,S),null,null,!1,null,this.xic,"3",null,!0)&&(5<this.Uob&&200>this.Uob&&b.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",
this.Uob),window.setTimeout(()=>{this.Uob++;L("-1")},1E3)))}vDf(O,L,S){S||(S={});S.IsNetworkOfflineAfterRequestComplete=this.Qi.Xbb;S.IsRequestSucceeded=L;O&&(S.EnqueueTime=O.ugc,S.InvokedTime=O.$F,S.CompletedTime=O.q1,O.responseHeaders&&(M.Hcc in O.responseHeaders&&(S.CorrelationId=O.responseHeaders[M.Hcc]),M.gNb in O.responseHeaders&&(S[M.gNb]=O.responseHeaders[M.gNb])));b.ULS.sendTraceTag(38633565,500,L?50:15,E.RtcUtils.Xeb(S))}P1f(O,L){O||(O={});O.ConnectionState=k.a[this.Tha];L||this.ej.O1f(1,
O)}aSi(O){try{var L=!1,S=!1,T=O.responseHeaders,V=u.a.AK(O.request.get_url());if(T&&M.WYd in T){const na=T[M.WYd].toString().toLocaleLowerCase();S="true"===na;L="false"===na}T=!1;const ba=0<=V.toLocaleLowerCase().indexOf("collab");S&&!ba?T=!0:L&&ba&&(T=!0);if(T){L={};L.HostName=V;L.Status=v.a[O.status];L.HttpStatus=O.httpStatus.toString();var la=O.request.get_headers();for(let na in la){var Z=la[na];(V=na)&&0<V.length&&(S=0,Z&&(S=Z.toString().length),L["r_"+V]=S)}if(O.responseHeaders){const na=new h.a;
na.add(M.Hcc);na.add(M.gNb);na.add(M.RSb);na.add(M.kKf);na.add(M.jKf);na.add(M.UHf);M.WWg(L,O.responseHeaders,na)}M.IWg(O.request.get_url(),L);var da=x.a.toJSON(L);b.ULS.sendTraceTag(559437006,500,15,da)}}catch(ba){b.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",ba.toString())}}static createInstance(O,L,S,T,V,la,Z,da,ba,na,Y,Ga=null){return M.irh(O,L,S,T,V,la,Z,da,ba,na,Y,Ga)}static irh(O,L,S,T,V,la,Z,da,ba,na,Y,Ga=null){O=O||l.a.create().toString();O=new M(O,L,S,T,V,
la,Z,da,ba,na,null,Y,Ga);O.init();return O}static WWg(O,L,S){for(let T of S)T in L&&(O[T]=L[T])}static IWg(O,L){if(O){var S=O.indexOf("?");if(-1!==S)for(O=O.substr(S+1).split("&"),S=0;S<O.length;++S){var T=O[S].split("=");if(2===T.length){const V=T[0];if(V&&0<V.length){let la=0;if(T=T[1])la=T.length;L["q_"+V]=la}}}}}}M.Lai=3E3;M.gXi=3E5;M.Khh="1.0";M.Apf=1E3;M.Hcc="X-CorrelationId";M.KRe="corrid";M.RSb="RtcErrorCode";M.gNb="X-OfficeCluster";M.WYd="X-NewEnv";M.UHf="X-MSEdge-Ref";M.jKf="X-OFFICEFD";
M.kKf="X-OfficeFE";Object(w.a)(M,"FindSessionStrategy",null,[956])},1204:function(w,C,a){a.r(C);w=a(0);var b=a(14),c=a(79),h=a(179),k=a(581),d=a(198);class f{constructor(r){this.messageId=r;this.HNj=(new Date).getTime();this.mFd=new d.a}}Object(w.a)(f,"MessageLatencyDetails",null,[]);a.d(C,"ClientToClientMessageTelemetry",function(){return u});class u{constructor(r,t,v){this.tca=null;this.RXc=this.E0c=0;this.tg=t;this.Ipe=v;this.ssb=!1;this.ej=r;this.ej.O3a(Object(c.a)(this,this.Nuj,"receiveMessage"))}start(){if(this.Ipe&&
!this.ssb){const r=this.tg.Pag;this.RXc=this.tg.Mag;r<=this.RXc?(b.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",this.tg.Pag,this.tg.Mag),this.Ipe=!1):(this.ssb=!0,this.E0c=window.setInterval(Object(c.a)(this,this.sendMessage,"sendMessage"),r))}}sendMessage(){if(this.ssb){const r=k.a.create().toString();this.tca=new f(r);this.ej.$Sd(16,
r,!1,new h.a);window.setTimeout(()=>{this.$Si(r)},this.RXc)}}$Si(r){this.tca&&this.tca.messageId===r&&(0<this.tca.mFd.count?(r=this.tca.mFd.toArray().join(","),b.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",r)):b.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),this.tca=null)}stop(){this.E0c&&(window.clearInterval(this.E0c),this.ssb=!1)}Nuj(r,t){16===t.type?this.ej.$Sd(17,t.Aba,!1,new h.a):17===t.type&&this.ssb&&t.Aba&&this.rpj(t.Aba)}rpj(r){r&&this.tca&&
r.toString()===this.tca.messageId&&(r=(new Date).getTime()-this.tca.HNj,this.tca.mFd.add(r))}static get instance(){return u.La}static Drd(r,t,v){return u.instance||(u.La=new u(r,t,v))}}u.La=null;Object(w.a)(u,"ClientToClientMessageTelemetry",null,[])},1242:function(w,C,a){a.r(C);a.d(C,"RealtimeChannelMetrics",function(){return d});w=a(0);var b=a(14),c=a(217),h=a(113),k=a(756);class d{constructor(){this.Iqe=this.Jqe=this.Kqe=this.Gqe=this.Fqe=this.Hqe=this.irb=this.SYc=0;this.gca=this.nXc=this.rqb=
this.iXc=this.Pja=this.$Wc=this.uva=this.lqb=this.x1a=this.ZWc=this.V0b=this.L0a=null;this.$Xc=this.Rqb=this.Pue=this.rge=0;this.Jpe=!1;this.r3f=this.OTd;this.u3f=this.RTd;this.t3f=this.QTd;this.y3f=this.TTd;this.x3f=this.STd;this.YTd=this.ZTd;this.HQb=this.WTd;this.$Va=this.UTd;this.aWa=this.VTd;this.s3f=this.PTd;this.Feb=this.nKd;this.HMb=this.pKd}OTd(){this.SYc++;this.ZWc=new Date;this.L0a||(this.L0a=new Date)}RTd(){this.irb++;this.uva=new Date;this.V0b||(this.V0b=this.uva);this.rqb=this.uva;this.Akh()}QTd(){this.Hqe++;
this.$Wc=new Date}TTd(){this.Fqe++;this.x1a=new Date}STd(){this.Gqe++;this.lqb=new Date}WTd(){this.Pja=new Date;this.Kqe++}VTd(){this.gca||(this.gca=new Date);this.Jqe++}UTd(){this.iXc=new Date;this.Iqe++}ZTd(){!this.Jpe&&this.SYc&&(b.ULS.sendTraceTag(39321871,500,15,h.a.toJSON(this.Pih())),this.Jpe=!0)}PTd(f){const {fof:u,hof:r,exception:t}=k.RtcUtils.hTh(f);u&&u!==c.a.PE&&(b.ULS.sendTraceTag(40157596,500,15,h.a.toJSON({["HttpErrorCode"]:u,["HttpErrorStatus"]:r,["Exception"]:t})),c.a.msf(u)&&this.rge++,
c.a.gxf(u)&&this.Pue++)}nKd(){this.nXc=new Date}pKd(){this.x1a=this.rqb=new Date}Pih(){return{["numberOfConnectionAttempts"]:this.SYc,["numberOfSuccessfulConnections"]:this.irb,["numberOfFailedConnections"]:this.Hqe,["numberOfDisconnectedConnections"]:this.Fqe,["numberOfExplicitDisconnectedConnections"]:this.Gqe,["numberOfSentMessages"]:this.Kqe,["numberOfReceivedMessages"]:this.Jqe,["numberOfLostMessages"]:this.Iqe,["firstConnectionAttempt"]:this.L0a?this.L0a:null,["firstMessageReceived"]:this.gca?
this.gca:null,["firstConnectionSuccess"]:this.V0b?this.V0b:null,["lastConnectionAttempt"]:this.ZWc?this.ZWc:null,["lastConnectionSuccess"]:this.uva?this.uva:null,["lastConnectionFailure"]:this.$Wc?this.$Wc:null,["lastMessageSent"]:this.Pja?this.Pja:null,["lastMessageLost"]:this.iXc?this.iXc:null,["lastDisconnect"]:this.x1a?this.x1a:null,["lastExplicitDisconnect"]:this.lqb?this.lqb:null,["lastTimeOnline"]:this.rqb?this.rqb:null,["lastTimeOffline"]:this.nXc?this.nXc:null,["maxDisconnectedTimeMs"]:this.Rqb,
["maxExplicitDisconnectedTimeMs"]:this.$Xc,["clientConnectionErrors"]:this.rge,["serverConnectionErrors"]:this.Pue}}Akh(){this.L0a&&1===this.irb&&(this.Rqb=Math.max(this.Rqb,this.uva.getTime()-this.L0a.getTime()));this.x1a&&1<this.irb&&(this.Rqb=Math.max(this.Rqb,this.uva.getTime()-this.x1a.getTime()));this.lqb&&1<this.irb&&(this.$Xc=Math.max(this.$Xc,this.uva.getTime()-this.lqb.getTime()))}static createInstance(f){d.La||(d.La=new d,b.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",
f));return d.La}}d.La=null;Object(w.a)(d,"RealtimeChannelMetrics",null,[957,95])},1243:function(w,C,a){a.d(C,"a",function(){return b});w=a(0);class b extends Sys.EventArgs{constructor(c,h){super();this.cM=c;this.P7=h}}Object(w.a)(b,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1338:function(w,C,a){a.r(C);var b={};a.r(b);a.d(b,"NamedSheetViewConversionManager",function(){return Pa});var c={};a.r(c);a.d(c,"RealTimeChannelController",function(){return wb});var h={};a.r(h);a.d(h,"PresenceConverter",function(){return za});
var k={};a.r(k);a.d(k,"PresenceTelemetry",function(){return hb});var d=a(0),f=a(79);class u{constructor(Wa,Qb){this.Wva=null;this.Brb=Wa;this.oOg=Qb}init(){this.Brb.continueWith(()=>{this.Wva=this.Brb.result;this.Wva.P3a(Object(f.a)(this,this.bR,"onUsersUpdated"))})}bR(){u.xGe(this.Wva.Kza())&&(this.Wva.rWd(Object(f.a)(this,this.bR,"onUsersUpdated")),this.oOg.IsRealCoauthSession=!0)}static xGe(Wa){let Qb=null;for(const Lc of Wa)if(Lc)if(Wa=Lc.isAnonymous||!Lc.email?Lc.clientId:Lc.email.toUpperCase(),
!Qb)Qb=Wa;else if(Qb!==Wa)return!0;return!1}}Object(d.a)(u,"CoauthTelemetry",null,[871]);var r=a(14),t=a(179),v=a(138),x=a(5),m;(function(Wa){Wa[Wa.badStatePreventedTelemetry=0]="badStatePreventedTelemetry";Wa[Wa.notImplemented=1]="notImplemented";Wa[Wa.renderHandled=2]="renderHandled";Wa[Wa.renderHandledWithVeto=3]="renderHandledWithVeto"})(m||(m={}));Object(d.b)("CoauthorGalleryTelemetryEndResult",m);var l=a(103),n=a(113),z=a(62);class y{constructor(Wa,Qb,Lc,Ba,qa,gb,Bb,ic,Cc){this.Ure=this.Cge=
this.Sz=null;this.F_a=Wa;this.r5b=new t.a;this.Oa=Lc;this.qRc=Qb;this.nua=Ba;this.aj=qa;this.OZc=gb;this.Rva=Bb;this.pFg=ic;this.Gke=this.Dke=!1;this.Q5b=0;this.zge=1;this.LHa=Cc;this.Mxe=this.Oa.pa("PeoplesWellExtraButtonInfoIsEnabled");this.mua=Object(v.a)(String,x.AFrameworkApplication.Yd.Application)||""}get ong(){return this.r5b.task}init(){z.Task.WAA.call(null,this.Rva,this.qRc,this.OZc).continueWith(()=>{this.Sz=this.Rva.result;this.Cge=this.qRc.result;this.Ure=this.OZc.result;z.Task.WAA.call(null,
this.qRc.result.Ebd,this.OZc.result.LKc).continueWith(()=>{this.zge=this.Cge.Ebd.result;this.Q5b=this.Ure.LKc.result;this.Sz.P3a(Object(f.a)(this,this.kzc,"onUsersUpdatedEventListener"));this.Sz.Kza().length&&this.bR()})})}kzc(){this.bR()}bR(){this.pFg(this.Sz.Kza())?(this.Sz.rWd(Object(f.a)(this,this.kzc,"onUsersUpdatedEventListener")),this.D7i(this.Dke)):this.r5b.uy(1);this.Dke=!0}D7i(Wa){this.Gke?this.ong.continueWith(()=>{r.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",
m[this.ong.result])}):(this.Gke=!0,this.Ipj(0===this.zge&&!Wa))}Ipj(Wa){Wa?this.nua.ik(4,Object(f.a)(this,this.rNd,"onInteractiveReady")):this.r5b.uy(1)}rNd(){const Wa=this.aj.bC("AppInitStatus_interactivityReady");r.ULS.shipAssertTag(42259235,325,!!this.Q5b);const Qb=this.Q5b-Wa,Lc={};Lc.InteractiveTime=Wa;Lc.ReactRenderComplete=this.Q5b;Lc.HadTabSwitch=this.LHa();Lc.IsModernGallery=this.Mxe;r.ULS.sendTraceTag(594883104,325,50,n.a.toJSON(Lc));this.Mxe?(r.ULS.sendTraceTag(42062997,325,15,Qb.toString()),
this.r5b.uy(this.vbe(Qb)?3:2)):r.ULS.sendTraceTag(594883103,325,15,Qb.toString())}vbe(Wa){const Qb=Wa>this.Oa.Hf("CoauthorGalleryTimeToRenderDurationMs",1E4);var Lc="Word"===this.mua;const Ba="PowerPoint"===this.mua;if(this.LHa())return r.ULS.sendTraceTag(50455714,325,50,Qb.toString()),!1;Lc&&l.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);Qb&&(Lc&&l.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",
!1,!0,null),Lc=x.AFrameworkApplication.da.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientCoauthorGalleryRenderLatencyQoSError"),Ba&&Lc&&l.Health.instance.recordQosError("CoauthorGalleryTimeToRenderDurationIsTooLong",["CoauthGalleryExperienceDegraded"],!1,!0,!0,!1,null),r.ULS.sendTraceTag(42062998,325,15,Wa.toString()));return Qb}}Object(d.a)(y,"CoauthorGalleryTelemetry",null,[870]);class B{constructor(Wa){this.Sz=null;this.z_b={};this.H3b={};this.Jpb=null;this.Rva=Wa}xlc(Wa){const Qb=
new t.a;this.init().continueWith(()=>{Wa in this.z_b?Qb.uy(this.z_b[Wa]):this.H3b[Wa]=Qb});return Qb.task}init(){if(this.Jpb)return this.Jpb.task;this.Jpb=new t.a;this.Rva.continueWith(()=>{this.Sz=this.Rva.result;this.Sz.P3a(Object(f.a)(this,this.bR,"onUsersUpdated"));this.iwg();this.Jpb.setResult(null)});return this.Jpb.task}iwg(){const Wa=this.Sz.Kza();Wa.sort(Object(f.a)(this,this.gkh,"comparePresenceUsers"));this.z_b={};for(let Qb=0;Qb<Wa.length&&Wa[Qb]&&Wa[Qb].Ipa;Qb++)this.EWg(this.z_b,Wa[Qb].clientId,
Qb)}EWg(Wa,Qb,Lc){Wa[Qb]=Lc;Qb in this.H3b&&(this.H3b[Qb].uy(Lc),delete this.H3b[Qb])}bR(){this.iwg()}gkh(Wa,Qb){return Wa.Ipa>Qb.Ipa?1:Wa.Ipa<Qb.Ipa?-1:0}}Object(d.a)(B,"CoauthorPositionFinder",null,[869]);var G=a(661),E=a(563),J=a(712),I=a(198),R=a(175);class X{constructor(){this.Nka=null;this.vnb=Array(32)}xor(Wa){if(!Wa)throw Error.argumentNull("Guid argument cannot be null");const Qb=new X,Lc=new Sys.StringBuilder;for(let Ba=0;Ba<Wa.vnb.length;Ba++){const qa=this.vnb[Ba]^Wa.vnb[Ba];Qb.vnb[Ba]=
qa;Lc.append(qa.toString(16));7!==Ba&&11!==Ba&&15!==Ba&&19!==Ba||Lc.append("-")}Qb.Nka=R.a.gea(Lc.toString());return Qb}toString(){return this.Nka.toString()}equals(Wa){if(!Wa)throw Error.argumentNull("Guid argument cannot be null");return this.Nka.equals(Wa.Nka)}static Ind(Wa){if(!Wa)throw Error.argumentNull("String input cannot be null");const Qb=new X;Qb.Nka=R.a.gea(Wa);const Lc=Qb.Nka.toString();let Ba=0;for(let gb=0;gb<Lc.length;gb++){var qa=Wa.charAt(gb);if(X.wFi(qa))qa=X.rri(qa,Wa.charCodeAt(gb)),
Qb.vnb[Ba++]=qa;else if(!X.REi(qa))throw Error.argument("String contains characters not valid in Guids");}return Qb}static wFi(Wa){return"0"<=Wa&&"9">=Wa||"A"<=Wa&&"F">=Wa||"a"<=Wa&&"f">=Wa}static REi(Wa){return"{"===Wa||"}"===Wa||"-"===Wa}static rri(Wa,Qb){if("0"<=Wa&&"9">=Wa)return Qb-48;if("A"<=Wa&&"F">=Wa)return Qb-65+10;if("a"<=Wa&&"f">=Wa)return Qb-97+10;throw Error.argument("Char is not valid hex digit");}}Object(d.a)(X,"Guid",null,[]);class H{constructor(Wa,Qb,Lc,Ba){this.Wva=null;this.Jhe=
this.bqe=!1;this.xoe=0;this.Brb=Wa;this.Q1c=Qb;this.Oa=Lc;this.P1a=Ba;this.$Eg=x.AFrameworkApplication.userNameUnknown||x.AFrameworkApplication.limitedEdit;this.$oe=new G.a(E.a.Fh())}get Dfd(){return this.Oa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1)}init(){this.Brb.continueWith(()=>{this.Wva=this.Brb.result;this.Wva.P3a(Object(f.a)(this,this.bR,"onUsersUpdated"))})}bR(){this.Nih(this.Wva.Kza())}Nih(Wa){var Qb=0;const Lc=new J.a(E.a.Fh());for(const Ba of Wa)if(Ba&&
Ba.isAnonymous){x.AFrameworkApplication.mZ("70eb6120;2gfeb930");if(Lc.kd(Ba.userName))Lc.ma(Ba.userName).add(Ba.clientId);else{let qa;Lc.add(Ba.userName,(qa=new I.a,qa.add(Ba.clientId),qa))}Ba.clientId!==this.P1a?(Qb++,2<=Qb&&!this.bqe&&this.cTi()):!this.Jhe&&this.Dfd&&"Guest"===Ba.userName&&(r.ULS.sendTraceTag(509726851,302,50,"User was assigned 'Guest' name"),this.Jhe=!0)}if(this.Dfd&&this.xoe!==Qb){r.ULS.sendTraceTag(512553562,302,50,"Total guests updated to: {0}",Qb+(this.$Eg?1:0));this.xoe=Qb;
for(const Ba of Lc.keys)2<=Lc.ma(Ba).count&&(Wa=this.Z6h(Lc.ma(Ba)),this.$oe.contains(Wa)||(Qb={},Qb.guestsWithSameName=Lc.ma(Ba).count,Qb.identifier=Wa,r.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected: {0}",Qb),this.$oe.add(Wa)))}}cTi(){r.ULS.sendTraceTag(525112603,302,50,"Multiple guests simultaneously coauthoring");this.bqe=!0;this.Dfd&&this.Q1c&&this.Q1c.continueWith(()=>{window.setTimeout(()=>{this.Q1c.result.logActivity("MultipleGuestsCoauthoring",null)},15E3)})}Z6h(Wa){if(!Wa||
1>=Wa.count)return"";let Qb=X.Ind(Wa.ma(0));for(let Lc=1;Lc<Wa.count;Lc++)Qb=Qb.xor(X.Ind(Wa.ma(Lc)));return Qb.toString()}}Object(d.a)(H,"GuestCoauthTelemetry",null,[]);var M=a(562);class O{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(d.a)(O,"PL",null,[]);var L=a(42);class S{constructor(){this.ct=this.vt=this.d=0}static Rdg(Wa,Qb,Lc){const Ba=new S;Ba.d=Wa;Ba.vt=Qb;Ba.ct=Lc;return L.c(Ba)}}Object(d.a)(S,"VD",null,[]);var T=a(174);class V{constructor(Wa,
Qb,Lc,Ba,qa,gb,Bb,ic,Cc,hd,Pd){this.Xue=!1;this._id=Wa;this.hr=Qb;this.Sve=Lc;this.WO=Ba;this.BYc=qa;this.g2c=gb;this.yKa=Bb;this.fIa=ic;this.FGg=Cc;this.LHa=hd;this.txe=Pd;this.mua=Object(v.a)(String,x.AFrameworkApplication.Yd.Application)||""}veto(Wa){const Qb=[this.BYc,this.g2c];this.txe&&Qb.push(this.Sve);z.Task.WAA.apply(null,Qb).continueWith(()=>{if(this.BYc.result<=this.g2c.result)Wa.uy(!1);else{this.txe&&(this.hr=this.Sve.result);var Lc=this.WO-this.hr,Ba=new O;Ba.id=this._id;Ba.et=this.WO;
Ba.st=this.hr;Ba.d=this.WO-this.hr;Ba.mp=this.BYc.result;Ba.tp=this.g2c.result;Ba.ct=this.q4h(this.FGg);Ba.vc=this.LHa();var qa=L.c(Ba),gb="Word"===this.mua,Bb="PowerPoint"===this.mua;r.ULS.sendTraceTag(42078597,302,15,qa);if(gb){const ic=new Map;ic.set("data",qa);l.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",ic)}Lc>this.yKa.value&&!this.Xue&&!Ba.vc&&(this.Xue=!0,Wa.uy(!0),Ba=Object.assign(new T.a,{inStaging:!0,extendedProperties:new Map}),Ba.extendedProperties.set("data",
qa),gb&&l.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",!1,!0,Ba),Lc<this.fIa.value&&(r.ULS.sendTraceTag(42078598,302,15,S.Rdg(Lc,this.yKa.value,this.fIa.value)),Lc=x.AFrameworkApplication.da.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientThumbnailPresenceRenderLatencyQoSError"),Bb&&Lc&&(Ba.inStaging=!1,l.Health.instance.recordQosError("PresenceRenderDurationIsTooLong",["PresenceExperienceDegraded"],!1,!0,!0,!1,Ba))));Wa.task.isCompleted||
Wa.uy(!1)}})}q4h(Wa){switch(Wa){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(d.a)(V,"PresenceLatencyActivityLogger",null,[]);class la{constructor(Wa,Qb,Lc){this.Zfe=this.yge=this.q_b=this.y_b=this.J_a=0;this._id=Wa;this.yKa=Qb;this.fIa=Lc;this.mua=Object(v.a)(String,x.AFrameworkApplication.Yd.Application)||""}get JDe(){return this.J_a}set JDe(Wa){this.J_a=Wa;this.mad()}get KOe(){return this.y_b}set KOe(Wa){this.y_b=Wa;this.mad()}get SLe(){return this.q_b}set SLe(Wa){this.q_b=
Wa;this.mad()}get LOe(){return 0!==this.yge}get TLe(){return 0!==this.Zfe}mad(){!this.LOe&&this.J_a&&this.y_b&&(this.yge=this.veto(this.y_b,"CoauthGalleryLightupDurationTooLong"));!this.TLe&&this.J_a&&this.q_b&&(this.Zfe=this.veto(this.q_b,"CanvasPresenceLightupDurationTooLong"))}veto(Wa,Qb){const Lc=Wa-this.J_a;var Ba=new O;Ba.id=this._id;Ba.et=Wa;Ba.st=this.J_a;Ba.d=Lc;var qa=L.c(Ba);Wa="Word"===this.mua;Ba="CanvasPresenceLightupDurationTooLong"===Qb?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";
"CanvasPresenceLightupDurationTooLong"===Qb?r.ULS.sendTraceTag(572289499,302,15,qa):r.ULS.sendTraceTag(571524118,302,15,qa);if(Wa){var gb=new Map;gb.set("data",qa);l.Health.instance.recordKpiUsage(Ba,0,"wordcollabrel",gb)}return Lc>this.yKa.value?(gb=Object.assign(new T.a,{inStaging:!0,extendedProperties:new Map}),gb.extendedProperties.set("data",qa),qa=Lc<this.fIa.value,gb.extendedProperties.set("cash",qa?"true":"false"),Wa&&l.Health.instance.recordKpiFailure(Ba,Qb,!1,!0,gb),r.ULS.sendTraceTag(572289500,
302,15,S.Rdg(Lc,this.yKa.value,this.fIa.value)),qa?2:1):3}}Object(d.a)(la,"PresenceLightupLatencyLogger",null,[]);var Z=a(52),da=a(362);class ba{constructor(Wa,Qb,Lc,Ba,qa,gb,Bb,ic=null,Cc=null,hd=null){this.Lse={};this.pRc={};this.Bne=new I.a;this.c_b=this.Kpb=this.Sz=this.gsb=null;this.v1c=this.u1c=0;this.yKa=new M.a(()=>ic.wY("PresenceBootLatencyThreshold",1E4));this.fIa=new M.a(()=>ic.wY("PresenceBootLatencyCutoffThreshold",6E4));this.USg=new M.a(()=>ic.wY("PresenceLightupLatencyThreshold",2E3));
this.JHg=new M.a(()=>ic.wY("PresenceLightupLatencyCutoffThreshold",1E4));this.nua=Ba;this.Oa=ic;this.rOg=qa;this.Bge=Wa;this.gue=Qb;this.Rva=Lc;this.aj=gb;this.P1a=Cc;this.LHa=Bb;this.Jke=hd;this.rQc=!1;this.init()}OFh(Wa,Qb,Lc=null){Lc&&(r.ULS.shipAssertTag(42274970,302,!this.P1a||this.P1a===Lc,"_myClientId is already set and you are trying to update it to something different"),this.P1a=Lc);const Ba=new t.a;this.init().continueWith(()=>{this.xcj(Wa);this.PFh(Ba,Wa,Qb)})}get TJd(){return this.P1a||
"{"+x.AFrameworkApplication.userSessionId+"}"}init(){if(this.Kpb)return this.Kpb.task;this.Kpb=new t.a;this.LHa()&&r.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.Bge.continueWith(()=>{const Wa=this.Bge.result,Qb=Wa.Ebd,Lc=Wa.kZi;Lc.continueWith(()=>{Qb.continueWith(()=>{this.Jke&&this.Jke.addQosPillar("RealTimeCoauth");this.s5j(Qb.result,Lc.result);this.Kpb.setResult(null)})})});this.gue.continueWith(()=>{this.gsb=this.gue.result;this.gsb.E6(Object(f.a)(this,this.Edj,"onRtcConnection"));
this.gsb.O3a(Object(f.a)(this,this.j5i,"onCoauthorBootReceived"))});this.Rva.continueWith(()=>{this.Sz=this.Rva.result;this.Sz.P3a(Object(f.a)(this,this.kzc,"onUsersUpdatedEventListener"));0<this.Sz.Kza().length&&this.bR()});return this.Kpb.task}nbf(){return this.aj.t7(Z.a.YZa)?this.aj.bC(Z.a.YZa):da.a.aT?window.performance.timing.fetchStart:-1}ief(){this.c_b||(this.c_b=new t.a,this.nua.ik(4,()=>{this.c_b.uy(this.aj.bC("AppInitStatus_interactivityReady"))}));return this.c_b.task}Edj(Wa,Qb){if(!this.rQc&&
2===Qb.newState)if(this.ZMc){const Lc=this.ief();Lc.continueWith(()=>{const Ba=Date.now()-Lc.result,qa={};qa.clientId=this.TJd;qa.bootTime=Ba;this.rQc=!0;this.gsb.Qaa(15,qa)})}else Wa=Date.now()-this.nbf(),Qb={},Qb.clientId=this.TJd,Qb.bootTime=Wa,this.rQc=!0,this.gsb.Qaa(15,Qb)}j5i(Wa,Qb){if(15===Qb.type){Wa=Date.now();Qb=Qb.Aba;var Lc=Qb.bootTime;this.ard(Qb.clientId).JDe=Wa-Lc}}kzc(){this.bR()}bR(){const Wa=Date.now();var Qb=this.Sz.Kza();const Lc=new I.a;for(const Ba of Qb)this.Bne.contains(Ba.clientId)||
(this.Bne.add(Ba.clientId),Lc.add(Ba.clientId));if(0<Lc.count)for(const Ba of Lc)Qb=this.ard(Ba),Qb.LOe||(Qb.KOe=Wa)}xcj(Wa){Wa=this.ard(Wa);Wa.TLe||(Wa.SLe=Date.now())}ard(Wa){return Wa in this.pRc?this.pRc[Wa]:this.pRc[Wa]=new la(Wa,this.USg,this.JHg)}s5j(Wa,Qb=0){this.u1c=Wa;this.v1c=Qb?Qb:(new Date).getTime()}PFh(Wa,Qb,Lc){Lc=Lc?Lc.getTime():(new Date).getTime();if(Qb in this.Lse)Wa.aD();else{const Ba=this.ZMc?0:this.Fhi(),qa=this.ZMc?this.Ghi():null;Lc=new V(Qb,Ba,qa,Lc,this.xlc(this.TJd),this.xlc(Qb),
this.yKa,this.fIa,0,this.LHa,this.ZMc);this.Lse[Qb]=Lc;Lc.veto(Wa)}}Fhi(){return 1===this.u1c?this.v1c:this.nbf()}Ghi(){return 1===this.u1c?z.Task.Wa(this.v1c):this.ief()}xlc(Wa){return this.rOg.xlc(Wa)}get ZMc(){return this.Oa.pa("UseAppInteractiveBootTimeForPresenceTelemetry")}}Object(d.a)(ba,"PresenceBootTelemetry",null,[868]);var na=a(144),Y=a(261),Ga=a(173),ma=a(84),fa=a(528);class Xa{get name(){return"Common.App.CoauthTelemetry"}Xj(Wa){Wa.register(u,"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").Ee().Le(()=>
new u(fa.a.ar(Wa.Qd("Common.IPeopleInfoProvider")),x.AFrameworkApplication.Wg));Wa.register(y,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").Ee().Le(()=>new y(x.AFrameworkApplication.Dd,fa.a.ar(Wa.Qd("Common.ICoauthoringTelemeryInfoProvider")),x.AFrameworkApplication.da,na.a.get_instance(),Ga.a.instance,fa.a.ar(Wa.Qd("Common.IPeoplesWell")),fa.a.ar(Wa.Qd("Common.IPeopleInfoProvider")),u.xGe,()=>this.nJe()));Wa.register(ba,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").Ee().Le(()=>
new ba(fa.a.ar(Wa.Qd("Common.ICoauthoringTelemeryInfoProvider")),fa.a.ar(Wa.Qd("Common.IRealtimeChannelBasic")),fa.a.ar(Wa.Qd("Common.IPeopleInfoProvider")),na.a.get_instance(),Wa.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),Ga.a.instance,()=>this.nJe(),x.AFrameworkApplication.da,null,l.Health.instance));Wa.register(B,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").Ee().Le(()=>new B(fa.a.ar(Wa.Qd("Common.IPeopleInfoProvider"))));
Wa.register(H,"Common.App.CoauthTelemetry.GuestCoauthTelemetry").Ee().Le(()=>new H(fa.a.ar(Wa.Qd("Common.IPeopleInfoProvider")),fa.a.ar(Wa.Qd("Common.ISystemInitiatedFeedback")),x.AFrameworkApplication.da,"{"+x.AFrameworkApplication.userSessionId+"}"))}init(){x.AFrameworkApplication.da.qx(()=>{ma.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();ma.a.instance.resolve("Common.App.CoauthTelemetry.GuestCoauthTelemetry").init();x.AFrameworkApplication.da.pa("CoauthorGalleryTelemetryIsEnabled")&&
ma.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();x.AFrameworkApplication.da.pa("CashTelemetryIsEnabled")&&(ma.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),ma.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}nJe(){return da.a.aT&&Ga.a.instance.t7(Z.a.tYb)?0<Ga.a.instance.bC(Z.a.tYb)[Z.a.Nyg]:!1}static main(){Y.a.instance.Tk(new Xa)}}Object(d.a)(Xa,"CoauthTelemetryPackage",null,[2,3]);var Ua=a(731),ka=a(39);class nb{}Object(d.a)(nb,
"NamedSheetViewConversionEntry",null,[]);var Ea=a(8),sb=a(125),Oa=a(34),La=a(1),ia=a(59);const Sa=(Wa,Qb,Lc,Ba,qa,gb=null)=>{gb=Wa.Pa(1,gb);return ia.g(Wa,"GetNamedSheetViewConversion",gb,Qb,Lc,Ba,qa,132)};var Za=a(45),Ab=a(22);const pb=(Wa,Qb)=>!!Wa&&!!Qb&&Wa.SheetName===Qb.SheetName&&(!!Wa.NamedObjectName&&Wa.NamedObjectName===Qb.NamedObjectName||!Wa.NamedObjectName&&!Qb.NamedObjectName&&Za.E(Wa).hf(Za.E(Qb))),Tb=(Wa,Qb,Lc)=>{if(!Qb||!Qb.Ud)return null;for(let Ba=0;Ba<Qb.Ud.count;Ba++){const qa=
Qb.Ud.getItem(Ba);if(qa&&qa.type===Lc&&qa.usedRange&&qa.usedRange.contains(Za.E(Wa))&&Ab.a.equals(qa.sheetName,Wa.SheetName,!0))return qa}return null};var ob=a(15),va=a(137);let Pa=class extends ka.a{constructor(Wa){super();this.G6a=this.Uxa=null;this.cOc=this.Eya=!1;this.Nh=()=>{const Qb=this.$.ea.pp;if(null===Qb||void 0===Qb?0:Qb.SheetChanges)for(const Lc of Qb.SheetChanges)if(2===Lc.Type){if(this.Uxa)for(const Ba of this.Uxa)Ba.Range.SheetName===Lc.Name&&(Ba.Range.SheetName=Lc.NewName);if(this.G6a)for(const Ba of this.G6a)Ba.Range.SheetName===
Lc.Name&&(Ba.Range.SheetName=Lc.NewName)}};this.DPf=()=>{r.ULS.sendTraceTag(537154395,0,50,"NamedSheetViewConversionManager.OnGridLoaded");this.cOc=!1;this.txc(this,Sys.EventArgs.Empty)};this.De=()=>{r.ULS.sendTraceTag(537154394,0,50,"NamedSheetViewConversionManager.OnWorkbookClosing");this.cOc=!0};this.txc=()=>{r.ULS.sendTraceTag(50620166,0,50,`NamedSheetViewConversionManager.OnConversionOutdatedEvent: triggered with version [${this.$.ea.UCa}]`);if(!this.$.isEditMode||!this.$.ea.oe||this.$.ea.$$a||
this.cOc||this.$.ea.UCa===Ea.a.rec)r.ULS.sendTraceTag(537154393,0,50,`NamedSheetViewConversionManager.OnConversionOutdatedEvent: Request skipped [Edit Mode: ${this.$.isEditMode}] [IsSessionActive: ${this.$.ea.oe}] [HasRaisedSessionEnded: ${this.$.ea.$$a}] [WorkbookClosed: ${this.cOc}]`);else{this.G6a=this.Uxa=null;var Qb=this.$.qa.ua.ie();Sa(this.$.qa.ua,this.i9i,this.h9i,null,Qb)}};this.i9i=Qb=>{if(Oa.a.Rr(Qb.Errors)){this.Eya=!0;const Lc=[-1100324317,-1857233882];Oa.a.nj(Qb.Errors,Lc)&&r.ULS.sendTraceTag(537154392,
0,10,`NamedSheetViewConversionManager.OnGetNamedSheetViewConversionSuccess Errors: [${Oa.a.ue(Qb.Errors)}]`);Qb=Oa.a.uE(Qb.Errors,Lc,"NamedSheetViewConversionManager:OnGetNamedSheetViewConversionSuccess");this.$.ea.Yp(Qb)}else this.Eya=!1,Qb=Qb.Result,this.$.ea.UCa=Qb.ConversionVersion,this.hpj(Qb.NamedSheetViewConversionEntries),this.Brj()};this.h9i=Qb=>{this.Eya=!0;Qb=sb.a.Lg(Qb.data);let Lc=!1;La.EwaSettings.isChangeGateEnabled("OfficeVSO:6401332_RefreshTokenException")&&Qb.forEach(Ba=>{-1537615947===
Ba.MessageId&&(Lc=!0)});Lc?r.ULS.sendTraceTag(512274778,0,50,`NamedSheetViewConversionManager.OnGetNamedSheetViewConversionFailure: Errors: [${Oa.a.ue(Qb)}].`):r.ULS.sendTraceTag(537154391,0,10,`NamedSheetViewConversionManager.OnGetNamedSheetViewConversionFailure: Errors: [${Oa.a.ue(Qb)}].`)};this.$=Wa;r.ULS.shipAssertTag(537154397,0,!!this.$.ea,"NamedSheetViewConversionManager ctor: EwaControl.SessionStateManager should not be null");this.$.gk(this.De);this.$.ea.Q0(this.DPf);this.$.ea.u_g(this.txc);
this.$.ea.Mw(this.Nh);this.$.ea.fy&&this.txc(this,Sys.EventArgs.Empty)}tCe(Wa){this.addHandler("SVCU",Wa)}h7f(Wa){this.removeHandler("SVCU",Wa)}dispose(){this.G6a=this.Uxa=null;this.$&&this.$.Hn(this.De);this.$.ea&&(this.$.ea.l4(this.DPf),this.$.ea.fCj(this.txc),this.$.ea.ny(this.Nh));this.$=null;super.dispose()}Smh(Wa){return this.Eya?null:this.oRe(Wa,this.G6a,"ConvertPresencePublicToPrivate")}Rmh(Wa){return this.Eya?null:this.oRe(Wa,this.Uxa,"ConvertPresencePrivateToPublic")}hpj(Wa){Wa?(this.Gwh(Wa),
this.Uxa=Wa,this.G6a=this.krh(this.Uxa)):r.ULS.sendTraceTag(537154396,0,10,"NamedSheetViewConversionManager.ProcessConversionEntries: conversionEntries can be empty but not null")}Brj(){r.ULS.sendTraceTag(537154390,0,50,"NamedSheetViewConversionManager.RaiseConversionUpdatedEvent: new version is update on client from server");this.raiseEvent("SVCU")}oRe(Wa,Qb,Lc){if(!Qb||!Qb.length)return r.ULS.sendTraceTag(537154389,0,50,`NamedSheetViewConversionManager.${Lc}: skipping convert due to ${Qb?"empty":
"null"} ConversionEntries. `),Wa;for(const Ba of Wa){for(const qa of Qb)!qa.IsRow||!pb(qa.Range,Ba)||Ba.FirstRow<=qa.Range.FirstRow&&Ba.LastRow>=qa.Range.LastRow||(Lc={},Lc.SheetName=Ba.SheetName,Lc.FirstRow=Lc.LastRow=Ba.FirstRow,Lc.FirstColumn=Lc.LastColumn=Ba.FirstColumn,pb(qa.Range,Lc)?(Lc=Ba.FirstRow-qa.Range.FirstRow,0>Lc||Lc>=qa.ConversionMap.length?r.ULS.sendTraceTag(537154388,0,10,`NamedSheetViewConversionManager.ConvertRanges: invalid mapIndex after adjust. Index: [${Lc}], ConversionMap.Length: ${qa.ConversionMap.length}`):
(Lc=qa.ConversionMap[Lc]-Lc,Ba.FirstRow+=Lc,Ba.LastRow=Ba.FirstRow,Ba.LastColumn=Math.min(Ba.LastColumn,qa.Range.LastColumn))):Ba.FirstRow<qa.Range.FirstRow&&Ba.LastRow>=qa.Range.FirstRow?Ba.LastRow=qa.Range.FirstRow-1:Ba.LastColumn>=qa.Range.FirstColumn&&(Ba.LastColumn=qa.Range.FirstColumn-1));if(0>Ba.FirstRow||Ba.FirstRow>Ea.a.UA)Ba.FirstRow=Math.max(Math.min(Ba.FirstRow,Ea.a.UA),0);if(0>Ba.LastRow||Ba.LastRow>Ea.a.UA)Ba.LastRow=Math.max(Math.min(Ba.LastRow,Ea.a.UA),0);if(0>Ba.FirstColumn||Ba.FirstColumn>
Ea.a.lz)Ba.FirstColumn=Math.max(Math.min(Ba.FirstColumn,Ea.a.lz),0);if(0>Ba.LastColumn||Ba.LastColumn>Ea.a.lz)Ba.LastColumn=Math.max(Math.min(Ba.LastColumn,Ea.a.lz),0)}return Wa}krh(Wa){if(!Wa||!Wa.length)return r.ULS.sendTraceTag(537154387,0,50,`NamedSheetViewConversionManager.CreateInverseConversionEntries: skip creating inverse due to ${this.Uxa?"empty":"null"} ConversionEntries. `),Wa;const Qb=Array(Wa.length);for(let Lc=0;Lc<Wa.length;++Lc){const Ba=new nb;Ba.Range=Wa[Lc].Range;Ba.IsRow=Wa[Lc].IsRow;
Ba.ConversionMap=Array(Wa[Lc].ConversionMap.length);Ba.IsRow||(this.Eya=!0,r.ULS.sendTraceTag(537154386,0,10,"NamedSheetViewConversionManager.CreateInverseConversionEntries: adjusting presence against column sort map is NYI."));for(let qa=0;qa<Wa[Lc].ConversionMap.length;++qa)Ba.ConversionMap[Wa[Lc].ConversionMap[qa]]=qa;Qb[Wa.length-Lc-1]=Ba}return Qb}Gwh(Wa){if(Wa&&Wa.length)for(const Qb of Wa)this.Fwh(Qb),Wa=Qb.IsRow?Qb.Range.LastRow-Qb.Range.FirstRow+1:Qb.Range.LastColumn-Qb.Range.FirstColumn+
1,Qb.ConversionMap.length!==Wa&&(r.ULS.shipAssertTag(537154385,0,!1,`NamedSheetViewConversionManager.DecompressEntries: decompressed conversion map doesn't match expected size - Expected: [${Wa}] | Actual: [${Qb.ConversionMap.length}]`),this.Eya=!0)}Fwh(Wa){const Qb=Wa.ConversionMap;if(Qb&&Qb.length)if(0>Qb[0])r.ULS.shipAssertTag(537154384,0,!1,"NamedSheetViewConversionManager.DecompressConversionMap: conversionMap starts with a negative number"),this.Eya=!0;else{var Lc=[];for(let Ba=0;Ba<Qb.length;++Ba)if(0>
Qb[Ba]){const qa=Qb[Ba-1],gb=-1*Qb[Ba];for(let Bb=1;Bb<=gb;++Bb)Lc.push(qa+Bb)}else Lc.push(Qb[Ba]);Wa.ConversionMap=Lc}}};Pa=Object(Ua.a)([Object(va.d)(ob.Nb),Object(Ua.b)(0,Object(ob.W)())],Pa);Object(d.a)(Pa,"NamedSheetViewConversionManager",ka.a,[878,5]);var jb=a(648),Ob=a(801);class kb extends Sys.EventArgs{constructor(Wa){super();this.Ii=Wa}}Object(d.a)(kb,"ConnectionCompletedEventArgs",Sys.EventArgs,[]);var ra=a(91),rb=a(53),Kb=a(38),Sb=a(56),cb=a(55),cc=a(1175),Ub;let wb=Ub=class extends ka.a{constructor(Wa){super();
this.oD=this.Sag=this.acc=null;this.ame=!1;this.S_d=null;this.HHc=!1;this.tZ=(Qb,Lc)=>{if(2===Lc.newState){if(this.Ii){if(La.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const Ba=(new Date).getTime();Kb.TaskExtensions.za(La.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigratePresenceTelemetry",!1)?Object(ra.d)(va.a.resolve(ob.oc,{Ja:1})):rb.GetServiceTaskFactory.ud(this.$.ga,435,436,1),qa=>{qa.result.PTi(Ba)},this.$.ka,3)}this.raiseEvent("connectionCompleted",
new kb(this.Ii),Lc)}else r.ULS.sendTraceTag(537167630,0,15,"RealTimeChannelController.OnConnectionStateChanged: new state is connected and this.RealTimeChannel is null");this.acc=Lc}else if(2===Lc.oldState||0===Lc.newState)this.acc=null,this.raiseEvent("connectionLostEventKey")};this.MUa=()=>{if(this.Ii){const Qb=Object(v.a)(239,this.Ii);Qb&&(r.ULS.sendTraceTag(537167629,0,50,"RealTimeChannelController.OnWorkbookClosed: disconnecting from RTC for clientID {0}",this.$.workbookContext.ClientId),Qb.disconnect(),
Qb.saa(this.tZ))}this.oD=null};this.$=Wa;this.$.gk(this.MUa);this.$.ea.T5c(this.MUa);if(this.HHc=La.EwaSettings.isChangeGateEnabled("OfficeVSO:7654759_PassSessionExpirationManagerToRTC"))this.S_d=jb.a.create();Wa.ga.qd(38,Qb=>{this.HHc&&(this.S_d.instance=Qb);Qb.GCe(this.MUa)})}C3a(Wa){this.addHandler("connectionCompleted",Wa)}$Cc(Wa){this.removeHandler("connectionCompleted",Wa)}O5c(Wa){this.addHandler("rtcInitialized",Wa)}HRb(Wa){this.removeHandler("rtcInitialized",Wa)}JBe(Wa){this.addHandler("connectionLostEventKey",
Wa)}E6f(Wa){this.removeHandler("connectionLostEventKey",Wa)}get Ii(){return this.oD}get yzd(){return this.ame}dispose(){this.Ii&&this.Ii.saa(this.tZ);this.$&&this.$.Hn(this.MUa);this.oD=this.$=null;super.dispose()}aUe(Wa){Kb.TaskExtensions.za(this.hhf().task,Qb=>{Wa(Qb.result)},this.ka)}Bcd(Wa,Qb){this.ame=Qb;this.Oaj(Wa)}GMa(){this.Ii&&(this.raiseEvent("rtcInitialized"),2===this.Ii.connectionState&&this.acc&&this.raiseEvent("connectionCompleted",new kb(this.Ii),this.acc))}HQi(){r.ULS.sendTraceTag(537167633,
0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice");const Wa=(new Date).getTime();Kb.TaskExtensions.za(La.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigratePresenceTelemetry",!1)?Object(ra.d)(va.a.resolve(ob.oc,{Ja:1})):rb.GetServiceTaskFactory.ud(this.$.ga,435,436,1),Ba=>{Ba.result.STi(Wa)},this.$.ka,3);var Qb=[];Qb.push(Sb.a.current.tq(65));Qb.push(Sb.a.current.tq(66));Qb=Sb.a.cGd(Qb,this.$.ka);const Lc=Sb.a.loadScript(9,0,1);return z.Task.MG(Qb,Lc)}Oaj(Wa){const Qb=this.HQi();
Kb.TaskExtensions.za(Qb,()=>{r.ULS.sendTraceTag(537167632,0,50,`RealTimeChannelController.OnLoadRealTimeChannelSlice Before RealtimeChannel create. RealtimeChannel = null: ${void 0===Ob.RealtimeChannel||null===Ob.RealtimeChannel}`);if(La.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const Ba=(new Date).getTime();Kb.TaskExtensions.za(La.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigratePresenceTelemetry",!1)?Object(ra.d)(va.a.resolve(ob.oc,{Ja:1})):
rb.GetServiceTaskFactory.ud(this.$.ga,435,436,1),qa=>{qa.result.TTi(Ba)},this.$.ka,3)}this.oD=Ob.RealtimeChannel.createInstance(Wa,this.$.xa.UserSessionId,x.AFrameworkApplication.Tag,x.AFrameworkApplication.tf,this.HHc?this.S_d:null,2,cb.b().njf(),this.$.workbookContext.RtcEndpointUrl,void 0,new cc.a,void 0,void 0,this.$.workbookContext.RtcBootToken);r.ULS.sendTraceTag(571770432,0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice RealtimeChannel created with clientID {0}",Wa);La.EwaSettings.isChangeGateEnabled("OfficeVSO:8030692_IsEditorsTableNotificationEnabled")&&
(ma.a.instance.register(Ob.RealtimeChannel,"AppRealtimeChannel.RealtimeChannel").as("Common.IRealtimeChannelBasic").as("AppRealtimeChannel.IRealtimeChannel").Ee().Le(()=>this.Ii),ma.a.instance.resolve("Common.IRealtimeChannelBasic"));this.hhf().setResult(this.Ii);if(La.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const Ba=(new Date).getTime();Kb.TaskExtensions.za(La.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigratePresenceTelemetry",!1)?Object(ra.d)(va.a.resolve(ob.oc,
{Ja:1})):rb.GetServiceTaskFactory.ud(this.$.ga,435,436,1),qa=>{qa.result.RTi(this.yzd,Ba)},this.$.ka,3)}this.raiseEvent("rtcInitialized");r.ULS.sendTraceTag(571770403,0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice raise RealTimeChannelInitializedEventKey");const Lc=Object(v.a)(239,this.Ii);Lc&&(r.ULS.sendTraceTag(571770402,0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice attach changed handler"),Lc.E6(this.tZ),Lc.connect())},this.ka,3)}hhf(){return this.Sag||(this.Sag=new t.a)}static la(Wa){Wa.ga.Qa(26,
new Ub(Wa))}};wb=Ub=Object(Ua.a)([Object(va.d)(ob.vc),Object(Ua.b)(0,Object(ob.W)())],wb);Object(d.a)(wb,"RealTimeChannelController",ka.a,[9,10]);var vc=a(10),Lb=a(2),Ja=a(105),Hb=a(112),gc=a(27);class ec{constructor(Wa,Qb,Lc,Ba,qa,gb,Bb,ic,Cc=!1){this.fua=null;this.uTc=!0;this.ZZc=this.Fv=this.cQc=null;this.$a=new Ja.a;this.fNg=Wa;this.h6=Qb;this.wse=Lc;this.tse=Ba;this.gfe=gb;ec.fg=qa;this.COg=Bb;this.Lva=ic;this.aPg=Cc;z.Task.WAA(Qb,Lc).continueWith(Object(f.a)(this,this.Yui,"initOnTaskReady"))}a2f(){this.$a.raiseEvent("u",
null,this)}Yui(){this.h6.result&&this.wse.result&&(this.Fv=this.h6.result,this.ZZc=this.wse.result,this.Fv.M3a(Object(f.a)(this,this.Rqa,"onPresenceUpdated")),this.cQc=new Hb.a(2,2,this.gfe,Object(f.a)(this,this.Egk,"updateAwayClientsTask"),88),ec.fg.Sh(this.cQc))}Rqa(Wa,Qb){(this.uTc||this.Quj(Qb.cM))&&ec.fg.Ura(this.cQc,0)}Quj(Wa){for(const Lc in Wa){var Qb=this.tse.rgf({key:Lc,value:Wa[Lc]});if(Qb&&Qb.clientId&&(Qb=Qb.clientId.toLowerCase(),(Qb=this.fua[Qb]||this.fua[Qb.toUpperCase()])&&2===Qb.status))return!0}return!1}Egk(Wa){var Qb=
this.Fv.T1h();if(Qb){var Lc=new Date,Ba=!1;if(this.uTc){this.fua=Qb;this.uTc=!1;var qa=this.fua;for(var gb in qa){Qb=gb;var Bb=qa[gb];Bb.udb<Lc&&(Lc=Bb.udb);2===Bb.status&&(Ba=!0,this.ZZc.j6f(Qb))}Ba&&this.a2f();ec.fg.Ura(Wa,this.qff(Lc))}else{Bb=new I.a;gb=!1;var ic=this.fua;for(qa in ic){ic=qa;if(!(ic in this.fua)||this.fNg.clientId===ic)continue;var Cc=this.fua[ic];const hd=Qb[ic];if(Cc&&hd){Cc=Cc.status;const Pd=hd.status;2===Cc&&1===Pd?(Bb.add(ic),r.ULS.sendTraceTag(38052609,392,50,ic+" returned from away")):
1===Cc&&2===Pd&&(gb=Ba=!0,this.ZZc.j6f(ic),r.ULS.sendTraceTag(38052610,392,50,ic+" went away"));1===Pd&&hd.udb<Lc&&(Lc=hd.udb)}}this.fua=Qb;ec.fg.Ura(Wa,this.qff(Lc));(0<Bb.count||Ba)&&this.a2f();0<Bb.count&&!this.aPg?(Wa=this.w4h(Bb),this.S$j(Wa)):Wa=new I.a;(gb||0<Wa.count)&&this.COg(gc.a.Dbd,2)}}}S$j(Wa){if(Wa.count)for(const Qb of Wa)Wa=this.Lva.u1(String.format(CommonUIStrings.l_EditorsToastArriving,Qb),!1),Wa.image=5,Wa.N2="CoAuth_AuthorStatus_16x16x32",this.Lva.tD(Wa)}w4h(Wa){const Qb=this.Fv.Gjc(),
Lc=new I.a;for(const Ba in Qb){const qa={key:Ba,value:Qb[Ba]};if(Wa.contains(qa.key)){const gb=this.tse.rgf(qa);gb&&(Lc.add(gb.userName),Wa.remove(qa.key))}}Lc.count||r.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return Lc}qff(Wa){const Qb=new Date;return Math.max(Wa.getTime()+this.gfe-Qb.getTime(),0)}}ec.fg=null;Object(d.a)(ec,"AwayManager",null,[]);var Ta=a(442),ib=a(108),bc=a(304),jc=a(96),sc=a(546);class Fa{static qgf(Wa){return new Ta.a(Wa.User.UserID,Wa.User.UserName,
Wa.UserColor,new sc.a(1),null,Wa.UserEmail,void 0,void 0,void 0,void 0,void 0,Wa.JoinCoauthTime)}}Object(d.a)(Fa,"PresenceHelper",null,[]);class Ha{constructor(Wa){this.Ua=new Ja.a;this.dNc=this.disposed=!1;this.JOb=()=>{r.ULS.sendTraceTag(537154381,0,50,"PeopleInfoProvider.OnUserListUpdated fired");this.Ua.raiseEvent("UU",this)};this.$=Wa;this.$.ea.gda(this.JOb);this.dNc=La.EwaSettings.isChangeGateEnabled("OfficeVSO:7554748_UseIsAnonymousForPresenceUserV2")}dispose(){this.disposed||(this.$&&this.$.ea&&
this.$.ea.yaa(this.JOb),jc.a.Fe([this.Ua]),this.$=this.Ua=null,this.disposed=!0)}P3a(Wa){this.Ua.addHandler("UU",Wa)}rWd(Wa){this.Ua.removeHandler("UU",Wa)}Kza(){const Wa=[];for(const Qb of this.$.ea.Vp)Wa.push(Fa.qgf(Qb));r.ULS.sendTraceTag(537154383,0,50,`PeopleInfoProvider.GetAllUsers: Count: [${Wa.length}]`);return Wa}}Object(d.a)(Ha,"PeopleInfoProvider",null,[902,5]);var Na=a(658);class W{tD(){r.ULS.sendTraceTag(537154380,0,50,"PresenceBootstrapper.AddNotificationBarEntry: User state changed from inactive to active")}removeEntry(){}get isVisible(){return!1}u1(Wa,
Qb){return new Na.a(Wa,Qb)}dispose(){}static get instance(){W.La||(W.La=new W);return W.La}}W.La=null;Object(d.a)(W,"NoOpNotificationBar",null,[901,5]);var U=a(233);let za=class{rgf(Wa){const Qb=Wa.key;Wa=Wa.value;if(!Wa)return null;const Lc=Wa.SupportsChat?4:0;return Object(Lb.a)(new Ta.a,{clientId:Qb,lad:Wa.ChatThreadId,kad:Wa.ChatThreadDiscoveryUri,lGb:Wa.InChat,email:Wa.Cid,capabilities:new sc.a(Lc),isAnonymous:Wa.IsAnonymous})}};za=Object(Ua.a)([Object(va.d)(ob.nc)],za);Object(d.a)(za,"PresenceConverter",
null,[874]);class ua extends U.a{constructor(){super();this.xRe=null;this.je()}create(){this.Ld(this.xRe||(this.xRe=new za))}static la(Wa){Wa.ga.Qa(159,new ua)}}Object(d.a)(ua,"PresenceConverterFactory",U.a,[]);var $a=a(142),Va=a(143);let hb=class{constructor(Wa){this.LZf=this.mRd=this.NZf=this.JZf=this.MXf=this.UYd=this.Jag=this.Rag=this.Qag=!1;this.nRd=this.VPd=this.PSb=this.SSb=this.PEc=this.YYd=0;this.Nwf=!1;this.hKd=this.Fwb=0;this.jsc=!1;this.ff=()=>{this.jsc=!0;this.$.ea.gm(this.ff)};this.$=
Wa;da.a.aT&&(this.hKd=window.performance.timing.navigationStart);this.hKd||r.ULS.sendTraceTag(537154379,0,15,"Navigation start time is zero");this.$.ea.Zl(this.ff)}STi(Wa){this.Qag||(this.YYd=Wa,this.Qag=!0)}TTi(Wa){this.Rag||(this.PEc=Wa,this.Rag=!0)}RTi(Wa,Qb){this.Jag||(this.SSb=Qb,this.Nwf=Wa,this.Jag=!0)}PTi(Wa){this.UYd||(this.PSb=Wa,this.UYd=!0)}vTi(Wa){!this.mRd&&this.UYd&&(this.nRd=Wa,this.mRd=!0)}qTi(Wa){this.MXf||(this.VPd=Wa,this.MXf=!0)}uTi(Wa){if(!this.JZf&&this.pla&&!this.jsc){this.JZf=
!0;const Qb=this.gpd();Qb.RtcIntializeToPeopleWellServiceCreate=this.VPd-this.SSb;Qb.PeopleWellServiceCreateToPresenceGalleryRender=Wa-this.VPd;Qb.PresenceGalleryRenderTotalTime=Wa-this.pla;Va.b(this.$).nf($a.a.KZf,Qb,void 0,!0)}}xTi(Wa){if(!this.NZf&&this.pla&&!this.jsc){this.NZf=!0;const Qb=this.gpd();Qb.RtcIntializeToRtcConnect=this.PSb-this.SSb;Qb.RtcConnectToPresenceSent=Wa-this.PSb;Qb.PresenceSentTotalTime=Wa-this.pla;Va.b(this.$).nf($a.a.OZf,Qb,void 0,!0)}}wTi(Wa){if(!this.LZf&&this.mRd&&this.pla&&
!this.jsc){this.LZf=!0;const Qb=this.gpd();Qb.RtcIntializeToRtcConnect=this.PSb-this.SSb;Qb.RtcConnectToPresenceRenderInitiate=this.nRd-this.PSb;Qb.PresenceRenderInitiateToPresenceRenderFinish=Wa-this.nRd;Qb.PresenceRenderTotalTime=Wa-this.pla;Va.b(this.$).nf($a.a.MZf,Qb,void 0,!0)}}dispose(){this.$=null}gpd(){const Wa={};Wa.CoAuthorCountsOnBoot=this.$.ea.Vp.length;Wa.RtcConnectedLaterInSession=this.Nwf;Wa.BrowserVisibilityChanged=this.s9g();Wa.AppInteractiveAbsTime=this.pla;Wa.NavigationStartTime=
this.hKd;Wa.AppInteractiveToRtcSliceDownloadInitialize=this.YYd-this.pla;Wa.RtcSliceDownloadInitializeToRtcSliceLoad=this.PEc-this.YYd;Wa.AppInteractiveToRtcSliceLoad=this.PEc-this.pla;Wa.RtcSliceLoadToRtcInitialize=this.SSb-this.PEc;return Wa}get pla(){if(this.Fwb)return this.Fwb;Ga.a.instance.t7("AppInitStatus_interactivityReady")&&(this.Fwb=Ga.a.instance.bC("AppInitStatus_interactivityReady"));this.Fwb||r.ULS.sendTraceTag(537154378,0,15,"App interactive time is zero");return this.Fwb}s9g(){return da.a.aT&&
Ga.a.instance.t7(Z.a.tYb)?0<Ga.a.instance.bC(Z.a.tYb)[Z.a.Nyg]:!1}};hb=Object(Ua.a)([Object(va.d)(ob.oc),Object(Ua.b)(0,Object(ob.W)())],hb);Object(d.a)(hb,"PresenceTelemetry",null,[875,5]);class qb extends U.a{constructor(Wa){super();this.$=Wa;this.je()}create(){this.Ld(this.$.ga.Da(435)||this.$.ga.Qa(435,new hb(this.$)))}static la(Wa){Wa.ga.Qa(436,new qb(Wa))}}Object(d.a)(qb,"PresenceTelemetryFactory",U.a,[]);var Nb=a(1243),yb=a(54),ja=a(48),Ka=a(33),Pb=a(133),rc=a(16),$c=a(19),Dd=a(83);class Jd extends ka.a{constructor(Wa){super();
this.Hxe=Wa;this.e_c=this.Tva=null}get xYb(){return this.Hxe}get xe(){return this.Tva||{}}set xe(Wa){this.e_c=this.Tva;this.Tva=Wa;this.raiseEvent("userPresenceChanged")}get LRd(){return this.e_c}dispose(){this.raiseEvent("userPresenceChanged");this.raiseEvent("userLeft");this.e_c=this.Tva=this.Hxe=null;super.dispose()}}Object(d.a)(Jd,"UserPresence",ka.a,[]);class Kd extends Dd.a{constructor(){super();this.xse=this.vse=this.bD=null}get eB(){return this.vse}O1d(Wa){this.vse=Wa}get Gn(){return this.xse}Ehg(Wa){this.xse=
Wa}get xe(){return this.bD.xe}set xe(Wa){this.bD.xe=Wa}V5a(){}p$a(){return null}iqd(){return null}Clg(){}Dlg(){}fwg(){}gIc(){}znc(){}static jjk(Wa,Qb){const Lc=Wa.bD.xe;jc.a.Fe(Wa.eB);jc.a.Fe([Wa.bD]);Wa.bD=null;Wa.bD=new Jd(Qb);Wa.O1d([]);Wa.Ehg(Qb);Wa.xe=Lc}}Object(d.a)(Kd,"IUserGridPresence",Dd.a,[]);var ce=a(1177),ge=a(872),uc=a(40),dd=a(111),Rd=a(1046),Yd=a(41),Md=a(161),ad=a(12),Mb=a(126);class Aa extends ka.a{constructor(Wa,Qb,Lc,Ba,qa){super();this.LA=[];this.v5a=null;this.visible=!1;this.Hvb=
this.tKb=null;this.Pea=!1;this.R1j=()=>{jc.a.Ma(this.Hvb);this.Hvb=null;this.visible&&(this.YRa()?this.raiseEvent("showPresenceTooltip"):this.b9(!0))};this.tNd=gb=>{this.wWa(gb)};this.qC=()=>{this.Lug()};this.CI=()=>{this.Lug()};this.domElement=Wa;this.gridView=Qb;this.F2c=Wa.id;this.Pva=Ba;this.$=qa;this.bsc=!1;this.Dnf();this.$Zc=Lc;this.Mg=null;this.cF={};this.cF.FirstColumn=0;this.cF.FirstRow=0;this.cF.LastColumn=0;this.cF.LastRow=0}v5c(Wa){this.addHandler("hidePresenceTooltip",Wa)}PVd(Wa){this.removeHandler("hidePresenceTooltip",
Wa)}X5c(Wa){this.addHandler("showPresenceTooltip",Wa)}mWd(Wa){this.removeHandler("showPresenceTooltip",Wa)}W5c(Wa){this.addHandler("showFullPresenceTooltip",Wa)}lWd(Wa){this.removeHandler("showFullPresenceTooltip",Wa)}YKa(Wa){this.addHandler("presenceChanged",Wa)}EEa(Wa){this.removeHandler("presenceChanged",Wa)}get tB(){return this.F2c}get aEa(){return this.$Zc}get paneType(){return this.Pva}get RAc(){if(!this.domElement)return null;var Wa=this.gridView.Xh(this.paneType).ao,Qb=this.gridView.rtl,Lc=
this.domElement.offsetWidth;if(!this.Mg&&4>=Lc){if(this.cF){Lc=this.gridView.Ol;var Ba=this.cF.FirstRow;Qb=Qb?this.cF.FirstColumn:this.cF.LastColumn;if(Lc&&!(Ba>=Lc.top&&Ba<=Lc.bottom&&Qb>=Lc.left&&Qb<=Lc.right))return Ba=Ba<=Lc.top?Wa.y:Wa.y+(Ba>=Lc.bottom?Wa.height:Wa.height/2),Qb=Qb<=Lc.left?Wa.x:Wa.x+(Qb>=Lc.right?Wa.width:Wa.width/2),this.tKb=new Sys.UI.Point(Qb,Ba)}return this.tKb}if(this.Mg){Wa=this.domElement.offsetTop-2;Ba=parseInt(this.domElement.style.left,10);let qa=0;Qb&&(qa=parseInt(this.domElement.parentNode.style.width,
10)-Lc-Ba,qa-=this.gridView.rV.OSa&&this.gridView.rV.$Dd?Mb.a.oy:0);return this.tKb=new Sys.UI.Point((Qb?qa:Ba)+Lc+4,Wa)}return this.tKb=new Sys.UI.Point(parseInt(Qb?this.domElement.style.right:this.domElement.style.left,10)+Lc,this.domElement.offsetTop)}get range(){return Za.E(this.cF)}dispose(){this.raiseEvent("hidePresenceTooltip");this.raiseEvent("presenceChanged");this.WNe();this.IZa();jc.a.Ma(this.Hvb);this.domElement=this.gridView=null;super.dispose()}M4d(Wa,Qb){const Lc=!!Wa&&!Za.E(Wa).equals(Za.E(this.cF)),
Ba=!!Qb&&(!this.Mg||this.Mg.get_id()!==Qb.get_id());if(Lc||Ba)this.raiseEvent("presenceChanged"),this.WNe(),this.Pea=!1,this.cF=Wa,this.Mg=Qb,this.tKb=null}b9(Wa){this.visible=this.Pea=!1;Wa&&this.raiseEvent("hidePresenceTooltip")}$ka(Wa){this.LA.push(Wa);this.Dnf();Wa.YKa(this.tNd)}Ksa(Wa,Qb){Wa?(this.visible=!0,Qb&&(this.Hvb=Md.AsyncMethodContext.Wr(this.R1j,this.$.xa.ShowTooltipDelayInMs,ja.a.Eak,this.Hvb))):this.b9(Qb)}oWb(){}Ylb(){if(this.domElement&&this.visible){this.v5a=ad.DOMElementExtensions.getBoundingClientRect(this.domElement);
const Wa=Math.floor(this.v5a.x);this.v5a.x=Wa===this.v5a.x?Wa:Wa+1;this.v5a.y=Math.floor(this.v5a.y)}}YRa(){if(!this.cF)return!1;const Wa=this.Ldi();return Wa?this.gridView.DIi(Wa,this.paneType):!1}Ldi(){if(this.range.isSingle){var Wa=this.gridView.ya.bAa(this.range,this.$.activeItemName);return Wa?(Wa=Wa.Vu(this.range))?Wa.QF:null:null}return this.range}WNe(){for(let Wa=0,Qb=this.LA.length;Wa<Qb;Wa++)this.LA[Wa].EEa(this.tNd);this.LA.length=0;this.IZa()}Dnf(){!this.bsc&&1<=this.LA.length&&(this.bsc=
!0,this.gridView.ya.WJ(this.qC),this.gridView.ya.Eu(this.qC),this.gridView.view.Rt(this.CI))}IZa(){this.bsc&&!this.LA.length&&(this.bsc=!1,this.gridView&&(this.gridView.ya.uL(this.qC),this.gridView.ya.Ft(this.qC),this.gridView.view.Cs(this.CI)))}wWa(Wa){Wa.EEa(this.tNd);Array.remove(this.LA,Wa);this.IZa()}Lug(){this.Ylb();for(let Wa=0,Qb=this.LA.length;Wa<Qb;Wa++)this.LA[Wa].Ylb()}}Object(d.a)(Aa,"TooltipNotificationUnit",ka.a,[942,5]);var Bc=a(795);class Vc extends ka.a{constructor(Wa,Qb,Lc,Ba,qa,
gb,Bb,ic){super();this.Md=null;this.oC={};this.$ye=0;this.Mg=this.Jwa=null;this.Pva=0;this.PNb=Cc=>{this.Jwa&&this.Jwa!==Cc||(this.Jwa=null,this.b9(!1));this.raiseEvent("hidePresenceTooltip")};this.uOb=Cc=>{this.Jwa&&this.Jwa!==Cc||(this.Jwa=null,this.Ksa(!0,!1));this.raiseEvent("showPresenceTooltip")};this.tOb=Cc=>{this.Jwa||this.raiseEvent("showFullPresenceTooltip");this.Jwa=Cc};this.lOb=()=>{this.b9(!1);this.raiseEvent("presenceChanged")};ic=Lc===rc.a.instance.xd(87)||ic;this.$Zc=new Ta.a(Qb,Lc,
Ba,new sc.a,null,null,null,null,ic);this.gridView=Wa;this.F2c=Qb;this.highlight=qa;this.qw=gb;this.$=Bb}v5c(Wa){this.addHandler("hidePresenceTooltip",Wa)}PVd(Wa){this.removeHandler("hidePresenceTooltip",Wa)}X5c(Wa){this.addHandler("showPresenceTooltip",Wa)}mWd(Wa){this.removeHandler("showPresenceTooltip",Wa)}W5c(Wa){this.addHandler("showFullPresenceTooltip",Wa)}lWd(Wa){this.removeHandler("showFullPresenceTooltip",Wa)}YKa(Wa){this.addHandler("presenceChanged",Wa)}EEa(Wa){this.removeHandler("presenceChanged",
Wa)}get tB(){return this.F2c}get aEa(){return this.$Zc}get paneType(){return this.Pva}get range(){return this.Md}get RAc(){return this.Md||this.Mg?Rd.a(this.gridView.Xh(this.paneType),this.kAa(this.paneType).RAc,!0):null}get Pea(){return this.kAa(this.paneType).Pea}set Pea(Wa){const Qb=this.oC;for(let Lc in Qb)Qb[Lc].Pea=Wa}dispose(){this.raiseEvent("hidePresenceTooltip");this.raiseEvent("presenceChanged");this.qw&&this.qw.Yek(this.tB);const Wa=this.oC;for(let Qb in Wa){const Lc=Wa[Qb];Lc.PVd(this.PNb);
Lc.mWd(this.uOb);Lc.lWd(this.tOb);Lc.EEa(this.lOb);Lc.dispose()}this.qw=this.Md=this.highlight=this.gridView=this.oC=null;super.dispose()}Nlg(Wa,Qb,Lc=null){Wa?(this.Md=Za.E(Wa),this.Pva=this.gridView.jd.$j(this.Md.topRight)):Lc?(this.Mg=Lc,this.Pva=Lc.$h.paneType):this.Pva=1;this.$ye=Qb;this.kAa(this.paneType);this.M4d(Wa,Lc)}M4d(Wa,Qb){const Lc=this.oC;for(let Ba in Lc)Lc[Ba].M4d(Wa,Qb)}b9(Wa){this.kAa(this.paneType).b9(Wa);Wa=this.oC;for(let Qb in Wa)Wa[Qb].b9(!1)}GAe(Wa){const Qb=this.oC;for(let Lc in Qb){const Ba=
Qb[Lc];Ba.$ka(Wa.kAa(Ba.paneType))}}$ka(Wa){this.kAa(Wa.paneType).$ka(Wa)}YRa(){let Wa=this.kAa(this.paneType).YRa();const Qb=this.oC;for(let Lc in Qb)Wa=Qb[Lc].YRa()||Wa;return Wa}Ksa(Wa,Qb){this.qw.pae(this);this.kAa(this.paneType).Ksa(Wa,Qb);Qb=this.oC;for(let Lc in Qb)Qb[Lc].Ksa(Wa,!1)}oWb(Wa){const Qb=this.oC;for(let Lc in Qb)Qb[Lc].oWb(Wa)}Ylb(){const Wa=this.oC;for(let Qb in Wa)Wa[Qb].Ylb();this.qw.pae(this)}kAa(Wa){return this.Jci(Wa,this.$ye)}U$d(Wa){this.qw.U$d(Wa)}Jci(Wa,Qb){const Lc=this.highlight?
this.highlight.RF(Qb,Wa).Qg:this.Mg?Bc.a?this.Mg.domElement:this.Mg.get_element():null;Qb=Vc.zji(Qb,Wa);let Ba=uc.a.kf(this.oC,Qb);Ba||(Ba=new Aa(Lc,this.gridView,this.aEa,Wa,this.$),this.oC[Qb]=Ba,Ba.v5c(this.PNb),Ba.X5c(this.uOb),Ba.W5c(this.tOb),Ba.YKa(this.lOb));return Ba}static zji(Wa,Qb){return Wa.toString()+Qb.toString()}}Object(d.a)(Vc,"PaneInvariantTooltipNotificationUnit",ka.a,[942,5]);class hc{constructor(Wa,Qb,Lc){this.Mg=this.objectId=this.Z0b=null;this.Gn=Wa;this.$=Qb;this.qw=Lc;this.xx=
new Vc($c.h(this.$),this.Gn.User.UserID,this.Gn.User.UserName,this.Gn.UserColor,null,Lc,this.$,this.Gn.IsAnonymous)}get Mg(){return this.Z0b}set Mg(Wa){this.Z0b=Wa}dispose(){this.PFb();jc.a.Ma(this.xx);this.objectId=this.$=this.Gn=this.Mg=null}$ka(Wa){this.xx.GAe(Wa.xx)}PFb(){var Wa;this.Mg&&this.Gn&&this.Gn.User&&(this.Mg.iMc(!1,this.Gn.User.UserID,null),Bc.a&&(null===(Wa=this.Mg)||void 0===Wa?void 0:Wa.oVd(this.Gn.User.UserID)),this.xx.b9(!0))}CVb(){ge.a.gVb&&this.Mg&&this.Gn&&this.Gn.User&&(this.Mg.iMc(!0,
this.Gn.User.UserID,this.Gn.UserColor),this.xx.Ylb())}ZI(Wa){var Qb;ge.a.Isa&&(Bc.a?this.Mg&&(null===(Qb=this.Gn)||void 0===Qb?0:Qb.User)&&this.Mg.Q4c(Fa.qgf(this.Gn)):(this.xx.Pea=Wa,this.xx.Ksa(Wa,!0)))}LVb(Wa,Qb){this.xx.Nlg(null,0===Qb?50:51,Wa)}}Object(d.a)(hc,"FloatingObjectPresenceHighlight",null,[934,5]);var xc=a(153),ab=a(641),Wb=a(68),Yc=a(69),Tc=a(11),ed=a(265),be=a(160);class Fc extends ab.a{constructor(Wa,Qb,Lc){super(Qb,$c.h(Qb),!0,!1,Wa.User.UserID);this.JA=[];this.Vqc=this.GVb=!1;
this.L3=()=>{La.EwaSettings.isChangeGateEnabled("OfficeVSO:7486785_FixPresenterPresenceHighlightJSCrash")&&!this.JA||this.Gn.User.UserID!==this.jEb()||(r.ULS.sendTraceTag(521143967,0,50,`PresenceHighlight:onPresenterDetailsSaved called for User:
        ${this.Gn.User.UserID}, Logging presenter information: ${this.jEb()}, meetingId: ${this.$.xa.MeetingId}`),this.JA.forEach(Ba=>{this.rYe(Ba)}),this.JA=[])};Fc.A6a||(Fc.A6a={});this.Gn=Wa;this.xx=new Vc(this.gridView,this.Gn.User.UserID,this.Gn.User.UserName,this.Gn.UserColor,this,Lc,this.$,this.Gn.IsAnonymous);this.RAd=be.j(this.$);this.dIi=La.EwaSettings.isChangeGateEnabled("OfficeVSO:6191577_PresenterPresenceOnTop");this.Szd=be.a(this.$);this.wtf=this.RAd||this.Szd;this.L3=this.L3.bind(this);
this.wtf&&this.YPi()}dispose(){var Wa;jc.a.Ma(this.xx);super.dispose();const Qb=Fc.A6a;for(let Ba in Qb){var Lc=Ba;const qa=Qb[Ba];qa&&!qa.children.length&&(ad.DOMElementExtensions.Oh(qa),Fc.A6a[Lc]=null)}null===(Wa=Fc.excelLiveManager)||void 0===Wa?void 0:Wa.lib(this.L3);this.JA=null}$ka(Wa){this.xx.GAe(Wa.xx)}ZI(Wa){ge.a.Isa&&(this.Vqc||(this.xx.Pea=Wa,this.xx.Ksa(Wa,!0)),this.GVb=Wa&&this.Vqc)}LVb(Wa,Qb){this.xx.Nlg(Wa,0===Qb?50:51);this.GVb=!1}CVb(Wa){ge.a.gVb&&(this.xx.Ksa(!0,!0),this.Jt([Wa]))}PFb(Wa){this.b9();
this.cm(Wa)}sUe(Wa,Qb,Lc){Lc.className=Wb.a.lPh;Lc.style.borderColor=this.Gn.UserColor;this.Szd&&Lc.classList.add(Wb.a.D4e);const Ba=document.createElement("div");50!==Wa&&51!==Wa&&(Ba.style.backgroundColor=this.Gn.UserColor);Lc.appendChild(Ba);Ba.className=[Wb.a.nPh,Wb.a.mPh][Wa-50];Wa=uc.a.kf(Fc.A6a,Qb.toString());if(!Wa){const qa=this.gridView.Xh(Qb).domElement;Wa=document.createElement("div");qa.insertBefore(Wa,qa.firstChild);Fc.A6a[Qb.toString()]=Wa}Wa.appendChild(Lc);this.wtf&&this.zBh(Ba)}OFb(){}Mfg(Wa,
Qb,Lc,Ba,qa){this.GLc&&ad.DOMElementExtensions.setVisible(Qb.Qg,qa);qa=this.C1g(Ba,Wa,Qb);ed.c(Lc,this.gridView.rtl,Tc.HelperMethods.Qe(qa.x));Lc.width=Tc.HelperMethods.Qe(qa.width);Lc.top=Tc.HelperMethods.Qe(qa.y);Lc.height=Tc.HelperMethods.Qe(qa.height);Qb=Qb.Qg;Lc=Qb.parentNode;51===Wa?Fc.HTd(Lc,Qb,!1):50===Wa&&(Wa=this.RF(51),Ba.equals(Wa.ktc)?Fc.HTd(Lc,Qb,!1):Fc.HTd(Lc,Qb,!0));this.Ymj()}ojg(){return!1}C1g(Wa,Qb,Lc){let Ba=Wa.y+this.Z9a(Lc,!1);Lc=Wa.x+this.Z9a(Lc,!0)+Mb.a.jod(Lc.Qg.parentNode.parentNode,
this.gridView.rtl);let qa=Wa.width;Wa=Wa.height+1;1>Lc&&-1<=Lc&&50===Qb&&(qa-=1-Lc,Lc=1);1>Ba&&-1<=Ba&&50===Qb&&(Wa-=1-Ba,Ba=1);qa=Math.max(0,qa-1);Wa=Math.max(0,Wa-2);return new Yc.a(Lc,Ba,qa,Wa)}Ymj(){this.xx.Ylb();this.Vqc=!1;this.GVb&&this.ZI(!0);this.GVb=!1}b9(){this.Vqc||(this.xx.b9(!0),this.GVb=!1)}static HTd(Wa,Qb,Lc){Lc?Qb!==Wa.firstChild&&(Wa.removeChild(Qb),Wa.insertBefore(Qb,Wa.firstChild)):Qb!==Wa.lastChild&&(Wa.removeChild(Qb),Wa.appendChild(Qb))}zBh(Wa){var Qb;(null===(Qb=Fc.excelLiveManager)||
void 0===Qb?0:Qb.aVa.kv)?this.Gn.User.UserID===this.jEb()&&(r.ULS.sendTraceTag(521143968,0,50,`PresenceHighlight:Distinct presenter presence called for User:${this.Gn.User.UserID}, Logging presenter information: ${this.jEb()}, meetingId: ${this.$.xa.MeetingId}`),this.rYe(Wa)):(r.ULS.sendTraceTag(509749071,0,50,`PresenceHighlight:PresenterCid is not yet saved for User:${this.Gn.User.UserID}`),this.JA.push(Wa))}rYe(Wa){this.Szd&&this.gzj(Wa);this.RAd&&(r.ULS.sendTraceTag(509749070,0,50,`PresenceHighlight:distinctPresenterPresenceInternal called for User:${this.Gn.User.UserID}`),
this.hsi(Wa));this.RAd&&this.dIi&&this.sjk(Wa)}YPi(){Fc.excelLiveManager?Fc.excelLiveManager.Eub(this.L3):this.$.ga.qd(473,Wa=>{Fc.excelLiveManager=Wa;Fc.excelLiveManager.Eub(this.L3)})}hsi(Wa){xc.a(()=>{Wa.style.backgroundColor=this.Gn.UserColor;Wa.classList.add(Wb.a.wPh);r.ULS.sendTraceTag(520648066,0,50,`PresenceHighlight:Highlighting presence for User: ${this.Gn.User.UserID}, Logging presenter information: ${this.jEb()}, meetingId: ${this.$.xa.MeetingId}`)},this.$.ka)}gzj(Wa){xc.a(()=>{Wa.parentElement.classList.remove(Wb.a.D4e)},
this.$.ka)}sjk(Wa){this.xx.U$d(Fc.excelLiveManager.aVa.kv);xc.a(()=>{Wa.parentElement.classList.add(Wb.a.vPh)},this.$.ka)}jEb(){return Fc.excelLiveManager.aVa.kv}}Fc.A6a=null;Object(d.a)(Fc,"PresenceHighlight",ab.a,[]);class vd extends Kd{constructor(Wa,Qb,Lc){super();this.sK=new uc.a(!0);this.countFloatingObjects=this.Gdd=this.Fdd=0;this.jSd=!1;this.At=()=>{this.K0d()};this.EDa=()=>{this.K0d()};this.bD=new Jd(Wa);this.Ehg(Wa);this.qw=Lc;this.O1d([]);this.$=Qb;this.$.va.Ri(this.EDa);$c.h(this.$).XW(this.At);
this.jSd=La.EwaSettings.isChangeGateEnabled("OfficeVSO:6331623_ProcessShapeFOPresence")}get xe(){return this.bD.xe}set xe(Wa){this.bD.xe=Wa;this.K0d()}gIc(){var Wa=1===this.xe.PresenceType?51:50;for(let Qb=0;Qb<this.eB.length;Qb++)this.eB[Qb].CVb(Wa);for(Wa=0;Wa<this.sK.count;Wa++)this.sK.li(Wa).CVb()}znc(){var Wa=1===this.xe.PresenceType?51:50;for(let Qb=0;Qb<this.eB.length;Qb++)this.eB[Qb].PFb([Wa]);for(Wa=0;Wa<this.sK.count;Wa++)this.sK.li(Wa).PFb()}dispose(){this.$&&(this.$.va&&this.$.va.uj(this.EDa),
$c.h(this.$).qR(this.At));this.jYe();jc.a.Fe(this.eB);jc.a.Fe([this.bD]);this.bD=this.$=null;this.O1d(null);this.sK=null;super.dispose()}jYe(){if(this.sK){for(let Wa=0;Wa<this.sK.count;Wa++)this.sK.li(Wa).dispose();this.sK.clear()}}V5a(Wa){1===this.xe.Version?this.Xfh(Wa):this.Yfh(Wa)}Xfh(Wa){if(Wa.xe.SelectedRange&&this.xe.SelectedRange){const Qb=this.xe.SelectedRange.length,Lc=Wa.xe.SelectedRange.length;for(let Ba=0;Ba<Qb;Ba++)for(let qa=0;qa<Lc;qa++)if(pb(this.xe.SelectedRange[Ba],Wa.xe.SelectedRange[qa])){this.eB[Ba].$ka(Wa.p$a(qa));
return}}}Yfh(Wa){var Qb;let Lc=0,Ba=0;if(this.xe&&this.xe.Object&&(null===(Qb=Wa.xe)||void 0===Qb?0:Qb.Object)){Qb=this.xe.Object.length;var qa=Wa.xe.Object.length;for(var gb=0;gb<Qb;gb++)if(this.xe.Object[gb]&&this.Csd(this.xe.Object[gb])){Lc++;for(var Bb=0;Bb<qa;Bb++)if(Wa.xe.Object[Bb]&&this.Csd(Wa.xe.Object[Bb])&&(Ba++,this.r7c(this.xe.Object[gb],Wa.xe.Object[Bb]))){var ic=this.p$a(Lc),Cc=Wa.p$a(Ba);if(ic&&Cc){ic.$ka(Cc);return}}}else if(this.xe.Object[gb]&&Wa.xe.Object[gb]&&(0===this.xe.Object[gb].ObjectType||
2===this.xe.Object[gb].ObjectType))for(Bb=0;Bb<qa;Bb++)if(Wa.xe.Object[Bb]&&(0===Wa.xe.Object[gb].ObjectType||2===Wa.xe.Object[gb].ObjectType)&&this.xe.Object[gb].ObjectId===Wa.xe.Object[Bb].ObjectId&&(ic=this.iqd(this.xe.Object[gb].ObjectId),Cc=Wa.iqd(this.xe.Object[gb].ObjectId),ic&&Cc)){ic.$ka(Cc);return}}if(Wa.xe.SelectedRange&&this.xe.SelectedRange)for(Qb=this.xe.SelectedRange.length,qa=Wa.xe.SelectedRange.length,gb=0;gb<Qb;gb++)for(Bb=0;Bb<qa;Bb++)if(pb(this.xe.SelectedRange[gb],Wa.xe.SelectedRange[Bb])&&
(ic=this.p$a(Lc+gb),Cc=Wa.p$a(Ba+Bb),ic&&Cc)){ic.$ka(Cc);return}}r7c(Wa,Qb){return!!Wa&&!!Qb&&Qb.ObjectType===Wa.ObjectType&&(1===Wa.ObjectType||3===Wa.ObjectType)&&!Wa.ObjectId.localeCompare(Qb.ObjectId)}p$a(Wa){return 0<=Wa&&this.eB.length>Wa?this.eB[Wa]:null}Clg(Wa){for(let Qb=0,Lc=this.eB.length;Qb<Lc;Qb++)this.eB[Qb].ZI(Wa)}iqd(Wa){return Wa&&this.sK.kd(Wa)?this.sK.getItem(Wa):null}Dlg(Wa,Qb=null){if(Wa)(Wa=this.sK.getItem(Qb))&&Wa.ZI(!0);else for(Wa=0;Wa<this.sK.count;Wa++)(Qb=this.sK.li(Wa))&&
Qb.ZI(!1)}fwg(Wa){Kd.jjk(this,Wa)}Ged(Wa,Qb){if(Wa<Qb)return this.eB[Wa];if(!this.Gn||!this.$||!this.qw)return null;Wa=new Fc(this.Gn,this.$,this.qw);this.eB.push(Wa);return Wa}dRj(){const Wa=this.eB.length;var Qb=this.xe.SelectedRange?this.xe.SelectedRange.length:0,Lc=this.$.va.na;for(let Ba=0;Ba<Qb;Ba++){let qa=this.Ged(Ba,Wa);qa&&this.xe.SelectedRange[Ba]&&(this.xe.SelectedRange[Ba].NamedObjectName?qa.cm([51,50]):(qa.LVb(this.xe.SelectedRange[Ba],this.xe.PresenceType),vd.T$d(this.xe.PresenceType,
qa,this.xe.SelectedRange[Ba],Lc,this.Gn,this.qw)))}Lc=!!this.bD&&!!this.bD.LRd&&this.bD.LRd.PresenceType!==this.bD.xe.PresenceType;for(Qb=Lc?0:Qb;Qb<Wa;Qb++)this.eB[Qb].cm([1===this.bD.LRd.PresenceType?51:50])}Csd(Wa){return(null===Wa||void 0===Wa?0:Wa.ObjectId)&&(1===this.hff(Wa.ObjectType)||2===this.hff(Wa.ObjectType))&&(Wa=this.$.Ud.ord(Wa.ObjectId))?Za.w(Wa):null}eRj(){const Wa=this.eB.length,Qb=this.$.va.na,Lc=this.xe.SelectedRange?this.xe.SelectedRange.length:0;var Ba=this.xe.Object?this.xe.Object.length:
0;for(var qa=0;qa<Wa;qa++)this.eB[qa].cm([51,50]);this.dhh();this.Gdd=this.Fdd=qa=0;for(var gb=0;gb<Ba;gb++){var Bb=this.xe.Object[gb],ic=this.Csd(Bb);if(ic){let Cc=this.Ged(qa,Wa);1===Bb.ObjectType?this.Fdd++:3===Bb.ObjectType&&this.Gdd++;qa++;Cc.LVb(ic,Bb.ObjectPresenceType);vd.T$d(Bb.ObjectPresenceType,Cc,ic,Qb,this.Gn,this.qw)}}for(Ba=0;Ba<Lc;Ba++)this.xe&&this.xe.SelectedRange&&(gb=this.xe.SelectedRange[Ba],gb.NamedObjectName||(Bb=!!Qb&&gb.SheetName===Qb.name,ic=!!Tb(gb,this.$,1),Bb&&ic||(Bb=
this.Ged(qa+Ba,Wa),Bb.LVb(gb,this.xe.PresenceType),vd.T$d(this.xe.PresenceType,Bb,gb,Qb,this.Gn,this.qw))));0<(this.countFloatingObjects=this.keg())&&r.ULS.sendTraceTag(537154370,0,50,'{{"SetAllFloatingObjectPresenceHighlights":"Success"}')}dhh(){this.keg();this.jYe()}keg(){let Wa=0;if(this.xe&&this.xe.Object)for(let Qb=0;Qb<this.xe.Object.length;Qb++)this.Lhk(this.xe.Object[Qb])&&Wa++;return Wa}msh(Wa,Qb){if(this.sK.kd(Qb))return Qb=this.sK.getItem(Qb),Qb.Mg=Wa,Qb;if(!this.Gn||!this.$||!this.qw)return null;
const Lc=new hc(this.Gn,this.$,this.qw);Lc.Mg=Wa;this.sK.add(Qb,Lc);return Lc}Lhk(Wa){let Qb=!1;if((null===Wa||void 0===Wa?0:Wa.ObjectId)&&(0===Wa.ObjectType||2===Wa.ObjectType||this.jSd&&5===Wa.ObjectType))try{const Lc=this.x8h(Wa);if(Lc){const Ba=this.msh(Lc,Wa.ObjectId);Ba.LVb(Lc,Wa.ObjectPresenceType);5!==Wa.ObjectType&&Ba.CVb();Bc.a&&0===Wa.ObjectType&&Ba.ZI(!0);Qb=!0}}catch(Lc){throw r.ULS.sendTraceTag(537154369,0,10,`{"UpdatedFloatingObjectPresence":"Fail","Exception":"${Lc.stack}"}`),Lc;}return Qb}x8h(Wa){if(!Wa)return null;
let Qb=null;this.jSd?-1!=Wa.ObjectType&&(Qb=dd.a(this.$).Yza(Wa.ObjectId)):2===Wa.ObjectType?Qb=dd.a(this.$).Yza(Wa.ObjectId):0===Wa.ObjectType&&(Wa=this.$.Ud.ord(Wa.ObjectId),null===Wa||void 0===Wa?0:Wa.imageId)&&(Qb=dd.a(this.$).l$h(Wa.imageId));return Qb}K0d(){try{1===this.xe.Version?(this.dRj(),r.ULS.sendTraceTag(537154368,0,50,'{{"SetGridHighlightPass":"V1"}')):(this.eRj(),r.ULS.sendTraceTag(537154339,0,50,`{"FloatingObjects":"${this.countFloatingObjects}","PivotTables":"${this.Fdd}","QueryTables":"${this.Gdd}"}`))}catch(Wa){throw r.ULS.sendTraceTag(537154338,
0,10,`{"SetGridHighlight Exception":"${Wa.stack}"}`),Wa;}}hff(Wa){switch(Wa){case 0:return 0;case 1:return 1;case 3:return 2;case 2:return 9;default:return-1}}static T$d(Wa,Qb,Lc,Ba,qa,gb){const Bb=1===Wa?51:50;Ba&&Lc&&Ba.name===Lc.SheetName?(Qb.kn(Za.E(Lc),[Bb]),Qb.CVb(Bb),r.ULS.shipAssertTag(537154337,0,Qb.xx.tB===qa.User.UserID,"UserID and UnitID should match"),gb.DUb(Qb.xx.tB,1===Wa)):Qb.PFb([Bb])}}Object(d.a)(vd,"UserGridPresence",Kd,[]);var lb=a(49),Eb=a(811);class Hc{constructor(Wa,Qb){this.yuf=
this.sCd=this.Xvf=!1;this.aud=this.kjc=this.TEb=this.p9a=0;this.myf=!0;this.AH=Wa;this.$=Qb}aik(){this.p9a||(this.p9a=Yd.a.Of(),this.uCa())}cik(){this.TEb||(this.TEb=Yd.a.Of(),this.uCa())}$hk(){this.kjc=Yd.a.Of();this.FDf()}bik(Wa){this.aud=Yd.a.Of();Wa&&(this.yuf=!0);this.FDf()}dispose(){this.AH=this.$=null}static o9h(){return Hc.Ztd}uCa(){this.p9a&&this.TEb?this.kC():window.setTimeout(()=>{this.kC()},Hc.Ztd)}FDf(){this.kjc&&this.aud?this.kC(!0):window.setTimeout(()=>{this.kC(!0)},Hc.Ztd)}kC(Wa=
!1){var Qb;if(Wa?!this.sCd:!this.Xvf)if(this.TEb||this.p9a)if(null!==(Qb=this.$)&&void 0!==Qb&&Qb.ea){Qb=this.$.ea.FEb(this.AH);var Lc=this.$.ea.Vp;for(var Ba of Lc)this.AH!==Ba.User.UserID&&(null===Qb||void 0===Qb?void 0:Qb.UserEmail)===(null===Ba||void 0===Ba?void 0:Ba.UserEmail)&&(this.myf=!1);Ba={};Ba.UserSessionId=this.$.xa.UserSessionId;Ba.ClientID=this.AH;Ba.IsUniqueUser=this.myf;Ba.IsUserRemovalLog=Wa;Ba.IsInactive=this.yuf;Wa||(Ba.GridPresenceTime=this.TEb,Ba.GalleryPresenceTime=this.p9a);
Ba.GridPresenceRemovalTime=this.aud;Ba.GalleryPresenceRemovalTime=this.kjc;r.ULS.sendTraceTag(508863559,0,50,`Grid Gallery presence telemetry: ${JSON.stringify(Ba)}`);Wa?this.sCd=!0:this.Xvf=!0}else r.ULS.sendTraceTag(508838665,0,50,"Grid Gallery presence telemetry: EwaControl or SessionStateManager is null")}IZj(){return this.p9a&&!this.kjc}}Hc.Ztd=12E4;Object(d.a)(Hc,"GridGalleryPresenceTelemetry",null,[5]);class Bd{constructor(Wa){this.Ytd=null;this.$=Wa;this.CY={};this.oxb=new Set}dispose(){for(let Wa in this.CY)this.CY[Wa].dispose(),
delete this.CY[Wa];this.CY=null;this.oxb.clear();this.$=this.oxb=null}Dvg(){var Wa=this.$.ea.Vp;for(var Qb of Wa)Wa=Qb.User.UserID,Wa===this.$.ea.clientId||this.oxb.has(Wa)||this.Grd(Wa).aik();for(let Lc in this.CY)this.$.ea.FEb(Lc)||(Qb=this.Grd(Lc),La.EwaSettings.isChangeGateEnabled("OfficeVSO:7941503_LogRemovalPostPresence")&&Qb.IZj()&&(Qb.$hk(),this.icg()))}Evg(Wa,Qb=!1,Lc=!1){Wa===this.$.ea.clientId||this.oxb.has(Wa)||(Wa=this.Grd(Wa),Qb?(Wa.bik(Lc),this.icg()):Wa.cik())}Grd(Wa){if(!this.CY[Wa]){const Qb=
new Hc(Wa,this.$);this.CY[Wa]=Qb}return this.CY[Wa]}Rli(){for(let Wa in this.CY)this.CY[Wa].sCd&&(this.CY[Wa].dispose(),delete this.CY[Wa],this.oxb.add(Wa)),this.Ytd=null}icg(){this.Ytd||n.a.isEmpty(this.CY)||(this.Ytd=z.Task.delay(Hc.o9h()).continueWith(()=>{this.Rli()}))}}Object(d.a)(Bd,"GridGalleryPresenceTelemetryHelper",null,[5]);class he extends ka.a{constructor(Wa,Qb,Lc,Ba,qa=null){super();this.Ox={};this.Jcc=this.Kcc=0;this.lFd=this.jzb=null;this.QCf=3E4;this.Zud=!1;this.J2d=!0;this.hRd=null;
this.RNf=()=>{var gb=this.hra;for(let Bb in gb)gb=Bb,this.DAe(gb)?(this.vuc(gb,!0),delete this.xgb[gb],delete this.hra[gb]):r.ULS.sendTraceTag(537154377,0,50,`PresenceView.OnEcsUserListChanged: pending userId=[${gb}] still not updated`);this.$Ub&&this.BQa.Dvg()};this.uOd=(gb,Bb)=>{gb={};gb.UpdatedCount=Bb.cM?Object.keys(Bb.cM).length:0;gb.DisconnectedCount=Bb.P7?Bb.P7.length:0;gb.Location="canvas";Va.b(this.$).nf($a.a.qRd,gb);gb=null;this.$.Sd&&(gb=this.$.Sd.fi("ModelUpdate","PresenceRendering"),
gb.start());var ic={};if(Bb.cM){if(La.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const Ee=(new Date).getTime();Kb.TaskExtensions.za(La.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigratePresenceTelemetry",!1)?Object(ra.d)(va.a.resolve(ob.oc,{Ja:1})):rb.GetServiceTaskFactory.ud(this.$.ga,435,436,1),Se=>{Se.result.vTi(Ee)},this.$.ka,3)}this.UBb||(this.SGd(!0),this.UBb=!0);const ue=Bb.cM;for(var Cc in ue){var hd=ue[Cc];let Ee=Cc;this.mxd[Ee]=Ka.a.$b.ke;
if(!be.i(this.$)||null==hd.NavigationState)if(this.ePe(Ee,new Date),this.J1g(hd),Ee!==this.jzb){var Pd=this.Ox[Ee];Pd||(this.DAe(Ee)?this.vuc(Ee,!0):(Ee in this.hra?r.ULS.sendTraceTag(537154376,0,50,`PresenceView.OnSelectionPresenceChanged: userId=[${Ee}] already pending update`):(this.xgb[Ee]=Ka.a.$b.ke,ic[Ee]=1),this.hra[Ee]=!0,Pd=this.ddi(Ee),this.Ox[Ee]=this.FUe(Pd)),Pd=this.Ox[Ee],this.$Ub&&this.BQa.Evg(Ee));Pd&&(Pd.xe=hd,hd.SelectedRange&&1<hd.SelectedRange.length?this.Kcc++:this.Jcc++,this.h6f(Ee),
this.V5a(Pd))}}if(La.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")&&this.$.ea&&this.$.ea.OQa){const Ee=(new Date).getTime();Kb.TaskExtensions.za(La.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigratePresenceTelemetry",!1)?Object(ra.d)(va.a.resolve(ob.oc,{Ja:1})):rb.GetServiceTaskFactory.ud(this.$.ga,435,436,1),Se=>{Se.result.wTi(Ee)},this.$.ka,3)}}if(Bb.P7)for(let ue=0,Ee=Bb.P7.length;ue<Ee;ue++)Cc=Bb.P7[ue],this.ehd[Cc]=Ka.a.$b.ke,this.Y5f(Cc,!0);
if(Bb.P7&&0<Bb.P7.length||0<Eb.a(ic).length||0<Eb.a(this.hra).length)Cc=[],Cc.push(...Eb.a(ic)),Cc.push(...Eb.a(this.hra)),(ic=this.$.ga.Da(292))&&ic.mmb(Cc,Bb.P7);gb&&gb.stop();this.Zud=!1;gb=this.Ox;for(let ue in gb)if(0===Object(v.a)(Kd,gb[ue]).xe.CollabMode){this.Zud=!0;break}this.raiseEvent("pcek",Bb)};this.eHa=(gb,Bb)=>{Bb&&this.$.ut&&(Bb.Wub.HasAnyNonOcsCoauthor=this.Zud)};this.cOb=()=>{const gb=new Nb.a({},null),Bb=this.Rta;for(let ic in Bb){const Cc=ic,hd=Bb[ic].xe;hd.SelectedRange=hd.SelectedRangeRaw;
gb.cM[Cc]=hd}this.uOd(this,gb)};this.uf=()=>{this.tlf()};this.zUi=()=>{this.lFd&&Pb.a(Ka.a.$b,this.lFd)<this.QCf||(this.lFd=Ka.a.$b.ke,this.tGd(),this.pRi(),this.$Ri(),this.UBb||this.SGd(!1))};this.EDa=()=>{this.tlf();const gb=this.Ox;for(let Bb in gb)this.V5a(gb[Bb])};this.De=()=>{this.tGd();this.UBb||this.SGd(!1);this.UBb=!1};this.qSf=()=>{const gb=this.Ox;for(let Bb in gb)gb[Bb].dispose();this.Ox={};this.vNe();this.xgb={};this.MZc={};this.LA.length=0;this.jIc()};this.Lga=(gb,Bb)=>{this.G5d(Bb.Ii)};
this.ehd={};this.mxd={};this.xgb={};this.MZc={};this.$=Wa;this.XTa=Ba;this.Bm=Qb;this.Lue=Lc;ge.a.gVb=!0;ge.a.Isa=!0;this.kab();this.qw=new ce.a(Wa);this.$.va&&this.$.va.Ri(this.EDa);this.Bm.C3a(this.Lga);Wa.qa&&this.$.qa.hla(this.eHa);this.LA=[];this.Bm.GMa();Wa.ga.Qa(25,this);this.UBb=!1;this.$.gk(this.De);this.P7c=yb.a.instance.CF(this.zUi,this.QCf/2,ja.a.ioj,!0,!1);this.iRd=qa;this.g7g=La.EwaSettings.isChangeGateEnabled("OfficeVSO:7736608_AvoidLoggingForInactiveUser");if(this.$Ub=La.EwaSettings.isChangeGateEnabled("OfficeVSO:7958832_LogGridGalleryPresenceTelemetryNew"))this.BQa=
this.Kqh(),this.BQa.Dvg()}YKa(Wa){this.addHandler("pcek",Wa)}EEa(Wa){this.removeHandler("pcek",Wa)}get rO(){return this.Lue}get Rta(){return this.Ox}isAnonymousUser(Wa){var Qb,Lc;return null===(Lc=null===(Qb=this.Rta[Wa])||void 0===Qb?void 0:Qb.xe)||void 0===Lc?void 0:Lc.IsAnonymous}j6f(Wa){this.Rta[Wa]&&this.Y5f(Wa,!1)}G5d(Wa){this.jzb&&this.jzb!==Wa.clientId&&(this.J2d=!1);!La.EwaSettings.isChangeGateEnabled("OfficeVSO:5657706_CorrectPresenceBootTelemetry")||this.$.ea.OQa&&lb.PageLoadTrackingInfo.instance.zOj||
(this.J2d=!1);this.rO.hlh(Wa);this.jzb=Wa.clientId}w$h(Wa,Qb){let Lc,Ba;Lc=[];Ba=[];const qa=this.Rta;for(let gb in qa){const Bb=qa[gb];if(Qb){const ic=Za.k(Wa,this.$);this.ajf(ic,Lc,Ba,Bb)}else this.$if(Wa,Lc,Ba,Bb)}return{bzi:Lc,MDh:Ba}}bXe(Wa,Qb,Lc,Ba,qa){(qa=this.Rta[qa])&&(Qb?this.ajf(Wa,Lc,Ba,qa):this.$if(Wa,Lc,Ba,qa))}wki(){const Wa=[],Qb=this.Rta;for(let qa in Qb){var Lc=Qb[qa],Ba=Lc.xe.SelectedRange;if(Ba)for(const gb of Ba){Ba=Za.E(gb);const Bb=$c.h(this.$).ha.ra.x8;if(this.$.va.na.sheetName===
gb.SheetName&&Ba.right===Bb.right&&Ba.top===Bb.top){Lc=Lc.Gn;Lc=new Ta.a(Lc.User.UserID,Lc.User.UserName,Lc.UserColor,new sc.a(1),null,Lc.UserEmail,void 0,void 0,void 0,void 0,void 0,Lc.JoinCoauthTime);Wa.push(Lc);break}}}return Wa}gIc(){ge.a.gVb=!0;ge.a.Isa=!0;const Wa=this.Ox;for(let Qb in Wa)Wa[Qb].gIc()}znc(){ge.a.gVb=!1;ge.a.Isa=!1;const Wa=this.Ox;for(let Qb in Wa)Wa[Qb].znc()}dispose(){this.IXb();this.$&&(this.$.va&&this.$.va.uj(this.EDa),this.$.qa&&this.$.qa.Nra(this.eHa),this.$.Hn(this.De));
this.Bm&&this.Bm.$Cc(this.Lga);this.P7c&&(this.P7c.dispose(),this.P7c=null);if(this.Ox){const Wa=this.Ox;for(let Qb in Wa)Wa[Qb].dispose()}this.$Ub&&this.BQa&&(this.BQa.dispose(),this.BQa=null);jc.a.Fe([this.rO,this.qw]);this.vNe();this.Ox=this.$=this.Lue=null;this.LA.length=0;super.dispose()}get hra(){return this.MZc}Kqh(){return new Bd(this.$)}IXb(){this.rO&&(this.rO.EEa(this.uOd),this.rO.ZAj(this.RNf),this.rO.yCj(this.qSf),this.rO.Fr(this.uf));this.XTa.h7f(this.cOb)}FUe(Wa){return new vd(Wa,this.$,
this.qw)}DAe(Wa){const Qb=this.$.ea.FEb(Wa);if(Qb)if(Wa in this.Ox)this.Ox[Wa].fwg(Qb);else{const Lc=this.FUe(Qb);this.Ox[Wa]=Lc;this.V5a(Lc)}return!!Qb}ajf(Wa,Qb,Lc,Ba){if(Wa)for(const qa of Wa){if(qa){if((Wa=Tb(qa,this.$,1))&&he.Atd(Wa.El,Qb,Lc,Ba))break;if((Wa=Tb(qa,this.$,2))&&he.Atd(Wa.El,Qb,Lc,Ba))break}if(Ba.xe.SelectedRange)for(const gb of Ba.xe.SelectedRange)if(gb&&qa&&pb(qa,gb)){(1===Ba.xe.PresenceType?Lc:Qb).push(Ba.bD.xYb.User);return}}}$if(Wa,Qb,Lc,Ba){Wa&&he.Atd(this.D8h(Wa),Qb,Lc,Ba)}J1g(Wa){Wa.SelectedRange&&
(Wa.SelectedRangeRaw=this.Mwh(Wa.SelectedRange),Wa.SelectedRange=this.XTa.Smh(Wa.SelectedRange))}Mwh(Wa){const Qb=Array(Wa.length);for(let qa=0;qa<Wa.length;qa++){var Lc=qa,Ba=Wa[qa];const gb={};gb.SheetName=Ba.SheetName;gb.FirstColumn=Ba.FirstColumn;gb.FirstRow=Ba.FirstRow;gb.LastRow=Ba.LastRow;gb.LastColumn=Ba.LastColumn;gb.NamedObjectName=Ba.NamedObjectName;Qb[Lc]=gb}return Qb}D8h(Wa){if(Wa)switch(Wa.type){case 0:return(Wa=this.$.Ud.gff(Wa.id))?Wa.El:null;case 2:return Wa.El}return null}kab(){this.rO.YKa(this.uOd);
this.rO.Y_g(this.qSf);this.rO.$Yg(this.RNf);this.rO.kr(this.uf);this.XTa.tCe(this.cOb)}nDf(Wa,Qb,Lc,Ba){const qa={};qa.a=this.$.xa.UserSessionId;qa.b=Wa;qa.c=Lc?"PendingUserRemoved":"Non-PendingUserRemoved";qa.d=Ba?"Disconnected":"Inactivity";qa.e=Qb;cb.b().ih(22,qa,!0)}Y5f(Wa,Qb){Wa in this.Ox&&(this.h6f(Wa),this.Ox[Wa].dispose(),delete this.Ox[Wa],r.ULS.sendTraceTag(537154375,0,50,`PresenceView.RemovePresenceForUser: userId=[${Wa}] removed due to inactivity`),this.nDf(Wa,Ka.a.$b.ke,!1,Qb));Wa in
this.hra&&(this.vuc(Wa,!1),delete this.xgb[Wa],delete this.hra[Wa],r.ULS.sendTraceTag(537154374,0,50,`PresenceView.RemovePresenceForUser: Pending userId=[${Wa}] removed due to inactivity`),this.nDf(Wa,Ka.a.$b.ke,!0,Qb));this.$Ub&&this.BQa.Evg(Wa,!0,!Qb)}h6f(Wa){for(let Qb=this.LA.length-1;0<=Qb;Qb--)if(this.LA[Qb].User.UserID===Wa){this.LA.splice(Qb,1);for(const Lc of this.Ox[Wa].eB)this.qw.usa(Lc.xx.tB,!1);this.jIc()}}$Ri(){if(this.Jcc||this.Kcc)this.$.Me(-70383382,-1,0,null),r.ULS.sendTraceTag(537154373,
0,50,`PresenceView.LogDiscontinuousCountPresenceData: Discontinuous Presence Received with count= [${this.Kcc}], Continuous Presence Received with count= [${this.Jcc}]`);this.Kcc=this.Jcc=0}vNe(){this.tGd();this.MZc=this.xgb=null}tGd(){const Wa=this.hra;for(let Qb in Wa)this.vuc(Qb,!1)}pRi(){var Wa=this.ehd;for(let Qb in Wa)this.WCf(Qb,!0,Wa[Qb]);Wa=this.mxd;for(let Qb in Wa)this.WCf(Qb,!1,Wa[Qb]);this.ehd={};this.mxd={}}us(Wa){var Qb;return(null===(Qb=this.Bm)||void 0===Qb?0:Qb.Ii)?(Wa=this.Bm.Ii.ooa(Wa),
1===(null===Wa||void 0===Wa?void 0:Wa.status)):!1}vuc(Wa,Qb){var Lc=this.g7g?this.us(Wa):!0;if(this.$.ut&&this.$.ea.oe&&Lc){Lc={};Lc.a=this.$.xa.UserSessionId;Lc.b=Wa;Lc.c=Qb;Lc.e=!1;Lc.d=-1;Lc.f=Ka.a.$b.ke;this.$.ea&&(Lc.e=this.$.ea.RP);if(Wa=this.xgb[Wa])Lc.d=Pb.a(Ka.a.$b,Wa);cb.b().ih(20,Lc,!0)}}SGd(Wa){if(this.$.ut){const Qb={e:-1,f:-1,c:!1,d:!1};Qb.b=Wa;Qb.a=this.$.xa.UserSessionId;this.$.ea&&(Qb.c=this.$.ea.OQa,Qb.d=this.$.ea.RP,Qb.e=this.$.ea.Vp.length,this.$.ea.jHa&&(Qb.f=Pb.a(Ka.a.$b,this.$.ea.epk)));
cb.b().ih(21,Qb,!0)}}WCf(Wa,Qb,Lc){if(this.$.ut){const Ba={};Ba.a=this.$.xa.UserSessionId;Ba.b=Wa;Ba.c=Qb;Ba.d=Lc;cb.b().ih(19,Ba,!0)}}tlf(){const Wa=[],Qb=this.Ox;for(let Lc in Qb){const Ba=Qb[Lc];if(this.rO.fdg(Ba.xe)){this.qBe(Wa,Ba);Array.remove(this.LA,Ba.bD.xYb);if(1===this.rO.xe.PresenceType){const qa={};qa.a=1===Ba.xe.PresenceType?"Editing":"Non-Editing";qa.b=this.$.xa.UserSessionId;qa.c=Ka.a.$b.ke;cb.b().ih(18,qa)}for(const qa of Ba.eB)this.qw.usa(qa.xx.tB,!0)}else for(const qa of Ba.eB)this.qw.usa(qa.xx.tB,
!1)}this.LA.length=0;this.LA=Wa;this.jIc()}qBe(Wa,Qb){const Lc=Qb.bD.xYb;if(0===Qb.xe.PresenceType){Qb=Wa.length;let Ba;for(Ba=0;Ba<Qb&&0===this.Ox[Wa[Ba].User.UserID].xe.PresenceType;Ba++);Wa.splice(Ba,0,Lc)}else Wa.push(Lc)}V5a(Wa){this.rO.fdg(Wa.xe)&&(this.qBe(this.LA,Wa),this.jIc());const Qb=Wa.bD.xYb.User.UserID,Lc=this.Ox;for(let qa in Lc){var Ba=Lc[qa];qa!==Qb&&Wa.V5a(Ba)}}jIc(){0<this.LA.length&&this.S1j()}S1j(){for(let Wa=0,Qb=this.LA.length;Wa<Qb;Wa++){const Lc=this.Ox[this.LA[Wa].User.UserID];
if(Lc)if(this.rO.g2f(Lc.xe)){Lc.Clg(!0);for(const Ba of Lc.eB)this.qw.usa(Ba.xx.tB,!0)}else{const Ba=this.rO.jef(Lc.xe);Ba&&Lc.Dlg(!0,Ba)}}}ddi(Wa){const Qb={User:{}};Qb.User.UserID=Wa;Qb.User.UserName=rc.a.instance.xd(87);Qb.UserColor="#AAAAAA";return Qb}ePe(Wa,Qb){this.J2d&&this.iRd&&(Wa&&Qb?this.hRd?this.hRd.OFh(Wa,Qb,this.jzb):this.iRd.continueWith(()=>{this.hRd=this.iRd.result;this.ePe(Wa,Qb)}):r.ULS.sendTraceTag(537154372,0,15,`userId: [${Wa}], endTime: [${Qb}]`))}static Atd(Wa,Qb,Lc,Ba){if(!Ba||
!Ba.xe||!Ba.xe.Object)return!1;for(const qa of Ba.xe.Object)if(Wa&&qa&&qa.ObjectId&&!qa.ObjectId.localeCompare(Wa))return(1===qa.ObjectPresenceType?Lc:Qb).push(Ba.bD.xYb.User),!0;return!1}}Object(d.a)(he,"PresenceView",ka.a,[898,899]);var je;(function(Wa){Wa[Wa.chart=0]="chart";Wa[Wa.image=1]="image";Wa[Wa.slicer=2]="slicer";Wa[Wa.modernOfficeExtension=3]="modernOfficeExtension";Wa[Wa.interactiveReport=4]="interactiveReport";Wa[Wa.shape=5]="shape";Wa[Wa.cardView=6]="cardView";Wa[Wa.group=7]="group";
Wa[Wa.ink=8]="ink";Wa[Wa.E1O=9]="E1O";Wa[Wa.unknown=99]="unknown";Wa[Wa.unsupported=100]="unsupported"})(je||(je={}));Object(d.b)("FloatingObjectType",je);var Fd=a(236),Oc=a(281),Ad=a(30);class Gb extends ka.a{constructor(Wa){super();this.statusBarManager=null;this.$=Wa;this.$.ga.qd(29,Qb=>{this.statusBarManager=Qb;Qb.zM(this)})}Xs(Wa){this.addHandler("OSC",Wa)}Gt(Wa){this.removeHandler("OSC",Wa)}pC(){this.raiseEvent("OSC")}Ru(Wa,Qb){if("QueryOcsConnectionStatus"===Wa)Wa=this.$.ea.Pcb?rc.a.instance.ia(924):
rc.a.instance.ia(925),Ad.a.Yn()?(Qb.LabelText=Wa,Qb.Visible=!0):Qb.Value=Wa;else return!1;return!0}Up(){return!0}dispose(){this.statusBarManager&&(this.statusBarManager.MI(this),this.statusBarManager=null);this.$=null;super.dispose()}}Object(d.a)(Gb,"OcsStatusBarManager",ka.a,[5,295,188]);class Wc extends ka.a{constructor(Wa,Qb){super();this.jqg=this.kqg=this.Ii=null;this.mAc=this.PCf=this.dNc=this.Jdg=!1;this.Wp=()=>{this.$&&this.v_d(0,!1)};this.kk=()=>{this.B7d?this.kqg(!1):(this.xe.PresenceType=
1,this.raiseEvent(Wc.Laa),this.sendPresenceToService(!1))};this.wj=()=>{this.B7d?this.jqg(!1):(this.jjb(!1),this.q_d())};this.rOf=()=>{this.ha.Va.pe?this.v_d(1,!1):this.B_d(0,!1)};this.Rqa=(Lc,Ba)=>{this.raiseEvent(Wc.jRd,Ba)};this.uf=()=>{this.B_d($c.h(this.$).ld?1:0,!1)};this.ff=(Lc,Ba)=>{Fd.a(Ba)&&(this.Tva={})};this.cOb=()=>{this.qdg()};this.TVf=(Lc,Ba)=>{if(Ba&&Ba.methodName in Wc.oAc){Lc=!1;switch(Wc.oAc[Ba.methodName]){case 0:Ba=Ba.parameters.cell;break;case 1:Ba=Ba.parameters.parameters.Location;
break;case 2:Ba=Za.v(this.ha.ra.activeRange,this.$);Lc=!0;break;default:return}Ba.LastColumn=Ba.FirstColumn;Ba.LastRow=Ba.FirstRow;Ba.NamedObjectName=null;this.xe.SelectedRange=[Ba];this.xe.PresenceType=0;if(Lc){Ba=[];for(var qa of this.$.Ud.Dbi())Lc={},Lc.ObjectType=this.cfa(qa.type),Lc.ObjectPresenceType=1,Lc.ObjectId=qa.El,Ba.push(Lc);this.xe.Object=Ba}else qa=Tb(Ba,this.$,1),Ba=null,qa&&(Ba={},Ba.ObjectType=this.cfa(qa.type),Ba.ObjectPresenceType=0,Ba.ObjectId=qa.El),this.xe.Object=[Ba];this.raiseEvent(Wc.Laa);
this.sendPresenceToService(!1)}};this.So=(Lc,Ba)=>{Ba.context.methodName in Wc.oAc&&(this.xe.Object=[null],this.jjb(!1))};this.xj=(Lc,Ba)=>{Ba.context.methodName in Wc.oAc&&(this.xe.Object=[null],this.jjb(!1))};this.wf=(Lc,Ba)=>{Ba.yQ||(this.Tva={},this.$.ut?this.kab():this.IXb())};this.De=()=>{this.mAc&&this.MCf();this.q_d()};this.uyf=()=>{this.qdg();this.bKf.pC()};this.$=Wa;this.ha=$c.h(this.$).ha;this.XTa=Qb;this.$.Zm(this.wf);this.$.gk(this.De);this.Tva={};this.Y1a=new Ta.a(null,null,null,null);
this.gFa={};this.gFa.b=0;this.gFa.c=0;this.bKf=new Gb(this.$);this.B7d=La.EwaSettings.Fd();this.n8e=60*La.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FloatingObjectLogInterval",10);this.yza={};this.B7d&&(this.kqg=Oc.b(Lc=>{this.xe.PresenceType=1;this.raiseEvent(Wc.Laa);this.sendPresenceToService(Lc)},40,this.$.ka,"SelectionPresenceManager.SendPresenceToService",!0),this.jqg=Oc.b(Lc=>{this.jjb(Lc);this.q_d()},40,this.$.ka,"SelectionPresenceManager.SendCurrentPresence",!0));this.Jdg=La.EwaSettings.isChangeGateEnabled("OfficeVSO:6331623_ProcessShapeFOPresence");
this.dNc=La.EwaSettings.isChangeGateEnabled("OfficeVSO:7554748_UseIsAnonymousForPresenceUserV2");this.PCf=La.EwaSettings.isChangeGateEnabled("OfficeVSO:7808895_LogFloatingObjectSelection");(this.mAc=La.EwaSettings.isChangeGateEnabled("OfficeVSO:7941790_LogFloatingObjectSelectionsPeriodically"))&&this.n8e&&this.pSi(this.n8e)}YKa(Wa){this.addHandler(Wc.jRd,Wa)}EEa(Wa){this.removeHandler(Wc.jRd,Wa)}$Yg(Wa){this.$.ea.gda(Wa)}ZAj(Wa){this.$.ea.yaa(Wa)}kr(Wa){this.addHandler(Wc.Laa,Wa)}Fr(Wa){this.removeHandler(Wc.Laa,
Wa)}Y_g(Wa){this.addHandler(Wc.kRd,Wa)}yCj(Wa){this.removeHandler(Wc.kRd,Wa)}get xe(){return this.Tva}get amIAlone(){return!this.$.ea||this.$.ea.amIAlone}dispose(){this.$&&(this.IXb(),this.$.co(this.wf),this.$.Hn(this.De));this.Ii&&this.Ii.CWa(this.Rqa);jc.a.Ma(this.bKf);this.$=this.Ii=null;super.dispose()}hlh(Wa){this.Ii?this.Ii.CWa(this.Rqa):this.kab();(this.Ii=Wa)?(this.Ii.M3a(this.Rqa),this.jjb(!0)):this.IXb()}kab(){this.ha.kr(this.uf);$c.h(this.$).iH(this.Wp);var Wa=$c.h(this.$).he;Wa.Mq(this.wj);
Wa.Gp(this.kk);this.$.ea.Zl(this.ff);this.$.ea.gCe(this.uyf);this.XTa.tCe(this.cOb);Wa=this.$.qa.ua;Wa.ZKa(this.TVf);Wa.St(this.xj);Wa.aA(this.So);this.$.ga.qd(16,Qb=>{Qb.mZg(this.rOf);Qb.lZg(this.wj)})}IXb(){this.ha.Fr(this.uf);$c.h(this.$).NI(this.Wp);const Wa=$c.h(this.$).he;Wa.$p(this.wj);Wa.zp(this.kk);this.$.ea.gm(this.ff);this.$.ea.X6f(this.uyf);this.XTa.h7f(this.cOb);this.$.qa.ua.DWa(this.TVf);this.$.qa.ua.mv(this.xj);this.$.qa.ua.hB(this.So);this.$.ga.qd(16,Qb=>{Qb.hBj(this.rOf);Qb.gBj(this.wj)});
this.raiseEvent(Wc.kRd)}fdg(Wa){return this.g2f(Wa)||!!this.jef(Wa)}g2f(Wa){if(2===this.xe.Version&&this.xe.Object&&2===Wa.Version&&Wa.Object&&0<this.xe.Object.length&&0<Wa.Object.length){var Qb=this.xe.Object.length,Lc=Wa.Object.length;for(var Ba=0;Ba<Qb;Ba++)for(var qa=0;qa<Lc;qa++)if(this.r7c(this.xe.Object[Ba],Wa.Object[qa]))return!0}if(this.xe.SelectedRange&&Wa.SelectedRange)for(Qb=this.xe.SelectedRange.length,Lc=Wa.SelectedRange.length,Ba=0;Ba<Qb;Ba++)for(qa=0;qa<Lc;qa++)if(Wc.Q4g(this.xe.SelectedRange[Ba],
Wa.SelectedRange[qa]))return!0;return!1}jef(Wa){if(2===this.xe.Version&&this.xe.Object&&2===Wa.Version&&Wa.Object&&0<this.xe.Object.length&&0<Wa.Object.length){const Qb=this.xe.Object.length,Lc=Wa.Object.length;for(let Ba=0;Ba<Qb;Ba++)for(let qa=0;qa<Lc;qa++)if(Wc.l2i(this.xe.Object[Ba],Wa.Object[qa]))return this.xe.Object[Ba].ObjectId}return null}r7c(Wa,Qb){return!!Wa&&!!Qb&&Wa.ObjectType===Qb.ObjectType&&(1===Wa.ObjectType||3===Wa.ObjectType)&&!!Wa.ObjectId&&!!Qb.ObjectId&&!Wa.ObjectId.localeCompare(Qb.ObjectId)}qdg(){this.jjb(!1)}jjb(Wa){this.ha.Va.pe?
this.v_d(0,Wa):this.B_d($c.h(this.$).he.ld?1:0,Wa)}v_d(Wa,Qb){var Lc={};this.$.Kl(Lc);var Ba=this.ha.Va.pe;if(Ba){const qa=Ba.floatingObject;Lc.FirstColumn=-1;Lc.FirstRow=-1;Lc.LastColumn=-1;Lc.LastRow=-1;Lc.NamedObjectName=qa?qa.Wi():null;this.xe.SelectedRange=[Lc];this.xe.PresenceType=0;Lc=null;if(this.Jdg){if(null===qa||void 0===qa?0:qa.id)Lc={ObjectType:this.Mdi(qa.type),ObjectPresenceType:Wa,DialogType:0,ObjectId:Ba.El}}else if(qa)switch(qa.type){case 0:if(Ba=this.$.Ud.gff(qa.id))Lc={},Lc.ObjectType=
this.cfa(0),Lc.ObjectPresenceType=Wa,Lc.ObjectId=Ba.El;break;case 2:qa.id&&(Lc={},Lc.ObjectType=this.cfa(9),Lc.ObjectPresenceType=Wa,Lc.ObjectId=qa.El)}this.xe.Object=[Lc];this.mAc&&this.yza&&0<=(null===qa||void 0===qa?void 0:qa.type)&&(Wa=je[qa.type],this.yza[Wa]=void 0===this.yza[Wa]?1:this.yza[Wa]+1);this.PCf&&0<=(null===qa||void 0===qa?void 0:qa.type)&&r.ULS.sendTraceTag(508913565,0,50,`FloatingObjectPresence {"SelectedFloatingObjectType":"${qa.type}",
              "SelectedFloatingObjectName":"${je[qa.type]}"}`)}this.raiseEvent(Wc.Laa);this.sendPresenceToService(Qb)}B_d(Wa,Qb){if(!$c.h(this.$).ld&&!$c.h(this.$).fl){const Ba=this.$.Sd.fi("ModelUpdate","SendRangePresence");Ba.start();var Lc=Za.k(this.ha.ra.selectedRanges,this.$);this.xe.SelectedRange=this.XTa.Rmh(Lc);this.xe.Object=[];for(const qa of Lc)if(Lc=Tb(qa,this.$,1)){const gb={};gb.ObjectType=this.cfa(Lc.type);gb.ObjectPresenceType=0;gb.ObjectId=Lc.El;this.xe.Object.push(gb)}this.xe.PresenceType=
Wa;this.raiseEvent(Wc.Laa);this.xe.SelectedRange||this.xe.Object?this.sendPresenceToService(Qb):r.ULS.sendTraceTag(537154371,0,50,`SelectionPresenceManager.SendRangePresence: skip sending range presence since selected range/object are both null.  UserId: [${this.Ii.clientId}]`);Ba.stop()}}sendPresenceToService(Wa){if(this.$.ea.fgc||!this.$.ea.$bc||Wa)if(this.amIAlone||++this.gFa.b,this.Ii){this.xe.Version=2;this.xe.ClientType=1;this.xe.ChatThreadId=this.Y1a.lad;this.xe.ChatThreadDiscoveryUri=this.Y1a.kad;
this.xe.InChat=this.Y1a.lGb;this.xe.Cid=this.Y1a.email;this.xe.SupportsChat=!!this.Y1a.capabilities&&this.Y1a.capabilities.KQa(4);this.xe.CollabMode=this.$.ea.Pcb?2:0;this.xe.OcsCapable=this.$.ea.ocsCapable;this.dNc&&(this.xe.IsAnonymous=x.AFrameworkApplication.userNameUnknown||x.AFrameworkApplication.limitedEdit);this.Ii.Gdg(this.xe);if(La.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")&&this.$.ea&&this.$.ea.OQa){const Qb=(new Date).getTime();Kb.TaskExtensions.za(La.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigratePresenceTelemetry",
!1)?Object(ra.d)(va.a.resolve(ob.oc,{Ja:1})):rb.GetServiceTaskFactory.ud(this.$.ga,435,436,1),Lc=>{Lc.result.xTi(Qb)},this.$.ka,3)}this.amIAlone||++this.gFa.c}}q_d(){this.$.ut&&(this.gFa.a=this.$.xa.UserSessionId,cb.b().ih(26,this.gFa,!0));this.gFa.b=0;this.gFa.c=0}Mdi(Wa){switch(Wa){case 0:return 0;case 2:return 2;case 5:return 5;default:return-1}}cfa(Wa){switch(Wa){case 0:return 0;case 1:return 1;case 2:return 3;case 9:return 2;default:return-1}}static get oAc(){return Wc.gse||(Wc.gse={["ApplyFilter"]:1,
["ApplyPivot"]:0,["ApplyPivotSort"]:0,["ApplyPivotSortByValue"]:1,["ApplyWellKnownPivotFilter"]:0,["RemovePivotFilter"]:0,["SetCustomFilter"]:1,["SetTop10Filter"]:1,["TogglePivotDrill"]:0,["RefreshAll"]:2})}static l2i(Wa,Qb){return!!Wa&&!!Wa.ObjectId&&!!Qb&&!!Qb.ObjectId&&(0===Wa.ObjectType||2===Wa.ObjectType)&&Wa.ObjectType===Qb.ObjectType&&!Wa.ObjectId.localeCompare(Qb.ObjectId)}static Q4g(Wa,Qb){return!Wa.NamedObjectName&&pb(Wa,Qb)}MCf(){this.yza&&0<Object.keys(this.yza).length&&r.ULS.sendTraceTag(508822753,
0,20,`PresenceFloatingObjectSelections: ${JSON.stringify(this.yza)}`);this.yza={}}pSi(Wa){const Qb=()=>{this.MCf();yb.a.instance.create(Qb,1E3*Wa,"FloatingObjectPresence.logFOSelectionsAtSpecifiedInterval",void 0,!0)};Qb.call(this)}}Wc.jRd="presenceChanged";Wc.kRd="presenceDisabled";Wc.Laa="selectionChanged";Wc.gse=null;Object(d.a)(Wc,"SelectionPresenceManager",ka.a,[918,5,919]);class pd extends U.a{constructor(Wa){super();this.manager=null;this.$=Wa;this.je()}create(){this.manager?this.Ld(this.manager):
Kb.TaskExtensions.za(Object(ra.d)(va.a.resolve(ob.Nb,{Ja:this.Ta})),Wa=>{this.Ld(this.manager||(this.manager=new Wc(this.$,Wa.result)))},this.ka,3)}}Object(d.a)(pd,"SelectionPresenceManagerFactory",U.a,[]);var fe=a(1197),le=a(6),te=a(201);class Ce extends Dd.a{constructor(Wa,Qb,Lc){super();this.uVa=this.lRd=null;this.lOb=(Ba,qa)=>{if(qa.cM){Ba=[];const Bb=[];var gb=$c.h(this.$).ha;const ic=!(2===gb.Bg||128===gb.Bg);gb=ic?Za.k(gb.ra.selectedRanges,this.$):gb.Va.pe.floatingObject;qa=qa.cM;for(let hd in qa)this.presenceView.bXe(gb,
ic,Ba,Bb,hd);for(const hd of this.zNa)Ba.includes(hd)||Bb.includes(hd)||this.presenceView.bXe(gb,ic,Ba,Bb,hd.UserID);this.zNa=[];this.zNa.push(...Ba);this.zNa.push(...Bb);this.lRd&&(jc.a.Ma(this.uVa),this.lRd=this.uVa=null);const Cc=Ce.HJe(Ba,Bb);this.uVa=new te.a;this.lRd=Kb.TaskExtensions.za(z.Task.delay(1),()=>{this.ariaLiveNotifier.RVa(Cc,le.a.kxa)},this.uVa.token,3)}};this.$=Qb;this.ariaLiveNotifier=Wa;this.presenceView=Lc;this.zNa=[];Lc.YKa(this.lOb);this.$.ga.Qa(231,this)}kef(Wa,Qb){this.zNa=
[];({bzi:Wa,MDh:Qb}=this.presenceView.w$h(Wa,Qb));this.zNa.push(...Wa);this.zNa.push(...Qb);return Ce.HJe(Wa,Qb)}dispose(){this.presenceView.EEa(this.lOb);this.uVa&&(jc.a.Ma(this.uVa),this.uVa=null);super.dispose()}static HJe(Wa,Qb){return Wa.length||Qb.length?Qb.length?1===Qb.length?String.format(rc.a.instance.xd(83),Qb[0].UserName):String.format(rc.a.instance.xd(84),Qb.length):1===Wa.length?String.format(rc.a.instance.xd(85),Wa[0].UserName):String.format(rc.a.instance.xd(86),Wa.length):""}}Object(d.a)(Ce,
"PresenceReadoutHandlerService",Dd.a,[900]);const Xb=(Wa,Qb,Lc,Ba,qa,gb,Bb,ic=null)=>{ic=Wa.Pa(1,ic);ic.Id=Qb;ic.OnBehalfOfOcs=Lc;return ia.g(Wa,"CheckPersistedContentUpdate",ic,Ba,qa,gb,Bb,516)},oc=(Wa,Qb,Lc,Ba,qa,gb,Bb,ic=null)=>{ic=Wa.Pa(1,ic);ic.clientIdsToAdd=Qb;ic.clientIdsToRemove=Lc;return ia.g(Wa,"UpdatePresenceUsers",ic,Ba,qa,gb,Bb,0)},Zc=(Wa,Qb,Lc,Ba,qa,gb=null)=>{gb=Wa.Pa(1,gb);return ia.g(Wa,"CheckWorkbookFileNameUpdate",gb,Qb,Lc,Ba,qa,0)},yd=(Wa,Qb,Lc,Ba,qa,gb,Bb,ic=null)=>{ic=Wa.Pa(1,
ic);ic.GenerateNotifications=Qb;ic.DownloadNotifications=Lc;return ia.g(Wa,"UploadLatencyTelemetry",ic,Ba,qa,gb,Bb,128)};class Od{constructor(Wa){this.$=Wa}L$e(Wa){return Wa}SXf(Wa){return Xb(this.$.qa.ua,Wa.Qvh,Wa.gxc,Wa.cJ,null,null,null)}PDe(Wa,Qb){if(!Qb)return Wa;if(!Wa)return r.ULS.shipAssertTag(537154133,0,!1,"CheckPersistedActionAggregationPerformer.AggregateActionParameters: Received null newActionParameters"),Qb;Wa.gxc=Qb.gxc&&Wa.gxc;return Wa}}Object(d.a)(Od,"CheckPersistedActionAggregationPerformer",
null,[894,895]);class dc{}Object(d.a)(dc,"RevisionGeneratedNotification",null,[]);class gd{}Object(d.a)(gd,"StateDownloadedNotification",null,[]);var wd=a(212);class Ld extends Dd.a{constructor(Wa){super();this.mergeSuspensionManager=this.Zf=null;this.FBa=!1;this.SPd=null;this.IJc=this.HJc=this.JJc=this.Pf=!1;this.DOb=(Qb,Lc)=>{this.FBa!==Lc.FBa&&(this.SPd=(this.FBa=Lc.FBa)?null:Ka.a.$b.ke)};this.wf=()=>{this.$.ut&&this.Q6j()};this.ff=(Qb,Lc)=>{Lc.oe||this.Xt(Qb,Lc)};this.Xt=()=>{if(0<this.REa.length||
0<this.xia.count)r.ULS.sendTraceTag(537154128,13,15,`Dropping ${this.REa.length} revisionGeneratedNotifications and ${this.xia.count} stateDownloadedNotifications.`),this.REa=[],this.xia=new wd.a;this.Jvb.cancel();this.rug();this.Y9d();this.agk()};this.TSf=(Qb,Lc)=>{this.O6j();this.P6j();Qb=new dc;Qb.Xluid=Lc.El;Qb.NotificationReceivedOn=Ka.a.$b.ke.toISOString();Qb.CurrentPresenceUserCount=this.$.ea.Vp.length;Qb.OurCollabModeIsUsingOcs=this.$.ea.Pcb;Qb.SenderCollabMode=Lc.QNj;Qb.SenderClientType=
Lc.PNj;Qb.SessionSiteIdentifier=Lc.Saa;Qb.CommandTimeInMs=Lc.ljh;r.ULS.sendTraceTag(537154127,13,50,`ContentLatencyTracker.OnRemoteRevisionGenerated: RevisionGeneratedNotification: ${JSON.stringify(Qb)}`);this.REa.push(Qb)};this.ek=()=>{this.bSe(this.$.ea.xg,"OnBlockCacheConsistent")};this.XSf=(Qb,Lc)=>{(Qb=Object(v.a)(896,Lc.pg))&&this.bSe(Qb.FM,"OnRenderedContent")};this.Lkk=()=>{if(!this.$.ea.oe)r.ULS.sendTraceTag(537154122,13,15,"ContentLatencyTracker.UploadLatencyTelemetryPeriodically: session isn't active");
else if(this.REa.length||this.xia.count){var Qb=null;0<this.REa.length&&(Qb=this.REa,this.REa=[]);var Lc=null;if(0<this.xia.count){Lc=Array(this.xia.count);let Ba=0;for(let qa of this.xia.values)Lc[Ba++]=qa;this.xia=new wd.a}r.ULS.sendTraceTag(537154120,13,100,`ContentLatencyTracker.UploadLatencyTelemetryPeriodically: Uploading ${Qb?Qb.length:0} revisionGeneratedNotifications and ${Lc?Lc.length:0} stateDownloadedNotifications.`);yd(this.$.qa.ua,Qb,Lc,this.ugj,null,null,null)}};this.ugj=Qb=>{Qb.Result&&
0<Qb.Result&&this.zId()};this.$=Wa;this.ya=$c.h(this.$).ya;this.viewport=$c.h(this.$).view;this.contentRefreshManager=this.$.ga.Da(292);this.Ug=this.$.Ug;this.REa=[];this.xia=new wd.a;this.Jvb=yb.a.instance.CF(this.Lkk,3E4,ja.a.Mlh,!1,!1);this.$.Zm(this.wf);this.$.ea.Zl(this.ff);this.$.ea.T5c(this.Xt);La.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ConvertDocumentVisibilityObserverService",!1)?void va.a.resolve(ob.O).then(Qb=>{this.Zf=Qb}):this.$.ga.qd(291,Qb=>{this.Zf=Qb});this.$.ga.qd(343,
Qb=>{this.Pf||(this.mergeSuspensionManager=Qb,this.mergeSuspensionManager.l8b(this.DOb),this.mergeSuspensionManager.pQb())});r.ULS.sendTraceTag(537154131,13,50,"ContentLatencyTracker initialized");this.wf(this.$,null)}dispose(){this.Pf=!0;this.Jvb&&(this.Jvb.dispose(),this.Jvb=null);this.contentRefreshManager&&(this.rug(),this.contentRefreshManager=null);this.ya&&(this.Y9d(),this.ya=null);this.viewport&&(this.Y9d(),this.viewport=null);this.Ug&&(this.Ug=null);this.$&&(this.$.co(this.wf),this.$.ea.gm(this.ff),
this.$.ea.s7f(this.Xt),this.$=null);this.mergeSuspensionManager&&(this.mergeSuspensionManager.BDc(this.DOb),this.mergeSuspensionManager=null);super.dispose()}Q6j(){this.JJc||(this.contentRefreshManager.g0g(this.TSf),this.JJc=!0,this.Jvb.Es())}rug(){this.JJc&&(this.contentRefreshManager.ECj(this.TSf),this.JJc=!1)}O6j(){this.HJc||(this.ya.Ws(this.ek),this.HJc=!0)}Y9d(){this.HJc&&(this.ya.Bs(this.ek),this.HJc=!1)}P6j(){this.IJc||(this.viewport.h0g(this.XSf),this.IJc=!0)}agk(){this.IJc&&(this.viewport.HCj(this.XSf),
this.IJc=!1)}bSe(Wa,Qb){if(Wa!==Ea.a.lg&&!this.xia.kd(Wa)){var Lc=Ka.a.$b.ke.toISOString();Lc=Object(Lb.a)(new gd,{StateId:Wa,DownloadedOn:Lc,IsHidden:this.Zf?this.Zf.hj:"visible"!==window.document.visibilityState,DocumentLastUnhidden:this.Zf&&this.Zf.otc?this.Zf.otc.toISOString():null,LastLostRtcConnection:this.contentRefreshManager&&this.contentRefreshManager.eAf?this.contentRefreshManager.eAf.toISOString():null,LastOffline:this.Ug&&this.Ug.hCa?this.Ug.hCa.toISOString():null});this.mergeSuspensionManager&&
(Lc.IsPendingMergeBlockedByClient=this.FBa,this.SPd&&(Lc.PendingMergeBlockedByClientLastEnded=this.SPd.toISOString()));r.ULS.sendTraceTag(537154124,13,50,`ContentLatencyTracker.CreateAndAddstateDownloadedNotifications: ${Qb} - StateDownloadedNotification: ${JSON.stringify(Lc)}`);this.xia.add(Wa,Lc)}}zId(){x.AFrameworkApplication.Wg&&x.AFrameworkApplication.Wg.zId()}}Object(d.a)(Ld,"ContentLatencyTracker",Dd.a,[]);var Xd=a(932),Ie=a(933);class We extends Sys.EventArgs{constructor(Wa,Qb,Lc,Ba,qa){super();
this.El=Wa;this.QNj=Qb;this.PNj=Lc;this.Saa=Ba;this.ljh=qa}}Object(d.a)(We,"RevisionGeneratedEventArgs",Sys.EventArgs,[]);class jf{constructor(Wa,Qb,Lc,Ba){this.iNc=this.QAc=this.dAc=this.Snc=0;this.Cme=this.wrf=!1;this.clientId=Wa;this.zvh=Qb;this.$=Ba;this.qUi=Yd.a.Of()+Lc}get dvf(){return this.Cme}Xik(){this.QAc||(this.QAc=Yd.a.Of(),this.uCa())}Uik(){this.Snc||(this.Snc=Yd.a.Of(),this.uCa())}Wik(){this.dAc||(this.dAc=Yd.a.Of(),this.uCa())}Yik(Wa){this.iNc||(this.iNc=Yd.a.Of(),this.wrf=Wa,this.uCa())}uCa(Wa=
0){this.dvf||(Wa&&Wa>this.qUi?this.kC(!0):this.QAc&&this.dAc&&this.Snc&&this.iNc&&this.kC(!1))}dispose(){this.$=null}kC(Wa){const Qb={};Qb.CoAuthorsCount=this.$.ea.Vp.length;Qb.HostNotificationTime=this.Snc;Qb.PeerNotificationTime=this.dAc;Qb.PresenceNotificationTime=this.QAc;Qb.UserFetchTime=this.iNc;Qb.IsAlreadyFetchedFromServer=this.wrf;Qb.IsTimeout=Wa;Qb.ClientId=this.clientId;Qb.CurrentUserClientId=this.zvh;La.EwaSettings.isChangeGateEnabled("OfficeVSO:6875242_useStringLiteralToPrintJsonObjectInLogs")?
r.ULS.sendTraceTag(541388879,0,50,`Host Notification Latency Entry: ${JSON.stringify(Qb)}`):r.ULS.sendTraceTag(541388879,0,50,"Host Notification Latency Entry: {0}",Qb);this.Cme=!0}}Object(d.a)(jf,"HostNotificationLatencyEntry",null,[5]);class tc{constructor(Wa,Qb,Lc){this.Qvh=Wa;this.gxc=Qb;this.cJ=Lc}}Object(d.a)(tc,"PersistedContentUpdateActionParameters",null,[]);class Qc{constructor(Wa,Qb,Lc){this.iRc={};this.jRc={};this.cJ=Lc;this.f9b(Wa,this.iRc);this.f9b(Qb,this.jRc)}get hbd(){return Eb.a(this.iRc)}get ibd(){return Eb.a(this.jRc)}get Ytf(){return!this.hbd.length&&
!this.ibd.length}bfk(Wa){this.f9b(Wa.hbd,this.iRc);this.f9b(Wa.ibd,this.jRc)}f9b(Wa,Qb){if(Wa)for(const Lc of Wa)Qb[Lc]=!0}}Object(d.a)(Qc,"UpdatePresenceUsersActionParameters",null,[]);class xd extends ka.a{constructor(Wa,Qb,Lc,Ba){super();this.Ii=null;this.WKd=!1;this.foe=this.currentUserId=this.rwd=null;this.$pc=!1;this.XNd=(qa,gb)=>{if(gb.cM){qa=gb.cM;for(let Bb in qa)(qa=Bb)&&qa!==this.currentUserId&&!this.Y5a.has(qa)&&this.nlc(qa).Xik()}};this.kE=()=>{this.A3f()};this.Vga=(qa,gb)=>{this.WKd=
!0;qa=Object(v.a)(Object,gb.Aba);if(1===gb.type){var Bb=La.EwaSettings.isChangeGateEnabled("OfficeVSO:8030692_IsEditorsTableNotificationEnabled");if(null===qa||void 0===qa?0:qa[Ea.a.Csi]){if(!Bb||!Object(v.a)(String,qa[Ea.a.Qnf]))return;var ic=this.bRe(Object(v.a)(String,qa[Ea.a.Qnf]));Object(v.a)(String,qa[Ea.a.Rnf])===Ea.a.Asi?(ic=[ic],ic[0]===this.currentUserId||this.Y5a.has(ic[0])||this.nlc(ic[0]).Uik(),this.qjg(ic)&&this.mmb(ic,null)):Object(v.a)(String,qa[Ea.a.Rnf])===Ea.a.Bsi&&ic!==this.currentUserId&&
this.mmb(null,null)}else{gb=Array.isArray(gb.Aba)?gb.Aba:null;!gb&&qa&&(gb=Array.isArray(qa[Ea.a.LZe])?qa[Ea.a.LZe]:null);if(gb&&Bb)for(ic of gb)ic===this.currentUserId||this.Y5a.has(ic)||this.nlc(ic).Wik();gb&&!this.qjg(gb)||this.mmb(gb,null);return}}if(qa)if(0===gb.type)({j3f:ic}=this.uvb(qa)).returnValue?(this.wUa(qa),Ea.a.xg in qa&&(this.$.ea.D_(qa[Ea.a.xg],"ContentRefreshManager.OnUpdateNotificationReceived"),this.Jug())):r.ULS.sendTraceTag(22905367,0,50,`RTC ContentUpdate session identifier mismatch. Received: ${ic}. Expected: ${this.$.ea.Saa}. Ignoring this update.`);
else{if(3===gb.type){if(!(Ea.a.Iag in qa)){r.ULS.sendTraceTag(537154117,13,10,"RTC WetContentUpdate does not specify a type. Ignoring this update.");return}gb=qa[Ea.a.Iag];gb===Ea.a.bJj?this.Qoi(qa):gb!==Ea.a.$Ij&&gb!==Ea.a.dJj&&gb!==Ea.a.eJj&&gb!==Ea.a.cJj&&gb!==Ea.a.aJj&&r.ULS.sendTraceTag(537154081,13,50,`RTC WetContentUpdate of unknown type ${gb}. Ignoring this update.`);return}if(4===gb.type){if(this.uvb(qa).returnValue)return;this.$.ea.yCi()&&this.Qfh();if(this.fAj)return;ic=!1;Ea.a.$Xf in qa&&
(ic=qa[Ea.a.$Xf]);if(this.$.ea.Pcb&&ic)return;Bb=qa[Ea.a.Gkj];this.$.ea.oe&&Bb&&this.Fkj.WXf(new tc(Bb,ic,this.G4i))}else if(8===gb.type)return}2===gb.type?qa&&this.uvb(qa).returnValue||(r.ULS.sendTraceTag(537154079,0,50,"RTC : FileNameUpdate received. Now invoking CheckWorkbookFileNameUpdate web method"),Zc(this.$.qa.ua,null,null,null,null)):12!==gb.type||qa&&this.uvb(qa).returnValue||this.raiseEvent("LabelUpdateEventKey")};this.G4i=qa=>{var gb=qa.Errors;Oa.a.Rr(gb)?(gb=Oa.a.uE(gb,[1552731907],"ContentRefreshManager"),
Oa.a.qla(gb)||this.$.ea.Yp(gb)):(gb=qa.StateId+1,qa.Result&&this.$.ea.xg<gb&&this.$.ea.D_(Ea.a.lg,"ContentRefreshManager.OnCheckForUpdateSuccess"))};this.xj=()=>{this.TIj&&this.WKd&&this.$.ea.fgc&&this.Jug()};this.VMf=()=>{this.WKd=!1;this.$.ea.bia=500;this.foe=Ka.a.$b.ke};this.Lga=(qa,gb)=>{this.G5d(gb.Ii)};this.$=Wa;this.Bm=Qb;this.$.qa.St(this.xj);this.Bm.C3a(this.Lga);this.Bm.JBe(this.VMf);this.Fkj=Lc;this.qjk=Ba;this.ZQa={};this.Y5a=new Set;this.$pc=La.EwaSettings.isChangeGateEnabled("OfficeVSO:8030692_IsEditorsTableNotificationEnabled");
this.Bm.GMa();this.$pc&&(this.currentUserId=this.$.workbookContext.ClientId,this.A3f(),this.$.ea.gda(this.kE));this.fAj=La.EwaSettings.isChangeGateEnabled("OfficeVSO:7792548_RemoveWebRequestsForPersistedContentUpdates")}g0g(Wa){this.addHandler("ekcrmrrg",Wa)}ECj(Wa){this.removeHandler("ekcrmrrg",Wa)}J3a(Wa){this.addHandler("ekcrmmcu",Wa)}hib(Wa){this.removeHandler("ekcrmmcu",Wa)}b_g(Wa){this.addHandler("LabelUpdateEventKey",Wa)}QBj(Wa){this.removeHandler("LabelUpdateEventKey",Wa)}get eAf(){return this.foe}get TIj(){return!!this.Ii&&
2===this.Ii.connectionState}mmb(Wa,Qb){this.$.ea.oe&&(r.ULS.sendTraceTag(39150978,0,50,`ContentRefreshManager.UpdatePresenceUsers: clientIdsToAdd=[${Wa?Wa.join(","):"null"}] clientIdsToRemove=[${Qb?Qb.join(","):"null"}]`),this.qjk.WXf(new Qc(Wa,Qb,null)))}dispose(){this.Ii&&(this.Ii.MRb(this.Vga),this.Ii.CWa(this.XNd));this.$&&(this.$.qa.mv(this.xj),this.$.ea.yaa(this.kE));this.Bm&&(this.Bm.$Cc(this.Lga),this.Bm.E6f(this.VMf));this.$=this.Ii=this.Y5a=this.ZQa=null;super.dispose()}G5d(Wa){this.Ii&&
(this.Ii.MRb(this.Vga),this.Ii.CWa(this.XNd));this.Ii=Object(v.a)(239,Wa);this.Ii.O3a(this.Vga);this.$pc&&this.Ii.M3a(this.XNd);this.currentUserId=this.Ii.clientId}A3f(){const Wa=!this.Ii;var Qb=this.$.ea.Vp;for(const Lc of Qb)(Qb=Lc.User.UserID)&&Qb!==this.currentUserId&&!this.Y5a.has(Qb)&&this.nlc(Qb).Yik(Wa)}Qoi(Wa){if(Ea.a.Hag in Wa&&Ea.a.Gag in Wa&&Ea.a.Fag in Wa){var Qb=Wa[Ea.a.Fag];1!==Qb||Ea.a.Saa in Wa&&Ea.a.OEc in Wa||r.ULS.sendTraceTag(537154076,13,10,`RTC WetContentUpdate was sent from ECS and is missing some expected fields. Has SessionSiteIdentifier: ${Ea.a.Saa in
Wa}, Has UserOperationTimeInMs: ${Ea.a.OEc in Wa}.`);var Lc;({j3f:Lc}=this.uvb(Wa)).returnValue||(Wa=new We(Wa[Ea.a.Hag],Wa[Ea.a.Gag],Qb,Lc,Ea.a.OEc in Wa?Wa[Ea.a.OEc]:0),this.raiseEvent("ekcrmrrg",Wa,this))}else r.ULS.sendTraceTag(537154077,13,10,"RTC WetContentUpdate is missing some critical fields. Ignoring this update.")}uvb(Wa){Wa=Ea.a.Saa in Wa?Wa[Ea.a.Saa]:null;return{returnValue:this.$.ea.Saa===Wa,j3f:Wa}}Jug(){this.$.ea.bia=Math.max(xd.m7g,this.$.ea.bia)}qjg(Wa){for(const Qb of Wa)if(!this.$.ea.FEb(Qb))return!0;
return!1}Qfh(){this.$.Me(1562177611,-1,0,null)}wUa(Wa){Ea.a.bHf in Wa&&Ea.a.cHf in Wa&&Ea.a.fHf in Wa&&(Wa=Object(Lb.a)(new Xd.a,{Pending:Wa[Ea.a.cHf],Current:Wa[Ea.a.bHf],SuspensionStartTimestamp:Wa[Ea.a.fHf]}),this.raiseEvent("ekcrmmcu",new Ie.a(Wa),this))}nlc(Wa){Wa=this.bRe(Wa);if(!this.ZQa[Wa]){const Qb=new jf(Wa,this.currentUserId,4E4,this.$);this.ZQa[Wa]=Qb}this.jcg();return Object(v.a)(jf,this.ZQa[Wa])}bRe(Wa){if(!Wa)return Wa;let Qb=Wa.toLocaleLowerCase();Qb.startsWith("{")||(Qb="{"+Wa+"}");
return Qb}jcg(){this.rwd||n.a.isEmpty(this.ZQa)||!this.$pc||(this.rwd=z.Task.delay(2E4).continueWith(()=>{this.zsi()}))}zsi(){const Wa=[],Qb=Yd.a.Of(),Lc=this.ZQa;for(let qa in Lc){var Ba=qa;const gb=Object(v.a)(jf,Lc[qa]);gb.uCa(Qb);gb.dvf&&(gb.dispose(),Wa.push(Ba))}for(const qa of Wa)delete this.ZQa[qa],this.Y5a.add(qa);this.rwd=null;this.jcg()}}xd.m7g=3E4;Object(d.a)(xd,"ContentRefreshManager",ka.a,[897]);var Gd=a(207),pe=a(78);class Dc{constructor(Wa){this.$=Wa}L$e(Wa){return Wa+5E3}SXf(Wa){return this.$.ea.oe?
Kb.TaskExtensions.ts(Kb.TaskExtensions.ts(z.Task.delay(0),()=>oc(this.$.qa.ua,Wa.hbd,Wa.ibd,Wa.cJ,null,null,null),Gd.a.none,0,pe.a.current),()=>z.Task.delay(5E3),Gd.a.none,0,pe.a.current):z.Task.Wa(!0)}PDe(Wa,Qb){if(!Qb)return Wa;if(!Wa)return r.ULS.shipAssertTag(537154073,0,!1,"UpdatePresenceUsersActionAggregationPerformer.AggregateActionParameters: Received null newActionParameter"),Qb;if(Qb.Ytf)return Qb;if(Wa.Ytf)return Wa;Qb.bfk(Wa);return Qb}}Object(d.a)(Dc,"UpdatePresenceUsersActionAggregationPerformer",
null,[894,895]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.CoauthTelemetry");Xa.main();Type.registerNamespace("Common.App.CollabControls");Type.registerNamespace("Common.App.Presence");Type.registerNamespace("RealtimePresenceUI");(()=>{vc.a.Ga(Wa=>{La.EwaSettings.H9()||wb.la(Wa)})})();(()=>{vc.a.Ga(Wa=>{La.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")&&(La.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigratePresenceTelemetry",
!1)||qb.la(Wa));const Qb=Wa.ga;Qb.Qa(158,new pd(Wa));vc.a.Ga(gb=>{La.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigratePresenceConverter",!1)||ua.la(gb)});const Lc=rb.GetServiceTaskFactory.create(Wa.ga,158,Qb.ka,1),Ba=Object(ra.d)(va.a.resolve(ob.Nb,{Ja:1})),qa=La.EwaSettings.H9()?Object(ra.d)(va.a.resolve(ob.vc,{Ja:4})):z.Task.Wa(null);Kb.TaskExtensions.za(Kb.TaskExtensions.Wf([Lc,Ba,qa],Qb.ka),()=>{const gb=new t.a,Bb=La.EwaSettings.H9()?qa.result:Qb.Da(26);Bb.aUe(Object(f.a)(gb,
gb.setResult,"setResult"));const ic=new he(Wa,Bb,Lc.result,Ba.result,fa.a.ar(ma.a.instance.Qd("Common.App.CoauthTelemetry.IPresenceBootTelemetry")));bc.a.getInstance(Wa.ga).add(ic);La.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigratePresenceConverter",!1)||Qb.Qa(159,new ua);Kb.TaskExtensions.za(La.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigratePresenceConverter",!1)?Object(ra.d)(va.a.resolve(ob.nc,{Ja:1})):rb.GetServiceTaskFactory.create(Qb,159,Qb.ka,1),Cc=>{const hd=
new t.a;hd.setResult(ic);new ec(Object(Lb.a)(new Ta.a,{clientId:Wa.workbookContext.ClientId}),gb.task,hd.task,Cc.result,ib.a.instance,x.AFrameworkApplication.da.pa("AwayStatusOneMinuteTimeoutIsEnabled")?6E4:x.AFrameworkApplication.da.Hf("AwayCoauthorThresholdMs",9E5),Object(f.a)(x.AFrameworkApplication.Dd,x.AFrameworkApplication.Dd.processAction,"processAction"),W.instance)},Qb.ka)},Qb.ka,3);ma.a.instance.register(877,"Microsoft.Office.Excel.WebUI.Client.ISessionStateManager").as("Common.ICoauthoringTelemeryInfoProvider").Ee().Le(()=>
Wa.ea);ma.a.instance.resolve("Common.ICoauthoringTelemeryInfoProvider");ma.a.instance.register(Ha,"Microsoft.Office.Excel.WebUI.Client.Presence.PeopleInfoProvider").as("Common.IPeopleInfoProvider").Ee().Le(()=>new Ha(Wa));ma.a.instance.resolve("Common.IPeopleInfoProvider")})})();vc.a.Ga(fe.a.la);vc.a.Ga(Wa=>{const Qb=Wa.ga,Lc=La.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Migrate2AriaLiveNotifier",!1)?Object(ra.d)(va.a.resolve(ob.f,{Ja:1})):rb.GetServiceTaskFactory.ud(Wa.ga,211,212,
1);Qb.qd(25,Ba=>{Kb.TaskExtensions.za(Lc,qa=>{Qb.Da(231)||new Ce(qa.result,Wa,Ba)},Qb.ka,3)})});(()=>{vc.a.Ga(Wa=>{const Qb=va.a.resolve(ob.Hc,{Ja:0}),Lc=La.EwaSettings.H9()?va.a.resolve(ob.vc,{Ja:4}):null;void Promise.all([Qb,Lc]).then(([Ba,qa])=>{var gb=La.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ConvertDocumentVisibilityObserverService",!1)?va.a.zg(ob.O):Wa.ga.Da(291);var Bb=new Od(Wa);gb=Ba.TRe(Bb,Bb,gb,"persisted");Bb=new Dc(Wa);Ba=Ba.TRe(Bb,Bb,null,"updatePresence");La.EwaSettings.H9()?
Wa.ga.Qa(292,new xd(Wa,qa,gb,Ba)):Wa.ga.Qa(292,new xd(Wa,Wa.ga.Da(26),gb,Ba));bc.a.getInstance(Wa.ga).add(new Ld(Wa));bc.a.getInstance(Wa.ga).add(gb)})})})();String(b);String(c);String(k);String(h);window.___1689695406604_closurehack=b;window.___1689695406604_closurehack=c;window.___1689695406604_closurehack=k;window.___1689695406604_closurehack=h},756:function(w,C,a){a.r(C);a.d(C,"RtcUtils",function(){return k});w=a(0);var b=a(14),c=a(801),h=a(42);class k{static oad(d,f=c.RealtimeChannel.FId){let u;
try{u=h.c(d)}catch(r){throw d=String.format("Failed to JSON-serialize payload : {0}",r),b.ULS.sendTraceTag(18637072,500,10,d),Error.argument("payload",d);}if(u.length>f)throw d=String.format("Payload exceeds maximum length: {0} > {1}.",u.length,f),b.ULS.sendTraceTag(18637074,500,10,d),Error.argument("payload",d);return u}static deserialize(d,f,u){if(!d)return null;if(Object.getType(d)!==String){var r=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",
f,Object.getType(d).getName(),u);b.ULS.sendTraceTag(18637075,500,10,r);return null}r=null;try{r=h.a(d)}catch(t){d=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",f,t,u),b.ULS.sendTraceTag(18637077,500,10,d)}return r}static Xeb(d){if(!d)return"";if("string"===typeof d)return d.toString();try{return h.c(d)}catch(f){return d.toString()}}static hTh(d){let f,u,r;f=0;r=u=null;if(!d)return{fof:f,hof:u,exception:r};try{const t=d.source;t&&Object.getType(t)===
String&&(r=t);const v=d.context;v&&(d=v,f=d.status?d.status:0,u=d.statusText?d.statusText:null)}catch(t){}return{fof:f,hof:u,exception:r}}}Object(w.a)(k,"RtcUtils",null,[])},788:function(w,C,a){a.r(C);w=a(0);var b=a(14),c=a(79),h=a(113),k;(function(r){r[r.SendNotification=0]="SendNotification";r[r.SendPersistentState=1]="SendPersistentState";r[r.FindSession=2]="FindSession";r[r.Last=3]="Last"})(k||(k={}));Object(w.b)("ApiType",k);var d;(function(r){r[r.AttemptCount=0]="AttemptCount";r[r.SuccessCount=
1]="SuccessCount";r[r.DropCount=2]="DropCount";r[r.FailedCount=3]="FailedCount";r[r.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";r[r.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";r[r.ThrottledCount=6]="ThrottledCount";r[r.Last=7]="Last"})(d||(d={}));Object(w.b)("EventCountType",d);var f=a(930);a.d(C,"FrequentLoggingMetrics",function(){return u});class u{constructor(r){this.zQe=this.C7e=null;this.uGf=this.F9e=0;this.eo=null;this.dpe=this.QXc=0;this.Qi=r;this.axi();this.YSc=
this.Hje=this.nYc=!1;this.LXc=0}get QSh(){return this.YSc}Z4j(r){this.dpe=r;window.setInterval(Object(c.a)(this,this.LGd,"logMetricsBatchAndReset"),r);this.QXc=(new Date).getTime()}KA(r,t){this.IWj(r)&&!this.Hje||this.QSh||!window.navigator.onLine||this.Qi.Xbb||(this.eo[r][t]++,this.nYc=!0)}axi(){this.eo=Array(3);for(let r=0;3>r;r++){this.eo[r]=Array(7);for(let t=0;7>t;t++)this.eo[r][t]=0}}I$g(){const r={};for(let t=0;3>t;t++)for(let v=0;7>v;v++)this.aMi(t,v)&&(r[k[t]+d[v]]=this.eo[t][v]);r.FSDomain=
this.C7e;r.ConnectionDomain=this.zQe;r.FSRetryInterval=this.F9e;r.MaxPayloadSize=this.uGf;r.LogNumber=this.LXc;1===this.LXc&&(r.FSLatencies=f.a.instance.j8h(),r.ConLatencies=f.a.instance.W4h());return r}aMi(r,t){return 2===r&&3!==t&&0!==t?!1:!0}IWj(r){return 2===r?!1:!0}LGd(){if(this.nYc){this.LXc++;if((new Date).getTime()-this.QXc<5E3+this.dpe){var r=h.a.toJSON(this.I$g());b.ULS.sendTraceTag(50644352,500,15,r)}this.QXc=(new Date).getTime();for(r=0;3>r;r++)for(let t=0;7>t;t++)this.eo[r][t]=0;this.nYc=
!1}}xWi(){this.Hje=!0}static get instance(){return u.La}static create(r){u.instance||(u.La=new u(r));return u.instance}}u.La=null;Object(w.a)(u,"FrequentLoggingMetrics",null,[940])},801:function(w,C,a){a.r(C);w=a(0);var b=a(14),c=a(79),h=a(179),k=a(931),d=a(106),f=a(5);class u{constructor(Ea,sb){this.status=Ea;this.udb=sb}}Object(w.a)(u,"UserStatusInfo",null,[]);var r=a(64),t=a(930);class v{constructor(Ea,sb){this.data=Ea;this.timeStamp=sb}}Object(w.a)(v,"PresenceData",null,[]);class x{constructor(Ea){this.Pca=
!1;this.R2a=0;this.GRc=!1;this.setTimeout=x.Cgd;this.clearTimeout=x.sgd;this.AUi=Object(c.a)(this,this.QTi,"logRtcConnectingUsageStatement");this.Wm=Ea}u5i(){this.Pca||(this.R2a=this.setTimeout(()=>{this.Pca=!1;this.wDf()},8E3),this.Pca=!0,this.GRc=!1)}x6i(){this.IP()}ifj(){this.wDf()}wDf(){this.IP();this.GRc||(this.GRc=!0,this.AUi())}QTi(){b.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",this.Wm)}IP(){this.Pca&&this.clearTimeout(this.R2a);this.R2a=0;this.Pca=
!1}static Cgd(Ea,sb){return window.setTimeout(Ea,sb)}static sgd(Ea){window.clearTimeout(Ea)}}Object(w.a)(x,"ConnectedUsageKpiLogger",null,[964]);class m{constructor(){this.r3f=this.OTd;this.u3f=this.RTd;this.t3f=this.QTd;this.y3f=this.TTd;this.x3f=this.STd;this.YTd=this.ZTd;this.HQb=this.WTd;this.$Va=this.UTd;this.aWa=this.VTd;this.s3f=this.PTd;this.Feb=this.nKd;this.HMb=this.pKd}OTd(){}RTd(){}QTd(){}TTd(){}STd(){}WTd(){}VTd(){}UTd(){}ZTd(){}PTd(){}nKd(){}pKd(){}}Object(w.a)(m,"NoopRealtimeChannelMetrics",
null,[957,95]);class l{}l.ZXb="presenceUpdated";l.updateNotification="updateNotification";l.cYf="persistentStateCleared";l.updatePersistentState="persistentStateUpdated";Object(w.a)(l,"RtcClientMethodNames",null,[]);class n{}n.Qsi="realtimeChannelHub";n.ZXb="UpdatePresence";n.Qaa="SendUpdateNotification";n.hpd="GetCompletePersistentStateWithMetadata";n.updatePersistentState="UpdatePersistentState";n.$lb="UpdateClientInfo";Object(w.a)(n,"RtcHubMethodNames",null,[]);class z{constructor(Ea){this.Au=
Ea}Kxj(Ea){this.Au.on(l.ZXb,Ea)}myj(Ea){this.Au.on(l.updateNotification,Ea)}Hxj(Ea){this.Au.on(l.updatePersistentState,Ea)}Gxj(Ea){this.Au.on(l.cYf,Ea)}Gfk(Ea){this.Au.off(l.ZXb,Ea)}Pfk(Ea){this.Au.off(l.updateNotification,Ea)}Ffk(Ea){this.Au.off(l.updatePersistentState,Ea)}Efk(Ea){this.Au.off(l.cYf,Ea)}ZXb(Ea){return this.Au.invoke(n.ZXb,Ea)}$lb(Ea){return this.Au.invoke(n.$lb,Ea)}Qaa(Ea,sb){return this.Au.invoke(n.Qaa,Ea,sb)}hpd(Ea){return this.Au.invoke(n.hpd,Ea)}updatePersistentState(Ea,sb){return this.Au.invoke(n.updatePersistentState,
Ea,sb)}}Object(w.a)(z,"RealtimeChannelProxy",null,[961,962,963]);class y{constructor(){this.dQc=this.ffe=!1;this.bQc=0;this.kRc=this.$0c=this.Z0c=this.yPc=!1;this.nTc=0;this.fue=!1;this.eue=this.due=0;this.g0c=!1;this.l0c=this.j0c=this.m0c=this.h0c=0;this.k0c=!1}get j7g(){return this.dQc}get i7g(){return this.bQc}get x2g(){return this.yPc}get PXj(){return this.Z0c}get QXj(){return this.$0c}get Jhh(){return this.kRc}get xic(){return this.nTc}get rtcJsClientFrequentlyLogsMetrics(){return this.fue}get Kag(){return this.due}get ZIj(){return this.eue}get rtcClientMessageTelemetryEnabled(){return this.g0c}get VIj(){return this.h0c}get Pag(){return this.m0c}get Mag(){return this.j0c}get Oag(){return this.l0c}get Nag(){return this.k0c}static createInstance(Ea){const {RealtimeChannel:sb}=
a(801);return Ea?Object.assign(new y,{ffe:Ea.pa("AwayStatusManagerIsEnabled"),dQc:Ea.pa("AwayStatusOneMinuteTimeoutIsEnabled"),bQc:Ea.Hf("AwayCoauthorThresholdMs",9E5),yPc:Ea.pa("RtcAllowCrossDomainAccessEnabled"),Z0c:Ea.pa("ShouldLogOnContentNotification"),$0c:Ea.pa("ShouldLogOnHostSubscriptionNotification"),kRc:Ea.pa("RtcClientMetricsEnabled"),nTc:Ea.Hf("RtcFindSessionRequestTimeoutInMS",6E4),fue:Ea.pa("RtcJsClientFrequentlyLogsMetrics"),due:Ea.Hf("RtcJsClientFrequentMetricsLatencyThresholdInMS",
1E3),eue:Ea.Hf("RtcJsClientFrequentMetricsLogIntervalInMS",3E5),g0c:Ea.pa("RtcClientMessageTelemetryEnabled"),h0c:Ea.Hf("RtcClientMessageTelemetrySampleSize",5),m0c:Ea.Hf("RtcSendTelemetryMessageIntervalInMS",3E5),j0c:Ea.Hf("RtcLogClientMessageMetricsTimeOutInMs",2E4),l0c:Ea.Hf("RtcMaxPayloadSizeInCharactersOverride",sb.FId),k0c:Ea.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RTCLogSignalrHeartBeatMessages",!1)}):Object.assign(new y,{ffe:!1,dQc:!1,bQc:9E5,yPc:!1,Z0c:!1,$0c:!0,kRc:!1,nTc:9E4,
g0c:!1,h0c:5,m0c:3E5,j0c:2E4,l0c:sb.FId,k0c:!1})}}Object(w.a)(y,"RealtimeChannelSettings",null,[960]);var B=a(1175),G=a(138),E=a(387);class J{constructor(Ea){this.$sb=null;this.Tha=0;this.MOa=!1;this.ej=Ea;this.ej.E6(Object(c.a)(this,this.tZ,"onConnectionStateChanged"))}tZ(Ea,sb){this.Tha=sb.newState}Yfj(){b.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.ej.EBc()}Bvi(Ea){this.$sb.init(Ea)}}Object(w.a)(J,"ARtcMessageHandler",null,[]);var I=a(372);
class R{constructor(){this.Presence=null;this.TimeStamp=0}}Object(w.a)(R,"PresenceDataEntryForClients",null,[]);var X=a(113);class H{constructor(Ea,sb=""){this.TPg=Ea;this.nM=sb}send(){return this.TPg()}get messageId(){return this.nM}}Object(w.a)(H,"MessageHandler",null,[976]);var M=a(1007);class O extends Sys.EventArgs{constructor(Ea,sb,Oa,La){super();this.OWd=Ea;this.reconnectDelay=sb;this.reason=Oa;this.p_d=La}}Object(w.a)(O,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);var L=a(1043);class S{constructor(){this.B1c=
this.hr=null}get Te(){return this.hr?this.B1c?this.B1c.getTime()-this.hr.getTime():(new Date).getTime()-this.hr.getTime():0}start(){this.hr=new Date}stop(){this.B1c=new Date}}Object(w.a)(S,"SimpleStopwatch",null,[]);var T=a(1044),V;(function(Ea){Ea[Ea.contentUpdate=0]="contentUpdate";Ea[Ea.editorsTableUpdate=1]="editorsTableUpdate";Ea[Ea.fileNameUpdate=2]="fileNameUpdate";Ea[Ea.wetContentUpdate=3]="wetContentUpdate";Ea[Ea.persistedContentUpdate=4]="persistedContentUpdate";Ea[Ea.clientRtcReconnectRequest=
5]="clientRtcReconnectRequest";Ea[Ea.replicationTelemetry=6]="replicationTelemetry";Ea[Ea.lockUpdate=7]="lockUpdate";Ea[Ea.collabServiceContentUpdate=8]="collabServiceContentUpdate";Ea[Ea.trackChangeSettingUpdate=9]="trackChangeSettingUpdate";Ea[Ea.saveTargetUpdate=10]="saveTargetUpdate";Ea[Ea.uploadToOcsUpdate=11]="uploadToOcsUpdate";Ea[Ea.labelUpdate=12]="labelUpdate";Ea[Ea.hostNotificationSubscriptionStatus=13]="hostNotificationSubscriptionStatus";Ea[Ea.subscribeOrExtend=14]="subscribeOrExtend";
Ea[Ea.elapsedBootTelemetry=15]="elapsedBootTelemetry";Ea[Ea.clientToClientTelemetryMessage=16]="clientToClientTelemetryMessage";Ea[Ea.clientToClientResponseMessage=17]="clientToClientResponseMessage";Ea[Ea.verifyNotificationPipeline=18]="verifyNotificationPipeline";Ea[Ea.hostNotificationHeartbeat=19]="hostNotificationHeartbeat";Ea[Ea.secondaryMetadataUpdate=20]="secondaryMetadataUpdate";Ea[Ea.last=21]="last"})(V||(V={}));Object(w.b)("UpdateNotificationType",V);var la=a(593),Z=a(613),da=a(614);class ba extends J{constructor(Ea,
sb,Oa,La,ia,Sa,Za,Ab,pb,Tb){super(Za);this.Au=null;this.Iqb=this.Yoe=!1;this.nM=0;this.KZc=new E.a;this.lMg=ba.f5h();this.vZc=f.AFrameworkApplication.da.Sa("OwningFeatureCrewForRtcNotificationKpis");this.tg=Ea;this.Bqe=this.Aqe=0;this.$sb=sb;this.$sb.m8b(Object(c.a)(this,this.Yfj,"onTooManyUndeliveredMessages"));this._clientId=Oa;this.GOg=ia;this.ej.e0g(Object(c.a)(this,this.cdj,"onRefreshProxyRequired"));this.ej.c0g(Object(c.a)(this,this.bdj,"onRefreshAllPersistentStateRequest"));this.ej.z0g(Object(c.a)(this,
this.Qaa,"sendUpdateNotification"));this.ej.PZg(Object(c.a)(this,this.$$i,"onInternalPresenceUpdated"));this.ej.QZg(Object(c.a)(this,this.aaj,"onInternalUpdateNotificationReceived"));this.ej.OZg(Object(c.a)(this,this.Z$i,"onInternalPersistentStateUpdated"));this.ej.NZg(Object(c.a)(this,this.Y$i,"onInternalPersistentStateCleared"));this.ej.y0g(Object(c.a)(this,this.CTb,"sendPersistentState"));this.ej.W0g(Object(c.a)(this,this.$lb,"updateClientInfo"));this.Hj=Sa;this.Wm=La;this.eo=Ab;this.ZE=pb;this.Sqb=
Tb;this.mua=Object(G.a)(String,f.AFrameworkApplication.Yd.Application)||""}cdj(Ea,sb){this.Au=this.GOg(sb.hubConnection);this.$sb.reset();this.Au.Kxj(Object(c.a)(this,this.Rqa,"onPresenceUpdated"));this.Au.Hxj(Object(c.a)(this,this.K3,"onPersistentStateUpdated"));this.Au.Gxj(Object(c.a)(this,this.SNd,"onPersistentStateCleared"));this.Au.myj(Object(c.a)(this,this.Vga,"onUpdateNotificationReceived"))}tZ(Ea,sb){this.Tha=sb.newState;2===sb.newState&&this.sNj()}sNj(){for(const Ea of this.KZc)this.Qaa(null,
new L.a(Ea.key,Ea.value,!1,new h.a));this.KZc=new E.a}bdj(Ea,sb){sb.Lad();for(Ea=0;3>Ea;++Ea)this.aNj(Ea,sb)}aNj(Ea,sb){try{this.Au.hpd(Ea).done(Oa=>{sb.Dmb(sb.Gcd,"GetCompletePresenceSuccess")&&(sb.ilh.ifj(),b.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}] of type [{1}]",this.Wm,Ea),this.ej.tsj(),this.ocj(Ea,Oa),this.ej.Qrj(Oa),sb.Q5e.kd(Ea)&&this.ej.R1f(Ea,sb.Q5e.ma(Ea),new h.a))}).fail(Oa=>{const {RtcUtils:La}=a(756);sb.Dmb(sb.Gcd,"GetCompletePresenceFail")&&
(b.ULS.sendTraceTag(3249541,500,15,"Failed to retrieve complete session state : {0} for [{1}] of type [{2}]",La.Xeb(Oa),this.Wm,Ea),this.ej.EBc())}).always(()=>{sb.stopwatch&&sb.stopwatch.stop()})}catch(Oa){b.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",sb.Gcd,Oa.message)}}CTb(Ea,sb){var {RtcUtils:Oa}=a(756);Ea=sb.presence;let La;const ia=sb.gta;this.ZE.KA(1,
0);try{La=Oa.oad(Ea,this.Sqb)}catch(Za){this.ZE.KA(1,3);b.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",Za.message);ia.setException(Za);return}Oa=new d.a;Oa.fa(this._clientId,Object.assign(new R,{Presence:Ea,TimeStamp:(new Date).getTime()}));this.ej.Z1f(sb.type,Oa);if(2!==this.Tha)this.eo.$Va(),this.ZE.KA(1,2),ia.setResult(null);else{var Sa=this.nM.toString();++this.nM;Ea=new H(()=>this.uNj(sb.type,La,Sa),Sa);Ea=this.qqg(0,sb.type).add(Ea);
Ea.nyc(Za=>{2===Za&&(this.ZE.KA(1,6),this.Iqb||2!==sb.type||b.ULS.sendTraceTag(508651234,500,15,"First persistent state update of type LiveMeeting for [{0}] was throttled",this.Wm));ia.setResult(null)});Ea.myc(()=>{})}}uNj(Ea,sb,Oa){let La=null;const ia=new S,Sa=new M.a;b.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}] of type [{1}]",this.Wm,Ea);if(2!==this.Tha)return this.eo.$Va(),this.ZE.KA(1,2),b.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}] of type [{1}]",
this.Wm,Ea),Sa.AId(),Sa;this.Hj&&20>this.Aqe&&(La=this.Hj.Ze("WebServiceCall","Send Presence Message"),this.Aqe++);ia.start();Sa.MLb(1);try{this.Au.updatePersistentState(Ea,sb).done(()=>{this.eo.HQb();this.ZE.KA(1,1);b.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}] of type [{2}]",Oa,this.Wm,Ea);Sa.ICa(1);ia&&(ia.stop(),ia.Te>this.tg.Kag?this.ZE.KA(1,4):this.ZE.KA(1,5))}).fail(Za=>{const {RtcUtils:Ab}=a(756);this.MOa||(this.eo.$Va(),this.ZE.KA(1,3),
this.Iqb||2!==Ea||b.ULS.sendTraceTag(508651233,500,15,"First persistent state update of type LiveMeeting for [{0}] failed",this.Wm),b.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",Oa,Ab.Xeb(Za),this.Wm));Sa.ICa(2)}).always(()=>{La&&La.stop()})}catch(Za){b.ULS.sendTraceTag(593072906,500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",Za.message),this.ZE.KA(1,3),this.Iqb||2!==Ea||b.ULS.sendTraceTag(508651232,500,
15,"First persistent state update of type LiveMeeting for [{0}] hit an exception",this.Wm),Sa.ICa(2)}return Sa}$lb(Ea,sb){({RtcUtils:Ea}=a(756));const Oa=sb.Ihh,La=sb.gta;let ia;try{ia=Ea.oad(Oa,this.Sqb)}catch(Sa){b.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",Sa.message);La.setException(Sa);return}try{this.Au.$lb(ia).done(()=>{b.ULS.sendTraceTag(544319E3,500,50,"Successfully delivered clientInfo.")}).fail(Sa=>{const {RtcUtils:Za}=
a(756);this.MOa||b.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",Za.Xeb(Sa));La.setResult(null)})}catch(Sa){b.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",Sa.message),La.setResult(null)}}Qaa(Ea,sb){({RtcUtils:Ea}=a(756));const Oa=sb.type,La=sb.Aba,ia=sb.nyh,Sa=sb.gta;let Za;this.ZE.KA(0,0);try{Za=Ea.oad(La,this.Sqb)}catch(pb){this.ZE.KA(0,3);b.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",
pb.message);Sa.setException(pb);return}if(2!==this.Tha)ia?this.KZc.fa(Oa,La):(this.eo.$Va(),this.ZE.KA(0,2)),Sa.setResult(null);else{var Ab=this.nM.toString();++this.nM;sb=new H(()=>this.ONj(Oa,Za,Ab),Ab);sb=this.qqg(1,Oa).add(sb);sb.nyc(pb=>{2===pb&&this.ZE.KA(0,6);Sa.setResult(null)});sb.myc(()=>{})}}ONj(Ea,sb,Oa){let La=null;const ia=new S,Sa=new M.a;b.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}] of type [{1}]",this.Wm,Ea);if(2!==this.Tha)return this.eo.$Va(),this.ZE.KA(0,
2),b.ULS.sendTraceTag(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",this.Wm),Sa.AId(),Sa;this.Hj&&3===Ea&&20>this.Bqe&&(La=this.Hj.Ze("WebServiceCall","Send WetContent Update"),this.Bqe++);ia.start();Sa.MLb(1);this.Au.Qaa(Ea,sb).done(()=>{this.eo.HQb();this.ZE.KA(0,1);b.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}] of type [{2}]",Oa,this.Wm,Ea);Sa.ICa(1);ia&&(ia.stop(),ia.Te>this.tg.Kag?this.ZE.KA(0,4):this.ZE.KA(0,
5))}).fail(Za=>{const {RtcUtils:Ab}=a(756);this.MOa||(this.eo.$Va(),this.ZE.KA(0,3),b.ULS.sendTraceTag(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",Oa,Ab.Xeb(Za),this.Wm));Sa.ICa(2)}).always(()=>{La&&La.stop()});return Sa}vy(){this.Au.Gfk(Object(c.a)(this,this.Rqa,"onPresenceUpdated"));this.Au.Ffk(Object(c.a)(this,this.K3,"onPersistentStateUpdated"));this.Au.Efk(Object(c.a)(this,this.SNd,"onPersistentStateCleared"));this.Au.Pfk(Object(c.a)(this,
this.Vga,"onUpdateNotificationReceived"))}$$i(Ea,sb){this.Rqa(sb.cM,sb.P7)}Rqa(Ea){this.eo.aWa();this.K3(0,Ea)}Z$i(Ea,sb){this.K3(sb.type,sb.cM)}ocj(Ea,sb){const Oa={};for(const La in sb)Oa[La]=sb[La].Presence;this.aSf(Ea,Oa,sb)}K3(Ea,sb){this.eo.aWa();this.aSf(Ea,sb)}aSf(Ea,sb,Oa=null){var {RtcUtils:La}=a(756);if(b.ULS.kia(500,100))for(var ia in sb);delete sb[this._clientId];if(!X.a.isEmpty(sb)){for(var Sa in sb)ia=Sa,sb[ia]=La.deserialize(sb[Sa],"Presence",ia,!1,this.Sqb);La=new d.a;Sa=(new Date).getTime();
for(const Za in sb){ia=sb[Za];const Ab=Za;let pb;Oa?(pb=Oa[Ab],pb.Presence=ia):pb=Object.assign(new R,{Presence:ia,TimeStamp:Sa});La.fa(Ab,pb)}this.ej.Z1f(Ea,La);switch(Ea){case 0:this.Yoe||(b.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this.Wm),this.Yoe=!0,f.AFrameworkApplication.Wg&&f.AFrameworkApplication.Wg.uWi());this.ej.I1f(sb,[]);break;case 2:this.Iqb||(b.ULS.sendTraceTag(508867081,500,50,"Raising first live meeting update notification for [{0}]",
this.Wm),this.Iqb=!0);this.ej.H1f(Ea,sb);break;default:this.ej.H1f(Ea,sb)}}}Y$i(Ea,sb){this.SNd(sb.lbd)}SNd(Ea){this.eo.aWa();if(b.ULS.kia(500,100))for(let sb=0;sb<Ea.length;++sb);Ea.length&&(this.ej.Jsj(Ea),this.ej.ksj(Ea),this.ej.I1f({},Ea))}aaj(Ea,sb){this.Vga(sb.type,sb.Aba)}Vga(Ea,sb=null){this.tg.PXj&&0===Ea&&b.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");if(0===Ea&&this.vZc&&0<this.vZc.length){var Oa=Object.assign(new la.a,{topLevelKpiName:"ContentUpdateNotificationReceived",
featureName:"RtcNotification",crewAlias:this.vZc,vetoPillar:"RealTimeCoauth"});(Oa=I.a.getInstance(Oa))&&Oa.logKpiUsage(this.lMg)}this.tg.QXj&&13===Ea&&b.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",sb||"<none>"));this.eo.aWa();5===Ea?(sb=(Ea=this.Djj(sb))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",Ea.reason,Ea.reconnectDelay):"Received client reconnection request from the server without params.",
b.ULS.sendTraceTag(18637071,500,50,sb),this.ej.EBc(Ea)):(sb=a(756).RtcUtils.deserialize(sb,String.format("UpdateNotification-{0}",V[Ea]),null,!1,this.Sqb),this.ej.Isj(Ea,sb))}Djj(Ea){try{if(!Ea||""===Ea)return null;const sb=JSON.parse(Ea);return new O(sb[T.a.XYd],sb[T.a.UIj],sb[T.a.WIj],sb[T.a.p_d])}catch(sb){return b.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",sb.message),null}}qqg(Ea,sb){return this.$sb.Kii(this.Lii(Ea,sb))}Lii(Ea,sb){return Ea+","+sb}static f5h(){var Ea=
new Map;Ea.set("SkipAria","True");Ea=Object.assign(new Z.a,{extendedProperties:Ea});return Object.assign(new da.a,{kpiName:"ContentUpdateNotificationReceived",kpiType:0,optionalProperties:Ea,blockFutureEmissionDurationInMs:3E5})}}Object(w.a)(ba,"RtcMessageHandler",J,[]);class na{tTe(Ea,sb=""){const {MaxOutstandingThrottler:Oa}=a(1040);return Oa.createInstance(Ea,sb)}Drh(Ea,sb=""){const {MaxRateThrottler:Oa}=a(1042);return Oa.createInstance(Ea,sb)}}Object(w.a)(na,"ThrottlerFactory",null,[959]);var Y=
a(105),Ga=a(1045);class ma{constructor(Ea){this.tg=null;this.Rz=!1;this.$a=new Y.a;this.eYc=new d.a;this.dYc=new d.a;this.i2c=Ea;this.V0a=this.i2c.tTe(sb=>sb.send(),"GlobalMaxOustandingThrottler");this.V0a.m8b(()=>{this.$a.raiseEvent("TMUDM")})}init(Ea){this.Rz||(this.tg=Ea,this.V0a.init(this.tg.gGa,this.tg.tli),this.Rz=!0)}Kii(Ea){var {MaxRateThrottler:sb}=a(1042),{MaxOutstandingThrottler:Oa}=a(1040);this.Rz||this.init(new Ga.a(sb.RVe,Oa.kWe,Oa.aWe,ma.vXi));({value:sb}=this.eYc.kf(Ea)).returnValue||
(({value:sb}=this.dYc.kf(Ea)).returnValue||(sb="MaxOutstandingThrottler-"+Ea,sb=this.i2c.tTe(Object(c.a)(this.V0a,this.V0a.add,"add"),sb),sb.init(this.tg.gGa,this.tg.uXi),sb.m8b(()=>{this.$a.raiseEvent("TMUDM")}),this.dYc.add(Ea,sb)),Oa="MaxRateThrottler-"+Ea,sb=this.i2c.Drh(Object(c.a)(sb,sb.add,"add"),Oa),sb.init(this.tg.oYi),this.eYc.add(Ea,sb));return sb}reset(){for(const Ea of this.eYc)Ea.value.XTd();for(const Ea of this.dYc)Ea.value.XTd(),Ea.value.reset();this.V0a.XTd();this.V0a.reset()}m8b(Ea){this.$a.addHandler("TMUDM",
Ea)}}ma.vXi=1E3;Object(w.a)(ma,"ThrottlerManager",null,[958]);var fa;(function(Ea){Ea[Ea.unspecified=0]="unspecified";Ea[Ea.word=1]="word";Ea[Ea.excel=2]="excel";Ea[Ea.powerPoint=3]="powerPoint";Ea[Ea.test=4]="test";Ea[Ea.wacFrontEnd=5]="wacFrontEnd";Ea[Ea.oneNote=6]="oneNote";Ea[Ea.visio=7]="visio";Ea[Ea.officeMobile=8]="officeMobile";Ea[Ea.cosmosDBChangefeed=9]="cosmosDBChangefeed";Ea[Ea.last=10]="last"})(fa||(fa={}));Object(w.b)("RtcClientAppName",fa);const Xa=(Ea,sb,Oa,La,ia,Sa,Za,Ab,pb=null,
Tb=null,ob=null,va=null)=>{const Pa=y.createInstance(f.AFrameworkApplication.da),jb=f.AFrameworkApplication.buildVersion?f.AFrameworkApplication.buildVersion:"1.0",Ob=Ua(Ea,sb,Za,jb),kb=Pa.Jhh?a(1242).RealtimeChannelMetrics.createInstance(Ob):new m;var ra=a(788).FrequentLoggingMetrics.create(ia);Pa.rtcJsClientFrequentlyLogsMetrics&&ra.Z4j(Pa.ZIj);var rb="";rb=pb&&""!==pb?pb:"/rtc2/";ra.C7e=r.a.AK(rb);const Kb=rb+"signalr";pb=rb+"findsession";const Sb=n.Qsi;rb=new na;ob=ob||B.a.getInstance();b.ULS.shipAssertTag(556867617,
500,Pa.Oag<=a(801).RealtimeChannel.vGf,"Client attempting to override max payload size beyond absolute limit");const cb=Math.min(Pa.Oag,a(801).RealtimeChannel.vGf);ra.uGf=cb;ra=new ba(Pa,new ma(rb),Ea,Ob,cc=>new z(cc.createHubProxy(Sb)),Ab,ob,kb,ra,cb);Tb||(Tb=a(1179).FindSessionStrategy.createInstance(sb,ia,pb,Ab,jb,Za,Ea,Ob,ob,Sa,La,va));Tb.xic=Pa.xic;sb=new x(Ob);Oa=Oa?Oa.split(","):null;Ea=new (a(801).RealtimeChannel)(Ea,Oa,Ob,Ab,()=>$.hubConnection(Kb),Tb,ra,sb,ob,kb,Pa,ia);Ea.init();return Ea},
Ua=(Ea,sb,Oa)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",Ea,ka(fa[Oa]),ka("browser"),sb),ka=Ea=>Ea?Ea.charAt(0).toLocaleUpperCase()+Ea.substring(1,Ea.length):Ea;a.d(C,"RealtimeChannel",function(){return nb});class nb{constructor(Ea,sb,Oa,La,ia,Sa,Za,Ab,pb,Tb,ob,va){this.A1c=!1;this.D5=null;this.LJ=new d.a;this.Wnb=1;this.qS=null;this.Hw=!1;this.aXc=(new Date(0)).getTime();this.Eve=0;this._clientId=Ea;this.Y5b=sb;this.PO=0;this.Hj=La;this.FRc=Ab;this.LPg=Za;this.AEg=pb;this.gHg=
ia;this.qua=Sa;this.Wm=Oa;this.eo=Tb;this.tg=ob;this.Qi=va;this.GQg=1>100*Math.random()}get JTa(){return this.qua.JTa}set JTa(Ea){this.qua.JTa=Ea}get VEa(){return this.LPg}get ej(){return this.AEg}init(){this.ej.d0g(Object(c.a)(this,this.ifc,"disconnectAndCreateNewConnection"));this.ej.Y0g(Object(c.a)(this,this.ngj,"onUpdatePersistentStateRequestReceivedInternal"));this.ej.X0g(Object(c.a)(this,this.mgj,"onUpdatePersistentStateClearedRequestReceived"));this.Qi.kub(this.eo);f.AFrameworkApplication.Lkb(()=>
{const {FrequentLoggingMetrics:Ea}=a(788);this.eo.YTd();Ea.instance&&Ea.instance.LGd()});this.CTe();this.nAh();this.ej.B0g(Object(c.a)(this,this.ihk,"updateConnectionQueryString"))}nAh(){try{const Oa=$.signalR;if(!Oa)throw Error.invalidOperation("Failed to retrieve Signalr object");const La=Oa.version;if(!La)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===La){var Ea=Oa.transports;if(!Ea)throw Error.invalidOperation("Failed to retrieve transports object");
var sb=Ea.longPolling;if(!sb)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!sb.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");sb.supportsKeepAlive=this.Yth()}}catch(Oa){b.ULS.sendTraceTag(6432339,500,15,"Failed to disable longPolling KeepAlives: {0}",Oa.message)}}Yth(){return()=>!1}CTe(){const Ea=++this.Wnb;this.aXc=(new Date(0)).getTime();this.qS=this.gHg();this.ej.rsj(this.qS);this.qS.stateChanged(sb=>
{this.w5i(sb,Ea)});this.qS.connectionSlow(Object(c.a)(this,this.Yej,"onSlowConnection"));this.qS.error(Object(c.a)(this,this.Oej,"onSignalRError"));this.qS.log=Object(c.a)(this,this.Pej,"onSignalRLog")}Dmb(Ea,sb){return Ea!==this.Wnb?(b.ULS.sendTraceTag(4309017,500,50,"ConnectionToken verification failed for {0}",sb),!1):!0}connect(){2!==this.PO&&1!==this.PO&&(b.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.Wm),this.FRc.u5i(),t.a.instance.a5j(),this.tZ(1,this.PO),
this.Pmg())}Pmg(){const Ea=this.Wnb;this.A1c=!1;this.eo.r3f();this.qua.Tfi(Object(c.a)(this,this.elh,"connectSignalrConnection"),Object(c.a)(this,this.pOf,"onFailureToConnect"),Object(c.a)(this.VEa,this.VEa.Bvi,"initThrottlerManager"),Object(c.a)(this,this.Dmb,"verifyConnectionToken"),Ea)}pOf(Ea=null){this.eo.t3f();let sb=null;!Ea||"documentsessiondeleted"!==(sb=Ea.toLowerCase())&&"documentsessionexpired"!==sb?this.ifc():(b.ULS.sendTraceTag(41788292,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",
this.Wm,Ea),this.disconnect())}ifc(Ea,sb=null){b.ULS.sendTraceTag(4309018,500,50,"Disconnecting the connection [{0}]",this.D5);Ea=(Ea=2===this.PO||1===this.PO)&&!this.VEa.MOa;let Oa=!0,La=0;sb&&Object.getType(sb)!==Object.getType(Sys.EventArgs.Empty)&&sb.OWd&&""!==sb.OWd&&(Ea=!0,this.qua.nTj(sb.OWd),Oa=sb.p_d,La=sb.reconnectDelay);Ea&&this.tZ(1,this.PO);++this.Wnb;this.VEa.vy();this.Y5j(Oa);this.qua.sBh();this.CTe();Ea&&window.setTimeout(Object(c.a)(this,this.Pmg,"startConnecting"),Math.min(La,3E4))}ihk(){let Ea=
null;const sb=({correlationId:Ea}=this.qua.Tcf()).returnValue;this.qS.qs=sb;b.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.Wm,Ea)}elh(Ea){const {FrequentLoggingMetrics:sb}=a(788);this.aXc=(new Date).getTime();let Oa=null;this.qS.qs=({correlationId:Oa}=this.qua.Tcf()).returnValue;this.tg.x2g&&(this.qS.url=Ea,sb.instance&&(sb.instance.zQe=r.a.AK(Ea)));let La=null;this.Hj&&(La=this.Hj.Ze("WebServiceCall","ConnectToServer"));b.ULS.sendTraceTag(3290048,
500,50,"Connecting to server for client [{0}]",this.Wm);Ea={};this.Y5b&&(Ea.transport=1===this.Y5b.length?this.Y5b[0]:this.Y5b);Ea.pingInterval=null;t.a.instance.GQb(1,0);Ea.waitForPageLoad=!1;this.qS.start(Ea,null).done(ia=>{this.eo.u3f();t.a.instance.GQb(1,1,!0);b.ULS.sendTraceTag(3457857,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",ia.id,Oa)}).fail(ia=>{b.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1},  ClientDetails: [{2}]",
this.qua.yF,Oa,this.Wm);this.pOf();this.eo.s3f(ia);t.a.instance.GQb(1,1,!1);this.ej.O1f(0,{["CorrelationId"]:Oa,["ErrorDetails"]:ia,["ConnectionState"]:k.a[this.PO]})}).always(()=>{const {FrequentLoggingMetrics:ia}=a(788);La&&La.stop();ia.instance&&(ia.instance.YSc=!1)})}disconnect(){const {FrequentLoggingMetrics:Ea}=a(788);0===this.PO?b.ULS.sendTraceTag(36545632,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.Wm):(this.eo.x3f(),Ea.instance&&(Ea.instance.YSc=
!0),b.ULS.sendTraceTag(36545633,500,50,"Starting explicit disconnect for [{0}]",this.Wm),this.VEa.MOa=!0,this.FRc.x6i(),this.tZ(0,this.PO),this.ifc(),this.VEa.MOa=!1)}Y5j(Ea){const sb=this.Uch(),Oa=this.qS,La=this.D5,ia=()=>{if(this.A1c)b.ULS.sendTraceTag(591692192,500,15,"Stop connection was called twice, possibly on the same connection.");else try{this.A1c=!0,Oa.stop(!0,Ea)}catch(Sa){b.ULS.sendTraceTag(591692191,500,15,"Stopping connection failed: {0}",Sa.message)}};0<sb?(b.ULS.sendTraceTag(4309020,
500,50,"Waiting to stop connection [{0}]: [{1}] ms.",La,sb),window.setTimeout(ia,sb)):(b.ULS.sendTraceTag(36804372,500,50,"Stopping connection [{0}].",La),ia())}Uch(){let Ea=0;0===this.qS.state&&(Ea=this.aXc+nb.gok-(new Date).getTime(),0>Ea&&(Ea=0));return Ea}get connectionState(){return this.PO}E6(Ea){this.ej.E6(Ea)}saa(Ea){this.ej.saa(Ea)}Gdg(Ea){this.CTb(0,Ea)}CTb(Ea,sb){const Oa=new h.a;this.ej.R1f(Ea,sb,Oa);return Oa.task}M3a(Ea){this.ej.M3a(Ea)}CWa(Ea){this.ej.CWa(Ea)}d8b(Ea){this.ej.d8b(Ea)}wDc(Ea){this.ej.wDc(Ea)}GEb(Ea){return this.Tji(Ea)}Gjc(){return this.tPa(0)}tPa(Ea){const sb=
{};for(const Oa of this.LJ)Oa.value.kd(Ea)&&(sb[Oa.key]=Oa.value.ma(Ea).data);return sb}Tji(Ea){return this.LJ.kd(Ea)&&this.LJ.ma(Ea).kd(0)?this.LJ.ma(Ea).ma(0).data:null}ngj(Ea,sb){for(const Oa of sb.Ekk)this.LJ.kd(Oa.key)||this.LJ.fa(Oa.key,new E.a),Ea=Oa.value,this.LJ.ma(Oa.key).fa(sb.type,new v(Ea.Presence,new Date(Ea.TimeStamp))),Oa.key===this._clientId&&0===sb.type&&this.ej.csj(Ea.Presence)}mgj(Ea,sb){for(const Oa of sb.lbd)this.LJ.remove(Oa)}O1h(){const Ea=new E.a;if(!this.LJ.kd(this._clientId))return Ea;
for(const sb of this.LJ.ma(this._clientId))Ea.fa(sb.key,sb.value.data);return Ea}Qaa(Ea,sb=null,Oa=!1){const La=new h.a;this.ej.$Sd(Ea,sb,Oa,La);return La.task}O3a(Ea){this.ej.O3a(Ea)}MRb(Ea){this.ej.MRb(Ea)}ooa(Ea){let sb,Oa;return({value:sb}=this.LJ.kf(Ea)).returnValue&&({value:Oa}=sb.kf(0)).returnValue?new u(this.Xji(Oa),Oa.timeStamp):null}T1h(){const Ea={};for(const sb of this.LJ)sb.value.kf(0).returnValue&&(Ea[sb.key]=this.ooa(sb.key));return Ea}$lb(Ea){const sb=new h.a;this.ej.Hsj(Ea,sb);return sb.task}get clientId(){return this._clientId}get g2j(){return this.GQg}dispose(){const {FrequentLoggingMetrics:Ea}=
a(788);this.Hw||(this.VEa.vy(),this.Qi.lVd(this.eo),this.eo.YTd(),Ea.instance&&Ea.instance.LGd(),this.Hw=!0)}w5i(Ea,sb){this.Dmb(sb,"StateChangedSignalR")&&this.tZ(this.qRe(Ea.newState),this.qRe(Ea.oldState))}tZ(Ea,sb){var {FrequentLoggingMetrics:Oa}=a(788),{ClientToClientMessageTelemetry:La}=a(1204);if((1!==this.PO||0!==sb||1!==Ea)&&this.PO!==sb){const ia=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.PO,
sb,Ea]));b.ULS.sendTraceTag(3290053,500,10,ia)}if(this.PO!==Ea){switch(Ea){case 2:Oa.instance&&Oa.instance.xWi();this.D5=this.qS.id;b.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.D5,this.Wm);this.sUi(this.qS);b.ULS.sendTraceTag(4298369,500,50,"Retrieving complete session state");Oa=null;this.Hj&&(Oa=this.Hj.Ze("WebServiceCall","Receive First Presence"));La=this.Wnb;this.ej.qsj(Object(c.a)(this,this.Dmb,"verifyConnectionToken"),La,this.FRc,Object(c.a)(this,this.Lad,
"clearExistingPersistentState"),this.O1h(),Oa);this.tg.rtcClientMessageTelemetryEnabled&&(Oa=100*Math.random()<=this.tg.VIj,a(1204).ClientToClientMessageTelemetry.Drd(this.ej,this.tg,Oa).start());break;case 1:2===sb&&b.ULS.sendTraceTag(4298644,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.D5);break;case 0:if(La.instance&&La.instance.stop(),this.VEa.MOa)b.ULS.sendTraceTag(3249543,500,50,"Connection [{0}] has been explicitly closed",this.D5);else{1===sb&&(b.ULS.sendTraceTag(7672737,
500,50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this.D5),this.eo.y3f());2===sb&&b.ULS.sendTraceTag(36574532,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.D5);this.ifc();return}}this.PO=Ea;this.ej.zrj(Ea,sb)}}sUi(Ea){if(Ea&&Ea.transport&&Ea.transport.name){Ea=Ea.transport.name;var sb=Ea.toLowerCase();
"websockets"===sb?b.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",Ea,this.Wm):"serversentevents"===sb?b.ULS.sendTraceTag(4290752,500,50,"Transport name - {0} for [{1}]",Ea,this.Wm):"foreverframe"===sb?b.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",Ea,this.Wm):"longpolling"===sb?b.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",Ea,this.Wm):"mocktransport"!==sb&&b.ULS.sendTraceTag(4290755,500,15,"Unknown transport protocol encountered - '{0}'",
Ea)}else b.ULS.sendTraceTag(4290722,500,10,"Transport protocol name is missing")}Yej(){if(this.tg.Nag){const Ea=r.a.gw(this.JTa,"mid");b.ULS.sendTraceTag(3249544,500,15,"Detected that the connection [{0}] is slow for target machine [{1}]",this.D5,Ea)}else b.ULS.sendTraceTag(522716053,500,50,"Detected that the connection [{0}] is slow",this.D5)}Oej(){b.ULS.sendTraceTag(3249545,600,15,"SignalR ERROR for connection [{0}];",this.D5)}Pej(Ea){Ea=a(756).RtcUtils.Xeb(Ea);if(this.tg.Nag&&Ea.startsWith("Keep alive timed out.")){const sb=
r.a.gw(this.JTa,"mid");b.ULS.sendTraceTag(522716054,500,15,"SignalR lib: {0}. Target Machine: {1}",Ea,sb)}else this.g2j&&2E3>this.Eve&&!Ea.startsWith("Invok")&&!Ea.startsWith("Trigger")&&(b.ULS.sendTraceTag(578950464,500,50,"SignalR lib: {0}",Ea),this.Eve++)}Lad(){let Ea;const sb=[];({value:Ea}=this.LJ.kf(this._clientId)).returnValue&&this.LJ.remove(this._clientId);for(const Oa of this.LJ.keys)Array.add(sb,Oa);for(const Oa of sb)this.LJ.remove(Oa);Ea&&this.LJ.fa(this._clientId,Ea);this.ej.Xrj(sb)}qRe(Ea){switch(Ea){case 0:return 1;
case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",Ea,"Unknown SignalR state");}}Xji(Ea){return Ea&&Ea.timeStamp?(new Date).getTime()-Ea.timeStamp.getTime()>(this.tg.j7g?6E4:this.tg.i7g)?2:1:1}static createInstance(Ea,sb,Oa,La,ia,Sa,Za,Ab=null,pb=null,Tb=null,ob=null,va=null,Pa=null){return Xa(Ea,sb,Oa,Pa,La,ia,Sa,Za,Ab,pb,Tb,va,ob)}}nb.vGf=31E3;nb.FId=8E3;nb.gok=15E3;Object(w.a)(nb,"RealtimeChannel",null,[239,927])},930:function(w,C,a){a.d(C,"a",function(){return b});
w=a(0);class b{constructor(){this.jwe=!1;this.f_c=null;this.jhe=0;this.mTc=this.IUe();this.D_b=this.IUe();this.XHa=this.T0a=0;this.Yy=()=>new Date}get X6j(){return this.jwe}IUe(){const c=Array(6);for(let h=0;h<c.length;h++)c[h]=0;return c}j8h(){return this.mTc.toString()}W4h(){return this.D_b.toString()}a5j(){this.f_c=this.Yy()}GQb(c,h,k=!1){this.X6j||(k&&(this.jwe=!0),k=this.Yy(),0===c&&5<this.T0a||1===c&&5<this.XHa||(this.jhe<c?(1===this.T0a%2&&(this.mTc[this.T0a]=-1,this.T0a++),this.jhe=c,1===
h&&(this.D_b[this.XHa]=-1,this.XHa++),this.D_b[this.XHa]=this.m6d(k),this.XHa++):0===c?(this.mTc[this.T0a]=this.m6d(k),this.T0a++):(this.D_b[this.XHa]=this.m6d(k),this.XHa++)))}m6d(c){const h=c.getTime()-this.f_c.getTime();this.f_c=c;return h}static get instance(){b.La||(b.La=new b);return b.La}static set instance(c){b.La=c}}b.La=null;Object(w.a)(b,"LatencyMetrics",null,[])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.cl.js.map/55c7467f765ac4f5da8efb94a8664dc4/EwaTS.cl.js.map
'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[37],{1344:function(w,C,a){a.r(C);var b={};a.r(b);a.d(b,"SensitivityCommandHandler",function(){return Oc});var c=a(0),h=a(14),k=a(79),d=a(908),f=a(198),u=a(563);class r{constructor(Gb,Wc,pd=null){this.id=Gb.Id;pd||(pd="");this.Uuj=pd;this.sensitivityLabel=Gb}}Object(c.a)(r,"AutoPolicyLabelData",null,[]);class t{constructor(Gb,Wc){this.uP=Gb;this.displayName=Wc}}Object(c.a)(t,"PolicyLabelRequestState",null,[]);class v{constructor(){this.WZd=
this.LKd=""}}Object(c.a)(v,"PolicyStrings",null,[]);var x=a(151),m=a(5),l=a(169),n=a(13),z=a(47),y=a(31);class B{static get zEd(){return B.vNi}}B.vNi="<div class='WACDialogRow' id='JustificationMessageBlock'> <div class='WACDialogIcon' id='JustificationIconArea'> <div class='clip32x32' id='JustificationIconClip' unselectable='on' style='z-index: 0; display: inline-block;'> <img id='iconJustification' class='{1}' role='presentation' src={0} /> </div> </div> <div class='WACDialogTextPanel WACJustificationDialogMessage' id='JustificationMessageArea'> <label id='messageJustification' class='WACDialogLabel' >{2}</label> </div> </div> <br/> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock0'> <input type='radio' id='radiobox0' name='ListRadioBox' class='WACDialogRadio' alt='{3}' title='{3}'></input> <label id='JustificationDlgList0' class='WACDialogLabel' for='radiobox0' >{3}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock1'> <input type='radio' id='radiobox1' name='ListRadioBox' class='WACDialogRadio' alt='{4}' title='{4}'></input> <label id='JustificationDlgList1' class='WACDialogLabel' for='radiobox1' >{4}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock2'> <input type='radio' id='radiobox2' name='ListRadioBox' class='WACDialogRadio' alt='{5}' title='{5}'></input> <label id='JustificationDlgList2' class='WACDialogLabel' for='radiobox2' >{5}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow WACJustificationDialogTextAreaRow' id='JustificationTextAreaBlock'> <textarea id='txtJustification' class='JustificationTextArea' placeholder='{6}' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"></textarea> </div>";
Object(c.a)(B,"JustificationDialogHtml",null,[]);class G extends x.a{constructor(Gb,Wc){super(!1,!1,G.Ix);this.rva=[CommonUIStrings.l_SensitivityJustificationNoLongerApplies,CommonUIStrings.l_SensitivityJustificationIncorrect,CommonUIStrings.l_SensitivityJustificationOther];this.$3b=null;this.Y3b=!1;this.G4b=Gb;this.UE=Wc;this.di=this.j$g();this.Rd=1;this.ug=G.id;this.qe(1,CommonUIStrings.l_DialogChange);this.tO(1,!1);this.D4(0)}d4d(){if(G.Ix)this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,
Object(k.a)(this,this.y2f,"reactJustificationDialogHandler"),this.Fgf(this.Y3b));else{const Gb={};for(let Wc=0;Wc<this.rva.length;Wc++)Gb[G.KSd+Wc]=!1;Gb[G.SWb]="";this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(k.a)(this,this.uNi,"justificationDialogHandler"),Gb);this.Mwj();z.a.addHandler($get(G.SWb),n.a.input,Object(k.a)(this,this.X8j,"textAreaHandler"))}}validate(){if(G.Ix)return this.Sxg(this.$3b);const Gb=$get(G.SWb);return Gb.disabled?!0:this.Sxg(Gb.value)}Sxg(Gb){const Wc=
2>Gb.length,pd=500<Gb.length,fe=RegExp("[{|}|;|\\\\]").test(Gb);Gb=""===y.a.BCc(Gb);return!Wc&&!pd&&!fe&&!Gb}uNi(Gb,Wc){let pd="";if(1===Gb)for(let fe=0;fe<this.rva.length;fe++)if(Wc[G.KSd+fe]){pd=fe===this.rva.length-1?Wc[G.SWb]:this.rva[fe];break}this.UE(Gb,this.G4b,pd)}y2f(Gb){let Wc="";1===Gb&&this.$3b&&(Wc=this.$3b);this.UE(Gb,this.G4b,Wc)}kaj(Gb){this.$3b=Gb;Gb=this.validate();this.Y3b!==Gb&&(this.Y3b=Gb,this.BGa(CommonUIStrings.l_SensitivityJustificationTitle,Object(k.a)(this,this.y2f,"reactJustificationDialogHandler"),
this.Fgf(this.Y3b)))}Fgf(Gb){return{["id"]:this.ug,["bodyControls"]:{["choiceGroupProps"]:{},["textAreaProps"]:{["placeholder"]:CommonUIStrings.l_SensitivityJustificationPlaceholder}},["actionButtonProps"]:{["label"]:CommonUIStrings.l_DialogChange,["disabled"]:!Gb},["infoMessage"]:CommonUIStrings.l_SensitivityJustificationMessage,["justificationIrrelevantLabel"]:CommonUIStrings.l_SensitivityJustificationNoLongerApplies,["justificationIncorrectLabel"]:CommonUIStrings.l_SensitivityJustificationIncorrect,
["justificationOtherLabel"]:CommonUIStrings.l_SensitivityJustificationOther,["onJustificationUpdated"]:Object(k.a)(this,this.kaj,"onJustificationUpdated")}}X8j(Gb){Gb.target&&this.tO(1,this.validate())}j$g(){return x.a.sq(G.zEd,m.AFrameworkApplication.dC,l.getImageClass(G.iconName),CommonUIStrings.l_SensitivityJustificationMessage,this.rva[0],this.rva[1],this.rva[2],CommonUIStrings.l_SensitivityJustificationPlaceholder)}Mwj(){const Gb=document.getElementsByName(G.VPi);for(let Wc=0;Wc<Gb.length;Wc++)z.a.addHandler(Gb[Wc],
n.a.focus,Object(k.a)(this,this.b1f,"radioButtonFocusHandler")),z.a.addHandler(Gb[Wc],n.a.click,Object(k.a)(this,this.b1f,"radioButtonFocusHandler"))}b1f(Gb){if(Gb=Gb.target){Gb.checked=!0;var Wc=$get(G.SWb);Gb.id===G.KSd+(this.rva.length-1)?(Wc.disabled=!1,Sys.UI.DomElement.setVisible(Wc,!0),Wc.focus()):(Wc.disabled=!0,Gb.focus());this.tO(1,this.validate())}}static get Ix(){return m.AFrameworkApplication.sa.Ra.hy&&m.AFrameworkApplication.sa.Ra.mCd}}G.zEd=B.zEd;G.VPi="ListRadioBox";G.KSd="radiobox";
G.SWb="txtJustification";G.iconName="Info_32x32x32";G.id="JustificationDialog";Object(c.a)(G,"JustificationDialog",x.a,[]);class E extends x.a{constructor(Gb,Wc,pd){super(!1,!1,!0);if(Gb&&pd){var fe={["id"]:"MandatoryLabellingDialog"};this.eIg=pd;this.wXc=Wc;if(!m.AFrameworkApplication.da.pa("MandatoryLabelingDialogLearnMoreSwitchIsEnabled")||this.wXc&&""!==this.wXc)fe.learnMoreLink={["type"]:"AppLinkProps",["id"]:"mandatoryLabellingLearnMoreLink",["text"]:CommonUIStrings.l_LearnMore,["handler"]:{["href"]:this.wXc,
["target"]:"_blank"},["customTooltip"]:CommonUIStrings.L_LearnMoreTooltip};Wc={["sections"]:[],["shouldAutoOpen"]:!1};Array.add(Wc.sections,{["id"]:"mandatoryLabellingFlyoutMenuSection",["controls"]:Gb});fe.labelFlyout={["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabellingFyout",["label"]:"Pick a label",["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!0,["menuDefinition"]:Wc};Gb={["id"]:"MandatoryLabellingDialog",["bodyControls"]:fe};fe.initialLabelText=CommonUIStrings.l_MandatoryLabellingDialogInitialLabelText;
fe.descriptionText=CommonUIStrings.l_MandatoryLabellingDialogDescriptionText;this.initializeAndShow(CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,Object(k.a)(this,this.nWi,"mandatoryLabellingDialogHandler"),Gb)}else h.ULS.sendTraceTag(560547850,306,10,"MandatoryLabelingDialog was triggered with invalid inputs")}nWi(Gb,Wc){1===Gb&&Wc.selectedLabel&&(Gb=Wc.selectedLabel,""!==Gb&&this.eIg(Gb))}}Object(c.a)(E,"MandatoryLabellingDialog",x.a,[]);class J{constructor(){this.Ypb=!!m.AFrameworkApplication.sa&&
m.AFrameworkApplication.sa.Ra.hy}Crh(Gb,Wc,pd){this.Ypb&&new E(Gb,Wc,pd)}static get instance(){return J.La||(J.La=new J)}}J.La=null;Object(c.a)(J,"MandatoryLabellingDialogFactory",null,[536]);class I{}I.P5j="sbProtectForm14";I.R5j="SBStatusBarMarkAsReadOnly14";I.gPi="Info_16x16x32";I.kxb="QuickSearchCompletedToday_16x16x32";I.lTd="CommonControlCheckboxCheck_16";I.Yqg="On";I.visible="Visible";I.rXh="ImageIsVisible";I.BG="SourceControlId";I.menuItemId="MenuItemId";I.menu="Menu";I.Q6c="AppLockId";I.value=
"Value";I.ak="LabelText";I.alt="Alt";I.Hof="Image16by16";I.Goa="Image16by16Class";I.O5j="SBProtectForm_16";I.Q5j="SBStatusBarMarkAsReadOnly_16";I.icon="Icon";I.iconColor="IconColor";I.customTooltip="CustomTooltip";I.Utj="MipTagDynamicFillWithOutline_20";I.Vtj="MipTagLockDynamicFillWithOutline_20";I.Ttj="MipTagErrorOutline_20";I.Wtj="MipTagQuestionOutline_20";I.oLc="transparent";I.vek="UILocation";Object(c.a)(I,"PolicyConstants",null,[]);class R extends x.a{constructor(Gb,Wc,pd){super(!1,!1,R.Ix);
this.G4b=Gb;this.u1a=Wc;this.UE=pd;this.Rd=1;this.ug=R.id;this.D4(1);this.D4(0)}D4d(){const Gb={["id"]:"UserDefinedPermissionsDialog"};R.Ix&&this.initializeAndShow("Defined Permissions",Object(k.a)(this,this.hlk,"userDefinedPermissionsDialogHandler"),Gb)}hlk(Gb){1!==Gb&&this.UE(Gb,this.G4b,"",this.u1a)}static get Ix(){return m.AFrameworkApplication.sa.Ra.hy&&m.AFrameworkApplication.sa.Ra.mCd}}R.id="UserDefinedPermissionsDialog";Object(c.a)(R,"UserDefinedPermissionsDialog",x.a,[]);var X=a(597),H=a(386),
M=a(325),O=a(576),L=a(103),S=a(110),T=a(571),V=a(568),la=a(147),Z=a(438),da=a(152),ba=a(95),na=a(114),Y=a(84),Ga=a(116),ma=a(27),fa=a(73),Xa=a(62);class Ua{constructor(Gb,Wc,pd,fe){this.jqb=this.gJa=null;this.Ame=this.qWc=this.IWc=this.$pb=this.Kne=this.lpe=this.hSc=!1;this.i0a=this.pja=this.ika=this.rua=this.u1a=this.Gq=this.Bca=this.lh=null;this.xHg=this.aQc=0;this.vje=this.EWc=this.nQc=this.WZc=null;this.Na=Gb;this.kh=Wc;this.Oa=pd;this.xi=fe;this.Tqb={};this.lse={};this.mpe={};this.opc=pd.pa("WacApplyManualPolicyLabelIsEnabled");
this.xi.value.UCe(Object(k.a)(this,this.aSd,"processAutoSensitivityLabel"));this.xi.value.V5c(Object(k.a)(this,this.aSd,"processAutoSensitivityLabel"));this.xi.value.X7b(Object(k.a)(this,this.lgj,"onUpdateLabelInfo"));m.AFrameworkApplication.sa&&m.AFrameworkApplication.sa.r_g(Object(k.a)(this,this.Yvj,"refreshDocumentPolicyLabelsOnModeChange"));pd.pa("SupportsPolicies")&&pd.Sa("AppliedPolicyId")&&(this.gJa=pd.Sa("IrmPolicyTitle"),this.jqb=pd.Sa("IrmPolicyDescription"));this.JFg=this.Oa.Hf("SetPolicyLabelAwaitFileExistsOnHostMaxRetries",
6);this.KFg=this.Oa.Hf("SetPolicyLabelAwaitFileExistsOnHostRetryDelayMs",5E3)}get eSa(){return m.AFrameworkApplication.eSa||!!this.EWc&&this.EWc()}tj(){this.Na.ae(ma.a.YOd,Ga.a.frame,Object(k.a)(this,this.Kfc,"documentLabelPaneHandler"));this.Na.Rg(ma.a.lhb,Ga.a.frame,Object(k.a)(this,this.lhb,"queryPolicyLabel"),96);this.Oa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpQueryShortLabelEnabled",!1)&&(this.Na.ae(ma.a.oWf,Ga.a.frame,Object(k.a)(this,this.Kfc,"documentLabelPaneHandler")),this.Na.Rg(ma.a.jQb,
Ga.a.frame,Object(k.a)(this,this.jQb,"queryPolicyShortLabel"),96));this.Na.ae(ma.a.sZa,Ga.a.frame,Object(k.a)(this,this.sZa,"toggleSensitivity"));this.Na.ae(ma.a.YDa,Ga.a.frame,Object(k.a)(this,this.YDa,"populateSensitivityFlyout"));this.Na.ae(ma.a.setSensitivity,Ga.a.frame,Object(k.a)(this,this.setSensitivity,"setSensitivity"));this.Na.Rg(ma.a.mhb,Ga.a.frame,Object(k.a)(this,this.mhb,"querySensitivity"),96);this.Na.ae(ma.a.haa,Ga.a.frame,Object(k.a)(this,this.haa,"querySensitivityToggleButton"));
this.Na.ae(ma.a.gaa,Ga.a.frame,Object(k.a)(this,this.gaa,"querySensitivitySubFlyout"));this.ztb(ma.a.sZa)||this.Na.rjb(ma.a.sZa,4);this.ztb(ma.a.YDa)||this.Na.rjb(ma.a.YDa,4);this.ztb(ma.a.setSensitivity)||this.Na.rjb(ma.a.setSensitivity,4);this.ztb(ma.a.haa)||this.Na.rjb(ma.a.haa,4);this.ztb(ma.a.gaa)||this.Na.rjb(ma.a.gaa,4);this.kh.updateCommandUI();m.AFrameworkApplication.da&&la.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")&&
this.xi.value.PBj(Object(k.a)(this,this.m4f,"registerActionsHandler"))}m4f(){this.tj()}KLc(){this.Na.FC(ma.a.YOd,Ga.a.frame,Object(k.a)(this,this.Kfc,"documentLabelPaneHandler"));this.Na.FC(ma.a.lhb,Ga.a.frame,Object(k.a)(this,this.lhb,"queryPolicyLabel"));this.Oa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpQueryShortLabelEnabled",!1)&&(this.Na.FC(ma.a.oWf,Ga.a.frame,Object(k.a)(this,this.Kfc,"documentLabelPaneHandler")),this.Na.FC(ma.a.jQb,Ga.a.frame,Object(k.a)(this,this.jQb,"queryPolicyShortLabel")));
this.Na.FC(ma.a.sZa,Ga.a.frame,Object(k.a)(this,this.sZa,"toggleSensitivity"));this.Na.FC(ma.a.YDa,Ga.a.frame,Object(k.a)(this,this.YDa,"populateSensitivityFlyout"));this.Na.FC(ma.a.setSensitivity,Ga.a.frame,Object(k.a)(this,this.setSensitivity,"setSensitivity"));this.Na.FC(ma.a.mhb,Ga.a.frame,Object(k.a)(this,this.mhb,"querySensitivity"));this.Na.FC(ma.a.haa,Ga.a.frame,Object(k.a)(this,this.haa,"querySensitivityToggleButton"));this.Na.FC(ma.a.gaa,Ga.a.frame,Object(k.a)(this,this.gaa,"querySensitivitySubFlyout"))}sZa(){return 32}kaf(Gb){const Wc=
"mandatoryLabelling_"+Gb.Id;this.mpe[Wc]=Gb.Id;return{["type"]:"AppToggleButtonProps",["id"]:Wc,["label"]:Gb.DisplayName,["hideLabel"]:!1,["customTooltip"]:Gb.Tooltip}}JSa(){return this.Oa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UDPEnabled",!1)}mBd(){return this.Oa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)}Nai(){const Gb=[],Wc=this.Bca;for(const fe in Wc){var pd=Wc[fe];const le=this.Gq[fe];if(le&&le.Enabled&&!le.HasUserDefinedPermissions)if(pd.count){const te=
{["sections"]:[],["shouldAutoOpen"]:!1},Ce={["id"]:"mandatoryLabelling_flyoutMenuSection_"+le.Id,["controls"]:[]};for(const Xb of pd)(pd=this.Gq[Xb])&&pd.Enabled&&!pd.HasUserDefinedPermissions&&Array.add(Ce.controls,this.kaf(pd));Array.add(te.sections,Ce);Array.add(Gb,{["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabelling_"+le.Id,["label"]:le.DisplayName,["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!1,["menuDefinition"]:te})}else Array.add(Gb,this.kaf(le))}return Gb}YDa(Gb,Wc,pd,fe,le){if(1===
pd||!this.xi.value.sla(!0))return 32;le.MenuItems=Object.assign(new T.a,{Id:"SensitivityList",MenuSectionList:[],UpdateDynamically:!0});Array.add(le.MenuItems.MenuSectionList,this.Ne(!this.isReactRibbonEnabled()));this.lh.CustomUrl&&Array.add(le.MenuItems.MenuSectionList,this.rrh(this.isReactRibbonEnabled()?this.lh.CustomUrl:y.a.Ch(this.lh.CustomUrl)));this.isReactRibbonEnabled()||(le.PopulationXML=M.q(le.MenuItems));return 32}mhb(Gb,Wc,pd,fe,le){if(1===pd||!le||!this.opc)return 32;this.lh=this.xi.value.ap;
if(this.xi.value.sla(!0)&&(le[I.visible]=!0,this.Kne||(S.a("MipLabelsAvailable"),this.Kne=!0),this.Oa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelTUIEnabled",!1)&&!this.Oa.getBooleanFeatureGate("Microsoft.Office.WordOnline.CEBlockPopupEnabled",!1)&&this.lh&&this.lh.AreLabelsAvailable&&(Gb=Y.a.instance.Qd("Common.ISystemInitiatedFeedback")))){const te=Ua.ij(this.lh.AppliedPolicyId)?"LouderLabel_NoLabelAppliedOnLoadActivity":"LouderLabel_LabelExistsOnLoadActivity";Gb.execute(Ce=>
{Ce.logActivity(te,null)})}return 32}haa(Gb,Wc,pd,fe,le){if(1===pd||!le)return 32;let te,Ce;le[I.Yqg]=!!(te=le[I.menuItemId])&&!!(Ce=this.Tqb[te])&&Ce===this.lh.AppliedPolicyId;return 32}gaa(Gb,Wc,pd,fe,le){if(1===pd||!le)return 32;let te,Ce,Xb;Gb=!!(te=le[I.BG])&&!!(Ce=this.Tqb[te])&&!!(Xb=this.Bca[Ce])&&Xb.contains(this.lh.AppliedPolicyId);le[I.rXh]=Gb;le[I.Yqg]=Gb;return 32}setSensitivity(Gb,Wc,pd,fe,le){if(1===pd||!le)return 32;Gb=this.Tqb[le[I.BG]];Wc=this.wek(le[I.vek]);pd=new fa.a;pd.name=
"SensitivityPickerLocation";pd.int64=Wc;S.a("SensitivityPickerUsage",void 0,void 0,[pd]);return this.qFa(Gb,le,2)}Upc(){return!!m.AFrameworkApplication.sa&&1===m.AFrameworkApplication.sa.mode}Yvj(){this.qWc&&!this.Upc()&&(this.qWc=!1,this.xi.value.Xvj())}Srg(){this.lh.DefaultLabelId&&this.lh.MandatoryLabelingEnforced?this.hSc||this.Upc()?this.lh.AppliedPolicyId?this.Ijd(""):(this.xi.value.iJi(this.xi.value.BKb)||this.Upc())&&this.a0e():this.dfg():this.lh.DefaultLabelId?this.dfg():this.lh.MandatoryLabelingEnforced&&
(this.lh.AppliedPolicyId?this.Ijd(""):this.a0e())}evf(){return this.lh.MandatoryLabelingEnforced?this.lh&&this.lh.AreLabelsAvailable?this.Oa.pa("TestOverrideIsReactDialogEnabled")||this.kh&&this.kh.Ra&&this.kh.Ra.hy?!0:(h.ULS.sendTraceTag(539109065,306,50,"Mandatory labelling not invoked b/c react dialogs disabled!"),!1):(h.ULS.sendTraceTag(539109064,306,50,"Mandatory labelling not invoked b/c there are no sensitivity labels!"),!1):(h.ULS.sendTraceTag(539109063,306,50,"Mandatory labelling not invoked b/c user did not have policy!"),
!1)}a0e(){!this.evf()||m.AFrameworkApplication.B9||this.lpe||(this.lpe=m.AFrameworkApplication.B9=!0,h.ULS.sendTraceTag(562837517,306,50,"Mandatory labelling is invoked successfully."),this.xi.value.x1f("",1),this.xi.value.H4c(37,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,CommonUIStrings.l_MandatoryLabellingDialogDescriptionText,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarButton,()=>{this.lWi()}))}Ijd(Gb){this.evf()&&m.AFrameworkApplication.B9&&(m.AFrameworkApplication.B9=
!1,h.ULS.sendTraceTag(562837518,306,50,"Mandatory labelling is escaped successfully."),this.xi.value.iVd(),this.xi.value.x1f(Gb,2))}lWi(){J.instance.Crh(this.Nai(),this.lh.CustomUrl,Object(k.a)(this,this.mWi,"mandatoryLabellingDialogCallback"))}mWi(Gb){this.Ijd(this.mpe[Gb])}ZHe(){return this.Oa.pa("CoAuthForProtectedFilesEnabled")&&this.Oa.pa("SupportsOfficeClientCoauthoring")&&this.Oa.pa("SetPolicyLabelAwaitFileExistsOnHostIsEnabled")&&!!this.vje&&this.eSa}qFa(Gb,Wc,pd,fe=null){this.xi.value.zsj(pd);
let le=32,te=!1,Ce=!0;const Xb=2===pd||8===pd||16===pd,oc=Gb===this.lh.AppliedPolicyId;if(this.nQc&&this.nQc(Gb,Xb))h.ULS.sendTraceTag(42860829,306,15,"SetSensitivity : As app doesn't support changing the label, skipping SetSensitivity call. ApplyLabelFlag : {0}",pd),this.kh.updateCommandUI();else if(Wc&&I.Q6c in Wc&&this.xi.value.URj(Wc[I.Q6c]),Gb)if(this.xi.value.jxf()||this.ZHe()&&this.IWc)h.ULS.sendTraceTag(42796168,306,50,"Policy label cannot be set because a set policy label request is already in progress. ApplyLabelFlag: {0}",
pd),this.kh.updateCommandUI(),Xb&&this.J8b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityQuickApplicationErrorMessage);else if(this.Oa.pa("HasDocumentEditRights"))if(this.xi.value.Jdh(Gb))if(!this.JSa()&&this.Gq[Gb]&&this.Gq[Gb].HasUserDefinedPermissions&&!oc)h.ULS.sendTraceTag(540608323,306,50,"UDP label cannot be applied during UDP in WAC Phase 1. ApplyLabelFlag: {0}",pd),1!==pd&&4!==pd&&this.h2g();else if(Xb&&this.lh.MandatoryLabelingEnforced&&oc)h.ULS.sendTraceTag(570972054,
306,50,"Policy label cannot be removed due to mandatory labeling. ApplyLabelFlag: {0}",pd),this.J8b(CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogTitle,CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogDescriptionText);else{if(Xb&&this.Oa.pa("WacLabelingJustificationDialogIsEnabled")&&this.lh.RequiredDowngradeJustification&&(oc||this.Gq[Gb].RequiredDowngradeJustification)&&(this.JSa()?!this.Ame&&!fe:!this.u1a))return h.ULS.sendTraceTag(570972055,306,50,"Downgrade justification is required. ApplyLabelFlag: {0}",
pd),this.d4d(Gb),le;if(this.JSa()&&this.Gq[Gb].HasUserDefinedPermissions&&!oc)return h.ULS.sendTraceTag(523019968,306,50,"UDP Label is selected. ApplyLabelFlag: {0}",pd),this.D4d(Gb,fe),le;if(this.ZHe()&&!this.vje())this.aQc<this.JFg?(h.ULS.sendTraceTag(577356770,306,50,"File does not exist on host, retrying after delay. RetryCount: {0} ApplyLabelFlag: {1}",this.aQc,pd),this.IWc=!0,this.aQc++,Xa.Task.delay(this.KFg).continueWith(()=>{this.IWc=!1;this.qFa(Gb,Wc,pd)})):(h.ULS.sendTraceTag(577356771,
306,15,"Policy label cannot be set because maximum retries were reached checking for file existence. ApplyLabelFlag: {0}",pd),te=1!==pd,Ce=!1,le=8);else{if(this.NHi(Gb)&&(h.ULS.sendTraceTag(553911752,306,15,"Policy label cannot be set because the selected label is a parent label. ApplyLabelFlag: {0}",pd),1===pd||8===pd||4===pd))return le;h.ULS.sendTraceTag(570972056,306,50,"SetSensitivityByPolicyId is succeeded. ApplyLabelFlag: {0}",pd);this.setPolicyLabel(oc?"":Gb,this.JSa()?fe:this.u1a,"",pd);return le}}else h.ULS.sendTraceTag(42796169,
306,50,"Policy label cannot be set because the user is in a coauth session. ApplyLabelFlag: {0}",pd),this.kh.updateCommandUI(),Xb&&this.J8b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityCoauthApplicationErrorMessage);else h.ULS.sendTraceTag(558892739,306,50,"Policy label cannot be set because the user doesn't have edit rights. ApplyLabelFlag: {0}",pd),this.kh.updateCommandUI(),Xb&&this.J8b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityNoEditRightsErrorMessage);
else h.ULS.sendTraceTag(42796167,306,15,"Policy label cannot be set because the selected policy ID is null. ApplyLabelFlag: {0}",pd),this.kh.updateCommandUI(),te=Xb,Ce=!1,le=8;this.xi.value.aTd(0,pd,te,Ce);return le}o4a(Gb,Wc,pd=null,fe=!1){L.Health.instance.recordKpiUsage("MipAutoClassificationSetLabel",0,"wordclpfc",null);this.Oa.pa("SupportsOfficeClientCoauthoring")&&this.Oa.pa("CoAuthForProtectedFilesIsEnabled")?(this.$pb=!1,(this.lh=this.xi.value.ap)&&!this.lh.AppliedPolicyId?this.$pb=!0:this.lh&&
this.lh.PolicyLabelAssignmentMethod&&(this.$pb=na.e(this.lh.PolicyLabelAssignmentMethod)===na.e("standard"))):this.$pb=fe;Gb=Ua.ij(Gb)?null:this.Gq[Gb];(Wc=Ua.ij(Wc)?null:this.Gq[Wc])?this.ika=new r(Wc,!0,pd):(this.xi.value.Fha(29),this.pja=null);Gb?this.rua=new r(Gb,!1):this.i0a=null;this.aSd(null,null);return 32}k4g(Gb){""!==this.lh.AppliedPolicyId?this.xi.value.aTd(14,16,!0):this.qFa(Gb,null,16)}Qfg(){this.Gq={};if(this.lh=this.xi.value.ap)for(const Gb of this.lh.SensitivityLabels)this.Gq[Gb.Id]=
Gb}NHi(Gb){if(this.Bca&&Gb in this.Bca){Gb=this.Bca[Gb];for(const Wc of Gb)if((Gb=this.Gq[Wc])&&Gb.Enabled)return!0}return!1}xgg(){this.Bca={};if(this.lh=this.xi.value.ap){for(const Gb of this.lh.SensitivityLabels)Gb.ParentId||(this.Bca[Gb.Id]=new f.a);for(const Gb of this.lh.SensitivityLabels)Gb.ParentId&&Gb.ParentId in this.Bca&&Gb.Enabled&&this.Bca[Gb.ParentId].add(Gb.Id)}}P0f(){this.lh=this.xi.value.ap;const Gb=this.opc&&this.isReactRibbonEnabled()&&this.xi.value.sla();Ua.PDc(Gb)}rwj(Gb){this.nQc=
Gb}kxj(Gb){this.EWc=Gb}dfg(){if(this.Oa.pa("WacApplyDefaultPolicyLabelIsEnabled"))if(this.Upc())this.qWc=!0;else if(!this.hSc&&(this.hSc=!0,(this.lh=this.xi.value.ap)&&this.lh.DefaultLabelId))if(!this.lh.AppliedPolicyId)h.ULS.sendTraceTag(509732190,306,50,"Default labeling triggered. DefaultLabelType: {0}",this.lh.DefaultLabelType),this.qFa(this.lh.DefaultLabelId,null,1);else if(u.a.Fh().equals(this.lh.DefaultLabelType,"documentLibraryDefault")){const Gb=this.Gq[this.lh.AppliedPolicyId],Wc=this.Gq[this.lh.DefaultLabelId];
this.lh.AppliedPolicyId!==this.lh.DefaultLabelId&&u.a.Fh().equals(this.lh.PolicyLabelAssignmentMethod,"standard")&&Gb.Order<Wc.Order&&(h.ULS.sendTraceTag(509732189,306,50,"Default labeling triggered. DefaultLabelType: {0}",this.lh.DefaultLabelType),this.qFa(this.lh.DefaultLabelId,null,1))}}aSd(){if(!this.xi.value.jxf()){var Gb=this.Gq[this.lh.AppliedPolicyId];this.$pb&&this.rua&&this.i0a!==this.rua.id&&(!Gb||Gb.Order<this.rua.sensitivityLabel.Order)&&(Gb=this.qFa(this.rua.id,{},4),32!==Gb?h.ULS.sendTraceTag(50868813,
306,10,"ProcessAutoSensitivityLabel: SetSensitivityByPolicyId failed with response: "+Gb):(this.i0a=this.rua.id,this.pja&&(Gb=this.Gq[this.pja])&&Gb.Order<=this.rua.sensitivityLabel.Order&&(this.xi.value.Fha(29),this.pja=null)));Gb=this.Gq[this.xi.value.ap.AppliedPolicyId];if(this.ika&&this.pja!==this.ika.id&&(!Gb||Gb.Order<this.ika.sensitivityLabel.Order)){const Wc=this.ika.id;this.xi.value.Fha(29);this.xi.value.e7b(29,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelRecommendationMessage,
this.rlc(this.ika.sensitivityLabel))+" "+this.ika.Uuj,CommonUIStrings.l_PolicyLabelRecommendationButton,()=>{this.qFa(Wc,{},8)});this.pja=this.ika.id}this.ika=this.rua=null}}setPolicyLabel(Gb,Wc,pd,fe=2){this.JSa()?Wc&&(this.Ame=!0):this.u1a=Wc;this.xi.value.setPolicyLabel(Gb);this.kh.updateCommandUI();pd=new t(fe,this.rlc(this.Gq[Gb]));this.xi.value.j1d(Gb,this.JSa()?Wc:this.u1a,pd)}rmh(Gb,Wc,pd,fe){1===Gb&&this.setPolicyLabel(Wc,fe,pd)}qmh(Gb,Wc,pd){1===Gb?this.JSa()?this.qFa(Wc,null,2,pd):this.setPolicyLabel(Wc===
this.lh.AppliedPolicyId?"":Wc,pd,""):this.kh.updateCommandUI()}d4d(Gb){(new G(Gb,Object(k.a)(this,this.qmh,"continueToSetPolicyLabelFromJustificationDialog"))).d4d()}D4d(Gb,Wc){(new R(Gb,Wc,Object(k.a)(this,this.rmh,"continueToSetPolicyLabelFromUDPDialog"))).D4d()}J8b(Gb="",Wc=""){const pd=new da.StandardDialog;pd.hw=m.AFrameworkApplication.nHb;pd.Rd=0;pd.qe(1,CommonUIStrings.l_DialogClose);pd.BV(Gb,Wc,null)}q8g(Gb){1===Gb&&this.xi.value.Esj()}h2g(){const Gb=new da.StandardDialog;Gb.hw=m.AFrameworkApplication.nHb;
Gb.Rd=1;Gb.qe(1,CommonUIStrings.l_OICDownLoadACopyDialogOpenButton);Gb.qe(0,CommonUIStrings.l_DialogClose);Gb.BV(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityBlockUDPSetLabelMessage,Object(k.a)(this,this.q8g,"blockUDPSetLabelHandler"))}isReactRibbonEnabled(){return!!this.kh&&!!this.kh.Ra&&this.kh.Ra.dm}Yn(){return this.kh&&this.kh.Ra?this.kh.Ra.Yn:!1}Kfc(){return 32}OSj(Gb,Wc,pd,fe){Gb?(fe[I.value]=Gb,fe[I.ak]=Gb,fe[I.customTooltip]=Wc,this.Yfg(pd,m.AFrameworkApplication.protectedFile,
fe)):(fe[I.iconColor]=I.oLc,this.lh.MandatoryLabelingEnforced?(fe[I.value]=fe[I.ak]=this.vlc().WZd,fe[I.icon]=I.Ttj):(fe[I.value]=fe[I.ak]=this.vlc().LKd,fe[I.icon]=I.Wtj));fe[I.visible]=!0}HRj(Gb){let Wc="",pd="",fe="";if(this.lh.AreLabelsAvailable){let le=null;this.Gq&&(le=this.Gq[this.lh.AppliedPolicyId]);le&&(Wc=this.rlc(le),pd=le.Tooltip,m.AFrameworkApplication.protectedFile=this.xi.value.hcb(le),fe=this.$od(le));if(!this.xi.value.sla()&&!le)return}else{if(!this.gJa)return;Wc=this.gJa;fe=I.oLc;
pd=this.jqb?this.jqb:""}this.OSj(Wc,pd,fe,Gb)}lhb(Gb,Wc,pd,fe,le){if(1===pd)return 32;this.lh=this.xi.value.ap;if(!this.lh||!le)return 32;le[I.value]="";le[I.ak]="";le[I.alt]=null;le[I.Hof]=null;le[I.Goa]=null;le[I.customTooltip]="";le[I.visible]=!1;le[I.iconColor]="";le[I.icon]="";if(this.mBd())this.HRj(le);else{pd=Wc=Gb="";if(!this.lh.AreLabelsAvailable){if(!this.gJa)return 32;Gb=this.gJa;pd=I.oLc;this.jqb&&(Wc=this.jqb)}else if(this.lh.AppliedPolicyId){fe=null;for(const te of this.lh.SensitivityLabels)if(te.Id.toLowerCase()===
this.lh.AppliedPolicyId.toLowerCase()){fe=te;break}fe&&(Gb=this.rlc(fe),Wc=fe.Tooltip,m.AFrameworkApplication.protectedFile=this.xi.value.hcb(fe),pd=this.$od(fe))}Gb&&(le[I.value]=Gb,le[I.ak]=Gb,this.Yn()?le[I.customTooltip]=Wc:le[I.alt]=Wc,this.Yfg(pd,m.AFrameworkApplication.protectedFile,le),le[I.visible]=!0)}return 32}jQb(Gb,Wc,pd,fe,le){if(1===pd)return 32;this.lh=this.xi.value.ap;if(!this.lh||!le)return 32;le[I.ak]="";if(this.Oa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpUseHideBarByDefaultSetting",
!1)&&this.lh.HideBarByDefault)return 32;Gb="";if(this.lh.AreLabelsAvailable)if(this.lh.AppliedPolicyId){if(!this.Gq)return 32;(Wc=this.Gq[this.xi.value.ap.AppliedPolicyId])&&(Gb=Wc.ParentId&&this.Gq[Wc.ParentId]?this.Gq[Wc.ParentId].DisplayName:Wc.DisplayName)}else Gb=this.lh.MandatoryLabelingEnforced?this.vlc().WZd:this.vlc().LKd;else{if(!this.gJa)return 32;Gb=this.gJa}le[I.ak]=Gb;return 32}rlc(Gb){return Gb?this.Gq?Gb.ParentId&&this.Gq[Gb.ParentId]?this.Gq[Gb.ParentId].DisplayName+"\\"+Gb.DisplayName:
Gb.DisplayName:(h.ULS.sendTraceTag(4282E4,306,15,"Policy ID to Sensitivity label dictionary has not been initialized."),Gb.DisplayName):""}Yfg(Gb,Wc,pd){this.mBd()?(pd[I.icon]=this.wif(Wc),pd[I.iconColor]=this.xif(Gb)):this.Yn()?pd[I.icon]=Wc?I.O5j:I.Q5j:(pd[I.Hof]=m.AFrameworkApplication.dC,pd[I.Goa]=Wc?l.getImageClass(I.P5j):l.getImageClass(I.R5j))}rrh(Gb){const Wc=this.rT("LearnMoreSection",!0);Gb=Object.assign(new H.a,{Id:"SensitivityLearnMore",ExternalId:"SensitivityLearnMore",MenuItemId:Gb,
LabelText:CommonUIStrings.l_LearnMore,Command:"1959943459",Image16by16:m.AFrameworkApplication.dC,Image16by16Class:l.getImageClass(I.gPi),Visible:!0,Alt:CommonUIStrings.L_LearnMoreTooltip,KeyTip:"L"});Array.add(Wc.ControlList,Gb);return Wc}AUe(Gb,Wc,pd=!1){let fe;fe="Toggle_"+Gb.Id;fe="Sensitivity_"+fe;const le=Gb.DisplayName,te=Gb.Tooltip;var Ce=Gb.Id===this.lh.AppliedPolicyId,Xb=pd?y.a.Ch(fe):fe;this.mBd()?(Ce=this.$od(Gb),Wc=Object.assign(new Z.a,{Id:Xb,ExternalId:Xb,LabelText:pd?y.a.Ch(le):le,
Command:"2935633379",MenuItemId:Xb,QueryCommand:"991261903",Visible:!0,Alt:pd?y.a.Ch(te):te,AriaLabel:ba.a.w9b,IconColor:this.xif(Ce),KeyTip:Wc}),Wc.ExternalImageId=this.wif(this.xi.value.hcb(Gb))):(Xb=Object.assign(new X.a,{Id:Xb,ExternalId:Xb,LabelText:pd?y.a.Ch(le):le,Command:"2935633379",MenuItemId:Xb,QueryCommand:"991261903",CheckedImage:m.AFrameworkApplication.dC,Visible:!0,Alt:pd?y.a.Ch(te):te,IsChecked:Ce,AriaLabel:ba.a.w9b,KeyTip:Wc}),this.isReactRibbonEnabled()?(Xb.CheckedImageClass=l.getImageClass(I.lTd),
Xb.ExternalImageId=I.lTd):Xb.CheckedImageClass=l.getImageClass(I.kxb),Wc=Xb);Xb=fe;this.Tqb[Xb]=Gb.Id;this.lse[Gb.Id]=Xb;return Wc}rT(Gb,Wc=!1){return Object.assign(new V.a,{Title:"",Id:Gb,DisplayMode:I.menu,ShowMenuSectionSeparator:Wc,ControlsId:"Ctrl_"+Gb,ControlList:[]})}kuh(Gb,Wc,pd){Gb=this.rT(Gb+"Sub");let fe=1;for(const le of Wc)(Wc=this.Gq[le])&&Wc.Enabled&&(Array.add(Gb.ControlList,this.AUe(Wc,fe.toString(),pd)),fe++);return Gb}Ne(Gb=!1){const Wc=this.rT("SensitivitySection");let pd=1;const fe=
this.Bca;for(const te in fe){const Ce=fe[te],Xb=this.Gq[te];if(Xb&&Xb.Enabled){if(Ce.count){var le="Sensitivity_"+Xb.Name;Gb&&y.a.Ch(le);le="Label"+this.xHg++;const oc=Object.assign(new O.a,{Id:le,ExternalId:le,LabelText:Gb?y.a.Ch(Xb.DisplayName):Xb.DisplayName,Command:"798637440",QueryCommand:"2875864574",Menu:Object.assign(new T.a,{Title:"",MenuSectionList:[],UpdateDynamically:!0}),ImageIsVisible:!1,Toggled:!1,ImageUsesSpaceWhileInvisible:!0,AriaLabel:ba.a.w9b,KeyTip:pd.toString(),Alt:Gb?y.a.Ch(Xb.Tooltip):
Xb.Tooltip});this.isReactRibbonEnabled()?oc.ExternalImageId=I.lTd:(oc.Image16by16=m.AFrameworkApplication.dC,oc.Image16by16Class=l.getImageClass(I.kxb));Array.add(oc.Menu.MenuSectionList,this.kuh(le,Ce,Gb));Array.add(Wc.ControlList,oc);this.Tqb[oc.Id]=Xb.Id;this.lse[Xb.Id]=oc.Id}else Array.add(Wc.ControlList,this.AUe(Xb,pd.toString(),Gb));pd++}}return Wc}ztb(Gb){return!!this.Na.z8(Gb)&&!!this.Na.z8(Gb).flags&&!!this.Na.z8(Gb).flags.length}lgj(Gb,Wc){Wc.onSuccess&&this.Gq&&(Gb=this.Gq[this.xi.value.ap.AppliedPolicyId])&&
(this.pja&&(Wc=this.Gq[this.pja])&&Wc.Order<=Gb.Order&&(this.xi.value.Fha(29),this.pja=null),this.i0a&&this.i0a!==Gb.Id&&(this.xi.value.Fha(28),this.i0a=null))}wif(Gb){return Gb?I.Vtj:I.Utj}xif(Gb){return Gb?Gb:I.oLc}$od(Gb){if(Gb.Color||!Gb.ParentId)return Gb.Color;const Wc=this.Gq[Gb.ParentId];return Wc?Wc.Color:Gb.Color}wek(Gb){switch(Gb){case 2:case 14:case 15:return 1;case 21:return 2;default:return 0}}vlc(){this.WZc||(this.WZc=Object.assign(new v,{LKd:HeaderStrings.NoSensitivityLabel,WZd:HeaderStrings.SelectASensitivityLabel}));
return this.WZc}static Kjk(){m.AFrameworkApplication.da&&!m.AFrameworkApplication.da.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)||!la.c()||appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("OpenDocumentLabelPane",!0))}static PDc(Gb){la.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!Gb))}static ij(Gb){return Gb&&Gb.length?!1:!0}}Object(c.a)(Ua,"PolicyActor",null,[526]);var ka=a(661),nb=a(105),Ea;(function(Gb){Gb[Gb.unknown=
0]="unknown";Gb[Gb.boot=1]="boot";Gb[Gb.refresh=2]="refresh";Gb[Gb.selfSetPolicyLabel=3]="selfSetPolicyLabel"})(Ea||(Ea={}));Object(c.b)("GetPolicyLabelsReason",Ea);class sb extends Sys.EventArgs{constructor(Gb,Wc,pd,fe,le,te){super();this.twb=Gb;this.title=Wc;this.message=pd;this.buttonText=fe;this.Eda=le;this.aJb=te}}Object(c.a)(sb,"AddAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class Oa extends Sys.EventArgs{constructor(Gb,Wc,pd,fe,le){super();this.twb=Gb;this.title=Wc;this.message=
pd;this.buttonText=fe;this.Eda=le}}Object(c.a)(Oa,"AddMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var La;(function(Gb){Gb[Gb.none=0]="none";Gb[Gb.reasonDefaultLabel=1]="reasonDefaultLabel";Gb[Gb.reasonManual=2]="reasonManual";Gb[Gb.reasonAutomatic=4]="reasonAutomatic";Gb[Gb.reasonRecommended=8]="reasonRecommended";Gb[Gb.reasonMandatory=16]="reasonMandatory"})(La||(La={}));Object(c.b)("ApplyLabelFlags",La);class ia extends Sys.EventArgs{constructor(Gb,Wc,pd){super();this.FOe=Gb;
this.EOe=Wc;this.existingLabelPriority=pd}}Object(c.a)(ia,"AutoCLPSecurityNodesEventArgs",Sys.EventArgs,[]);class Sa extends Sys.EventArgs{constructor(){super()}}Object(c.a)(Sa,"GetPolicyLabelEventArgs",Sys.EventArgs,[]);class Za extends Sys.EventArgs{constructor(){super()}}Object(c.a)(Za,"GetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class Ab{constructor(){this.AreLabelsAvailable=!1;this.AppliedPolicyId=null;this.MandatoryLabelingEnforced=this.RequiredDowngradeJustification=!1;this.SensitivityLabels=
this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.CustomUrl=this.DefaultLabelType=this.DefaultLabelId=null;this.AreLabelsAvailable=this.HideBarByDefault=!1;this.AppliedPolicyId="";this.RequiredDowngradeJustification=!1;this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.DefaultLabelType=this.DefaultLabelId="";this.SensitivityLabels=[];this.MandatoryLabelingEnforced=!1;this.CustomUrl="";this.HideBarByDefault=!1}}Object(c.a)(Ab,"GetPolicyLabelsData",null,[]);class pb extends Sys.EventArgs{constructor(Gb=
!1){super();this.onSuccess=Gb}}Object(c.a)(pb,"LabelInfoUpdateEventArgs",Sys.EventArgs,[]);class Tb extends Sys.EventArgs{constructor(Gb,Wc){super();this.GCa=Gb;this.TEe=Wc}}Object(c.a)(Tb,"MandatoryLabellingAppHandlerEventArgs",Sys.EventArgs,[]);class ob extends Sys.EventArgs{constructor(Gb,Wc,pd,fe){super();this.title=Gb;this.xAc=Wc;this.buttonText=pd;this.QLf=fe}}Object(c.a)(ob,"PolicyTipEventArgs",Sys.EventArgs,[]);class va extends Sys.EventArgs{constructor(Gb,Wc){super();this.twb=Gb;this.aJb=
Wc}}Object(c.a)(va,"RemoveAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class Pa extends Sys.EventArgs{constructor(){super()}}Object(c.a)(Pa,"RemoveMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);class jb extends Sys.EventArgs{constructor(Gb,Wc){super();this.wAc=Gb;this.uP=Wc}}Object(c.a)(jb,"SetPolicyLabelEventArgs",Sys.EventArgs,[]);class Ob extends Sys.EventArgs{constructor(Gb,Wc,pd,fe=null,le=null,te=null,Ce=null){super();this.errorType=Gb;this.Lkg=pd;this.title=fe;this.message=
le;this.buttonText=te;this.Eda=Ce}}Object(c.a)(Ob,"SetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class kb extends Sys.EventArgs{constructor(){super()}}Object(c.a)(kb,"SetPolicyLabelTriggeredEventArgs",Sys.EventArgs,[]);class ra extends Sys.EventArgs{constructor(Gb){super();this.aYj=Gb}}Object(c.a)(ra,"UDPLabelingAppHandlerEventArgs",Sys.EventArgs,[]);var rb=a(112),Kb=a(108),Sb=a(42),cb=a(64),cc=a(41);class Ub{constructor(Gb,Wc,pd,fe,le,te,Ce,Xb=null,oc=null,Zc=!1,yd=null,Od=null,dc=null,gd=null,
wd=!1,Ld=null,Xd=null,Ie=null,We=null,jf=null,tc=null){this.url=Gb;this.cnk=Wc;this.body=pd;this.headers=fe;this.ckb=le;this.priority=te;this.state=Ce;this.azg=Xb;this.tR=oc;this.zQ=Zc;this.lrj=yd;this.RNj=Od;this.name=dc;this.igb=gd;this.jnd=wd;this.wPd=Ld;this.Jhc=Xd;this.epc=Ie;this.Iib=We;this.usi=jf;this.responseType=tc}}Object(c.a)(Ub,"ClientRequest",null,[]);var wb=a(473),vc=a(237);class Lb{static tQj(Gb,Wc){if(!Gb||!Wc||Gb.count!==Wc.count)return!1;for(const pd of Gb)if(!Wc.contains(pd))return!1;
return!0}static toArray(Gb){if(!Gb)return null;const Wc=Array(Gb.count);let pd=0;for(const fe of Gb)Wc[pd]=fe,pd++;return Wc}}Object(c.a)(Lb,"HashSetUtils",null,[]);var Ja=a(209),Hb=a(174);class gc{constructor(Gb,Wc,pd,fe=0,le=null){this.eSc=this.Kie=null;this.hwa=this.qpb=this.spb=0;this.v5="";this.aKa=this.UPc=this.$le=this.lua=this.JXc=null;this.Bme=!1;this.DHa=null;this.GUc=0;this.N3b=this.cKa=this.IIa=this.M3b=null;this.$a=new nb.a;this.yUb=this.iEb=this.Fv=null;this.uVc=!1;this.BKb=null;this.Oa=
Gb;this.Qi=Wc;this.Hj=pd;this.Q2b=fe;this.ap=new Ab;this.kse=this.Oa.Sa("PolicyHandlerEndpointName")||"PolicyHandler.ashx";this.nS=le;this.opc=Gb.pa("WacApplyManualPolicyLabelIsEnabled");this.Epc=Gb.pa("CoAuthForProtectedFilesIsEnabled");this.supportsOfficeClientCoauthoring=Gb.pa("SupportsOfficeClientCoauthoring");this.bKi=!1;this.FSj=3E4;this.fg=Kb.a.instance;Gb.pa("SupportsPolicies")&&S.a("MipSupportsPolicies");this.Epc&&this.supportsOfficeClientCoauthoring&&S.a("MipSupportsOfficeClientCoauthoring")}get azd(){return this.uVc}JCe(Gb){this.$a.addHandler("PolicyTipEvent",
Gb)}X7b(Gb){this.$a.addHandler("LabelInfoUpdateEvent",Gb)}PBj(Gb){this.$a.removeHandler("LabelInfoUpdateEvent",Gb)}UCe(Gb){this.$a.addHandler("SetPolicyLabelEventKey",Gb)}$Cj(Gb){this.$a.removeHandler("SetPolicyLabelEventKey",Gb)}V5c(Gb){this.$a.addHandler("SetPolicyLabelFailureEventKey",Gb)}ZCj(Gb){this.$a.removeHandler("SetPolicyLabelFailureEventKey",Gb)}AZg(Gb){this.$a.addHandler("GetPolicyLabelEventKey",Gb)}zZg(Gb){this.$a.addHandler("GetPolicyLabelFailureEventKey",Gb)}xZg(Gb){this.$a.addHandler("GetAutoPolicyLabelEventKey",
Gb);this.azd&&(h.ULS.sendTraceTag(51668058,306,15,"GetAutoPolicyLabelHandler was registered after the AutoPolicyLabelHandlerEvent was raised"),this.PSd(new Sa(0)))}sBj(Gb){this.$a.removeHandler("GetAutoPolicyLabelEventKey",Gb)}UYg(Gb){this.$a.addHandler("CreateAutoCLPSecurityNodesEventKey",Gb)}UAj(Gb){this.$a.removeHandler("CreateAutoCLPSecurityNodesEventKey",Gb)}T0g(Gb){this.$a.addHandler("UpdateAutoCLPLabelPriorityNodeEventKey",Gb)}nDj(Gb){this.$a.removeHandler("UpdateAutoCLPLabelPriorityNodeEventKey",
Gb)}U0g(Gb){this.$a.addHandler("UpdateAutoCLPSITNodesEventKey",Gb)}oDj(Gb){this.$a.removeHandler("UpdateAutoCLPSITNodesEventKey",Gb)}vBe(Gb){this.$a.addHandler("AddAutoPolicyBusinessBarEntryEventKey",Gb)}kAj(Gb){this.$a.removeHandler("AddAutoPolicyBusinessBarEntryEventKey",Gb)}LCe(Gb){this.$a.addHandler("RemoveAutoPolicyBusinessBarEntryEventKey",Gb)}FCj(Gb){this.$a.removeHandler("RemoveAutoPolicyBusinessBarEntryEventKey",Gb)}wBe(Gb){this.$a.addHandler("AddMandatoryLabellingBusinessBarEntryEventKey",
Gb)}mAj(Gb){this.$a.removeHandler("AddMandatoryLabellingBusinessBarEntryEventKey",Gb)}MCe(Gb){this.$a.addHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",Gb)}GCj(Gb){this.$a.removeHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",Gb)}m_g(Gb){this.$a.addHandler("MandatoryLabellingAppHandlerEventKey",Gb)}$Bj(Gb){this.$a.removeHandler("MandatoryLabellingAppHandlerEventKey",Gb)}Q0g(Gb){this.$a.addHandler("UDPLabelingAppHandlerEventKey",Gb)}lDj(Gb){this.$a.removeHandler("UDPLabelingAppHandlerEventKey",
Gb)}get lAd(){if(!this.Kie)return!1;for(const Gb of this.Kie.zrk())if(!Gb.Capabilities||!Gb.Capabilities.SupportsClientIsMipTrusted)return!1;return!0}get vJi(){return!!this.Fv}Zfh(){return this.$le?this.$le():!1}nwj(Gb){this.UPc=Gb}Yy(){return(new Date).getTime()}tkc(){this.Hj&&(this.M3b=this.Hj.Ze("WebServiceCall","Call Get Policy Endpoint On Server"));var Gb=Ja.a.wma(1,1);this.Oa.pa("SendHostAttributionInfoForPolicyLabelEnabled")?(Gb=new Ub(this.o$a("datalosspolicy"),1,null,null,!0,2,null,void 0,
void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Gb),this.Qi.send(Gb).pUd(Object(k.a)(this,this.pNf,"onDataLossPolicySuccessCallback"),Object(k.a)(this,this.oNf,"onDataLossPolicyFailureCallback"))):this.Qi.Ho(this.o$a("datalosspolicy"),1,null,null,!0,2,Object(k.a)(this,this.pNf,"onDataLossPolicySuccessCallback"),Object(k.a)(this,this.oNf,"onDataLossPolicyFailureCallback"),null);this.spb++;h.ULS.sendTraceTag(25565151,306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.",
this.kse,this.spb)}Xvj(){this.Fpd(this.v5,2,this.lua)}Fpd(Gb,Wc=0,pd=null,fe=!1){L.Health.instance.recordKpiUsage("MipGetPolicyLabel",0,"officewebclp",this.Wpd(void 0,Wc));this.iEb=this.Yy();const le=this.sed(Wc);this.skc(Gb,le,pd,fe,Wc);this.PWd(!0)}pNf(Gb){this.xYf();let Wc="";({data:Wc}=this.o9d(Gb)).returnValue&&(h.ULS.sendTraceTag(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),this.spb=0,this.Hj&&(this.N3b=this.Hj.Ze("Task","Parse and Handle Get Policy Response")),this.ojj(Wc),
this.N3b&&(this.N3b.stop(),this.N3b=null))}oNf(Gb){this.xYf();this.spb<=this.Q2b?this.tkc():(h.ULS.sendTraceTag(25565154,306,15,"Request to get DataLossPrevention policy failed with error response: {0}.",Gb?Gb.data?Gb.data.RWa:null:null),this.spb=0)}jxf(){return 0<this.hwa}setPolicyLabel(Gb){this.ap.AppliedPolicyId=Gb}j1d(Gb,Wc,pd=null){const fe=this.Wqh(pd);this.ESj(Gb,Wc,fe,pd)}eUf(Gb){this.cKa&&(this.cKa.stop(),this.cKa=null);const {Zcg:Wc,Dgg:pd}=this.Ghf(Gb),fe=Gb.data.state,le=fe?fe.uP:2;let te=
"";({data:te}=this.o9d(Gb)).returnValue?(h.ULS.sendTraceTag(41799707,306,50,"Request to set label policy data succeeded. ApplyLabelFlag: {0}",le),this.hwa=0,this.Gjj(te,Wc,pd,fe)):this.xYd(le)}zsj(Gb){L.Health.instance.recordKpiUsage("MipSetPolicyLabel",0,"officewebclp",this.Wpd(Gb));this.yUb=this.Yy();h.ULS.sendTraceTag(575947405,306,50,"Raising set policy label triggered event.");this.$a.raiseEvent("SetPolicyLabelTriggeredEventKey",new kb(Gb))}Y0i(){this.Epc&&this.supportsOfficeClientCoauthoring&&
this.vJi&&this.Fv.Qaa(12,null,!0)}dUf(Gb){this.cKa&&(this.cKa.stop(),this.cKa=null);const {Zcg:Wc,Dgg:pd}=this.Ghf(Gb);if(this.hwa<=this.Q2b)this.j1d(Wc,pd);else{var fe=Gb.data.state;fe=fe?fe.uP:2;h.ULS.sendTraceTag(41799708,306,15,"Request to set label policy failed with error response: {0}. ApplyLabelFlag: {1}",Gb?Gb.data?Gb.data.RWa:null:null,fe);this.BKb="WACServerConnectionFailed";this.hwa=0;this.xYd(fe)}}iJi(Gb){if(Gb&&("LabelNotSupported"===Gb||"LabelErrorRetryLater"===Gb||"CoherencyFailure"===
Gb||"LabelIdNotFound"===Gb||"LabelDisabled"===Gb))return h.ULS.sendTraceTag(539103556,306,50,"LabelError is retriable: {0}",Gb),!0;h.ULS.sendTraceTag(539103557,306,50,"LabelError is not retriable: {0}",Gb);return!1}hcb(Gb){return this.Oa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UDPAsProtectedLabelEnabled",!1)?Gb.IsEndpointProtectionEnabled||Gb.HasUserDefinedPermissions:Gb.IsEndpointProtectionEnabled}Jdh(Gb){if(!Gb)return!1;let Wc=null,pd=null;for(const fe of this.ap.SensitivityLabels)fe.Id===
Gb&&(Wc=fe),fe.Id===this.v5&&(pd=fe);if(!Wc)return!1;if(this.Epc&&this.supportsOfficeClientCoauthoring){if(this.UPc&&this.UPc()||this.lAd)return!0}else if(m.AFrameworkApplication.Oy&&m.AFrameworkApplication.Oy.B9a||this.lua&&this.lua())return!0;return this.hcb(Wc)===(!!pd&&this.hcb(pd))}e7b(Gb,Wc,pd,fe,le){28===Gb?this.d1f(new sb(Gb,Wc,pd,fe,le,!1)):this.d1f(new sb(Gb,Wc,pd,fe,le,!0))}Fha(Gb){28===Gb?this.L1f(new va(Gb,!1)):this.L1f(new va(Gb,!0))}Crj(Gb,Wc,pd){h.ULS.sendTraceTag(545280777,306,50,
"Raising a CreateAutoCLPSecurityNodes event.");this.$a.raiseEvent("CreateAutoCLPSecurityNodesEventKey",new ia(Gb,Wc,pd))}Fsj(Gb){h.ULS.sendTraceTag(545280778,306,50,"Raising a UpdateAutoCLPLabelPriorityNode event.");this.$a.raiseEvent("UpdateAutoCLPLabelPriorityNodeEventKey",new ia(null,null,Gb))}Gsj(Gb,Wc){h.ULS.sendTraceTag(545280779,306,50,"Raising a UpdateAutoCLPSITNodes event.");this.$a.raiseEvent("UpdateAutoCLPSITNodesEventKey",new ia(Gb,Wc,null))}x1f(Gb,Wc){h.ULS.sendTraceTag(572650527,306,
50,"Raising a mandatory labelling"+(1===Wc?"Reading":"Edit")+" switch event.");this.$a.raiseEvent("MandatoryLabellingAppHandlerEventKey",new Tb(Gb,Wc))}H4c(Gb,Wc,pd,fe,le){37===Gb&&this.srj(new Oa(37,Wc,pd,fe,le))}iVd(){this.ssj(new Pa)}Esj(){h.ULS.sendTraceTag(540608322,306,50,"Raising a UDP labeling event.");this.$a.raiseEvent("UDPLabelingAppHandlerEventKey",new ra(!0))}sla(Gb=!1){const Wc=!!this.ap&&this.ap.AreLabelsAvailable&&!!this.ap.SensitivityLabels&&0<this.ap.SensitivityLabels.length&&vc.a.any(this.ap.SensitivityLabels,
pd=>!!pd&&pd.Enabled);Wc||Gb||Ua.PDc(!1);return Wc}qPf(Gb){this.IIa&&(this.IIa.stop(),this.IIa=null);var Wc="";this.PWd(!1);({data:Wc}=this.o9d(Gb)).returnValue?(h.ULS.sendTraceTag(34996493,306,50,"Request to get label policy data succeeded."),this.qpb=0,Wc=this.wjj(Wc),Gb=this.kgf(Gb.data),L.Health.instance.recordKpiSuccess("MipGetPolicyLabel",this.Cjc(void 0,Gb,this.iEb)),this.iEb=null,Gb=new Sa(Gb),this.Prj(Gb),this.Oa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?
Wc&&this.GWj()?this.azd?this.Bgk():(this.Oa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)||this.vyb(),this.PSd(Gb),this.uVc=!0):Wc||this.ABc():!this.azd&&Wc&&this.Oa.pa("WacApplyManualPolicyLabelIsEnabled")&&this.nGe()?(this.PSd(Gb),this.uVc=!0):Wc||this.ABc()):this.ABc()}GWj(){if(!this.Oa.pa("WacApplyManualPolicyLabelIsEnabled"))return h.ULS.sendTraceTag(539877667,306,50,"ShouldAutoClassificationRun returned false - Manual Labeling is not enabled"),
!1;if(!this.nGe())return!1;if(""===this.v5)return h.ULS.sendTraceTag(539877696,306,50,"ShouldAutoClassificationRun returned true - document is not labeled"),!0;if(this.DHa===this.GUc)return h.ULS.sendTraceTag(539877697,306,50,"ShouldAutoClassificationRun returned false - Applied label already has the highest priority"),!1;h.ULS.sendTraceTag(539877698,306,50,"ShouldAutoClassificationRun returned true - document is labeled but not with the highest priority label");return!0}vyb(){this.Gug();h.ULS.sendTraceTag(545104324,
306,50,"Creating AutoCLP Security nodes. HasSITs: {0}, LabelPriority: {1}",0<this.aKa.count,this.DHa);const Gb=Lb.toArray(this.aKa);this.Crj(Gb,Gb,this.DHa)}Bgk(){var Gb=this.aKa;this.Gug();Lb.tQj(Gb,this.aKa)||(h.ULS.sendTraceTag(545104325,306,50,"Updating AutoCLP SIT nodes. HasSITs: {0}",0<this.aKa.count),Gb=Lb.toArray(this.aKa),this.Gsj(Gb,Gb));this.Bme&&(h.ULS.sendTraceTag(545104326,306,50,"Updating AutoCLP Label Priority node. LabelPriority: {0}",this.DHa),this.Fsj(this.DHa))}Gug(){const Gb=
new ka.a(u.a.Fh());for(const Wc of this.ap.SensitivityLabels)if(Wc&&Wc.AutoLabelingSensitiveTypeIds&&0<Wc.AutoLabelingSensitiveTypeIds.length)for(const pd of Wc.AutoLabelingSensitiveTypeIds)pd&&Gb.add(pd);this.aKa=Gb}pPf(Gb){const Wc=this.kgf(Gb.data);L.Health.instance.recordKpiFailure("MipGetPolicyLabel","GetPolicyLabelsFailure",!1,!1,this.Cjc(void 0,Wc,this.iEb));this.iEb=null;this.IIa&&(this.IIa.stop(),this.IIa=null);if(this.qpb<=this.Q2b){if(this.Oa.pa("SendHostAttributionInfoForPolicyLabelEnabled")){const pd=
Gb.data.request.get_headers();if("HostAttributionInfo.ScenarioParamName"in pd&&pd[Ja.a.jFc]&&"HostAttributionInfo.ScenarioTypeParamName"in pd&&pd[Ja.a.fTb]){Gb.data.request.get_headers();Gb.data.request.get_headers()[Ja.a.fTb];Gb=this.sed(Wc);this.skc(this.v5,Gb,this.lua,void 0,Wc);return}}this.Fpd(this.v5,Wc,this.lua)}else h.ULS.sendTraceTag(34996494,306,15,"Request to get label policy failed with error response: {0}.",Gb?Gb.data?Gb.data.RWa:null:null),this.ABc(),this.qpb=0,this.PWd(!1)}kgf(Gb){return Gb.state?
Gb.state:0}o$a(Gb,Wc=!1){let pd=String.format("{0}{1}?action={2}&{3}",this.Oa.Sa("PolicyHandlerWebServiceBase")||m.AFrameworkApplication.sa.Ra.rZ,this.kse,Gb,m.AFrameworkApplication.Ak);"setpolicylabel"===Gb&&m.AFrameworkApplication.Oy&&m.AFrameworkApplication.Oy.Etf&&(pd=cb.a.um(pd,"sl","1"));Wc&&(pd=cb.a.um(pd,"cbd","1"));return pd}Ghf(Gb){let Wc,pd;Wc=pd=null;Gb&&Gb.data&&Gb.data.request&&Gb.data.request.get_headers()&&(Wc=Gb.data.request.get_headers()[wb.a.h_d],pd=Gb.data.request.get_headers()[wb.a.i1d]);
return{Zcg:Wc,Dgg:pd}}o9d(Gb){Gb=Gb?Gb.data?Gb.data.Tf:null:null;return Gb&&Gb.length&&!this.XJi(Gb)?{returnValue:!0,data:Gb}:(h.ULS.sendTraceTag(25565152,306,10,"No response data from policy endpoint."),{returnValue:!1,data:Gb})}ojj(Gb){let Wc;try{Wc=Sb.b(Gb)}catch(pd){h.ULS.sendTraceTag(37880331,306,10,"Error when deserializing DataLossPrevention response.");return}if(Wc)if(Wc.IsPolicyTipAvailable)switch(Wc.IsPolicyTipAvailable.toLowerCase()){case "false":h.ULS.sendTraceTag(26007261,306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");
break;case "true":h.ULS.sendTraceTag(25565186,306,50,"DLP Policy is enabled on this document.");this.eSc=Wc.NavigateUrl;this.d1j(Wc.GeneralText,Object(k.a)(this,this.j6i,"onDataLossPolicyOverrideButtonClick"));break;default:h.ULS.sendTraceTag(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",Wc.IsPolicyTipAvailable)}else h.ULS.sendTraceTag(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");else h.ULS.sendTraceTag(25565185,
306,10,"policyData is null after deserializing DataLossPrevention response.")}lnh(Gb){switch(Gb){case "CoherencyFailure":return 1;case "DisabledByPolicy":return 2;case "FileCheckedOut":return 3;case "FileEncrypted":return 4;case "FileLocked":return 5;case "FileNotSupported":return 6;case "FileTooLarge":return 7;case "InvalidOperationOnZeroByteFile":return 8;case "LabelDisabled":return 9;case "LabelErrorRetryLater":return 10;case "LabelIdNotFound":return 11;case "LabelIrmDisabledByTenant":return 12;
case "LabelNotSupported":return 13;case "MinorVersionLimitExceeded":return 15;default:return 0}}Gjj(Gb,Wc,pd,fe){var le=fe?fe.uP:2;let te=0,Ce="",Xb;if(({Mu:Xb}=Sb.d(Gb)).returnValue)if(Xb){Ce="Success";Gb=this.sed(3);if(Xb.IsSuccessful){L.Health.instance.recordKpiSuccess("MipSetPolicyLabel",this.Cjc(le,void 0,this.yUb));this.BKb=this.yUb=null;h.ULS.sendTraceTag(51233632,306,50,"setPolicyLabel was successful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",le);2===
le&&this.Fha(29);this.DTj(Wc,le);this.Y0i();this.Fha(28);fe&&4===le&&this.e7b(28,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelAutomaticallyAppliedMessage,fe.displayName),CommonUIStrings.l_DialogOk,()=>{});S.a("MipAppliedLabels",void 0,void 0,[Object.assign(new fa.a,{name:"SetPolicyLabelApplyFlag",string:La[le]})]);this.skc(Wc,Gb,this.lua,void 0,3);return}h.ULS.sendTraceTag(51233631,306,10,"setPolicyLabel was unsuccessful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}, FailureReason: {1}",
le,Xb.FailureReason);this.BKb=Xb.FailureReason;te=this.lnh(Xb.FailureReason);this.bKi&&0<=Xb.FailureReason.indexOf("InvalidOperationOnZeroByteFile")&&(fe=new rb.a(2,1,this.FSj,()=>{h.ULS.sendTraceTag(575428443,306,15,"Retring SetPolicyLabelRequestAsync as previous called failed due to zero byte. Attempt number : {0}",this.hwa);this.hwa<=this.Q2b&&this.j1d(Wc,pd)}),this.fg.Sh(fe));this.Epc&&this.supportsOfficeClientCoauthoring&&this.skc(this.ap.AppliedPolicyId,Gb,this.lua,!0,3)}else Ce="setPolicyLabelData null.",
h.ULS.sendTraceTag(42467541,306,10,"setPolicyLabelData is null after deserializing set policy label data response. ApplyLabelFlag: {0}",le);else Ce="TryDeserialize failed.",h.ULS.sendTraceTag(41799709,306,10,"Error when deserializing set policy label data response. ApplyLabelFlag: {0}",le);this.xYd(le,te);le=this.Cjc(le,void 0,this.yUb);this.yUb=null;le.extendedProperties.set("SetPolicyLabelDataFailureReason",this.BKb);le.extendedProperties.set("SetPolicyLabelDataParseStatus",Ce.toString());L.Health.instance.recordKpiFailure("MipSetPolicyLabel",
"SetPolicyLabelFailure",!1,!1,le)}xYd(Gb,Wc=0){const pd=2===Gb||8===Gb||16===Gb;this.setPolicyLabel(this.v5);this.v1f(new pb);this.aTd(Wc,Gb,pd,!1)}DTj(Gb,Wc){this.setPolicyLabel(this.v5=Gb);if(""===Gb)m.AFrameworkApplication.protectedFile=!1,m.AFrameworkApplication.enableMacrosForProtectedFile=!1;else for(const pd of this.ap.SensitivityLabels)if(pd.Id===Gb){m.AFrameworkApplication.protectedFile=this.hcb(pd);break}this.ysj(new jb(Gb,Wc))}Aik(){for(const Gb of this.ap.SensitivityLabels)Gb&&Gb.Enabled&&
(Gb.Id===this.v5&&(this.Bme=this.DHa!==Gb.Order,this.DHa=Gb.Order),Gb.Order>this.GUc&&(this.GUc=Gb.Order))}wjj(Gb){if(!({Mu:Gb}=Sb.d(Gb)).returnValue)return h.ULS.sendTraceTag(34996495,306,10,"Error when deserializing label policy data response."),!1;if(!Gb)return h.ULS.sendTraceTag(42467542,306,10,"policyData is null after deserializing label policy data response."),!1;if(!Gb.AreLabelsAvailable)return!1;this.ap=Gb;this.v5=Gb.AppliedPolicyId;this.Oa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnablePdfProtectionUsageTelemetry",
!1)&&this.Oa.appSettings&&(this.Oa.appSettings.AppliedPolicyId=this.v5);this.Oa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&this.Aik();this.sla()&&h.ULS.sendTraceTag(51197846,306,50,"Labels are available for display after GetPolicyLabels call.");this.v1f(new pb(!0));return!0}nGe(){if(!this.sla())return h.ULS.sendTraceTag(539877699,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels to display"),!1;for(const Gb of this.ap.SensitivityLabels)if(Gb&&
Gb.AutoLabelingSensitiveTypeIds&&0<Gb.AutoLabelingSensitiveTypeIds.length)return!0;h.ULS.sendTraceTag(539877700,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels with AutoClp SIT");return!1}v1f(Gb){h.ULS.sendTraceTag(35393610,306,50,"Raising label info update event.");this.$a.raiseEvent("LabelInfoUpdateEvent",Gb)}Prj(Gb){h.ULS.sendTraceTag(50676305,306,50,"Raising get policy label event.");this.$a.raiseEvent("GetPolicyLabelEventKey",Gb)}ABc(){Ua.PDc(!1);this.$a.raiseEvent("GetPolicyLabelFailureEventKey",
new Za)}PSd(Gb){this.nS&&this.nS.execute(Wc=>{Wc=[Wc.isFeatureEnabled("MsoClpSpTwo",!0),Wc.isFeatureEnabled("MsoDrmPremiumSpTwo",!0)];Promise.all(Wc).then(pd=>{vc.a.any(pd,fe=>fe)&&(h.ULS.sendTraceTag(50944077,306,50,"Raising get auto policy label event."),this.$a.raiseEvent("GetAutoPolicyLabelEventKey",Gb),this.Oa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)&&this.vyb(),S.a("MipAutoClassificationEnabled"));return null})})}Wpd(Gb=null,Wc=null){const pd=
new Map;pd.set("ClpCoauth",this.supportsOfficeClientCoauthoring.toString());null!=Gb&&pd.set("ApplyLabelFlags",La[Gb]);null!=Wc&&pd.set("GetPolicyLabelsReason",Ea[Wc]);return pd}Cjc(Gb=null,Wc=null,pd=null){const fe=new Hb.a;fe.extendedProperties=this.Wpd(Gb,Wc);null!=pd&&(fe.durationMs=this.Yy()-pd);return fe}ysj(Gb){h.ULS.sendTraceTag(41799710,306,50,"Raising set policy label event.");this.$a.raiseEvent("SetPolicyLabelEventKey",Gb)}d1f(Gb){h.ULS.sendTraceTag(51128227,306,50,"Raising an add auto policy business bar entry event.");
Gb&&Gb.aJb&&S.a("MipRecommendations");this.$a.raiseEvent("AddAutoPolicyBusinessBarEntryEventKey",Gb)}L1f(Gb){h.ULS.sendTraceTag(51128256,306,50,"Raising an remove auto policy business bar entry event.");this.$a.raiseEvent("RemoveAutoPolicyBusinessBarEntryEventKey",Gb)}srj(Gb){h.ULS.sendTraceTag(573842331,306,50,"Raising an add mandatory labelling business bar entry event.");this.$a.raiseEvent("AddMandatoryLabellingBusinessBarEntryEventKey",Gb)}ssj(Gb){h.ULS.sendTraceTag(573842332,306,50,"Raising a remove mandatory labelling business bar entry event.");
this.$a.raiseEvent("RemoveMandatoryLabellingBusinessBarEntryEventKey",Gb)}d1j(Gb,Wc=null){h.ULS.sendTraceTag(34996496,306,50,"Showing policy tip to user.");this.$a.raiseEvent("PolicyTipEvent",new ob(CommonUIStrings.l_PolicyBusinessBarTitle,Gb,CommonUIStrings.l_PolicyOverrideButton,Wc))}aTd(Gb,Wc,pd,fe=!0){h.ULS.sendTraceTag(42074656,306,fe?50:15,"Raising set policy label failure event. ApplyLabelFlags: {0}",Wc);fe=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle;let le=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage,
te=null,Ce=null;switch(Gb){case 2:fe=CommonUIStrings.l_SensitivityApplicationErrorDisabledByPolicyBusinessBarTitle;le=CommonUIStrings.l_SensitivityApplicationErrorDisabledByPolicyBusinessBarMessage;break;case 5:le=CommonUIStrings.l_SensitivityApplicationErrorFileLockedBusinessBarMessage;break;case 7:fe=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle;le=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage;break;case 13:fe=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle;
le=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage;break;case 9:fe=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle;le=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage;break;case 10:le=CommonUIStrings.l_SensitivityApplicationErrorLabelErrorRetryLaterBusinessBarMessage;break;case 14:fe=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle;le=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage;
break;case 15:fe=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle,le=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage,te=CommonUIStrings.l_LearnMore,Ce=()=>{this.GSj()}}Gb=new Ob(Gb,Wc,pd,fe,le,te,Ce);this.$a.raiseEvent("SetPolicyLabelFailureEventKey",Gb)}URj(Gb){this.JXc=Gb}j6i(){this.eSc?(h.ULS.sendTraceTag(25565187,306,50,"DLP override button was clicked."),cc.a.f2(this.eSc)):h.ULS.sendTraceTag(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")}XJi(Gb){if(!Gb.startsWith("<")||
-1===Gb.indexOf("Error")&&-1===Gb.indexOf("Unavailable"))return!1;h.ULS.sendTraceTag(25565189,306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint.");return!0}xYf(){this.M3b&&(this.M3b.stop(),this.M3b=null)}f1h(Gb){if(!Gb)return"manual";switch(Gb.uP){case 0:return"manual";case 4:return"auto";case 1:return"default";case 16:return"mandatory";case 2:return"manual";case 8:return"recommended";
default:return"manual"}}o2h(Gb){if(!Gb)return"privileged";Gb=Gb.uP;let Wc="privileged";if(4===Gb||1===Gb)Wc="standard";return Wc}skc(Gb,Wc,pd=null,fe=!1,le=0){this.Oa.pa("WacLabelingGetPolicyLabelsIsEnabled")&&(this.v5=Gb,this.lua=pd,this.Hj&&(this.IIa=this.Hj.Ze("WebServiceCall","Call Get Policy Endpoint On Server")),pd={},pd[wb.a.WFe]=Gb,this.Oa.pa("SendHostAttributionInfoForPolicyLabelEnabled")?(Gb=new Ub(this.o$a("getpolicylabels",fe),1,null,pd,!0,2,le,void 0,void 0,void 0,void 0,void 0,void 0,
void 0,void 0,void 0,void 0,void 0,void 0,Wc),this.Qi.send(Gb).pUd(Object(k.a)(this,this.qPf,"onGetPolicyLabelsSuccessCallback"),Object(k.a)(this,this.pPf,"onGetPolicyLabelsFailureCallback"))):this.Qi.Ho(this.o$a("getpolicylabels",fe),1,null,pd,!0,2,Object(k.a)(this,this.qPf,"onGetPolicyLabelsSuccessCallback"),Object(k.a)(this,this.pPf,"onGetPolicyLabelsFailureCallback"),le,void 0,void 0,void 0,void 0,"22"),this.qpb++,h.ULS.sendTraceTag(34996492,306,50,"Policy label request sent to server. Policy call times: {0}",
this.qpb))}ESj(Gb,Wc,pd,fe=null){if(this.opc){this.Hj&&(this.cKa=this.Hj.Ze("WebServiceCall","Call Set Policy Endpoint On Server"));var le={};le[wb.a.h_d]=Gb;Wc&&(le[wb.a.i1d]=encodeURIComponent(Wc));this.JXc&&(le[wb.a.SEe]=this.JXc);fe?(le[wb.a.g1d]=this.f1h(fe),le[wb.a.h1d]=this.o2h(fe),1===fe.uP&&this.ap.DefaultLabelType&&(le[wb.a.Cgg]=this.ap.DefaultLabelType)):(le[wb.a.g1d]="manual",le[wb.a.h1d]="privileged");this.supportsOfficeClientCoauthoring&&this.ap&&(le[wb.a.yYf]=this.ap.PolicyLabelVersionToken);
this.Oa.pa("SendHostAttributionInfoForPolicyLabelEnabled")?(Gb=new Ub(this.o$a("setpolicylabel",!0),1,null,le,!0,2,fe,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,pd),this.Qi.send(Gb).pUd(Object(k.a)(this,this.eUf,"onSetPolicyLabelSuccessCallback"),Object(k.a)(this,this.dUf,"onSetPolicyLabelFailureCallback"))):this.Qi.Ho(this.o$a("setpolicylabel",!0),1,null,le,!0,2,Object(k.a)(this,this.eUf,"onSetPolicyLabelSuccessCallback"),Object(k.a)(this,this.dUf,"onSetPolicyLabelFailureCallback"),
fe,void 0,void 0,void 0,void 0,"32");this.hwa++;h.ULS.sendTraceTag(41799706,306,50,"Set policy label request sent to server. Policy call times: {0}",this.hwa)}else h.ULS.sendTraceTag(570972052,306,50,"SetPolicyLabelRequestInternalAsync was exited - ApplyManualPolicyLabel was not enabled.")}GSj(){const Gb=new da.StandardDialog,Wc=this.Oa.Sa("BreadcrumbFolderUrl");Wc?(Gb.Rd=11,Gb.qe(1,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoAction),Gb.qe(2,CommonUIStrings.l_DialogOk)):
(Gb.Rd=0,Gb.qe(1,CommonUIStrings.l_DialogOk));Gb.rAe(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoHelpText,"0f6cd105-974f-44a4-aadb-43ac5bdfd247");Gb.szj();Gb.BV(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoTitle,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoMessage,pd=>{1===pd&&Wc&&cc.a.Sg(Wc,"_blank",void 0,"SetPolicyLabelFailureBusinessBarActionCallback.BreadcrumbFolderUrl")})}sed(Gb){switch(Gb){case 1:return Ja.a.wma(1,
1);case 2:return Ja.a.wma(7,1);case 3:return Ja.a.wma(8,1);default:return Ja.a.wma(7,0)}}Wqh(Gb=null){if(!Gb)return Ja.a.wma(8,0);switch(Gb.uP){case 1:case 16:return Ja.a.wma(1,1);case 4:case 2:case 8:return Ja.a.wma(8,1);default:return Ja.a.wma(8,0)}}PWd(Gb){la.c()&&appChrome.api.setAsyncRequestStatus("sensitivity",Gb)}}Object(c.a)(gc,"PolicyManager",null,[488]);var ec=a(144),Ta=a(261);class ib{constructor(){this.x5=this.Sva=this.hd=this.xi=null}get name(){return"Common.App.Policy"}init(){m.AFrameworkApplication.da.pa("ShouldInitCommonPolicyPackage")&&
(m.AFrameworkApplication.da.pa("IsDataLossPreventionEnabledForUser")&&m.AFrameworkApplication.sa&&(this.xi=this.hd.resolve("Common.App.Policy.Contracts.IPolicyManager"),this.xi.JCe(Object(k.a)(this,this.p4d,"showPolicyBusinessBar")),h.ULS.sendTraceTag(36537375,306,50,"PolicyManager is created successfully."),m.AFrameworkApplication.da.getBooleanFeatureGate("Microsoft.Office.SharedOnline.InitPolicyManagerEarlierEnabled",!1)?ec.a.get_instance().ik(5,()=>{this.xi.tkc()}):ec.a.get_instance().ik(6,()=>
{this.xi.tkc()})),m.AFrameworkApplication.da.pa("WacLabelingPoliciesIsEnabled")&&m.AFrameworkApplication.da.pa("SupportsPolicies")?m.AFrameworkApplication.da.getBooleanFeatureGate("Microsoft.Office.SharedOnline.InitPolicyManagerEarlierEnabled",!1)?ec.a.get_instance().ik(5,Object(k.a)(this,this.XKf,"onAfterRibbonBehaviorAttached")):ec.a.get_instance().ik(6,Object(k.a)(this,this.XKf,"onAfterRibbonBehaviorAttached")):(Ua.Kjk(),Ua.PDc(!1)))}dispose(){}Xj(Gb){Gb.register(488,"Common.App.Policy.Contracts.IPolicyManager").Ee().Le(()=>
new gc(m.AFrameworkApplication.da,m.AFrameworkApplication.tf,m.AFrameworkApplication.sa.EG,m.AFrameworkApplication.da.Hf("MaxGetPolicyRetries",1),Gb.Qd("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),m.AFrameworkApplication.sa.Ra.kj));Gb.register(Ua,"Common.App.Policy.PolicyActor").as("Common.App.Policy.Contracts.IPolicyActor").Ee().Le(()=>new Ua(m.AFrameworkApplication.Dd,m.AFrameworkApplication.sa,m.AFrameworkApplication.da,Gb.bYd("Common.App.Policy.Contracts.IPolicyManager")));
this.hd=Gb}XKf(){this.x5=this.hd.oi("CommonUI.BusinessBar");this.xi||(this.xi=this.hd.resolve("Common.App.Policy.Contracts.IPolicyManager"));this.Sva=this.hd.resolve("Common.App.Policy.PolicyActor");la.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")?this.xi.X7b(Object(k.a)(this.Sva,this.Sva.m4f,"registerActionsHandler")):this.Sva.tj();this.xi.X7b(Object(k.a)(this,this.H$d,"updateLabelInfo"));m.AFrameworkApplication.da.pa("WacApplyManualPolicyLabelIsEnabled")&&
(this.xi.V5c(Object(k.a)(this,this.$oi,"handleSetPolicyLabelFailure")),this.xi.vBe(Object(k.a)(this,this.e7b,"addAutoPolicyBusinessBarEntry")),this.xi.LCe(Object(k.a)(this,this.Fha,"removeAutoPolicyBusinessBarEntry")),this.xi.wBe(Object(k.a)(this,this.H4c,"addMandatoryLabellingBusinessBarEntry")),this.xi.MCe(Object(k.a)(this,this.iVd,"removeMandatoryLabellingBusinessBarEntry")))}H$d(){this.Sva.xgg();this.Sva.Qfg();this.Sva.P0f();const Gb=this.xi.Zfh();m.AFrameworkApplication.da.pa("HasDocumentEditRights")&&
!Gb?this.Sva.Srg():h.ULS.sendTraceTag(558682911,306,50,"Default/Mandatory Labeling has been skipped because HasDocumentEditRights: {0}, IsClpBlockedByAppSpecificScenario: {1}",m.AFrameworkApplication.da.pa("HasDocumentEditRights"),Gb);m.AFrameworkApplication.sa.updateCommandUI()}p4d(Gb,Wc){this.igf(Wc.title,Wc.xAc,38,Wc.QLf,Wc.buttonText);h.ULS.sendTraceTag(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.")}$oi(Gb,Wc){Wc.Lkg&&(this.igf(Wc.title,Wc.message,
21,null,null,Wc.Eda,Wc.buttonText),h.ULS.sendTraceTag(42074654,306,10,"Failed to add entry to business bar. CLP policy message could not be shown to user."))}Fha(){}e7b(Gb,Wc){this.x5&&(this.xi.Fha(Wc.twb),Gb=new d.a(Wc.title,Wc.message,null),Gb.id=Wc.twb,Gb.closeable=!0,Gb.image=3,Gb.addButton(Wc.buttonText,Wc.Eda,Wc.buttonText,!0),this.x5.tD(Gb,!1))}H4c(Gb,Wc){this.x5&&(Gb=new d.a(Wc.title,Wc.message,null),Gb.id=Wc.twb,Gb.closeable=!1,Gb.image=3,Gb.addButton(Wc.buttonText,Wc.Eda,Wc.buttonText,!1),
this.x5.tD(Gb,!1))}iVd(){}igf(Gb,Wc,pd,fe=null,le=null,te=null,Ce=null){Gb=new d.a(Gb,Wc,null);Gb.id=pd;Gb.closeable=!0;fe&&Gb.SVg(le,fe);te&&Gb.addButton(Ce,te,Ce)}static main(){Ta.a.instance.Tk(new ib)}}Object(c.a)(ib,"PackageManager",null,[2,3]);var bc=a(1),jc=a(10),sc=a(562),Fa=a(233),Ha=a(53),Na=a(38),W=a(138),U=a(39),za=a(383),ua=a(200),$a=a(93),Va=a(34),hb=a(248),qb=a(22),Nb=a(247);class yb{constructor(){this.wAc=this.Udg=null;this.uP=0}}Object(c.a)(yb,"ApplyPolicyContextParameters",null,[]);
var ja=a(2),Ka=a(730),Pb=a(574),rc=a(54),$c=a(48);class Dd{constructor(){this.k4a=this.annotationType=null;this.Vab=this.hC=!1}}Object(c.a)(Dd,"AnnotationActivationOptions",null,[]);var Jd=a(59);const Kd=(Gb,Wc,pd,fe,le,te,Ce=null)=>{Ce=Gb.Pa(1,Ce);Ce.tenantId=Wc;return Jd.g(Gb,"GetPolicyLabelId",Ce,pd,fe,le,te,4)},ce=(Gb,Wc,pd,fe,le,te,Ce,Xb,oc,Zc,yd=null)=>{yd=Gb.Pa(41,yd);yd.labelsInfoJson=Wc;yd.appliedLabelId=pd;yd.tenantId=fe;yd.applyLabelFlag=le;yd.skipApplyOutcomes=te;return Jd.g(Gb,"ApplyPolicyLabel",
yd,Ce,Xb,oc,Zc,0)},ge=(Gb,Wc,pd,fe,le,te,Ce=null)=>{Ce=Gb.Pa(1,Ce);Ce.tenantId=Wc;return Jd.g(Gb,"GetPolicyApplicationMethod",Ce,pd,fe,le,te,4)};var uc=a(765),dd=a(738);class Rd extends uc.a{constructor(){super();this.source=this.automatic=this.recommended=null;this.H_=Object.assign(new dd.a,{T_:Rd.getTypeName(),B_:Rd.getBaseTypes()})}static getTypeName(){return"AugLoop_SecurityClp_LabellingAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}}Object(c.a)(Rd,"LabellingAnnotation",uc.a,
[]);var Yd=a(757);class Md extends Yd.a{constructor(){super();this.fullDocSITs=this.partialDocSITs=null;this.H_=Object.assign(new dd.a,{T_:Md.getTypeName(),B_:Md.getBaseTypes()})}static getTypeName(){return"AugLoop_SecurityShared_SecurityShared"}static getBaseTypes(){return[]}}Object(c.a)(Md,"SecurityShared",Yd.a,[]);class ad extends Md{constructor(){super();this.existingLabelPriority=null;this.H_=Object.assign(new dd.a,{T_:ad.getTypeName(),B_:ad.getBaseTypes()})}static getTypeName(){return"AugLoop_SecurityShared_CLP"}static getBaseTypes(){return["AugLoop_SecurityShared_SecurityShared"]}}
Object(c.a)(ad,"CLP",Md,[]);class Mb extends uc.a{constructor(){super();this.source=this.automatic=this.recommended=null;this.H_=Object.assign(new dd.a,{T_:Mb.getTypeName(),B_:Mb.getBaseTypes()})}static getTypeName(){return"AugLoop_Automatic_Clp_LabellingAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}}Object(c.a)(Mb,"LabellingAnnotation",uc.a,[]);var Aa=a(1033),Bc=a(925),Vc=a(1035);class hc extends uc.a{constructor(){super();this.classificationId=null;this.H_=Object.assign(new dd.a,
{T_:hc.getTypeName(),B_:hc.getBaseTypes()})}static getTypeName(){return"AugLoop_LinkedDataType_LinkedDataTypeAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}}Object(c.a)(hc,"LinkedDataTypeAnnotation",uc.a,[]);var xc=a(137),ab=a(15),Wb=a(91);class Yc extends U.a{constructor(Gb,Wc,pd,fe,le){super();this.gGf=3;this.sP=this.Ti=null;this.I4a=!1;this.Ufb=[];this.pAf=new Ka.a(Pb.a.tN());this.HRd=0;this.MRd=null;this.vyb=(te,Ce)=>{te=Object(ja.a)(new Aa.a,{parentPath:["session","doc",
"security"],items:[Object(ja.a)(new Bc.a,{id:"clp",body:Object(ja.a)(new ad,{existingLabelPriority:Ce.existingLabelPriority,partialDocSITs:Ce.FOe,fullDocSITs:Ce.EOe})})]});this.Ufb.push(te);this.wGb()};this.Eug=(te,Ce)=>{te=Object(ja.a)(new Vc.a,{parentPath:["session","doc","security"],items:[Object(ja.a)(new Bc.a,{id:"clp",body:Object(ja.a)(new ad,{existingLabelPriority:Ce.existingLabelPriority})})]});this.Ufb.push(te);this.wGb()};this.Fug=(te,Ce)=>{te=Object(ja.a)(new Vc.a,{parentPath:["session",
"doc","security"],items:[Object(ja.a)(new Bc.a,{id:"clp",body:Object(ja.a)(new ad,{partialDocSITs:Ce.FOe,fullDocSITs:Ce.EOe})})]});this.Ufb.push(te);this.wGb()};this.z$=()=>{h.ULS.sendTraceTag(537154588,306,50,`AutoPolicyManager::OnApplicationModeChanged - isEditMode:${this.$.isEditMode}.`);this.$.isEditMode?bc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?this.wGb():this.dpf():(this.businessBar.removeEntry(41),this.businessBar.removeEntry(40),this.xwh())};
this.dxc=()=>{var te;h.ULS.sendTraceTag(537154587,306,50,"AutoPolicyManager::OnAugmentationLoopSessionClose called.");null===(te=this.Ti)||void 0===te?void 0:te.unregister("AutoPolicy");this.Ti=null};this.XNi=(te,Ce)=>{var Xb,oc,Zc,yd,Od;h.ULS.sendTraceTag(537154586,306,50,"AutoPolicyManager::LabellingAnnotationHandler called.");if(3===Ce.operationType)h.ULS.sendTraceTag(537154585,306,50,"AutoPolicyManager::LabellingAnnotationHandler Ignoring delete operation.");else{var dc=te=null,gd=null;if(this.qpc()){var wd=
Ce.annotation;if(!wd){h.ULS.sendTraceTag(537154584,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}if(null===(Xb=wd.automatic)||void 0===Xb?0:Xb.id)te=wd.automatic.id;if(null===(oc=wd.recommended)||void 0===oc?0:oc.id)dc=wd.recommended.id,wd.recommended.policyTip&&(gd=wd.recommended.policyTip)}else{Xb=Ce.annotation;if(!Xb){h.ULS.sendTraceTag(537154583,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}if(null===(Zc=
null===(wd=Xb.automatic)||void 0===wd?void 0:wd.sensitivityLabel)||void 0===Zc?0:Zc.id)te=Xb.automatic.sensitivityLabel.id;if(null===(Od=null===(yd=Xb.recommended)||void 0===yd?void 0:yd.sensitivityLabel)||void 0===Od?0:Od.id)dc=Xb.recommended.sensitivityLabel.id,Xb.recommended.sensitivityLabel.policyTip&&(gd=Xb.recommended.sensitivityLabel.policyTip)}this.applyPolicyLabel(te,dc,gd,1)}};this.TPi=(te,Ce)=>{h.ULS.sendTraceTag(537154582,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Handler called.");
3===Ce.operationType?h.ULS.sendTraceTag(537154581,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received delete operation."):(te=Ce.annotation)?(te=te.classificationId,this.applyPolicyLabel(te,te,null,2)):h.ULS.sendTraceTag(537154580,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received an empty annotation.")};this.s5f=(te,Ce)=>{Ce?Ce.aJb&&this.businessBar.yH(41)?(this.businessBar.removeEntry(41),h.ULS.sendTraceTag(537154562,306,50,"Remove entry to RecommendedSensitivityLabelBusinessBarEntry succeeded.")):
!Ce.aJb&&this.businessBar.yH(40)&&(this.businessBar.removeEntry(40),h.ULS.sendTraceTag(537154561,306,50,"Remove entry to AutomaticSensitivityLabelBusinessBarEntry succeeded.")):h.ULS.sendTraceTag(537154563,306,15,"RemoveAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};this.Wjg=(te,Ce)=>{Ce?Ce.aJb?(this.businessBar.r1j(Ce.title,Ce.message,Ce.buttonText,Xb=>{Ce.Eda(Xb);this.businessBar.yH(41)&&this.businessBar.removeEntry(41)}),h.ULS.sendTraceTag(537154531,306,
50,"Add entry to RecommendedSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):(this.businessBar.b_j(Ce.title,Ce.message,Ce.buttonText,Xb=>{Ce.Eda(Xb);this.businessBar.yH(40)&&this.businessBar.removeEntry(40)}),h.ULS.sendTraceTag(537154530,306,50,"Add entry to AutomaticSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):h.ULS.sendTraceTag(537154560,306,15,"ShowAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};this.sQd=
Gb;this.policyManager=Wc;this.$=pd;this.da=fe;this.businessBar=le;this.nui();this.pwj();this.disposed=!1}get oe(){return!this.disposed&&this.$.ea.oe}dispose(){var Gb;this.disposed||(this.disposed=!0,this.pyh(),null===(Gb=this.Ti)||void 0===Gb?void 0:Gb.unregister("AutoPolicy"),this.sQd=this.policyManager=this.Ti=null,super.dispose())}o4a(Gb,Wc,pd,fe,le=!1){h.ULS.sendTraceTag(537154642,306,50,`AutoPolicyManager: ApplyAutoPolicyLabel called for LabellingSource ${fe} with AutoLabelPresent: ${!!Gb}, RecommendedLabelPresent: ${!!Wc}, isStandard: ${le}.`);
this.oe?this.sQd&&(this.Ldh(Wc,fe)?(this.MRd=Wc,this.HRd=fe,this.pAf.fa(fe,Wc)):Wc=this.MRd,Gb=this.sQd.o4a(Gb,Wc,pd,le),h.ULS.sendTraceTag(537154640,306,50,`AutoPolicyManager::ApplyAutoPolicyLabel - policyActor.ApplyAutoPolicyLabel returned ${Gb}.`)):h.ULS.sendTraceTag(537154641,306,15,`AutoPolicyManager: ApplyAutoPolicyLabel failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.oe}.`)}Ldh(Gb,Wc){if(!this.policyManager.sla())return h.ULS.sendTraceTag(537154639,306,15,"CanShowRecommendedSensitivityLabel - Labels are not available."),
!1;const pd=this.policyManager.ap;let fe;({value:fe}=this.pAf.kf(this.HRd));let le=null,te=null,Ce=null;for(const Xb of pd.SensitivityLabels)Xb.Id===Gb&&(le=Xb),Xb.Id===fe&&(te=Xb),Xb.Id===this.MRd&&(Ce=Xb);return te&&te.Id===Gb?(h.ULS.sendTraceTag(537154638,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since it is same as last recommendation from current source."),!1):this.businessBar.yH(41)&&this.HRd!==Wc&&Ce&&(!le||Ce.Order>=le.Order)?(h.ULS.sendTraceTag(537154637,
306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since current label priority is lower than last label priority."),!1):!0}qpc(){return bc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)}Grf(){return bc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPSecurityNodeCreation",!1)}pwj(){this.policyManager.vBe(this.Wjg);this.policyManager.LCe(this.s5f);this.$.ea.N0(this.z$);this.qpc()&&this.Grf()&&
(this.policyManager.UYg(this.vyb),this.policyManager.T0g(this.Eug),this.policyManager.U0g(this.Fug))}pyh(){this.businessBar.removeEntry(41);this.businessBar.removeEntry(40);this.policyManager.kAj(this.Wjg);this.policyManager.FCj(this.s5f);this.$.ea.k4(this.z$);this.qpc()&&this.Grf()&&(this.policyManager.UAj(this.vyb),this.policyManager.nDj(this.Eug),this.policyManager.oDj(this.Fug))}nui(){this.sP=new Ka.a(Pb.a.tN());const Gb=this.qpc()?Rd.getTypeName():Mb.getTypeName();this.sP.add(1,Object(ja.a)(new Dd,
{annotationType:Gb,k4a:this.XNi,hC:!1,Vab:!1}));this.sP.add(2,Object(ja.a)(new Dd,{annotationType:hc.getTypeName(),k4a:this.TPi,hC:!1,Vab:!1}))}pog(){for(let Gb of this.Ufb)this.Ti.submitOperation(Gb);this.Ufb=[]}Cha(Gb){if(!this.sP.kd(Gb))return h.ULS.sendTraceTag(537154636,306,15,`AutoPolicyManager::RegisterAnnotation - AnnotationActivationOptions not available for LabellingSource ${Gb}.`),!1;if(this.sP.ma(Gb).hC)return h.ULS.sendTraceTag(537154635,306,15,`AutoPolicyManager::RegisterAnnotation - Annotations already registered for LabellingSource ${Gb}.`),
!0;this.sP.ma(Gb).hC=!0;h.ULS.sendTraceTag(537154634,306,50,`AutoPolicyManager::RegisterAnnotation - Annotations registered for LabellingSource ${Gb}.`);if(!this.$.isEditMode)return h.ULS.sendTraceTag(537154633,306,50,"AutoPolicyManager::RegisterAnnotation - Skipping AugmentationLoop initialization in view mode."),!0;bc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?this.wGb():this.dpf();return!0}dpf(){var Gb=!1;for(let Wc of this.sP)if(Gb=Wc.value.hC||Gb)break;
Gb?this.Ti?(h.ULS.sendTraceTag(537154631,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop already initialized."),this.E6b()):this.I4a?h.ULS.sendTraceTag(537154630,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop initialization in-progress."):(this.I4a=!0,Gb=this.$.xa.FlightingSettings.AutoCLPStartUpDelay,h.ULS.sendTraceTag(537154629,306,50,`AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - Initializing AugmentationLoop in ${Gb} milliseconds.`),
rc.a.instance.create(()=>{this.qui()},Gb,$c.a.SHe,!0,!0)):h.ULS.sendTraceTag(537154632,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - no registered annotations.")}wGb(){var Gb=0<this.Ufb.length;if(!Gb)for(let Wc of this.sP)if(Gb=Wc.value.hC||Gb)break;Gb?this.Ti?(h.ULS.sendTraceTag(537154627,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop already initialized."),this.E6b(),this.pog()):this.I4a?h.ULS.sendTraceTag(537154626,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop initialization in-progress."):
(this.I4a=!0,Gb=this.$.xa.FlightingSettings.AutoCLPStartUpDelay,h.ULS.sendTraceTag(537154625,306,50,`AutoPolicyManager::InitAugmentationLoopIfNecessary - Initializing AugmentationLoop in ${Gb} milliseconds.`),rc.a.instance.create(()=>{this.rui()},Gb,$c.a.SHe,!0,!0)):h.ULS.sendTraceTag(537154628,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - no registered annotations and operations.")}rui(){Na.TaskExtensions.za(Object(Wb.d)(xc.a.resolve(ab.i,{Ja:1})),Gb=>{this.Ti=Gb.result;this.I4a=!1;
this.Ti?(h.ULS.sendTraceTag(537154595,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),this.Ti.register(this.Ti.j2().E4("AutoPolicy").C4(this.dxc).build()),this.$.isEditMode?(this.E6b(),this.pog()):h.ULS.sendTraceTag(537154594,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):h.ULS.sendTraceTag(537154624,306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},this.ka,
3)}qui(){Na.TaskExtensions.za(Object(Wb.d)(xc.a.resolve(ab.i,{Ja:1})),Gb=>{this.Ti=Gb.result;this.I4a=!1;this.Ti?(h.ULS.sendTraceTag(571479120,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),this.Ti.register(this.Ti.j2().E4("AutoPolicy").C4(this.dxc).build()),this.$.isEditMode?this.E6b():h.ULS.sendTraceTag(537154592,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):h.ULS.sendTraceTag(537154593,306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},
this.ka,3)}E6b(){for(let Gb of this.sP)Gb.value.hC&&!Gb.value.Vab&&this.activateAnnotation(Gb.key)}activateAnnotation(Gb){this.Ti.Cha("AutoPolicy",{annotationType:this.sP.ma(Gb).annotationType,iu:!0,JQ:this.sP.ma(Gb).k4a});this.sP.ma(Gb).Vab=!0;h.ULS.sendTraceTag(537154590,306,50,`AutoPolicyManager::ActivateAnnotation completed for LabellingSource ${Gb}.`)}xwh(){for(let Gb of this.sP)Gb.value.Vab&&this.wwh(Gb.key)}wwh(Gb){var Wc;null===(Wc=this.Ti)||void 0===Wc?void 0:Wc.kfk(this.sP.ma(Gb).annotationType);
this.sP.ma(Gb).Vab=!1;h.ULS.sendTraceTag(537154589,306,50,`AutoPolicyManager::DeactivateAnnotation completed for LabellingSource ${Gb}.`)}applyPolicyLabel(Gb,Wc,pd,fe){if(this.da.pa("SupportsOfficeClientCoauthoring"))h.ULS.sendTraceTag(537154579,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is enabled."),this.o4a(Gb,Wc,pd,fe);else{h.ULS.sendTraceTag(537154578,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is disabled.");const le=te=>{this.o4a(Gb,
Wc,pd,fe,0===te||1===te||4===te)};this.Trd(le,()=>{le(2)},this.gGf)}}h8c(Gb,Wc){let pd=null,fe=null;if(!({sensitivityLabel:pd,yLa:fe}=this.Hsg(Gb)).returnValue)return h.ULS.sendTraceTag(537154577,306,15,"AutoApplyOrRecommendPolicyLabel - Failed to set the sensitivity labels."),!1;if(fe&&fe.Order>=pd.Order)return h.ULS.sendTraceTag(537154576,306,50,"AutoApplyOrRecommendPolicyLabel - The applied label has a higher sensitivty."),!1;this.applyPolicyLabel(pd.Id,pd.Id,null,Wc);return!0}i8c(Gb,Wc){Wc=!1;
let pd=null,fe=null;if(!({sensitivityLabel:pd,yLa:fe}=this.Hsg(Gb)).returnValue)return h.ULS.sendTraceTag(537154575,306,15,"AutoApplyOrRecommendPowerBILabel - Failed to set the sensitivity labels."),{returnValue:!1,vbb:Wc};if(fe&&fe.ParentId&&pd.ParentId&&fe.ParentId===pd.ParentId)return h.ULS.sendTraceTag(537154574,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label has a common parent with AppliedLabel."),{returnValue:!1,vbb:Wc};if(fe&&fe.Order>=pd.Order)return h.ULS.sendTraceTag(537154573,
306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label does not have a higher priority than AppliedLabel."),{returnValue:!1,vbb:Wc};if(this.da.pa("SupportsOfficeClientCoauthoring"))h.ULS.sendTraceTag(537154572,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is enabled."),Gb=this.policyManager.ap,Gb=!Gb.AppliedPolicyId||!Gb.PolicyLabelAssignmentMethod||na.e(Gb.PolicyLabelAssignmentMethod)===na.e("standard"),this.gGe(pd.Id,Gb);else{h.ULS.sendTraceTag(537154571,
306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is disabled.");const le=te=>{this.gGe(pd.Id,0===te||1===te||4===te)};this.Trd(le,()=>{le(2)},this.gGf)}return{returnValue:!0,vbb:Wc}}Trd(Gb,Wc,pd,fe=0){if(this.oe){var le=this.$.qa.ua.ie();ge(this.$.qa.ua,this.$.xa.DocumentHostInfo.TenantId,te=>{this.xdi(te,Gb)},()=>{this.wdi(Gb,Wc,pd,fe)},null,null,le)}else h.ULS.sendTraceTag(537154570,306,15,`AutoPolicyManager: GetPolicyApplicationMethod failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.oe}.`)}xdi(Gb,
Wc){h.ULS.sendTraceTag(537154569,306,50,"AutoPolicyManager: GetPolicyApplicationMethod web service call was successful.");this.oe?!Gb||hb.a(Gb)?h.ULS.sendTraceTag(537154567,306,15,Gb?"AutoPolicyManager: GetPolicyApplicationMethod result has non-status message.":"AutoPolicyManager: GetPolicyApplicationMethod result is null"):Wc(Gb.Result):h.ULS.sendTraceTag(537154568,306,50,`AutoPolicyManager: GetPolicyApplicationMethodSuccessCallback failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.oe}.`)}wdi(Gb,
Wc,pd,fe){h.ULS.sendTraceTag(537154566,306,15,"AutoPolicyManager: GetPolicyApplicationMethod web service call failed. Trying again");this.oe?fe>=pd?(h.ULS.sendTraceTag(537154564,306,15,"AutoPolicyManager: GetPolicyApplicationMethod max retries exhausted."),Wc()):this.Trd(Gb,Wc,pd,fe+1):h.ULS.sendTraceTag(537154565,306,50,`AutoPolicyManager: GetPolicyApplicationMethodFailureCallback failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.oe}.`)}gGe(Gb,Wc){Wc?this.o4a(Gb,null,null,
3,!0):this.o4a(null,Gb,null,3,!1)}Hsg(Gb){let Wc,pd;pd=Wc=null;if(!this.$.isEditMode)return{returnValue:!1,sensitivityLabel:Wc,yLa:pd};if(!this.policyManager.sla())return h.ULS.sendTraceTag(537154529,306,15,"TryGettingSensitivityLabels - Labels are not available."),{returnValue:!1,sensitivityLabel:Wc,yLa:pd};const fe=this.policyManager.ap;if(!fe)return h.ULS.sendTraceTag(537154528,306,15,"TryGettingSensitivityLabels - GetPolicyLabelsData returned an invalid result."),{returnValue:!1,sensitivityLabel:Wc,
yLa:pd};if(vc.a.ij(fe.SensitivityLabels))return h.ULS.sendTraceTag(537154527,306,15,"TryGettingSensitivityLabels - Attempting to apply labels when there are no sensitivity labels available."),{returnValue:!1,sensitivityLabel:Wc,yLa:pd};const le=fe.AppliedPolicyId;for(const te of Gb)for(const Ce of fe.SensitivityLabels)Ce.Id===te&&(!Wc||Wc.Order<Ce.Order)&&(Wc=Ce),Ce.Id===le&&(pd=Ce);return Wc?{returnValue:!0,sensitivityLabel:Wc,yLa:pd}:(h.ULS.sendTraceTag(537154526,306,10,"TryGettingSensitivityLabels - None of the sensitivity labels matched."),
{returnValue:!1,sensitivityLabel:Wc,yLa:pd})}}Object(c.a)(Yc,"AutoPolicyManager",U.a,[5]);var Tc=a(170),ed=a(12),be=a(16);class Fc extends Tc.ErrorDialog{constructor(Gb){super(Gb,Fc.n2(Gb))}Is(){super.Is();if(this.error.Appearance&1&&this.$.If&2){const Gb=this.getButton(0);ed.DOMElementExtensions.v0d(Gb.get_element(),be.a.instance.ia(1315));this.pP(()=>{0===this.returnValue&&this.$.If&2&&(h.ULS.sendTraceTag(50373725,306,50,"BlockSenitivityLabelActionDialog : Opening the book in excel desktop."),Na.TaskExtensions.za(Ha.GetServiceTaskFactory.ud(this.$.ga,
55,56,0),Wc=>{Wc.result.Zcd()},this.$.ka,3))})}}static n2(Gb){return Gb.If&2?Va.a.qf(3,1,0,1975,0,-1237306487,"SensitivityLabelBlockApplyLabelOpenInDesktop"):Va.a.qf(1,1,0,1976,0,-313914360,"SensitivityLabelBlockApplyLabel")}}Object(c.a)(Fc,"BlockSenitivityLabelActionDialog",Tc.ErrorDialog,[]);var vd=a(30),lb=a(90);class Eb extends U.a{constructor(Gb,Wc,pd,fe,le){super();this.statusBarManager=null;this.g9c=!1;this.zda=null;this.RMc=!1;this.GCa=this.J_d=null;this.oI=this.tQd=!1;this.fJa=this.cre=this.Rja=
this.mse=this.Mr=null;this.A_e=()=>{h.ULS.sendTraceTag(537154520,306,50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Triggered EnableAutoLabellingInDocument");const te=this.q4f(1);h.ULS.sendTraceTag(537154519,306,50,`PolicyManagerWrapper::EnableAutoLabellingInDocument - Annotation registration result: ${te}.`)};this.p4d=(te,Ce)=>{Ce?(this.Mr=Ce.title,this.mse=Ce.xAc,this.Rja=Ce.buttonText,this.cre=Ce.QLf,this.Fda.yi(27,null),h.ULS.sendTraceTag(537154509,306,50,"Add entry to BusinessBar succeeded. Message is shown to user.")):
h.ULS.sendTraceTag(537154510,306,15,"ShowPolicyBusinessBar is called but PolicyTipventArgs is null.")};this.rlg=(te,Ce)=>{const Xb=Object(W.a)(Ob,Ce);Xb?Xb.Lkg?(h.ULS.sendTraceTag(537154508,306,15,`ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of ${Xb.errorType}`),this.Fda.x1j(Xb.title,Xb.message,Xb.buttonText,oc=>{Xb.Eda&&(this.Fda.yH(54)&&this.Fda.removeEntry(54),Xb.Eda(oc))})):h.ULS.sendTraceTag(537154506,306,50,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure ShowMessage is false"):
(h.ULS.sendTraceTag(537154505,306,10,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure args is null"),this.Fda.yi(48,null))};this.H$d=(te,Ce)=>{this.X$&&(h.ULS.sendTraceTag(537154504,306,50,"PolicyManagerWrapper: UpdateLabelInfo called"),this.X$.xgg(),this.X$.Qfg(),this.X$.P0f(),this.$.If&64&&(Ce.onSuccess&&this.GCa?this.j4g():this.X$.Srg()));this.da.pa("SupportsOfficeClientCoauthoring")&&(te=this.jv.ap,this.fJa=te.AppliedPolicyId,"null"===this.labelId&&(this.fJa=""),this.RMc&&(te=
te.PolicyLabelAssignmentMethod&&na.e(te.PolicyLabelAssignmentMethod)===na.e("standard")?4:2,this.applyPolicyLabel(this.labelId,te,!0,this.J_d)));this.G5e();this.pC()};this.oPf=()=>{this.tQd=!0;this.G5e()};this.cUf=(te,Ce)=>{h.ULS.sendTraceTag(42322116,306,50,`PolicyManagerWrapper.OnSetLabelSucceeded: Applying outcomes for change in policy label. ProtectedFile = ${m.AFrameworkApplication.protectedFile}, ApplyLabelFlag = ${Ce.uP}`);this.applyPolicyLabel(Ce.wAc,Ce.uP,!1,null)};this.w3i=(te,Ce)=>{this.fJa=
Ce.wAc;if(Va.a.Rr(te.Errors)){var Xb=Va.a.l8(te.Errors,[2045508683]);0<Xb.length&&(te.Errors=Va.a.uE(te.Errors,[2045508683],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.$.ea.Yp(te.Errors));Xb=Va.a.l8(te.Errors,[2046680228]);0<Xb.length&&(4===Ce.uP||1===Ce.uP)&&(te.Errors=Va.a.uE(te.Errors,[2046680228],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.$.ea.Yp(te.Errors));Xb=te=null;for(var oc of this.jv.ap.SensitivityLabels)qb.a.equals(this.labelId,oc.Id,
!1)&&(te=oc),qb.a.equals(Ce.Udg,oc.Id,!1)&&(Xb=oc);oc={};oc.ApplyLabelFlag=Ce.uP;te?(oc.currentLabel="Set",oc.currentLabelEnabled=te.Enabled,oc.currentLabelName=te.Name?"Set":"NotSet",oc.currentLabelParentId=te.ParentId?"Set":"NotSet"):oc.currentLabel="NotSet";Xb?(oc.serverLabel="Set",oc.serverLabelEnabled=Xb.Enabled,oc.serverLabelName=Xb.Name?"Set":"NotSet",oc.serverLabelParentId=Xb.ParentId?"Set":"NotSet"):oc.serverLabel="NotSet";h.ULS.sendTraceTag(541638850,306,15,`PolicyManagerWrapper.OnApplyManualPolicyLabelSuccessCallback Failed. DiagnosticInfo : ${JSON.stringify(oc)}`)}};
this.o8g=(te,Ce)=>{if(!this.$.workbookContext.HasRoundTrippedHFPart)return!1;const Xb=this.jv.ap;if(!Xb)return h.ULS.sendTraceTag(537154502,306,15,"PolicyManagerWrapper.BlockSetSensitivityCall: policyLabelsData is null."),!1;let oc=null;for(const Zc of Xb.SensitivityLabels)qb.a.equals(Zc.Id,te,!1)&&(oc=Zc);return oc&&this.Tqi(oc)?(h.ULS.sendTraceTag(50341186,306,50,"PolicyManagerWrapper.BlockSetSensitivityCall: selectedSensitivityLabel has watermark label action."),this.e_j(Ce),!0):!1};this.wAi=()=>
{let te=!1;!this.$.xa.IsNewWorkbook||this.labelId&&this.labelId.length||(te=!0);h.ULS.sendTraceTag(537154501,306,50,`PolicyManagerWrapper.IsANewFile: is this a new file : ${te}`);return te};this.WFf=(te,Ce)=>{1===Ce.TEe?this.$.isEditMode?(h.ULS.sendTraceTag(537154500,306,50,"MandatoryLabellingHandler : Swtiching to view-mode."),this.$.Ha.Ad(new $a.a(-723527778,0,this.$.se,10,null))):h.ULS.sendTraceTag(537154499,306,50,"MandatoryLabellingHandler : App is already in view-mode."):(this.GCa=Ce.GCa,this.$.ea.N0(this.bGe),
this.$.Zlb(),h.ULS.sendTraceTag(537154498,306,50,"MandatoryLabellingHandler : Swtiching to edit-mode."),this.$.Ha.Ad(new $a.a(-8805455,0,this.$.se,10,null)))};this.uAe=(te,Ce)=>{Ce?(te=!!(this.$.If&64),h.ULS.sendTraceTag(537154496,306,50,`AddMandatoryLabellingBusinessBar User has edit permission : ${te}`),te&&(this.$.Zlb(),this.Fda.H0j(Ce.title,Ce.message,Ce.buttonText,Xb=>{Ce.Eda(Xb)}))):h.ULS.sendTraceTag(537154497,306,15,"AddMandatoryLabellingBusinessBar is called but MandatoryLabellingAppHandlerEventArgs is null.")};
this.Q5f=()=>{this.Fda.yH(42)&&this.Fda.removeEntry(42)};this.ntg=(te,Ce)=>{Ce.aYj&&(h.ULS.sendTraceTag(527716803,306,50,"PolicyManagerWrapper.udpLabelingAppHandler: Open the document in the client when the applied label is a UDP label."),Na.TaskExtensions.za(Ha.GetServiceTaskFactory.ud(this.$.ga,55,56,0),Xb=>{Xb.result.Zcd()},this.$.ka,3))};this.bGe=()=>{this.GCa&&this.$.isEditMode?(this.$.ea.k4(this.bGe),this.nDb()):h.ULS.sendTraceTag(537154467,306,15,`ApplyMandatoryLabelOnEditMode : mandatoryPolicyId empty ${!this.GCa} , edit mode : ${this.$.isEditMode}.`)};
this.kfa=()=>{const te=this.$.ea.pp;te&&!qb.a.equals(te.AppliedPolicyLabelId,this.labelId,!1)&&(h.ULS.sendTraceTag(537154464,306,50,"PolicyManagerWrapper.HandleWorkbookMetadataChanged: Calling GetPolicyLabels to update statusbar and ribbon control."),h.ULS.shipAssertTag(537154463,306,this.$.isEditMode,"PolicyManagerWrapper.HandleWorkbookMetadataChanged policyId cannot change in read-only mode, this can happen if right policy id is not read from server."),this.da.pa("SupportsOfficeClientCoauthoring")&&
this.$.isEditMode&&(this.RMc=!0,this.J_d=te.AppliedPolicyLabelId),this.fJa=te.AppliedPolicyLabelId,this.nDb())};this.lAd=()=>{let te=!0;if(!this.$.ea.amIAlone)for(const Ce of this.$.ea.Vp)if(!Ce.SupportsClientIsMipTrusted){te=!1;break}h.ULS.sendTraceTag(537154462,306,50,`PolicyManagerWrapper.IsEveryCoauthorInSessionClientMipTrusted : ${te}`);return te};this.xQf=()=>{h.ULS.sendTraceTag(537154461,306,50,"PolicyManagerWrapper.OnLabelUpdate: RTC notification received");this.RMc=!0;this.nDb()};this.$=
fe;this.jv=Gb;this.Fda=pd;this.da=le;this.jv.JCe(this.p4d);this.X$=Wc}initialize(){this.da.pa("SupportsPolicies")?(this.fJa=this.da.Sa("AppliedPolicyId"),this.X$.tj(),this.$.ga.qd(29,Gb=>{this.statusBarManager=Gb;Gb.zM(this)}),this.pC(),qb.a.ij(this.da.Sa("HostUserId"))||this.Dlj(),this.X$.rwj(this.o8g),this.X$.kxj(this.wAi),this.jv.nwj(this.lAd),this.oI=!0):la.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!0));!qb.a.ij(this.da.Sa("HostUserId"))&&bc.EwaSettings.Ea(158)&&
this.$.ea.pj.get(45)&&(h.ULS.sendTraceTag(537154524,306,50,"DataLossPrevention feature is Enabled and launched on Excel."),this.U6h())}Xs(Gb){this.addHandler("LabelInfoChangedKey",Gb)}Gt(Gb){this.removeHandler("LabelInfoChangedKey",Gb)}Up(){return!0}Ru(Gb,Wc){if("QueryPolicyLabel"!==Gb)return!1;if(this.Gsa())return Wc.Visible=!1,!0;!qb.a.ij(Wc.LabelText)&&vd.a.Yn()&&window.setTimeout(()=>{appChrome.api.dispatch(appChrome.actions.setControlCustomTooltip(lb.a.Yac,Wc.Alt))},0);Wc.Visible=!0;return 32===
m.AFrameworkApplication.Dd.eg(ma.a.lhb,2,Wc)}dispose(){this.statusBarManager&&(this.statusBarManager.MI(this),this.statusBarManager=null);this.X$.KLc();this.g9c=!1;this.jv.ZCj(this.rlg);this.jv.$Cj(this.cUf);this.$.ea.ny(this.kfa);if(this.da.pa("SupportsOfficeClientCoauthoring")){const Gb=this.$.ga.Da(292);Gb&&Gb.QBj(this.xQf)}this.jv.mAj(this.uAe);this.jv.GCj(this.Q5f);this.jv.$Bj(this.WFf);this.jv.lDj(this.ntg);this.jv.sBj(this.A_e);this.zda&&(this.zda.dispose(),this.zda=null);super.dispose()}get title(){return this.Mr}get xAc(){return this.mse}get linkText(){return this.Rja}get Iaj(){return this.cre}get labelId(){return this.fJa}h8c(Gb,
Wc){if(!this.da.pa("SupportsPolicies"))return h.ULS.sendTraceTag(537154523,306,15,"AutoApplyOrRecommendPolicyLabel - Called when SupportPolicies is disabled."),!1;if(!this.tQd)return h.ULS.sendTraceTag(537154522,306,15,"AutoApplyOrRecommendPolicyLabel - PolicyData hasn't been received yet."),!1;if(vc.a.ij(Gb))return!1;this.zda||this.vxd();return this.zda.h8c(Gb,Wc)}pC(){this.raiseEvent("LabelInfoChangedKey")}U6h(){ec.a.get_instance().ik(10,()=>{this.jv.tkc()})}Dlj(){ec.a.get_instance().ik(10,()=>
{this.jv.X7b(this.H$d);this.jv.AZg(this.oPf);this.jv.zZg(this.oPf);this.jv.V5c(this.rlg);this.jv.UCe(this.cUf);this.$.ea.Mw(this.kfa);this.jv.wBe(this.uAe);this.jv.MCe(this.Q5f);this.jv.m_g(this.WFf);this.jv.Q0g(this.ntg);if(this.da.pa("SupportsOfficeClientCoauthoring")){const Gb=this.$.ga.Da(292);Gb&&Gb.b_g(this.xQf)}h.ULS.sendTraceTag(537154521,306,50,"PolicyManagerWrapper: ApplyAutomaticPolicyLabel enabled and registered GetAutoPolicyLabelHandler");this.jv.xZg(this.A_e);this.TTh()});this.$.m1d("sensitivity",
!0)}TTh(){this.da.pa("SupportsOfficeClientCoauthoring")||this.labelId&&this.labelId.length?this.nDb():this.f2h(this.$.xa.DocumentHostInfo.TenantId)}vxd(){this.zda=new Yc(this.X$,this.jv,this.$,this.da,this.Fda)}q4f(Gb){if(!this.da.pa("SupportsPolicies"))return h.ULS.sendTraceTag(537154518,306,10,"PolicyManagerWrapper::RegisterAugmentationLoopAnnotations called when CLP is disabled."),!1;this.zda||this.vxd();return this.zda.Cha(Gb)}i8c(Gb,Wc){if(!this.da.pa("SupportsPolicies"))return h.ULS.sendTraceTag(537154517,
306,10,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called when CLP is disabled."),{returnValue:!1,vbb:!1};if(!this.tQd)return h.ULS.sendTraceTag(537154516,306,15,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called before PolicyData fetch is complete."),{returnValue:!1,vbb:!0};this.zda||this.vxd();return this.zda.i8c(Gb,Wc)}f2h(Gb){h.ULS.sendTraceTag(537154514,306,50,`PolicyManagerWrapper: Doing GetPolicyLabelId web service call with tenantId length ${Gb.length}`);const Wc=this.$.qa.ua.ie();
Kd(this.$.qa.ua,Gb,pd=>{this.V6j(pd)},null,null,null,Wc)}V6j(Gb){h.ULS.sendTraceTag(537154513,306,50,"PolicyManagerWrapper: GetPolicyLabelId web service call was successful");Gb&&!hb.a(Gb)&&(this.fJa=Gb.Result);this.nDb();this.labelId?h.ULS.sendTraceTag(537154512,306,50,`PolicyManagerWrapper: Fetched LabelId length from custom.xml is ${this.labelId.length}`):h.ULS.sendTraceTag(537154511,306,50,"PolicyManagerWrapper: LabelId is invalid")}nDb(){this.jv.Fpd(this.labelId,void 0,void 0,!1)}G5e(){if(!this.g9c){this.$.Qh();
this.g9c=!0;this.Fda.hlf();const Gb={};Gb.hasLabel=!!this.labelId&&0<this.labelId.length;Gb.isProtectedFile=this.da.pa("ProtectedFile");Gb.SupportsPolicies=this.da.pa("SupportsPolicies");Gb.AreLabelsAvailableForDisplay=this.jv.sla();Gb.SupportsOfficeClientCoauthoring=this.da.pa("SupportsOfficeClientCoauthoring");Gb.IsAnonymousUser=this.da.pa("IsAnonymousUser");h.ULS.sendTraceTag(51238051,306,50,`CLPUsage : ${JSON.stringify(Gb)}`)}}j4g(){this.X$.k4g(this.GCa);this.GCa=null}Tqi(Gb){for(const Wc of Gb.LabelActions)if(qb.a.equals(Wc.Name,
"ApplyWatermark",!1))return!0;return!1}e_j(Gb){Gb?(new Fc(this.$)).Ji():h.ULS.sendTraceTag(537154465,306,50,"PolicyManagerWrapper.showBlockApplyLabelDialogDialog: Watermark Dialog box called with showDialog set to false from autoapply.")}applyPolicyLabel(Gb,Wc,pd,fe){const le=Sb.c(this.jv.ap);if(void 0===Gb||null===Gb)Gb="";const te=new yb;te.wAc=Gb;te.Udg=fe;te.uP=Wc;const Ce=this.$.qa.ua;za.a(this.$.userOperationManager,(Xb,oc,Zc)=>ce(Ce,le,Gb,this.$.xa.DocumentHostInfo.TenantId,Wc,pd,Nb.b.call(null,
this.w3i,Xb),null,Zc,te),Xb=>new ua.a(222,0,Xb),null);this.RMc=!1;this.J_d=null}Gsa(){const Gb=this.$.ga.Da(478);return this.oI&&Gb?Gb.oI():!1}}Object(c.a)(Eb,"PolicyManagerWrapper",U.a,[295,188,690]);var Hc=a(155);class Bd extends Fa.a{constructor(Gb){super();this.$=Gb;this.je()}create(){const Gb=Object(Hc.a)("OfficeVSO:7811663_ConvertBusinessBarManagerService2")?Object(Wb.d)(xc.a.resolve(ab.m,{Ja:this.Ta})):Ha.GetServiceTaskFactory.ud(this.$.ga,5,4,this.Ta),Wc=m.AFrameworkApplication.tf,pd=m.AFrameworkApplication.da;
Na.TaskExtensions.za(Gb,()=>{try{const fe=new sc.a(()=>new gc(pd,Wc,m.AFrameworkApplication.sa.EG,this.$.xa.MaxGetPolicyRetries,Y.a.instance.Qd("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"))),le=new sc.a(()=>new Ua(m.AFrameworkApplication.Dd,m.AFrameworkApplication.sa,m.AFrameworkApplication.da,fe));let te=this.$.ga.Da(274);te||(te=new Eb(fe.value,le.value,Gb.result,this.$,m.AFrameworkApplication.da),this.$.ga.Qa(274,te),te.initialize());this.Ld(te)}catch(fe){throw h.ULS.sendTraceTag(537154525,
306,10,`PolicyManager was not created successfully [Exception: ${fe.toString()}]`),fe;}},this.ka,3)}static la(Gb){Gb.ga.Qa(275,new Bd(Gb))}}Object(c.a)(Bd,"PolicyManagerFactory",Fa.a,[]);var he=a(734),je=a(731),Fd=a(199);let Oc=class{constructor(Gb){this.$=Gb}Pe(){return!1}executeCommand(Gb,Wc,pd){switch(Wc.command){case ma.a.setSensitivity:return this.$.workbookContext.FileCoauthorable||(pd[I.Q6c]=this.$.workbookContext.ExclusiveLockId),Gb=m.AFrameworkApplication.Dd.eg(ma.a.setSensitivity,2,pd),
Xa.Task.Wa(32===Gb);case ma.a.gaa:return Gb=m.AFrameworkApplication.Dd.eg(ma.a.gaa,2,pd),Xa.Task.Wa(32===Gb);case ma.a.haa:return Gb=m.AFrameworkApplication.Dd.eg(ma.a.haa,2,pd),Xa.Task.Wa(32===Gb);default:return Fd.a(Wc.command)}}Be(Gb,Wc){switch(Wc.command){case ma.a.setSensitivity:case ma.a.gaa:case ma.a.haa:return!0;default:return!1}}Ue(Gb,Wc,pd){switch(Wc){case "PopulateSensitivityFlyout":return 32===m.AFrameworkApplication.Dd.eg(ma.a.YDa,2,pd);default:return!1}}};Oc=Object(je.a)([Object(xc.d)(ab.Dc),
Object(je.b)(0,Object(ab.W)())],Oc);Object(c.a)(Oc,"SensitivityCommandHandler",null,[203]);class Ad extends he.a{constructor(Gb){super(Gb)}Uf(){this.Lf([new Oc(this.$)])}static la(Gb){he.a.qg(316,new Ad(Gb))}}Object(c.a)(Ad,"SensitivityCommandHandlerFactory",he.a,[]);Type.registerNamespace("Common.App.Policy");ib.main();(()=>{jc.a.Ga(Gb=>{Bd.la(Gb);bc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigrateServices4",!1)||Ad.la(Gb)})})();String(b);window.___1689695406713_closurehack=b}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.policy.js.map/13056d3cd48e3bf5a272cf32a5e83d03/EwaTS.policy.js.map
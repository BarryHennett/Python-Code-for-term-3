'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[24],{1039:function(w,C,a){a.d(C,"a",function(){return h});w=a(0);var b=a(181);C=a(906);var c=a(764);class h extends C.a{constructor(k,d){super(k,d);d!==c.a.DM&&this.LS(d);this.KS(h.iterateNext);this.KS(h.$Ba);this.KS(h.O7a);this.KS(h.saveACopy);this.q3a(b.a.n_a);this.q3a(b.a.o_a);this.q3a(b.a.L1)}}h.iterateNext="IterateNext";h.$Ba="IteratePrevious";h.O7a="DownloadVersion";h.saveACopy="SaveACopy";h.hXb="ToggleShowChanges";
h.setCurrentChangeCount="SetCurrentChangeCount";h.setTotalChangesCount="SetTotalChangesCount";h.LUa="OnVHDiffReady";Object(w.a)(h,"VersionHistoryMessenger",C.a,[])},1199:function(w,C,a){w=a(0);var b=a(14),c=a(64),h=a(778),k=a(138),d=a(8),f=a(220),u=a(74),r=a(45),t=a(200),v=a(131),x=a(248),m=a(1),l=a(11),n=a(107),z=a(16),y=a(247),B=a(19),G=a(356);class E{constructor(Ga,ma,fa){this.JKa=Ga;this.Il=ma;this.Fae=fa}}Object(w.a)(E,"UserActivityLocation",null,[]);var J=a(1039),I=a(59),R=a(764),X=a(62),H=
a(76),M=a(46),O=a(266),L=a(7),S=a(588),T=a(589),V=a(262),la=a(93),Z=a(110),da=a(38),ba=a(53),na=a(34);a.d(C,"a",function(){return Y});class Y{constructor(Ga,ma,fa,Xa){this.authorColor=this.r6=this.Via=null;this.Gcb=!1;this.$6a=-1;this.Afd=0;this.LNa=100;this.T9=-1;this.obe=null;this.Vvb=d.a.rnk;this.ugd=d.a.snk;this.JMb=!1;this.LJj="&versionHistorySaveACopy=1";this.q6h=()=>({DisplayName:d.a.tnk,Email:null,Id:null,Provider:null});this.xj=Ua=>{(Ua=x.a(Ua)?null:Ua.Result)?Ua.OperationWaitingForFileDownload?
20>this.Afd?(this.LNa*=2,X.Task.delay(this.LNa).continueWith(()=>{this.j9d()})):(this.xMc(),b.ULS.sendTraceTag(537150406,0,50,"VersionHistoryHighlightManager::OnWebMethodSuccess Next Operation enqueue failed")):Ua.ActivityList?(this.initialize(Ua.ActivityList,Ua.VersionAuthors),m.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")?this.LUa():this.yVb(!0),this.obe.stop(),b.ULS.sendTraceTag(41743369,0,50,`VersionHistoryHighlightManager: Time taken For showing diffs in Ms:${this.obe.Te.toString()}`)):
(this.xMc(),b.ULS.sendTraceTag(537150407,0,50,"VersionHistoryHighlightManager::OnWebMethodSuccess no activity list found.")):(this.LNa*=2,X.Task.delay(this.LNa).continueWith(()=>{this.j9d()}),b.ULS.sendTraceTag(537150408,0,10,"VersionHistoryHighlightManager::OnWebMethodSuccess call returned null result."))};this.MDa=()=>{this.xMc();b.ULS.sendTraceTag(537150405,0,10,"VersionHistoryHighlightManager::OnWebMethodFailure service call failed.")};this.IPb=Ua=>{b.ULS.sendTraceTag(537150400,0,50,`VersionHistoryHighlightManager.PostMessageHandler called with MessageID:${Ua.MessageId}`);
switch(Ua.MessageId){case J.a.iterateNext:this.iterateNext();this.T9=(this.T9+1)%this.HR.length;this.BTb(J.a.setCurrentChangeCount,this.T9+1);break;case J.a.$Ba:this.$Ba();this.T9=0>this.T9?0:this.T9;this.T9=(this.T9+this.HR.length-1)%this.HR.length;this.BTb(J.a.setCurrentChangeCount,this.T9+1);break;case J.a.O7a:this.GCh();break;case J.a.hXb:this.yVb(Ua.Values.ToggleValue);break;case J.a.saveACopy:this.KJj()}};this.mkh=(Ua,ka)=>this.Qbc(Ua.Il,ka.Il);this.kkh=(Ua,ka)=>this.Qbc(Ua.Il,ka);this.uf=()=>
{m.EwaSettings.isChangeGateEnabled("OfficeVSO:7487107_XlOnlineVHRemovingDeselectOnSelectionChanged")||this.Gec()};this.Wp=()=>{this.Gec()};this.kk=()=>{this.Gec()};b.ULS.sendTraceTag(537150411,0,50,"VersionHistoryHighlightManager::Constructor.");this.$=Ga;this.ariaLiveNotifier=Xa;this.gridView=B.h(this.$);this.gridView.ha.kr(this.uf);this.gridView.iH(this.Wp);this.gridView.he.Gp(this.kk);this.oik();this.JMb=m.EwaSettings.isChangeGateEnabled("OfficeVSO:7468185_XlOnlineVHNewIterationAlgorithm");ma&&
(this.obe=Ga.Sd.Ze("UserAction","VersionHistoryDiffManagerStopWatch"),this.j9d());if(this.uq=fa)Ga=c.a.rN(this.$.xa.VersionHistoryActionUrl)||R.a.DM,Ga!==R.a.DM&&this.uq.LS(Ga),this.uq.Rn(J.a.iterateNext),this.uq.Rn(J.a.$Ba),this.uq.Rn(J.a.hXb),m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.VersionHistoryServiceCompliance",!1)&&(this.uq.Rn(J.a.O7a),this.uq.fm(J.a.O7a,this.IPb),this.uq.Rn(J.a.saveACopy),this.uq.fm(J.a.saveACopy,this.IPb)),this.uq.fm(J.a.iterateNext,this.IPb),this.uq.fm(J.a.$Ba,
this.IPb),this.uq.fm(J.a.hXb,this.IPb)}get Imb(){return this.r6}get wTb(){return-1===this.$6a?null:this.HR[this.$6a]}get HR(){this.Gcb||(this.Via.sort(this.mkh),this.Gcb=!0);return this.Via}dispose(){this.AEa();this.Via=this.r6=null;this.gridView&&(this.gridView.ha&&this.gridView.ha.Fr(this.uf),this.gridView.NI(this.Wp),this.gridView.he&&this.gridView.he.zp(this.kk),this.uq&&(this.uq.NV(J.a.$Ba),this.uq.NV(J.a.iterateNext),this.uq.NV(J.a.hXb),m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.VersionHistoryServiceCompliance",
!1)&&(this.uq.NV(J.a.O7a),this.uq.NV(J.a.saveACopy))))}initialize(Ga,ma){Ga?(this.AEa(),this.$6a=-1,this.Via=[],this.Gcb=!1,this.r6={},this.authorColor={},this.qWi(ma),this.kfd(Ga)):b.ULS.shipAssertTag(537150410,0,!1,"VersionHistoryHighlightManager.Initialize - userActivityList was Null")}j9d(){b.ULS.sendTraceTag(537150409,0,50,`VersionHistoryHighlightManager: TryFetchUserActivityandTriggerDiff triggered: ${this.Afd.toString()} --${this.LNa.toString()}`);this.Afd++;this.$.userOperationManager.enqueueOperation(new t.a(537,
0,(Ga,ma,fa)=>{var Xa=this.$.qa.ua;Ga=y.b(Ga,this.xj);ma=y.a(ma,this.MDa);const Ua=Xa.Pa(1,null);return I.g(Xa,"GetVersionHistoryHighlightActivitiesData",Ua,Ga,ma,fa,null,4)},80),null)}yVb(Ga){const ma=this.r6;for(let Xa in ma){var fa=Xa;const Ua=ma[Xa];Ua?Ua.AVb(Ga):b.ULS.shipAssertTag(537150404,0,!1,"VersionHistoryHighlightManager.ShowOrHideAllHighlights -"+fa+"view was Null")}}AEa(){const Ga=this.r6;for(let fa in Ga){var ma=fa;const Xa=Ga[fa];Xa?Xa.$Ud():b.ULS.shipAssertTag(537150403,0,!1,"VersionHistoryHighlightManager.RemoveAllHighlights -"+
ma+"view was Null")}this.Via=this.r6=null}Tcg(Ga){let ma,fa;if(this.JMb)fa=Ga?this.nff(this.T9):this.sgf(this.T9),ma=this.HR[fa];else if(!(()=>{let Ua=this.Wbi(Ga,this.$6a);({Zof:fa,qxg:ma}=Ua);return Ua})().returnValue)return;b.ULS.shipAssertTag(537150402,0,!!ma,"VersionHistoryHighlightManager.SelectNextOrPreviousChange - userActivityLocation is null");this.Gec();if(ma.JKa.toString()in this.r6){this.r6[ma.JKa.toString()].oMj(ma.Il);var Xa=r.E(ma.Il);this.ariaLiveNotifier.setEnabled(!1);this.ariaLiveNotifier.setEnabled(!0);
this.ariaLiveNotifier.readText(String.format(z.a.instance.xd(158),fa+1,this.HR.length,Xa.EA(!1),ma.Fae.DisplayName));this.$6a=fa}else b.ULS.shipAssertTag(537150401,0,!1,`VersionHistoryHighlightManager.SelectNextOrPreviousChange - ${ma.JKa.toString()} view not present in views dictionary`)}KJj(){if(this.$.ea.oe){b.ULS.sendTraceTag(508601793,0,50,"VersionHistoryHighlightManager.saveACopyHelper started saveACopy operation using downloadACopy url");var Ga=null;da.TaskExtensions.za(ba.GetServiceTaskFactory.ud(this.$.ga,
55,56,0),ma=>{Ga=ma.result.F9c(-1804063550);Ga+=this.LJj;this.$.mg.get(51)?(b.ULS.sendTraceTag(508601792,0,50,"VersionHistoryHighlightManager: saveACopyHelper for ODConsumer Called"),ma=new la.a(-309686558,0,this.$.se,0,null)):ma=new la.a(-1244760097,0,this.$.se,0,null);Z.c(1604651619,!0);this.$.Ha.Ad(ma,{["FileDownloadUrl"]:Ga})},this.$.ka,3)}else{b.ULS.sendTraceTag(508601794,0,50,"VersionHistoryHighlightManager.saveACopyHelper: saveACopy not allowed in expired session");const ma=na.a.Xed();M.a(this.$).zs(new V.a(L.a.ix,
5,()=>{const fa=H.a(this.$);fa.rf.activityState[O.a.Lq]=L.a.accessTokenExpiringWarning;fa.rf.Us([ma])}))}}GCh(){b.ULS.sendTraceTag(508703947,0,50,"VersionHistoryHighlightManager.downloadVersionHelper started version download using downloadACopy command");this.$.ea.te.hasUnsupportedFeaturesForEdit&&b.ULS.sendTraceTag(508687379,0,50,"VersionHistoryHighlightManager.downloadVersionHelper: The selected version for download has hasUnsupportedFeaturesForEdit.");M.a(this.$).zs(new V.a(L.a.ix,5,()=>{this.$.HI(!1);
const Ga=H.a(this.$).rf.activityState;Ga[O.a.Lq]=L.a.Lhd;Ga[S.a.Ttb]=this.$.ea.te.hasUnsupportedFeaturesForEdit;Ga[T.a.T6b]=-1804063550}))}BTb(Ga,ma){if(m.EwaSettings.Ea(279))if(this.uq){var fa={};fa.count=ma;Ga=new h.a(Ga);Ga.Values=fa;this.uq.send(Ga)}else b.ULS.sendTraceTag(537150370,0,10,"VersionHistoryHighlightManager.SendIteratorTextUpdateMessage hostPostmessenger is null");else b.ULS.sendTraceTag(537150371,0,50,"VersionHistoryHighlightManager.SendIteratorTextUpdateMessage VersionHistoryIterator BRS is turned off")}Wbi(Ga,
ma){let fa,Xa=!1;fa=null;let Ua=0;for(;!Xa&&Ua<this.HR.length;){ma=Ga?this.nff(ma):this.sgf(ma);fa=this.HR[ma];const ka=Object(k.a)(n.a,this.$.va.getItemByName(fa.Il.SheetName));if(!ka)return b.ULS.shipAssertTag(537150369,0,!1,"VersionHistoryHighlightManager.GetNextorPreviousUserActivityLocationFromIndex - useractivitylocation contains sheetrange with null sheet"),{returnValue:!1,Zof:ma,qxg:fa};ka.visible&&(Xa=!0);Ua++}return{returnValue:Xa,Zof:ma,qxg:fa}}nff(Ga){return this.JMb||-1!==Ga?(Ga+1)%this.HR.length:
this.kff()}sgf(Ga){this.JMb&&-1===Ga?Ga=0:-1===Ga&&(Ga=this.kff());return Ga=(Ga+this.HR.length-1)%this.HR.length}kfd(Ga){this.Luh(Ga);this.Ked()}Mji(Ga,ma){const fa=[];if(!Ga.RangeList)return b.ULS.shipAssertTag(537150368,0,!1,"VersionHistoryHighlightManager.GetUserActivityLocationFromRangeActivityLocation - ActivityLocationType.Range RangeList Null "),fa;for(const Xa of Ga.RangeList)if(!Xa||!this.$.va.zm(Xa.SheetName))b.ULS.shipAssertTag(537150367,0,!1,"Invalid sheet name "+Xa.SheetName);else if(!this.JMb||
this.$.va.getItemByName(Xa.SheetName).visible)Ga=new E(0,Xa,ma),fa.push(Ga);return fa}Luh(Ga){for(const ma of Ga)if(!ma||v.e(ma.LocationList))b.ULS.sendTraceTag(537150366,0,50,"Empty Location list");else for(const fa of ma.LocationList)if(fa)switch(fa.Type){case 0:this.Via.push(...this.Mji(fa,ma.Person));break;default:b.ULS.sendTraceTag(537150364,0,50,"VersionHistoryHighlightManager.CreateViews Failed. Invalid ActivityLocationType")}else b.ULS.shipAssertTag(537150365,0,!1,"VersionHistoryHighlightManager.CreateUserActivityLocationList - LocationList contains Null")}Ked(){var Ga=
{};const ma=[];for(const fa of this.Via){if(0!==fa.JKa)continue;const Xa=new G.a(r.E(fa.Il),u.d(this.$.va.getItemByName(fa.Il.SheetName))),Ua=Y.oHc(Xa);Ua in Ga||ma.push(Xa);Ga[Ua]=this.B4h(fa.Fae);Ga[Ua]===this.ugd&&this.ukk(fa)}b.ULS.sendTraceTag(42541534,0,15,`VersionHistoryHighlightManager.CreateRangeHighlightView. Total activities : ${this.Via.length}, Highlightable activities: ${ma.length},Total userlist in activities : ${this.Via.length}, Total userlist from pane: ${ma.length} `);this.xMc();
0<ma.length&&(Ga=new (a(1296).RangeVersionHistoryHighlightView)(this.$,ma,Ga,this.Vvb),this.r6["0"]=Ga)}ukk(Ga){m.EwaSettings.isChangeGateEnabled("OfficeVSO:7213684_NarratorReadsAuthorNameForChangesWithoutUserAttributionDuringIteration")&&(Ga.Fae=this.q6h())}xMc(){const Ga=this.Via?this.HR.length:0;this.BTb(J.a.setCurrentChangeCount,0);this.BTb(J.a.setTotalChangesCount,Ga)}LUa(){this.BTb(J.a.LUa,0)}qWi(Ga){if(Ga)for(let Ua=0;Ua<Ga.length;++Ua)if(m.EwaSettings.isChangeGateEnabled("OfficeVSO:5140301_HandleEmptyInitialsColor")&&
!Ga[Ua].InitialsColor)b.ULS.sendTraceTag(537150362,0,15,"VersionHistoryHighlightManager.MapAuthorColorInfo: InitialsColor is null or empty for a version author");else{var ma=Ga[Ua].EmailAddress;var fa=Ga[Ua].UserName;var Xa=null;if(Ga[Ua].LoginName){const ka=Ga[Ua].LoginName.split("|");3===ka.length&&(Xa=ka[2])}Xa?this.authorColor[Xa]=Ga[Ua].InitialsColor:ma?(b.ULS.sendTraceTag(537150361,0,15,"VersionHistoryHighlightManager Map Author Color: LoginName is null"),this.authorColor[ma]=Ga[Ua].InitialsColor):
fa?(b.ULS.sendTraceTag(537150360,0,15,"VersionHistoryHighlightManager Map Author Color: Email Address is null"),this.authorColor[fa]=Ga[Ua].InitialsColor):b.ULS.sendTraceTag(537150359,0,10,"VersionHistoryHighlightManager Map Author Color: User name is null")}else b.ULS.sendTraceTag(537150363,0,15,"VersionHistoryHighlightManager.MapAuthorColorInfo: versionAuthors is null")}oik(){if(this.$.xa.VersionHistoryHighlightsSettings){var Ga=Array.isArray(Sys.Serialization.JavaScriptSerializer.deserialize(this.$.xa.VersionHistoryHighlightsSettings))?
Sys.Serialization.JavaScriptSerializer.deserialize(this.$.xa.VersionHistoryHighlightsSettings):null;for(let fa=0;fa<Ga.length;fa++){var ma=Ga[fa];const Xa=ma.key?ma.key:ma.Key?ma.Key:"";ma=ma.value?ma.value:ma.Value?ma.Value:"";"DefaultColor"===Xa?this.ugd=ma:"InitialTint"===Xa?this.Vvb=ma:b.ULS.sendTraceTag(537150357,0,15,"VersionHistoryHighlightManager.UpdateHighlightSettings Highlight Settings are incorrect")}}else b.ULS.sendTraceTag(537150358,0,15,"VersionHistoryHighlightManager.UpdateHighlightSettings Highlight Settings are null")}B4h(Ga){if(Ga.Email in
this.authorColor)return this.authorColor[Ga.Email];if(Ga.DisplayName in this.authorColor)return this.authorColor[Ga.DisplayName];b.ULS.sendTraceTag(537150356,0,15,"VersionHistoryHighlightManager GetColorFromPerson - unable to associate corresponding author in dictionary");return this.ugd}Qbc(Ga,ma){var fa=Object(k.a)(n.a,this.$.va.getItemByName(Ga.SheetName));const Xa=Object(k.a)(n.a,this.$.va.getItemByName(ma.SheetName));return fa&&Xa?(fa=(fa=l.HelperMethods.yI(fa.index,Xa.index))||l.HelperMethods.yI(Ga.FirstRow,
ma.FirstRow))||l.HelperMethods.yI(Ga.FirstColumn,ma.FirstColumn):(b.ULS.sendTraceTag(537150355,0,10,"VersionHistoryHighlightManager.CompareSharedSheetRange - null sheet"),0)}kff(){var Ga=r.m(this.gridView.ha.ra.activeRange,this.$.va.na);if(!Ga)return b.ULS.sendTraceTag(537150354,0,10,"VersionHistoryHighlightManager.GetNearestLocationIndexFromCurrentSelection - SelectedSharedSheetRange is null "),0;Ga=l.HelperMethods.cA(new f.a(this.HR),0,this.HR.length,Ga,this.kkh);0>Ga&&(Ga=~Ga);return Ga%this.HR.length}Gec(){if(this.wTb){if(!(this.wTb.JKa.toString()in
this.r6)){b.ULS.shipAssertTag(537150353,0,!1,`VersionHistoryHighlightManager.DeselectCurrentlySelectedView - ${this.wTb.JKa.toString()} view not present in views dictionary`);return}this.r6[this.wTb.JKa.toString()].wyh(this.wTb.Il)}this.$6a=-1}iterateNext(){this.Tcg(!0)}$Ba(){this.Tcg(!1)}static oHc(Ga){return`${Ga.range}${Ga.sheetId}`}}Object(w.a)(Y,"VersionHistoryHighlightManager",null,[795,5])},1296:function(w,C,a){a.r(C);w=a(0);var b=a(14),c=a(8);class h{}h.wNh="ewa-vhr-rectinnerborder";Object(w.a)(h,
"CssClassNames",null,[]);var k=a(74),d=a(45),f=a(210),u=a(19),r=a(356),t=a(1199);a.d(C,"RangeVersionHistoryHighlightView",function(){return v});class v{constructor(x,m,l,n){this.upb=null;this.$=x;this.dQg=m;this.eYa=l;this.fYa={};this.Vvb=n;this.Axi()}get cI(){return[v.c9]}get Kd(){return this.upb||(this.upb=u.h(this.$).Kd)}AVb(x){x?this.Kd.Jt(this.cI):this.Kd.cm(this.cI)}$Ud(){this.AVb(!1);this.Kd.RXa(new r.a(null,k.d(this.$.na)),this.cI)}oMj(x){if(this.eYa){var m=new r.a(d.E(x),k.d(this.$.va.getItemByName(x.SheetName))),
l=t.a.oHc(m);if(l in this.eYa)if(l in this.fYa){m=f.a.tr(this.eYa[l]);l=this.fYa[l];for(let n in l)l[n].style.backgroundColor=`rgba(${m.r},${m.g},${m.b},${c.a.unk})`;u.h(this.$).ha.Va.oK(null);u.h(this.$).Vjf(x,60,!0,"RangeVersionHistoryHighlightViewSelectView.SelectView")}else b.ULS.sendTraceTag(537150426,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToDivMap doesn't contain entry for "+l);else b.ULS.sendTraceTag(537150427,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToColorMap doesn't contain entry for "+
l)}else b.ULS.sendTraceTag(537150428,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToColorMap is null")}wyh(x){x=new r.a(d.E(x),k.d(this.$.va.getItemByName(x.SheetName)));var m=t.a.oHc(x);if(m in this.fYa)if(m in this.eYa){x=f.a.tr(this.eYa[m]);m=this.fYa[m];for(let l in m)m[l].style.backgroundColor=`rgba(${x.r},${x.g},${x.b},${this.Vvb})`}else b.ULS.sendTraceTag(537150424,0,10,"RangeVersionHistoryHighlightView.DeselectView sheetRangeToColorMap doesn't contain entry for "+m);else b.ULS.sendTraceTag(537150425,
0,10,"RangeVersionHistoryHighlightView.DeSelectView sheetRangeToDivMap doesn't contain entry for "+m)}Axi(){this.Kd.QC(this.dQg,[v.c9],!1,(x,m)=>{if(x&&x.range&&x.sheetId&&m){var l=new r.a(x.range,x.sheetId);l=t.a.oHc(l);l in this.fYa||(this.fYa[l]={});this.fYa[l][x.paneType.toString()]=m;l in this.eYa?(x=this.eYa[l],l=f.a.tr(x),m.style.borderColor=x,m.style.backgroundColor=`rgba(${l.r},${l.g},${l.b},${this.Vvb})`,x=document.createElement("div"),x.className=h.wNh,m.appendChild(x)):b.ULS.sendTraceTag(537150419,
0,10,"RangeVersionHistoryHighlightView.InitializeSheetRangeList sheetRangeToColorMap doesn't contain entry for "+l)}else b.ULS.shipAssertTag(537150423,0,!!x,"RangeVersionHistoryHighlightView.AddSheetRangeList: state is null"),b.ULS.shipAssertTag(537150422,0,!x||!!x.range,"RangeVersionHistoryHighlightView.AddSheetRangeList: state.Range is null"),b.ULS.shipAssertTag(537150421,0,!x||!!x.sheetId,"RangeVersionHistoryHighlightView.AddSheetRangeList: state.SheetId is null"),b.ULS.shipAssertTag(537150420,
0,!!m,"RangeVersionHistoryHighlightView.AddSheetRangeList: div is null")})}}v.c9=23;Object(w.a)(v,"RangeVersionHistoryHighlightView",null,[812])},1333:function(w,C,a){a.r(C);var b={};a.r(b);a.d(b,"CatchUpActivityCommandHandler",function(){return yd});var c=a(10),h=a(0),k=a(5),d=a(233),f=a(14),u=a(128),r=a(110),t=a(42),v=a(59),x=a(1);class m extends u.a{constructor(Jb,yc,Id,qe,Me){super(Jb,yc);this.executionContext=null;this.retryCount=0;this.sdj=oa=>{let vb;(()=>{let jd=this.vdk(oa);({kYd:vb}=jd);
return jd})().returnValue?vb.Success?(r.c(2138207060,!0),f.ULS.sendTraceTag(42287318,0,15,"RestoreVersionActivity:onRestoreSuccessCallback Restore version is successful")):(r.c(2138207060,!1),f.ULS.sendTraceTag(42287317,0,10,`RestoreVersionActivity:onRestoreSuccessCallback Restore version failed with message ${vb.Output}`),this.Zi(this.MF)):(r.c(2138207060,!1),this.Zi(this.MF));const Ac=this.executionContext.activityState[m.mLb];Ac&&Ac();this.xq();this.executionContext.iK()};this.rdj=()=>{if(0<this.retryCount)f.ULS.sendTraceTag(537150418,
0,15,`RestoreVersionActivity:onRestoreFailureCallback Retrying version restore, retry count : ${this.retryCount}`),this.retryCount--,this.A$f();else{f.ULS.sendTraceTag(42287320,0,10,"RestoreVersionActivity:onRestoreFailureCallback Restore version failed");r.c(2138207060,!1);this.Zi(this.MF);var oa=this.executionContext.activityState[m.mLb];oa&&oa();this.xq();this.executionContext.iK()}};this.MF=Id;this.l7=qe;this.baseUrl=Me}execute(Jb){this.executionContext=Jb;this.retryCount=3;x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.VersionHistoryServiceCompliance",
!1)?this.c0i():this.A$f();return 1}c0i(){var Jb=this.executionContext.Dg,yc=this.executionContext.activityState[m.lQb];const Id={};Id.VersionId=this.executionContext.activityState[m.sbe];Id.QuerySignature=yc;yc=Jb.qa.ua.ie();Jb=Jb.qa.ua;var qe=this.vbj.bind(this),Me=this.ubj.bind(this);yc=Jb.Pa(0,void 0===yc?null:yc);yc.restoreVersionParams=Id;v.g(Jb,"RestoreVersion",yc,qe,Me,null,null,0)}vbj(Jb){const yc=Jb.Result;yc?yc.Success?(r.c(2138207060,!0),f.ULS.sendTraceTag(508859478,0,15,"RestoreVersionActivity:onNewRestoreSuccessCallback Restore version is successful")):
(r.c(2138207060,!1),f.ULS.sendTraceTag(508859479,0,10,`RestoreVersionActivity:onNewRestoreSuccessCallback Restore version failed with message ${Jb.Result.Output}`),this.Zi(this.MF)):(r.c(2138207060,!1),this.Zi(this.MF));(Jb=this.executionContext.activityState[m.mLb])&&Jb();this.xq();this.executionContext.iK()}ubj(){f.ULS.sendTraceTag(508859477,0,10,"RestoreVersionActivity:onNewRestoreFailureCallback Restore version failed");r.c(2138207060,!1);this.Zi(this.MF);const Jb=this.executionContext.activityState[m.mLb];
Jb&&Jb();this.xq();this.executionContext.iK()}A$f(){var Jb=this.executionContext.activityState[m.lQb];const yc=`${this.baseUrl}${"restoreversion.ashx"}`,Id={};Id.VersionId=this.executionContext.activityState[m.sbe];Id.QuerySignature=Jb;Jb=t.c(Id);this.l7.Ho(yc,2,Jb,{"Content-Type":"application/json; charset=utf-8"},!1,2,this.sdj,this.rdj,null)}vdk(Jb){let yc;yc=null;Jb=Jb?Jb.data?Jb.data.Tf:null:null;if(!Jb||!Jb.length)return f.ULS.sendTraceTag(537150417,0,10,"RestoreVersionActivity:TryGetRestoreResult data returned from restoreversion call is null or empty"),
{returnValue:!1,kYd:yc};Jb=t.d(Jb);({Mu:yc}=Jb);return Jb.returnValue?{returnValue:!0,kYd:yc}:(f.ULS.sendTraceTag(537150416,0,10,"RestoreVersionActivity:TryGetRestoreResult Failed in deserialization of returned data from restore version"),{returnValue:!1,kYd:yc})}}m.sbe="RVAvi";m.lQb="RVAqs";m.mLb="RVlvrt";Object(h.a)(m,"RestoreVersionActivity",u.a,[]);var l=a(7);class n extends d.a{constructor(Jb,yc,Id){super();this.activityName=Jb;this.$M=yc;this.MF=Id;this.je()}create(){this.Ld(new m(this.activityName,
this.$M,this.MF,k.AFrameworkApplication.tf,k.AFrameworkApplication.sa.Ra.rZ))}static la(Jb){Jb.ga.Qa(320,new n(l.a.nYd,l.a.Gk,l.a.oYd))}}Object(h.a)(n,"RestoreVersionActivityFactory",d.a,[]);class z extends u.a{constructor(Jb,yc){super(Jb,yc)}execute(Jb){(0,Jb.activityState[z.qlg])(()=>{this.xq();Jb.iK()});return 1}}z.qlg="RVEAssea";Object(h.a)(z,"RestoreVersionErrorActivity",u.a,[]);class y extends d.a{constructor(Jb,yc){super();this.activityName=Jb;this.$M=yc;this.je()}create(){this.Ld(new z(this.activityName,
this.$M))}static la(Jb){Jb.ga.Qa(321,new y(l.a.oYd,l.a.Gk))}}Object(h.a)(y,"RestoreVersionErrorActivityFactory",d.a,[]);var B=a(64),G=a(734),E=a(53),J=a(38),I=a(199),R=a(384),X=a(62);class H{constructor(Jb,yc){this.$=Jb;this.xnk=yc}Pe(){return k.AFrameworkApplication.da.pa("IsAnonymousUser")?(f.ULS.sendTraceTag(537150415,0,15,"Verison History Command Handler: Anonymous user."),!0):!1}executeCommand(Jb,yc){f.ULS.sendTraceTag(537150414,0,50,"VersionHistoryCommandHandler:ExecuteCommand called.");Jb=
!1;switch(yc.command){case -1112508866:R.a(this.$)&&this.$.ga.Da(423).lIc(!1),Jb=this.xnk.Y1j()}f.ULS.sendTraceTag(537150413,0,50,`VersionHistoryCommandHandler:ExecuteCommand response${Jb}.`);return Jb?X.Task.Wa(Jb):I.a(yc.command)}Be(Jb,yc){return-1112508866===yc.command&&this.$.isVersionHistoryEnabled()}Ue(){return!1}}Object(h.a)(H,"VersionHistoryCommandHandler",null,[203]);var M=a(2),O=a(264),L=a(181),S=a(480);class T{static addAppPLTEventToLog(Jb){try{Microsoft.VersionHistory.VersionHistoryLogHelper.addAppPLTEventToLog(Jb)}catch(yc){}}static setIsPageLoadForFirstTime(Jb){try{Microsoft.VersionHistory.VersionHistoryLogHelper.setIsPageLoadForFirstTime(Jb)}catch(yc){}}}
Object(h.a)(T,"VersionHistoryLogConnector",null,[]);var V=a(32),la=a(778),Z=a(906),da=a(170),ba=a(137),na=a(15),Y=a(93),Ga=a(34),ma=a(46),fa=a(262),Xa=a(1039),Ua=a(275),ka=a(260),nb=a(12);class Ea{constructor(Jb){this.wz=Jb}vk(){Ua.a(this.wz.$).$y(this.jg)||Ua.a(this.wz.$).vk(this)}zba(){Ua.a(this.wz.$).$y(this.jg)&&Ua.a(this.wz.$).gB(this)}get jg(){return ka.a.pyg}get Ce(){return document.querySelector('[id="vhHeader"]')}get zi(){return!0}Nj(Jb){return nb.DOMElementExtensions.mi(this.Ce,Jb)}Ll(){this.wz.$.frame.ii.hq(this.wz.$.frame.ii.LX)}lm(){}Pi(Jb,
yc){yc||this.wz.DXb.then(Id=>{Id.enterHeaderFocusTrapZone();return null});return!yc}}Object(h.a)(Ea,"VersionHistoryHeader",null,[56]);class sb{constructor(Jb){this.wz=Jb}vk(){Ua.a(this.wz.$).$y(this.jg)||Ua.a(this.wz.$).vk(this)}zba(){Ua.a(this.wz.$).$y(this.jg)&&Ua.a(this.wz.$).gB(this)}get jg(){return ka.a.qyg}get Ce(){return document.querySelector('[aria-describedby="versionHistoryPane"]')}get zi(){return!0}Nj(Jb){return nb.DOMElementExtensions.mi(this.Ce,Jb)}Ll(){this.wz.$.frame.ii.hq(this.wz.$.frame.ii.LX)}lm(){}Pi(Jb,
yc){yc||this.wz.DXb.then(Id=>{Id.enterFocusTrapZone();return null});return!yc}}Object(h.a)(sb,"VersionHistoryPane",null,[56]);class Oa{constructor(Jb){this.wz=Jb}vk(){Ua.a(this.wz.$).$y(this.jg)||Ua.a(this.wz.$).vk(this)}zba(){Ua.a(this.wz.$).$y(this.jg)&&Ua.a(this.wz.$).gB(this)}get jg(){return ka.a.ryg}get Ce(){return document.querySelector('[id="vhViewer"]')}get zi(){return!0}Nj(Jb){return nb.DOMElementExtensions.mi(this.Ce,Jb)}Ll(){this.wz.$.frame.ii.hq(this.wz.$.frame.ii.LX)}lm(){}Pi(Jb,yc){yc||
this.wz.DXb.then(Id=>{Id.enterViewerFocusTrapZone();return null});return!yc}}Object(h.a)(Oa,"VersionHistoryViewer",null,[56]);var La=a(162),ia=a(266),Sa=a(76),Za=a(529),Ab=a(764);class pb{constructor(){this.actionUrl=this.ulsLogger=null;this.useFetch=this.hideEmbedFooter=!1}}Object(h.a)(pb,"AppBootSettings",null,[]);class Tb{constructor(){this.rootDiv=this.appBootSettings=null}}Object(h.a)(Tb,"AppVersionControllerFactoryParameters",null,[]);class ob{constructor(){this.telemetryCollector=this.baseVersionInfo=
this.selectedVersionInfo=null}}Object(h.a)(ob,"OnVersionSelectedParams",null,[]);class va{constructor(){this.appName=0;this.wdEnableDownloadTokens=!1;this.retryCount=0;this.wdEnableIterator=this.wdEnableRestore=this.wdEnableSaveACopy=!1;this.uiLocale=this.wacCluster=this.userSessionId=null;this.disableSaveACopy=this.wdEnableShowVersionChanges=this.wdEnableHiddenButtonsUntilVersionLoadComplete=this.viewerRootPositionRelative=this.useXhr=this.isRtl=!1;this.disabledChangeGates=null;this.wdEnableDeleteVersions=
this.wdEnableSaveACopyOverFlowMenu=!1;this.wdEnableAppVHProvider=this.wdDisableODCFileCache=this.wdDisableSPOFileCache=this.wdExperimentWithIteratorLocation=this.wdEnableAppColorUpdate=null}}Object(h.a)(va,"AppSettings",null,[]);class Pa{constructor(){this.perfTelemetryInfos=this.appSettings=this.docId=this.latestStreamServiceBase=this.serviceBase=this.ulsLogger=null}}Object(h.a)(Pa,"ControllerFactoryParameters",null,[]);var jb;(function(Jb){Jb[Jb.none=0]="none";Jb[Jb.vhUnknown=1]="vhUnknown";Jb[Jb.vhFailedToLoadVersionList=
100]="vhFailedToLoadVersionList";Jb[Jb.vhFailedToGetDownloadToken=101]="vhFailedToGetDownloadToken";Jb[Jb.vhFailedToParseVersionList=102]="vhFailedToParseVersionList";Jb[Jb.vhFetchFailed=103]="vhFetchFailed";Jb[Jb.vhVersioningNotEnabled=104]="vhVersioningNotEnabled";Jb[Jb.vhFileNotFound=105]="vhFileNotFound";Jb[Jb.vhVersionTooOld=106]="vhVersionTooOld";Jb[Jb.vhFetchException=107]="vhFetchException";Jb[Jb.vhServiceUnavailable=108]="vhServiceUnavailable";Jb[Jb.vhBadGateway=109]="vhBadGateway";Jb[Jb.vhUnauthorized=
110]="vhUnauthorized";Jb[Jb.vhInternalServerError=111]="vhInternalServerError";Jb[Jb.vhEmptyVersionMetadatas=112]="vhEmptyVersionMetadatas";Jb[Jb.vhFailedHostDownload=113]="vhFailedHostDownload";Jb[Jb.vhFailedToAddDownloadToVersionStore=114]="vhFailedToAddDownloadToVersionStore";Jb[Jb.vhFailedToCacheParts=115]="vhFailedToCacheParts";Jb[Jb.vhFailedToDownloadVersionMetadata=116]="vhFailedToDownloadVersionMetadata";Jb[Jb.vhFailedToDownloadParts=117]="vhFailedToDownloadParts";Jb[Jb.vhInvalidDocID=118]=
"vhInvalidDocID";Jb[Jb.vhMissingDocID=119]="vhMissingDocID";Jb[Jb.vhNullDocID=120]="vhNullDocID";Jb[Jb.vhNullHashedDocID=121]="vhNullHashedDocID";Jb[Jb.vhNullGetDownloadAccessTokenRequest=122]="vhNullGetDownloadAccessTokenRequest";Jb[Jb.vhFailedToDownloadVersionFromHost=123]="vhFailedToDownloadVersionFromHost";Jb[Jb.vhNullResponseFromFetch=124]="vhNullResponseFromFetch";Jb[Jb.vhGetTipVersionException=125]="vhGetTipVersionException";Jb[Jb.vhGetVersionsException=126]="vhGetVersionsException";Jb[Jb.vhGetDownloadTokenException=
127]="vhGetDownloadTokenException";Jb[Jb.vhFetchRetryException=128]="vhFetchRetryException";Jb[Jb.vhNullResponseFromRequestVersionHistory=129]="vhNullResponseFromRequestVersionHistory";Jb[Jb.vhNullResponseFromRequestDownloadToken=130]="vhNullResponseFromRequestDownloadToken";Jb[Jb.vhXhrJsonParseFailed=131]="vhXhrJsonParseFailed";Jb[Jb.vhXhrException=132]="vhXhrException";Jb[Jb.vhNullResponseFromXhr=133]="vhNullResponseFromXhr";Jb[Jb.vhFileGone=134]="vhFileGone";Jb[Jb.vhNullRevisionIDs=135]="vhNullRevisionIDs";
Jb[Jb.vhRequestDeleteVersionsException=136]="vhRequestDeleteVersionsException";Jb[Jb.vhNullResponseFromRequestDeleteVersions=137]="vhNullResponseFromRequestDeleteVersions";Jb[Jb.vhVersionInfoFromTipVersionException=138]="vhVersionInfoFromTipVersionException"})(jb||(jb={}));Object(h.b)("VersionHistoryFullAppErrorCode",jb);var Ob=a(315);class kb{constructor(Jb){this.baseVersionInfo=this.K7=this.Uta=this.Ln=this.ewaAccessibilityManager=this.DXb=null;this.JUd=this.cJf=!1;this.dVe=!0;this.dialog=this.accessTokenExpirationManager=
this.wB=this.e8e=this.yG=this.rbe=this.pbe=this.qbe=null;this.bTf=yc=>{f.ULS.sendTraceTag(42553885,0,50,"VersionHistoryPaneActor:OnRestoreVersionSelected - Restore is triggered");if(this.CZj()){var Id=Me=>{r.c(2138207060,!1);this.Ln.setRestoreFailedAtServer(Me)};this.yG&&this.yG.startTimer(kb.Bqg);var qe=()=>{this.yG.endTimer(kb.Bqg);this.WLe(this.yG)};this.Ln.setRestoreInProgress();ma.a(this.$).zs(new fa.a(l.a.ix,5,()=>{const Me=Sa.a(this.$).rf.activityState;Me[ia.a.Lq]=l.a.COe;Me[La.a.K0]=!0;Me[La.a.PW]=
0;Me[m.sbe]=yc;Me[m.lQb]=k.AFrameworkApplication.Ak;Me[m.mLb]=qe;Me[z.qlg]=Id;x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RestoreVersionForConvergenceExcelOnline",!1)&&(Me[Ob.a.qzc]=!0)}))}else r.c(2138207060,!1)};this.JVf=yc=>{this.DXb.then(Id=>{Id.enterFocusTrapZone();return null});f.ULS.sendTraceTag(537150349,0,50,"VersionHistoryPaneActor: OnVersionsReady called");this.yG.endTimer(kb.L7d);this.yG.incrementCounter(kb.Qnh);f.ULS.sendTraceTag(537150348,0,50,`VersionHistoryPaneActor: OnVersionsReady TimeTakenGetVersionsToOnVersionsReady Ms:${this.yG.getTimerDuration(kb.L7d)}`);
this.XFj(yc.containerDiv);yc.versions&&0<yc.versions.length&&(this.e8e=kb.ZH(yc.versions[yc.versions.length-1]));this.K7&&this.Uta&&this.e_d(this.K7);f.ULS.sendTraceTag(537150346,0,50,"VersionHistoryPaneActor:OnVersionsReady Exit")};this.onVersionSelected=yc=>{f.ULS.sendTraceTag(537150345,0,50,`VersionHistoryPaneActor:OnVersionSelected called. for Version:${kb.ZH(yc.currentVersion)}, LastSelected:${kb.ZH(this.K7)}`);this.yG.incrementCounter(kb.Pnh);this.K7=yc.currentVersion;this.baseVersionInfo=yc.baseVersion;
this.cJf=yc.noBaseToCompareTo;this.Uta&&this.Fmk()&&(this.e_d(yc.currentVersion),f.ULS.sendTraceTag(537150344,0,50,"VersionHistoryPaneActor:OnVersionSelected Exit"))};this.DNf=yc=>{f.ULS.sendTraceTag(537150337,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady called. for Version:${(null===yc||void 0===yc?0:yc.versionSelected)?kb.ZH(yc.versionSelected.currentVersion):null} UpdatedVersionsCount${(null===yc||void 0===yc?0:yc.updatedVersions)?yc.updatedVersions.length:0}, LastSelected:${kb.ZH(this.K7)}`);
this.yG.incrementCounter(kb.Onh);if(this.baseVersionInfo){if((null===yc||void 0===yc?0:yc.updatedVersions)&&2<=yc.updatedVersions.length){let Id=null,qe=null;const Me=kb.ZH(this.K7),oa=kb.ZH(this.baseVersionInfo);for(const vb of yc.updatedVersions)if(yc=kb.ZH(vb),Me===yc?Id=vb:oa===yc&&(qe=vb),Id&&qe)break;Id&&qe?(this.K7=Id,this.baseVersionInfo=qe,f.ULS.sendTraceTag(537150307,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady -Calling versionsViewController:OnVersionSelected RevisionID[N]: ${kb.ZH(this.K7)}, RevisionID[N-1]: ${kb.ZH(this.baseVersionInfo)}.`),
this.e_d(this.K7)):f.ULS.sendTraceTag(537150306,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady - does not find currentVersion or baseVersion from UpdatedVersions. RevisionID[N]: ${Me}, RevisionID[N-1]: ${oa}.`)}else f.ULS.sendTraceTag(537150305,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady - no diff call due to downloadTokenReadyObject or downloadTokenReadyObject.UpdatedVersions objects are null or not enough.");f.ULS.sendTraceTag(537150304,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady")}else f.ULS.sendTraceTag(537150336,
0,50,"VersionHistoryPaneActor:OnDownloadTokenReady baseVersionInfo is null in OnDownloadTokenReady callback.")};this.AMf=()=>{f.ULS.sendTraceTag(537150303,0,50,"VersionHistoryPaneActor:OnCloseVersionHistoryDialog Called");this.vih();const yc=new Y.a(1470556788,0,this.$.se,0,null);this.$.Ha.Ad(yc)};this.oTf=yc=>{f.ULS.sendTraceTag(41739662,0,50,"VersionHistoryPaneActor:OnSaveACopy Called");if(x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.VersionHistoryServiceCompliance",!1))this.ETb(Xa.a.saveACopy,
{});else{var Id=new Y.a(-1244760097,0,this.$.se,0,null);this.$.mg.get(51)&&(f.ULS.sendTraceTag(537150301,0,50,"VersionHistoryPaneActor:OnSaveACopy for ODConsumer Called"),Id=new Y.a(-309686558,0,this.$.se,0,null));r.c(1604651619,!0);this.$.Ha.Ad(Id,{["FileDownloadUrl"]:yc})}};this.ENf=yc=>{f.ULS.sendTraceTag(537150300,0,50,"VersionHistoryPaneActor:OnDownloadVersion Called");if(!x.EwaSettings.isChangeGateEnabled("OfficeVSO:6794681_VHDisableDownloadACopy")||this.BZj())x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.VersionHistoryServiceCompliance",
!1)?this.ETb(Xa.a.O7a,{}):(yc=new O.QueryStringBuilder(yc),yc.mj("fn",k.AFrameworkApplication.fileName),f.ULS.sendTraceTag(537150299,0,50,"VersionHistoryPaneActor:OnDownloadVersion URL Length is "+yc.toString().length),8===this.$.frame.Ceb(yc.toString(),!0)?(f.ULS.sendTraceTag(587830283,0,10,"VersionHistoryPaneActor:OnDownloadVersion failed"),r.c(1316171850,!1)):r.c(1316171850,!0))};this.aLf=yc=>{this.Ln.setFullAppErrorCode(yc);x.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes")&&
this.Ln.setViewerError(!0)};this.kHe=yc=>{const Id=document.getElementById(kb.q5e);!Id||this.wB&&!yc||(f.ULS.sendTraceTag(537150293,0,50,"VersionHistoryPaneActor: SelectVersion Lazy instantiate VersionHistoryMessenger"),this.wB=new Xa.a(Id.contentWindow,B.a.rN(this.$.xa.VersionHistoryActionUrl)||Ab.a.DM),this.wB.fm(L.a.n_a,this.Hhb),this.wB.fm(L.a.o_a,this.Hhb),this.wB.fm(L.a.L1,this.Hhb),this.wB.Rn(Xa.a.setCurrentChangeCount),this.wB.Rn(Xa.a.setTotalChangesCount),x.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&
this.wB.Rn(Xa.a.LUa),this.wB.fm(Xa.a.setCurrentChangeCount,this.Hhb),this.wB.fm(Xa.a.setTotalChangesCount,this.Hhb),x.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&this.wB.fm(Xa.a.LUa,this.Hhb))};this.TOf=yc=>{if(x.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes"))yc=jb[yc]?jb[yc]:"None";else switch(yc){case 101:yc="VHFailedToGetDownloadToken";break;case 100:yc="VHFailedToLoadVersionList";break;case 104:yc="VHVersioningNotEnabled";
break;case 105:yc="VHFileNotFound";break;case 106:yc="VHVersionTooOld";break;default:yc="None"}this.yG.addEvent("OnFullAppError",yc);f.ULS.sendTraceTag(537150291,0,10,`FullApp Error Event: ${yc}`)};this.xOd=yc=>{this.dVe=yc;f.ULS.sendTraceTag(537150290,0,50,`VersionHistoryPaneActor:Show Changes toggled to:${yc.toString()}`);this.ETb(Xa.a.hXb,{["ToggleValue"]:yc})};this.oQf=yc=>{f.ULS.sendTraceTag(50405840,0,50,`VersionHistoryPaneActor:OnIteratorSelected next: ${yc}`);r.c(1488635506,!0);const Id={};
yc?this.ETb(Xa.a.iterateNext,Id):this.ETb(Xa.a.$Ba,Id)};this.Hhb=yc=>{switch(yc.MessageId){case L.a.n_a:f.ULS.sendTraceTag(537150289,0,50,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession WacAppCompleted ");x.EwaSettings.Ea(370)&&this.Ln.setVersionLoadComplete();break;case L.a.o_a:f.ULS.sendTraceTag(51128035,0,10,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession WacAppFailed");break;case Xa.a.setCurrentChangeCount:yc=yc.Values.count;f.ULS.sendTraceTag(537150288,0,50,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession SetCurrentChangeCount : ${yc}`);
this.Ln.setCurrentChangeCount(yc);break;case Xa.a.setTotalChangesCount:yc=yc.Values.count;f.ULS.sendTraceTag(537150287,0,50,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession SetTotalChangesCount : ${yc}`);this.Ln.setTotalChangesCount(yc);break;case Xa.a.LUa:this.xOd(this.dVe);break;case L.a.L1:if(!x.EwaSettings.isChangeGateEnabled("OfficeVSO:7402639_ExcelVHAccessTokenExpiredRefreshFix"))break;f.ULS.sendTraceTag(509682466,0,50,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession DocumentRefresh");
this.R2i();break;default:f.ULS.sendTraceTag(537150286,0,15,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession MessageID:${yc.MessageId}`)}};this.$=Jb;this.whc=this.$.Pd+kb.URh;this.Puh();x.EwaSettings.isChangeGateEnabled("OfficeVSO:7323755_ExcelVersionHistoryTokenRefreshFix")&&this.$.ga.qd(38,yc=>{this.accessTokenExpirationManager=yc;this.JUa=this.JUa.bind(this);this.accessTokenExpirationManager.Aub(this.JUa)});this.vKb="";this.dFd=0;this.perfTelemetryInfos=[]}JUa(){null!=this.Ln&&(this.Ln.updateDocId(k.AFrameworkApplication.Ak),
f.ULS.sendTraceTag(509699330,0,50,"VersionHistoryPaneActor:onTokenRefreshed completed Successfully"))}dispose(){x.EwaSettings.isChangeGateEnabled("OfficeVSO:7323755_ExcelVersionHistoryTokenRefreshFix")&&this.accessTokenExpirationManager.sDc(this.JUa);this.uNe()}Amj(){x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigrateEwaAccessibilityManager",!1)?void ba.a.KE(na.V).then(Jb=>{this.ewaAccessibilityManager=Jb;this.ewaAccessibilityManager.mode=2}):this.$.ga.qd(15,Jb=>{this.ewaAccessibilityManager=
Jb;this.ewaAccessibilityManager.mode=2})}Puh(){this.qbe=new sb(this);this.pbe=new Ea(this);this.rbe=new Oa(this)}Y1j(){f.ULS.sendTraceTag(41739649,0,15,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction called");k.AFrameworkApplication.KN("8492a557;72ff4572");this.yG=excelVersionHistory.FactoryGlobal.getTelemetryCollector();this.perfTelemetryInfos=[];this.yG.startTimer(kb.Aqg);if(!this.Ln&&(Za.a(()=>{this.Ln=versionHistory.FactoryGlobal.getVersionHistoryControllerInstance(Object(M.a)(new Pa,
{ulsLogger:new S.a,docId:k.AFrameworkApplication.Ak,appSettings:Object(M.a)(new va,{appName:120,userSessionId:k.AFrameworkApplication.userSessionId,wdEnableSaveACopy:!0,wdEnableDownloadTokens:!0,wacCluster:k.AFrameworkApplication.tf.iS,uiLocale:k.AFrameworkApplication.uiCulture||"en-us",wdEnableRestore:this.$.isEditMode,wdEnableIterator:x.EwaSettings.Ea(279),useXhr:!1,wdEnableHiddenButtonsUntilVersionLoadComplete:x.EwaSettings.Ea(370),disableSaveACopy:this.N2d(),wdEnableShowVersionChanges:!0,disabledChangeGates:this.$.xa.VHSDisabledChangeGates,
wdEnableSaveACopyOverFlowMenu:x.EwaSettings.Ea(466),isRtl:k.AFrameworkApplication.isRtl,wdExperimentWithIteratorLocation:x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.VersionHistoryIteratorInPane",!1),wdDisableSPOFileCache:x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.VersionHistoryServiceCompliance",!1)}),perfTelemetryInfos:this.perfTelemetryInfos}))}),!this.Ln))return f.ULS.sendTraceTag(537150352,0,10,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction - VersionHistoryController should not be null"),
r.c(429638140,!1),!1;this.Z1j();this.yG.endTimer(kb.Aqg);this.yG.startTimer(kb.Eqg);f.ULS.sendTraceTag(537150351,0,50,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction Returned Success");r.c(429638140,!0);return!0}Z1j(){var Jb;this.pyj();if(!document.getElementById(this.whc)){const yc=document.createElement("div");yc.id=this.whc;yc.style.width="100%";yc.style.zIndex="998";yc.style.display="block";yc.style.position="absolute";if(k.AFrameworkApplication.sa.Ra.gh){const Id=(null===(Jb=document.getElementById("HeaderRegion"))||
void 0===Jb?void 0:Jb.offsetHeight)||0;yc.style.top=Id+"px";yc.style.bottom="0px";yc.style.height=`calc(100vh - ${Id}px)`}else yc.style.height="100%";this.$.Qr.insertBefore(yc,this.$.Qr.firstChild);this.DXb=this.Ln.createVersionHistoryDialog(yc)}document.getElementById(this.whc).style.display="block";this.BUd();this.yG.startTimer(kb.L7d);this.Ln.getVersions("")}BUd(){this.qbe.vk();this.pbe.vk();this.rbe.vk();this.Amj()}T9d(){this.qbe.zba();this.pbe.zba();this.rbe.zba();this.ewaAccessibilityManager&&
(this.ewaAccessibilityManager.mode=0)}pyj(){this.Ln.getVersionsReadyEvent().addListener(this.JVf);this.Ln.getVersionSelectedEvent().addListener(this.onVersionSelected);this.Ln.getCloseSelectedEvent().addListener(this.AMf);this.Ln.getFullAppErrorEvent().addListener(this.TOf);this.Ln.getIteratorSelectedEvent().addListener(this.oQf);this.Ln.getShowVersionChangesToggledEvent().addListener(this.xOd);this.Ln.getDownloadTokenReadyEvent().addListener(this.DNf);this.Ln.getSaveACopySelectedEvent().addListener(this.oTf);
this.Ln.getDownloadVersionSelectedEvent().addListener(this.ENf);this.$.isEditMode&&(this.Ln.getRestoreVersionSelectedEvent().addListener(this.bTf),this.JUd=!0)}qyj(){this.Uta.getAppErrorEvent().addListener(this.aLf)}Jk(){this.Ln.getVersionsReadyEvent().removeListener(this.JVf);this.Ln.getVersionSelectedEvent().removeListener(this.onVersionSelected);this.Ln.getCloseSelectedEvent().removeListener(this.AMf);this.Ln.getFullAppErrorEvent().removeListener(this.TOf);this.Ln.getIteratorSelectedEvent().removeListener(this.oQf);
this.Ln.getShowVersionChangesToggledEvent().removeListener(this.xOd);this.Ln.getSaveACopySelectedEvent().removeListener(this.oTf);this.Ln.getDownloadVersionSelectedEvent().removeListener(this.ENf);this.Ln.getDownloadTokenReadyEvent().removeListener(this.DNf);this.JUd&&(this.Ln.getRestoreVersionSelectedEvent().removeListener(this.bTf),this.JUd=!1);this.Uta&&this.Uta.getAppErrorEvent().removeListener(this.aLf)}cXj(){return this.N2d()||!k.AFrameworkApplication.N1}BZj(){return this.cXj()?(f.ULS.sendTraceTag(520180169,
0,15,"VersionHistoryPaneActor:OnDownloadVersion blocked"),r.c(1316171850,!1),!1):!0}CZj(){let Jb=!0;this.$.ea.amIAlone||(this.JRi(),this.Ln.setCoauthRestoreError(),Jb=!1);this.$.nU&&(f.ULS.sendTraceTag(42522439,0,10,"VersionHistoryPaneActor:ShouldTriggerRestore - Restore failed, Unsaved changes present"),Jb&&(Jb=!1,this.X1j()));return Jb}X1j(){var Jb=Ga.a.qf(1,0,1903,1902,0,-1603358883,"RestoreVersionUnsavedChangesError");Jb=this.dialog||new da.ErrorDialog(this.$,Jb);Jb.initialize();Jb.Ji()}Fmk(){f.ULS.sendTraceTag(537150343,
0,50,`VersionHistoryPaneActor:ValidateDiffDiffParameters called for BaseVersion${this.baseVersionInfo?kb.ZH(this.baseVersionInfo):""}`);if(kb.ZH(this.K7)===this.e8e)return f.ULS.sendTraceTag(537150342,0,15,"VersionHistoryPaneActor:ValidateDiffDiffParameters for last version"),!0;if(x.EwaSettings.isChangeGateEnabled("OfficeVSO:4381797_XLVHSkipBaseVersionValidateForGroupingUI")&&!this.baseVersionInfo&&this.cJf)return f.ULS.sendTraceTag(537150341,0,50,"VersionHistoryPaneActor:ValidateDiffDiffParameters skipping diff last version"),
!0;if(!this.baseVersionInfo)return f.ULS.sendTraceTag(537150340,0,10,"VersionHistoryPaneActor:ValidateDiffDiffParameters for null BaseVersion"),!1;const Jb=kb.V6h(this.baseVersionInfo);f.ULS.sendTraceTag(537150339,0,50,`downloadURL length ${Jb?Jb.length:0}`);return Jb?!0:(f.ULS.sendTraceTag(537150338,0,50,"VersionHistoryPaneActor:ValidateDiffDiffParameters downloadURL is null"),!1)}N2d(){return!this.$.epa}vih(){document.getElementById(this.whc).style.display="none";const Jb=new Y.a(-1423792966,0,
this.$.se,0,null);this.$.Ha.Ad(Jb);this.uNe()}uNe(){this.yG&&(this.yG.endTimer(kb.Eqg),this.WLe(this.yG),this.yG=null);this.Jk();this.T9d();this.perfTelemetryInfos&&(f.ULS.sendTraceTag(537150302,0,15,this.perfTelemetryInfos.map(Jb=>JSON.stringify(Jb)).toString()),this.perfTelemetryInfos=null);this.wB&&(this.wB.NV(L.a.n_a),this.wB.NV(L.a.o_a),this.wB.NV(Xa.a.setCurrentChangeCount),this.wB.NV(Xa.a.setTotalChangesCount),this.wB.NV(L.a.L1),x.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&
this.wB.NV(Xa.a.LUa),this.wB.dispose(),this.wB=null)}XFj(Jb){try{this.Uta?(T.setIsPageLoadForFirstTime(!1),x.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes")&&!document.getElementById(kb.q5e)&&(this.Uta.resetContainer(Jb),this.kHe(!0))):(T.setIsPageLoadForFirstTime(!0),Za.a(()=>{const yc=new pb;yc.ulsLogger=new S.a;yc.actionUrl=this.$.xa.VersionHistoryActionUrl;yc.hideEmbedFooter=!0;yc.useFetch=!V.a.fC;this.Uta=excelVersionHistory.FactoryGlobal.getAppVersionControllerInstance(Object(M.a)(new Tb,
{appBootSettings:yc,rootDiv:Jb}))})),this.qyj()}catch(yc){f.ULS.sendTraceTag(41239239,0,10,`VersionHistoryPaneActor: ResetAppVersionController failed due to exception. ${yc}`)}}e_d(Jb){f.ULS.sendTraceTag(537150298,0,50,`VersionHistoryPaneActor:SelectVersion called. for Version:${kb.ZH(Jb)}, LastSelected:${this.vKb}`);if(Jb)if(kb.ZH(Jb).length){var yc=(new Date).getTime();if(kb.ZH(Jb)===this.vKb&&1E3>yc-this.dFd)f.ULS.sendTraceTag(537150295,0,50,"VersionHistoryPaneActor:SelectVersion reattempt within 1 sec");
else{kb.ZH(Jb)!==this.vKb&&(f.ULS.sendTraceTag(537150294,0,50,"VersionHistoryPaneActor:Reset Iterator states if user clicks on different version"),this.Ln.setTotalChangesCount(-1),this.Ln.setCurrentChangeCount(-1));var Id=excelVersionHistory.FactoryGlobal.getTelemetryCollector();Id.addEvent("SelectVersion",kb.ZH(Jb));try{this.qpk(Id);this.dFd=yc;this.vKb=kb.ZH(Jb);const qe=new ob;qe.selectedVersionInfo=this.K7;qe.baseVersionInfo=this.baseVersionInfo;qe.telemetryCollector=Id;this.Uta.onVersionSelectedWithParams(qe);
this.Ln&&this.Ln.setDisableSaveACopy(this.N2d());this.kHe(!1)}catch(qe){this.dFd=0,this.vKb="",Id.addEvent("Exception",qe.toString()),f.ULS.sendTraceTag(42016832,0,10,`VersionHistoryPaneActor: OnVersionSelected failed due to exception. ${qe}`)}finally{f.ULS.sendTraceTag(537150292,0,50,Id?Id.getJsonForLogging():"")}}}else f.ULS.sendTraceTag(537150296,0,50,"VersionHistoryPaneActor:SelectVersion selectedVersion RevisionId is null");else f.ULS.sendTraceTag(537150297,0,50,"VersionHistoryPaneActor:SelectVersion selectedVersion is null")}qpk(Jb){for(const yc of this.perfTelemetryInfos){const Id=
yc.TelemetryEventKey?yc.TelemetryEventKey:yc.telemetryEventKey?yc.telemetryEventKey:"",qe=yc.TelemetryEventData?yc.TelemetryEventData:yc.telemetryEventData?yc.telemetryEventData:"";Id&&qe&&Jb.addEvent(Id,qe)}this.perfTelemetryInfos.length=0}WLe(Jb){f.ULS.sendTraceTag(42553886,0,15,`VersionHistoryPaneActor:CaptureSessionTelemetry - ${Jb?Jb.getJsonForLogging():""} `)}JRi(){const Jb=this.$.ea.Vp,yc={};let Id=null;for(const qe of Jb)qe.UserEmail&&(yc[qe.UserEmail]=qe.UserEmail in yc?yc[qe.UserEmail]+
1:1),qe.User.UserID===this.$.ea.clientId&&(Id=qe.UserEmail);f.ULS.sendTraceTag(42522438,0,10,`VersionHistoryPaneActor:LogCoauthorsTelemetry Restore failed, TotalAuthors: ${Jb.length}, TotalAuthorsAsYourself ${Id?yc[Id]:-1}`)}R2i(){ma.a(this.$).zs(new fa.a(l.a.ix,5,()=>{const Jb=Sa.a(this.$).rf.activityState;Jb[ia.a.Lq]=l.a.Gk;Jb[Ob.a.qzc]=!0}))}ETb(Jb,yc){f.ULS.sendTraceTag(537150285,0,50,`VersionHistoryPaneActor.SendPostMessageToTheVHSession called with MessageID:${Jb}`);if(this.wB){Jb=new la.a(Jb);
Jb.Values[Z.a.hzb]=this.$.xa.UserSessionId;if(yc)for(let Id in yc)Jb.Values[Id]=yc[Id];this.wB.send(Jb)}else f.ULS.sendTraceTag(537150284,0,10,"VersionHistoryPaneActor.SendPostMessageToTheVHSession versionHistoryMessenger is null")}static ZH(Jb){return Jb?Jb.RevisionID?Jb.RevisionID:Jb.revisionID?Jb.revisionID:"":""}static V6h(Jb){return Jb?Jb.DownloadUrl?Jb.DownloadUrl:Jb.downloadUrl?Jb.downloadUrl:"":""}}kb.URh="_excelVersionHistoryOverlay";kb.q5e="vhs_frame";kb.Aqg="TimeTakenShowVersionHistoryDialogAction";
kb.Eqg="TimeTillVersionHistoryDialogWasOpenMs";kb.L7d="TimeTakenGetVersionsToOnVersionsReady";kb.Pnh="CountOnVersionSelectedCalledinOneVHSession";kb.Qnh="CountOnVersionsReadyCalledinOneVHSession";kb.Onh="CountOnDownloadTokenReadyCalledinOneVHSession";kb.Bqg="TimeTakenVersionRestore";Object(h.a)(kb,"VersionHistoryPaneActor",null,[5]);var ra=a(91);class rb extends G.a{constructor(Jb){super(Jb)}Uf(){const Jb=this.QQi(),yc=E.GetServiceTaskFactory.ud(this.$.ga,21,137,this.Ta);J.TaskExtensions.za(J.TaskExtensions.Wf([Jb,
yc],this.ka,3),()=>{var Id=yc.result;const qe=B.a.rN(this.$.xa.VersionHistoryActionUrl);qe!==Ab.a.DM&&Id.LS(qe);Id=new kb(this.$);this.Lf([new H(this.$,Id)])},this.ka,3)}QQi(){return ra.d(ba.a.resolve(na.S,{Ja:this.Ta}).then(Jb=>Jb("excelVersionHistory")))}static la(Jb){G.a.qg(304,new rb(Jb))}}Object(h.a)(rb,"VersionHistoryCommandHandlerFactory",G.a,[]);var Kb=a(1199),Sb=a(737);class cb extends d.a{constructor(Jb){super();this.$=Jb;this.je()}create(){const Jb=x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Migrate2AriaLiveNotifier",
!1)?Object(ra.d)(ba.a.resolve(na.f,{Ja:this.Ta})):E.GetServiceTaskFactory.ud(this.$.ga,211,212,this.Ta),yc=E.GetServiceTaskFactory.ud(this.$.ga,21,137,this.Ta);J.TaskExtensions.za(J.TaskExtensions.Wf([Jb,yc],this.$.ka),()=>{const Id=Object(Sb.a)(this.$.ga,305,()=>new Kb.a(this.$,!0,yc.result,Jb.result));this.Ld(Id)},this.$.ka,3)}static la(Jb){Jb.ga.Qa(306,new cb(Jb))}}Object(h.a)(cb,"VersionHistoryHighlightManagerFactory",d.a,[]);var cc=a(521),Ub=a(6),wb=a(180),vc=a(16);class Lb extends u.a{constructor(Jb,
yc,Id){super(Jb,yc);this.lineageManager=Id}execute(Jb){this.lineageManager.lineageHidePreviousHistory();return super.execute(Jb)}}Object(h.a)(Lb,"LineageClearHistoryConfirmedActivity",u.a,[]);var Ja=a(17),Hb=a(157);class gc{constructor(Jb,yc){this.$=Jb;this.lineageManager=yc;Jb=[new Ja.a(l.a.TFd,1038647878,0,0,2244),new Ja.a(l.a.idle,1038647878,0,1)];Sa.a(this.$).oUd(new Hb.a(l.a.SFd,l.a.idle,Jb),new Lb(l.a.TFd,l.a.idle,yc))}Pe(){return!1}executeCommand(Jb,yc,Id){Jb=!1;switch(yc.command){case 1834994092:9===
yc.Tg&&this.E7j();this.q_j(yc,Id);Jb=!0;break;case -409942531:this.v_j(),Jb=!0}return Jb?X.Task.Wa(!0):I.a(yc.command)}Be(Jb,yc){return 1834994092===yc.command||-409942531===yc.command}Ue(){return!1}q_j(Jb,yc){f.ULS.sendTraceTag(537155483,0,50,`LineageActivityCommandHandler::ShowChangesCore command location: ${yc.MenuItemId||Jb.Tg}`);this.lineageManager.Ikg(19===Jb.Tg&&!!yc.MenuItemId,yc.MenuItemId,Jb.Tg,yc)}E7j(){const Jb=Ub.a.LBc;Jb!==wb.a(this.$).Fs.jB&&wb.a(this.$).Fs.activateRibbonTab(Jb)}v_j(){ma.a(this.$).zs(new fa.a(l.a.SFd,
5,()=>{const Jb=Sa.a(this.$).rf,yc=Ga.a.qf(3,1,2241,2242,2243,1038647878,"LineageConfirmClearHistory");yc.HelpTopicId="a1493bf9-25c3-470a-b970-60eceb0136e5";yc.HelpDescription=vc.a.instance.ia(1319);Jb.Us([yc])}))}}Object(h.a)(gc,"LineageActivityCommandHandler",null,[203]);class ec extends G.a{constructor(Jb){super(Jb)}Uf(){J.TaskExtensions.za(E.GetServiceTaskFactory.ud(this.$.ga,366,367,this.Ta),Jb=>{this.Lf([new gc(this.$,Jb.result)])},this.ka,3)}static la(Jb){G.a.qg(363,new ec(Jb))}}Object(h.a)(ec,
"LineageActivityCommandHandlerFactory",G.a,[]);var Ta=a(427),ib=a(30),bc=a(84),jc=a(176),sc=a(118);class Fa{}Object(h.a)(Fa,"LineageClientParams",null,[]);class Ha{}Object(h.a)(Ha,"LineageFilter",null,[]);var Na=a(74),W=a(77),U=a(142),za=a(45),ua=a(200),$a=a(125),Va=a(131),hb=a(248),qb=a(247),Nb=a(19),yb=a(143);const ja=(Jb,yc,Id,qe,Me,oa)=>{oa=Jb.Pa(1,void 0===oa?null:oa);return v.g(Jb,"LineageUpdateView",oa,yc,Id,qe,Me,0)},Ka=(Jb,yc,Id,qe,Me,oa)=>{oa=Jb.Pa(1,void 0===oa?null:oa);return v.g(Jb,"LineageClosePane",
oa,yc,Id,qe,Me,0)};var Pb=a(55),rc=a(357);class $c{constructor(){this.activityList=null;this.oldestActivityId=this.latestActivityId=0;this.lastSearchedActivityTimestamp=null;this.serverLastActivityId=this.serverFirstActivityId=this.serverMessageCode=0;this.docId=null;this.showLoadPrevious=!1;this.eolPersonHideHistory=this.eolDateHideHistory=this.eolCorrelationId=null}}Object(h.a)($c,"LineageActivitiesResponseDTO",null,[]);class Dd extends $c{constructor(){super();this.hasNewActivities=!1;this.filterSheetMultiRange=
null}}Object(h.a)(Dd,"LineageActivitiesUpdateResponseDTO",$c,[]);class Jd{constructor(){this.hasAnyActiveInGridHighlight=this.shouldShowBlueDot=this.onDisplayInGridHighlightsChanged=this.areInGridHighlightsEnabled=this.areInGridHighlightsAvailable=this.onLearnMoreLinkClicked=this.isFeatureEnabled=this.onRangeFilterInputEnabled=this.tryParseRangeInfo=this.onVersionHistoryButtonClicked=this.onCardSelected=this.lineageUpdateViewRequest=this.lineageRefreshViewRequest=this.lineageLoadMoreRequest=this.lineageOpenPaneOrChangeFilterRequest=
null}}Object(h.a)(Jd,"LineageAppCallbacks",null,[]);class Kd{constructor(){this.imageUrl=this.email=this.displayName=this.provider=this.id=null}}Object(h.a)(Kd,"LineageAuthorDTO",null,[]);class ce{constructor(){this.logger=this.uiCulture=this.dataCulture=null;this.clientBatchSize=0;this.lineageAppCallbacks=this.filterableSheetList=null}}Object(h.a)(ce,"LineageControllerFactoryParams",null,[]);class ge{constructor(){this.lastCol=this.firstCol=this.lastRow=this.firstRow=0}}Object(h.a)(ge,"LineageSharedRangeDTO",
null,[]);class uc{constructor(){this.sheetName=this.rangeList=null}}Object(h.a)(uc,"LineageSheetMultiRangeDTO",null,[]);class dd{constructor(){this.activityId=0;this.displayTimestamp=this.author=this.activityGuid=null;this.activityType=0;this.rangeHighlightLocation=this.isBulkEditOverflow=this.valueChanges=this.gridLocation=this.sheetName=this.nestedActivityList=null;this.degradedCardTypeBits=0}}Object(h.a)(dd,"LineageUserActivityDTO",null,[]);class Rd{constructor(){this.hasOldValue=this.hasNewValue=
!1;this.cellLocation=this.oldValue=this.newValue=null}}Object(h.a)(Rd,"LineageValueChangeDTO",null,[]);var Yd;(function(Jb){Jb[Jb.default=0]="default";Jb[Jb.D48X48=1]="D48X48";Jb[Jb.D64X64=2]="D64X64";Jb[Jb.D96X96=3]="D96X96";Jb[Jb.D120X120=4]="D120X120";Jb[Jb.D240X240=5]="D240X240";Jb[Jb.D360X360=6]="D360X360";Jb[Jb.D432X432=7]="D432X432";Jb[Jb.D504X504=8]="D504X504";Jb[Jb.D648X648=9]="D648X648"})(Yd||(Yd={}));Object(h.b)("ProfilePhotoDimension",Yd);const Md=(Jb,yc)=>{let Id=[];for(const Dg of Jb){Jb=
Dg;var qe=yc,Me=Object(M.a),oa=new dd,vb=Number.parseLocale(Jb.UserActivity.Id),Ac=Jb.Uid,jd=Jb.UserActivity.Type;var Ud=Jb.UserActivity.Person;var ke=qe;if(Ud){var Pe=null;k.AFrameworkApplication.da.pa("IsUserProfilePictureResolutionEnabled")&&(Pe=ke.zma(Ud.Email,Ud.Provider,k.AFrameworkApplication.Ak,Yd.default));Ud=Object(M.a)(new Kd,{id:Ud.Id,provider:Ud.Provider,displayName:Ud.DisplayName,email:Ud.Email,imageUrl:Pe})}else Ud=null;ke=Jb.SheetName;Pe=new Date(Jb.UserActivity.DisplayTimestamp);
var ze=Jb.DisplayLocation,Ue=Jb.LineageValueChangeList;var hg=[];for(const Gg of Ue)Ue=Object(M.a)(new Rd,{hasNewValue:Gg.HasNewValue,hasOldValue:Gg.HasOldValue,newValue:Gg.HasNewValue?Gg.NewValue:null,oldValue:Gg.HasOldValue?Gg.OldValue:null,cellLocation:Gg.CellLocation}),hg.push(Ue);Ue=Jb.IsBulkEditOverFlow;a:{var of=Jb.UserActivity.LocationList;var Gf=Jb.UserActivity.Type;if(!of){f.ULS.sendTraceTag(512259102,0,15,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is null");Gf=null;
break a}if(!of.length){f.ULS.sendTraceTag(512259101,0,50,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is empty");Gf=null;break a}var Wf=[],bg=[];let Gg="";21===Gf?bg.push(of[0]):bg=of;for(const Rf of bg)switch(Rf.Type){case 1:break;case 2:Gg=Rf.SheetName;break;case 0:of=Rf;if(!of.RangeList){f.ULS.sendTraceTag(512259099,0,50,"LineageManagerUtil:: RangeHighlightLocation.RangeActivityLocation is null");break}Gg=of.RangeList[0].SheetName;bg=[];21===Gf?bg.push(of.RangeList[0]):bg=
of.RangeList;for(const Eg of bg)of=Object(M.a)(new ge,{firstCol:Eg.FirstColumn,firstRow:Eg.FirstRow,lastRow:Eg.LastRow,lastCol:Eg.LastColumn}),Wf.push(of);break;default:f.ULS.sendTraceTag(512259098,0,50,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is of type: ",Rf.Type)}Gf=Object(M.a)(new uc,{sheetName:Gg,rangeList:Wf})}qe=(Wf=Jb.NestedActivityList)?Md(Wf,qe):null;Jb=Me(oa,{activityId:vb,activityGuid:Ac,activityType:jd,author:Ud,sheetName:ke,displayTimestamp:Pe,gridLocation:ze,
valueChanges:hg,isBulkEditOverflow:Ue,rangeHighlightLocation:Gf,nestedActivityList:qe,degradedCardTypeBits:Jb.DegradedCardTypeBits});25===Jb.activityType?(Me=[],ad(Jb,Me),Id=[...Id,...Me]):Id.push(Jb)}return Id},ad=(Jb,yc)=>{25===Jb.activityType?Jb.nestedActivityList.forEach(Id=>{Id&&ad(Id,yc)}):yc.push(Jb)};class Mb{constructor(Jb,yc,Id,qe,Me){this.Q8a=this.fG=null;this.fH=this.Rpa=0;this.VNb=()=>{this.cba&&(this.cba.stop(),this.cba=null);this.qVb.start();this.fG.createLineageTaskPane(this.RFd,this.Q8a,
this.activityGuid)};this.onBlueDotsUpdated=()=>{this.fG.onBlueDotsUpdated()};this.lineageOpenPaneOrChangeFilterRequest=(oa,vb)=>{this.qVb.stop();yb.b(this.$).nf(U.a.Eaj,{});this.A4d();const Ac=Object(M.a)(new Fa,{ClientViewCapacity:oa.clientViewCapacity});let jd=null;vb&&(jd=Object(M.a)(new Ha,{FilterSheetMultiRange:this.Mbk(vb.filterSheetMultiRange)}));const Ud=ke=>{ke=$a.a.Lg(ke.data);f.ULS.sendTraceTag(537155481,0,50,`LineageManager::LineageOpenPaneOrChangeFilter service call failed. Errors: [${Ga.a.ue(ke)}]`)};
this.$.userOperationManager.enqueueOperation(new ua.a(1010,0,(ke,Pe,ze)=>{var Ue=this.$.qa.ua,hg=jd;ke=qb.b(ke,this.brd("LineageOpenPaneOrChangeFilter"));Pe=qb.a(Pe,Ud);const of=Ue.Pa(1,null);of.clientParams=Ac;of.lineageFilter=hg;return v.g(Ue,"LineageOpenPaneOrChangeFilter",of,ke,Pe,ze,null,0)},80),null)};this.lineageLoadMoreRequest=oa=>{yb.b(this.$).nf(U.a.Daj,{});const vb=Ac=>{Ac=$a.a.Lg(Ac.data);f.ULS.sendTraceTag(537155480,0,50,`LineageManager::LineageLoadMore service call failed. Errors: [${Ga.a.ue(Ac)}]`)};
this.$.userOperationManager.enqueueOperation(new ua.a(1011,0,(Ac,jd,Ud)=>{var ke=this.$.qa.ua;Ac=qb.b(Ac,this.brd("LineageLoadMore"));jd=qb.a(jd,vb);const Pe=ke.Pa(1,null);Pe.fetchFromBelow=oa;return v.g(ke,"LineageLoadMore",Pe,Ac,jd,Ud,null,0)},80),null)};this.lineageRefreshViewRequest=()=>{yb.b(this.$).nf(U.a.Gaj,{});const oa=vb=>{vb=$a.a.Lg(vb.data);f.ULS.sendTraceTag(537155479,0,50,`LineageManager::LineageRefreshView service call failed. Errors: [${Ga.a.ue(vb)}]`)};this.$.userOperationManager.enqueueOperation(new ua.a(1012,
0,(vb,Ac,jd)=>{var Ud=this.$.qa.ua;vb=qb.b(vb,this.brd("LineageRefreshView"));Ac=qb.a(Ac,oa);const ke=Ud.Pa(1,null);return v.g(Ud,"LineageRefreshView",ke,vb,Ac,jd,null,0)},80),null)};this.lineageUpdateViewRequest=()=>{ja(this.$.qa.ua,oa=>{if(oa=hb.a(oa)?null:oa.Result){var vb={["CountOfUpdatedActivities"]:oa.LineageActivitiesResponse.ActivityList.length};yb.b(this.$).nf(U.a.Haj,vb);oa=Object(M.a)(new Dd,{activityList:x.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager")?
Md(oa.LineageActivitiesResponse.ActivityList,this.eaa):this.cSd(oa.LineageActivitiesResponse.ActivityList),latestActivityId:oa.LineageActivitiesResponse.LastSearchedActivityId,oldestActivityId:oa.LineageActivitiesResponse.FirstSearchedActivityId,serverMessageCode:oa.LineageActivitiesResponse.LineageResponseCode,lastSearchedActivityTimestamp:new Date(oa.LineageActivitiesResponse.EcmaLastSearchedDate),hasNewActivities:oa.HasNewActivities,filterSheetMultiRange:this.Cbk(oa.LineageActivitiesResponse.FilterSheetMultiRange),
serverFirstActivityId:oa.LineageActivitiesResponse.ServerFirstActivityId,serverLastActivityId:oa.LineageActivitiesResponse.ServerLastActivityId,showLoadPrevious:oa.LineageActivitiesResponse.ShowLoadPrevious,eolCorrelationId:oa.LineageActivitiesResponse.EolCorrelationId,eolDateHideHistory:new Date(oa.LineageActivitiesResponse.EolDateHideHistory),eolPersonHideHistory:this.gEb(oa.LineageActivitiesResponse.EolPersonHideHistory)});this.fG.onLineageActivitiesUpdateResponse(oa)}else f.ULS.shipAssertTag(537155475,
0,!!oa,"LineageManager.LineageUpdateView returned null response.")},oa=>{oa=$a.a.Lg(oa.data);f.ULS.sendTraceTag(537155474,0,50,`LineageManager::LineageUpdateView service call failed. Errors: [${Ga.a.ue(oa)}]`)},null,null)};this.areInGridHighlightsAvailable=()=>ib.a.iHb(this.$)&&this.blueDotManager&&this.blueDotManager.areInGridHighlightsAvailable();this.areInGridHighlightsEnabled=()=>this.blueDotManager&&this.blueDotManager.areInGridHighlightsEnabled();this.hasAnyActiveInGridHighlight=()=>this.blueDotManager?
this.blueDotManager.hasAnyActiveInGridHighlight():!0;this.onDisplayInGridHighlightsChanged=oa=>{this.blueDotManager&&this.blueDotManager.sRj(oa)};this.onCardSelected=(oa,vb)=>{if(oa=oa.rangeHighlightLocation){if(vb){let Ac;if((()=>{let jd=za.ab(vb,x.EwaSettings.isChangeGateEnabled("OfficeVSO:7236999_passEwaSheetsInLineageManager")?this.$.va:null);({range:Ac}=jd);return jd})().returnValue){this.ynf(oa.sheetName,this.pEb([za.j(Ac)]));return}f.ULS.shipAssertTag(537155472,0,!1,"The produced subCellLocation string "+
vb+" is not valid.")}oa.rangeList.length?this.ynf(oa.sheetName,oa.rangeList):this.ksi(oa.sheetName)}};this.onLearnMoreLinkClicked=()=>{const oa=new Y.a(-859308420,W.a.Bd,this.$.se,12,null);this.$.Ha.Ad(oa,{[W.a.Th]:"HelpID=XLO_LineageTS",["InputMethod"]:W.a.Bd,[W.a.We]:Ub.a.xN,["ShouldCanvasTakeFocus"]:!0})};this.onVersionHistoryButtonClicked=oa=>{this.$.Ha.Ad(new Y.a(-1112508866,oa,this.$.se,12,null))};this.isFeatureEnabled=oa=>{switch(oa){case "FlattenListInLineageManager":return x.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager");
case "UseLineagePaneContainer":return x.EwaSettings.isChangeGateEnabled("OfficeVSO:7883958_UseLineagePaneContainer");default:return!1}};this.Nh=()=>{const oa=this.$.ea.pp.LineageVersion;oa!==this.Rpa&&(f.ULS.sendTraceTag(537155470,0,50,`LineageManager.OnWorkbookMetadataChanged: lineageVersion: ${oa}, this.lineageVersion: ${this.Rpa}`),this.Rpa=oa,this.fwj())};this.ff=(oa,vb)=>{this.fG&&!this.lineageTaskPane.uIb&&vb.nI&&(f.ULS.sendTraceTag(587220563,0,15,"LineageManager::SessionIdChanged detected."),
this.onStaleActivitiesDetected())};this.yp=()=>{this.fG&&!this.lineageTaskPane.uIb&&(f.ULS.sendTraceTag(587220562,0,15,"LineageManager::LoadOnDemandOccurred detected."),this.onStaleActivitiesDetected())};this.rG=()=>{const oa=this.w$a();this.fG.onFilterableSheetListChange(oa)};this.FDa=()=>{const oa=this.w$a();this.fG.onFilterableSheetListChange(oa)};this.Uyc=()=>{const oa=this.w$a();this.fG.onFilterableSheetListChange(oa)};this.onPaneClosed=()=>{this.fG.onPaneClosed();Ka(this.$.qa.ua,null,oa=>{oa=
$a.a.Lg(oa.data);f.ULS.sendTraceTag(537155469,0,50,`LineageManager::OnLineageClosePaneFailed service call failed. Errors: [${Ga.a.ue(oa)}]`)},null,null)};this.onRangeFilterInputEnabled=oa=>{oa?this.gridView.ha.XJ(this.uf):this.gridView.ha.QI(this.uf)};this.uf=()=>{var oa=za.q(this.gridView.ha.ra.activeRange,this.$);oa=Object(M.a)(new uc,{rangeList:this.pEb(oa.Ranges),sheetName:oa.SheetName});this.fG.onSelectedRangeUpdated(oa)};this.tryParseRangeInfo=oa=>{let vb,Ac;if((()=>{let Ud=za.ab(oa,this.$.va);
({sheetName:Ac,range:vb}=Ud);return Ud})().returnValue){Ac||(Ac=this.$.va.na.sheetName);var jd=[];jd.push(vb);jd=za.u(Ac,null,jd);return Object(M.a)(new uc,{rangeList:this.pEb(jd.Ranges),sheetName:jd.SheetName})}return null};this.vC=()=>{const oa=this.fH!==this.$.ea.xg;this.fG&&this.lineageTaskPane.isVisible&&oa&&(this.fH=this.$.ea.xg,this.fG.onRefreshRequired());this.blueDotManager&&this.blueDotManager.Fbb()&&this.blueDotManager.Faj(!this.lineageTaskPane.uIb)};this.$=Jb;yc.Qa(366,this);this.blueDotManager=
qe;this.gridView=Nb.h(this.$);this.lineageTaskPane=Id;this.RFd=this.lineageTaskPane.z7();this.batchSize=50;this.cba=Me;this.qVb=this.$.Sd.fi("UserAction","LineagePaneLoadingShimmerStopWatch");this.eaa=bc.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.Wwi();this.pVg()}dispose(){this.ozj();this.$=null;this.lineageTaskPane&&(this.lineageTaskPane.vaa(this.onPaneClosed),this.lineageTaskPane.RI(this.vC),this.lineageTaskPane=null);this.qVb=this.eaa=this.Q8a=this.RFd=this.fG=null}Ikg(Jb,
yc,Id,qe){this.activityGuid=null;if(this.lineageTaskPane.isVisible){if(9===Id){f.ULS.sendTraceTag(560989858,0,50,"LineageManager::ShowLineageTaskPane open from callout was invoked with an opened pane");return}if(!Jb&&16!==Id&&18!==Id&&30!==Id){this.lineageTaskPane.xbc();return}}ib.a.gg()||(this.qVb.start(),this.cba&&(Pb.b().uD(this.qVb.id,this.cba.id,"actions","actions"),this.cba.stop(),this.cba=null));this.lineageTaskPane.uIb||f.ULS.sendTraceTag(537155482,0,50,`LineageManager::ShowLineageTaskPane pane reopened by user via ${Jb?
yc:Id}`);this.fH=this.$.ea.xg;this.Q8a=null;Jb?(Jb=za.r(this.gridView.ha.ra.selectedRanges,this.$),this.Q8a=Object(M.a)(new uc,{rangeList:yc.toString()===Ub.a.Zjg?this.pEb(Jb.Ranges):null,sheetName:Jb.SheetName})):x.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")&&30===Id&&this.Fnj(qe);ib.a.gg()&&this.lineageTaskPane.uIb?this.lineageTaskPane.PRj(this.VNb):this.fG.createLineageTaskPane(this.RFd,this.Q8a,this.activityGuid);this.lineageTaskPane.Ik(!0);
this.$.Me(-71295319,-1,0,null)}Fnj(Jb){var yc;if(Jb){var Id=Jb.sheetRanges,qe=Jb.activityGuid;Jb=Jb.blueDotSheetRangeKey;Id&&qe?(null===(yc=this.blueDotManager)||void 0===yc?0:yc.DN())&&!Jb?f.ULS.shipAssertTag(508700375,0,!1,"LineageManager.prepareBlueDotNavigationAndFilterFromCommandProperties: blueDotSheetRangeKey is not set."):(this.blueDotManager&&(this.blueDotManager.DN()?this.blueDotManager.Hya(this.blueDotManager.TCb(Jb).a4c,2):this.blueDotManager.Hya([qe],2)),this.activityGuid=qe,this.Q8a=
this.d8h(Id)):f.ULS.shipAssertTag(509752709,0,!1,"Blue dot gridLocation/activityGuid is not set.")}else f.ULS.shipAssertTag(509752710,0,!1,"Blue dot unexpected undefined properties for command handling.")}lineageHidePreviousHistory(){const Jb={["paneVisible"]:this.lineageTaskPane.isVisible};jc.a.sendTelemetryEvent(Object(M.a)(new rc.a,{name:"Office.Excel.Online.Lineage.ClearHistoryConfirmed",dataFields:sc.a.$k(Jb)}));this.$.userOperationManager.enqueueOperation(new ua.a(1018,0,(yc,Id,qe)=>{var Me=
this.$.qa.ua;const oa=Me.Pa(1,null);return v.g(Me,"LineageHidePreviousHistory",oa,yc,Id,qe,null,0)},64),null);this.lineageTaskPane.isVisible||this.Ikg(!1,null,4,void 0)}Wwi(){const Jb=Object(M.a)(new Jd,{tryParseRangeInfo:this.tryParseRangeInfo,isFeatureEnabled:this.isFeatureEnabled,onCardSelected:this.onCardSelected,onVersionHistoryButtonClicked:this.onVersionHistoryButtonClicked,onRangeFilterInputEnabled:this.onRangeFilterInputEnabled,onLearnMoreLinkClicked:this.onLearnMoreLinkClicked,lineageOpenPaneOrChangeFilterRequest:this.lineageOpenPaneOrChangeFilterRequest,
lineageLoadMoreRequest:this.lineageLoadMoreRequest,lineageRefreshViewRequest:this.lineageRefreshViewRequest,lineageUpdateViewRequest:this.lineageUpdateViewRequest,areInGridHighlightsAvailable:this.areInGridHighlightsAvailable,areInGridHighlightsEnabled:this.areInGridHighlightsEnabled,hasAnyActiveInGridHighlight:this.hasAnyActiveInGridHighlight,onDisplayInGridHighlightsChanged:this.onDisplayInGridHighlightsChanged,shouldShowBlueDot:yc=>{var Id,qe;return null!==(qe=null===(Id=this.blueDotManager)||
void 0===Id?void 0:Id.shouldShowBlueDot(yc))&&void 0!==qe?qe:!1}});Za.a(()=>{this.fG=cellLineage.LineageActivityControllerFactoryGlobal.createLineageActivityController(Object(M.a)(new ce,{clientBatchSize:this.batchSize,filterableSheetList:this.w$a(),uiCulture:this.$.xa.UICultureTag,dataCulture:this.$.xa.DataCultureTag,logger:new S.a,lineageAppCallbacks:Jb}))})}d8h(Jb){var yc=null;const Id=this.$.va.na;for(const qe of Jb)qe.sheetId===Id.sheetId&&(Jb=za.j(qe.range),yc?(yc.FirstRow=Math.min(yc.FirstRow,
Jb.FirstRow),yc.FirstColumn=Math.min(yc.FirstColumn,Jb.FirstColumn),yc.LastRow=Math.max(yc.LastRow,Jb.LastRow),yc.LastColumn=Math.max(yc.LastColumn,Jb.LastColumn)):yc=Jb);yc=Object(M.a)(new ge,{firstCol:yc.FirstColumn,firstRow:yc.FirstRow,lastCol:yc.LastColumn,lastRow:yc.LastRow});return Object(M.a)(new uc,{rangeList:[yc],sheetName:Id.sheetName})}brd(Jb){return yc=>{if(yc=hb.a(yc)?null:yc.Result){var Id={["CountOfActivities"]:yc.ActivityList.length};Id.WebRequestName=Jb;yb.b(this.$).nf(U.a.a9i,Id);
yc=Object(M.a)(new $c,{activityList:x.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager")?Md(yc.ActivityList,this.eaa):this.cSd(yc.ActivityList),latestActivityId:yc.LastSearchedActivityId,oldestActivityId:yc.FirstSearchedActivityId,serverMessageCode:yc.LineageResponseCode,lastSearchedActivityTimestamp:new Date(yc.EcmaLastSearchedDate),serverFirstActivityId:yc.ServerFirstActivityId,serverLastActivityId:yc.ServerLastActivityId,showLoadPrevious:yc.ShowLoadPrevious,
eolCorrelationId:yc.EolCorrelationId,eolDateHideHistory:new Date(yc.EolDateHideHistory),eolPersonHideHistory:this.gEb(yc.EolPersonHideHistory)});this.fG.onLineageActivitiesResponse(yc)}else f.ULS.shipAssertTag(537155477,0,!!yc,"LineageManager."+Jb+" returned null response.")}}Cbk(Jb){return Va.e(Jb.Ranges)&&!Jb.SheetName?null:Object(M.a)(new uc,{rangeList:this.pEb(Jb.Ranges),sheetName:Jb.SheetName})}pEb(Jb){const yc=[];for(const Id of Jb)Jb=Object(M.a)(new ge,{firstCol:Id.FirstColumn,firstRow:Id.FirstRow,
lastRow:Id.LastRow,lastCol:Id.LastColumn}),yc.push(Jb);return yc}Mbk(Jb){if(!Jb)return null;const yc={};yc.Ranges=this.gsd(Jb.rangeList);yc.SheetName=Jb.sheetName;return yc}gsd(Jb){const yc=[];if(Va.e(Jb))return yc;for(const Id of Jb)Jb={},Jb.FirstColumn=Id.firstCol,Jb.FirstRow=Id.firstRow,Jb.LastRow=Id.lastRow,Jb.LastColumn=Id.lastCol,yc.push(Jb);return yc}ksi(Jb){(Jb=this.$.va.getItemByName(Jb))&&Jb.visible&&Jb.activate({disableAutoFocusOnGrid:!0,scenario:"lineage"})}ynf(Jb,yc){const Id=[];for(var qe of yc)yc=
{},yc.FirstColumn=qe.firstCol,yc.FirstRow=qe.firstRow,yc.LastRow=qe.lastRow,yc.LastColumn=qe.lastCol,Id.push(za.E(yc));qe=Id.length-1;yc=Id[qe].topLeft;Nb.h(this.$).A2(Id,qe,Jb,null,yc,null,null,3,"LineageManager.OnCardSelected",void 0,void 0,void 0,!0)}fwj(){this.fG&&this.lineageTaskPane.isVisible&&(this.fH=this.$.ea.xg,this.fG.onRefreshRequired())}pVg(){var Jb;this.lineageTaskPane.H6(this.onPaneClosed);this.lineageTaskPane.kH(this.vC);this.$.ea.Mw(this.Nh);this.$.ea.Zl(this.ff);this.$.ea.BM(this.yp);
const yc=this.$.va;yc.R0(this.rG);yc.cla(this.Uyc);yc.WKa(this.FDa);yc.H3a(this.Uyc);null===(Jb=this.blueDotManager)||void 0===Jb?void 0:Jb.V0g(this.onBlueDotsUpdated)}ozj(){var Jb;this.$.ea.ny(this.Nh);this.gridView.ha.QI(this.uf);this.$.ea.gm(this.ff);this.$.ea.rR(this.yp);const yc=this.$.va;yc.uaa(this.rG);yc.Lra(this.Uyc);yc.AWa(this.FDa);yc.BRb(this.Uyc);null===(Jb=this.blueDotManager)||void 0===Jb?void 0:Jb.pDj(this.onBlueDotsUpdated)}onStaleActivitiesDetected(){this.fG.onStaleActivitiesDetected()}w$a(){const Jb=
this.$.va.items,yc=[];for(const Id of Jb)Id.visible&&!Na.e(Id)&&yc.push(Id.sheetName);return yc}A4d(){var Jb=this.$.ga.Da(403);Jb&&Jb.disable();Jb=new Y.a(-847286761,W.a.Bd,this.$.se,0,Ub.a.d4);this.$.Ha.Ad(Jb,{["InputMethod"]:W.a.Bd,CalloutName:5})}cSd(Jb){const yc=[];for(const Id of Jb)Jb=Object(M.a)(new dd,{activityId:Number.parseLocale(Id.UserActivity.Id),activityGuid:Id.Uid,activityType:Id.UserActivity.Type,author:this.gEb(Id.UserActivity.Person),sheetName:Id.SheetName,displayTimestamp:new Date(Id.UserActivity.DisplayTimestamp),
gridLocation:Id.DisplayLocation,valueChanges:this.Opj(Id.LineageValueChangeList),isBulkEditOverflow:Id.IsBulkEditOverFlow,rangeHighlightLocation:this.Apj(Id.UserActivity.LocationList,Id.UserActivity.Type),nestedActivityList:this.tpj(Id.NestedActivityList),degradedCardTypeBits:Id.DegradedCardTypeBits}),yc.push(Jb);return yc}Apj(Jb,yc){if(!Jb)return f.ULS.sendTraceTag(537155468,0,15,"LineageManager:: RangeHighlightLocation.ActivityLocationList is null"),null;if(!Jb.length)return f.ULS.sendTraceTag(537155467,
0,50,"LineageManager:: RangeHighlightLocation.ActivityLocationList is empty"),null;const Id=[];var qe=[];let Me="";21===yc?qe.push(Jb[0]):qe=Jb;for(const oa of qe)switch(oa.Type){case 1:break;case 2:Me=oa.SheetName;break;case 0:Jb=oa;if(!Jb.RangeList){f.ULS.sendTraceTag(537155465,0,50,"LineageManager:: RangeHighlightLocation.RangeActivityLocation is null");break}Me=Jb.RangeList[0].SheetName;qe=[];21===yc?qe.push(Jb.RangeList[0]):qe=Jb.RangeList;for(const vb of qe)Jb=Object(M.a)(new ge,{firstCol:vb.FirstColumn,
firstRow:vb.FirstRow,lastRow:vb.LastRow,lastCol:vb.LastColumn}),Id.push(Jb);break;default:f.ULS.sendTraceTag(537155464,0,50,"LineageManager:: RangeHighlightLocation.ActivityLocationList is of type: ")}return Object(M.a)(new uc,{sheetName:Me,rangeList:Id})}Opj(Jb){const yc=[];for(const Id of Jb)Jb=Object(M.a)(new Rd,{hasNewValue:Id.HasNewValue,hasOldValue:Id.HasOldValue,newValue:Id.HasNewValue?Id.NewValue:null,oldValue:Id.HasOldValue?Id.OldValue:null,cellLocation:Id.CellLocation}),yc.push(Jb);return yc}tpj(Jb){return Jb?
this.cSd(Jb):null}gEb(Jb){if(!Jb)return null;let yc=null;k.AFrameworkApplication.da.pa("IsUserProfilePictureResolutionEnabled")&&(yc=this.eaa.zma(Jb.Email,Jb.Provider,k.AFrameworkApplication.Ak,0));return Object(M.a)(new Kd,{id:Jb.Id,provider:Jb.Provider,displayName:Jb.DisplayName,email:Jb.Email,imageUrl:yc})}}Object(h.a)(Mb,"LineageManager",null,[804,5]);class Aa extends d.a{constructor(Jb){super();this.cba=this.lineageTaskPane=null;this.$=Jb;this.je()}KBf(Jb,yc){J.TaskExtensions.za(Jb,()=>{this.Ld(this.$.ga.Da(366)||
new Mb(this.$,this.$.ga,this.lineageTaskPane,yc,this.cba))},this.$.ka,3)}create(){this.cba=this.$.Sd.Ze("UserAction","LineagePaneSeenStopwatch");this.cba.start();const Jb=E.GetServiceTaskFactory.ud(this.$.ga,365,364,this.Ta),yc=Ta.a(this.$);let Id=ra.d(ba.a.resolve(na.T,{Ja:this.Ta}));if(x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)){const qe=E.GetServiceTaskFactory.ud(this.$.ga,501,500,0);J.TaskExtensions.za(J.TaskExtensions.Wf([Jb,yc,Id,qe],this.$.ka),()=>{this.lineageTaskPane=
Jb.result;ib.a.gg()||yc.result.h9(this.lineageTaskPane);this.KBf(ra.d(Id.result.zv.loadScript("cellLineage")),qe.result)},this.$.ka,3)}else J.TaskExtensions.za(J.TaskExtensions.Wf([Jb,yc,Id],this.$.ka),()=>{this.lineageTaskPane=Jb.result;ib.a.gg()||yc.result.h9(this.lineageTaskPane);this.KBf(ra.d(Id.result.zv.loadScript("cellLineage")),null)},this.$.ka,3)}static la(Jb){Jb.ga.Qa(367,new Aa(Jb))}}Object(h.a)(Aa,"LineageManagerFactory",d.a,[]);var Bc=a(926),Vc=a(234),hc=a(13),xc=a(117),ab=a(277),Wb=
a(92),Yc=a(249),Tc=a(18),ed=a(754);const be=Ub.a.Apg+"LineageActivityPaneTitle",Fc=Ub.a.hKc+"LineageActivityCloseButton";class vd extends Yc.a{constructor(Jb,yc,Id){super(Jb);this.VNb=this.uOe=this.Jh=null;this.LBd=!0;this.rB=0;this.LG=!1;this.De=(qe,Me)=>{Me.ni||this.xbc()};this.xp=()=>{this.xbc();return!0};this.$=yc;this.taskPaneManager=Id;this.$.gk(this.De);Ua.a(this.$).vk(this);ib.a.gg()&&(this.isVisible=!1)}I6(Jb){this.get_events().addHandler("LineageTaskPaneRemove",Jb)}waa(Jb){this.get_events().removeHandler("LineageTaskPaneRemove",
Jb)}kH(Jb){this.addHandler("LineageTaskPaneVisibilityChanged",Jb)}RI(Jb){this.removeHandler("LineageTaskPaneVisibilityChanged",Jb)}H6(Jb){this.get_events().addHandler("LineageTaskPaneClose",Jb)}vaa(Jb){this.get_events().removeHandler("LineageTaskPaneClose",Jb)}get isVisible(){return super.isVisible}set isVisible(Jb){super.isVisible!==Jb&&(super.isVisible=Jb,this.raiseEvent("LineageTaskPaneVisibilityChanged"))}get uIb(){return this.LBd}get zi(){return this.isVisible}get Bl(){return 15}get jg(){return ka.a.QPi}get Bn(){return Tc.a.TOh}get J2(){return vc.a.instance.ia(1077)}get lw(){return 300}get isResizable(){return!1}get Ce(){return this.domElement}get height(){return this.taskPaneManager.s_.offsetHeight}get titleText(){return vc.a.instance.ia(1294)}get DG(){return this.taskPaneManager.sPa(this.Ce,
this.titleText,this.lw,this.isResizable,()=>{this.isVisible=!0;this.VNb?this.VNb():f.ULS.shipAssertTag(537155462,0,!1,"OnLineagePaneOpened callback not set.")},()=>{this.isVisible=!1;this.xbc()},()=>{this.isVisible=!0},()=>{this.isVisible=!1},this.lw)}$u(){return this.LG}ey(){return this.LG}M$(){}V8(){return!1}Ll(){}lm(){}dispose(){this.$&&(this.$.Hn(this.De),Ua.a(this.$).gB(this));this.Jh&&(Vc.a.instance.Aa(hc.a.click,this.Jh,this.xp),xc.KeyInputManager.instance.uB(this.Jh,this.uOe));this.Jh=this.taskPaneManager=
this.$=null;super.dispose()}Pi(Jb,yc){if(!yc){Jb=nb.DOMElementExtensions.getElementById(this.domElement,"LineagePaneFilterButton");if(!Jb)return!1;nb.DOMElementExtensions.setFocus(Jb)}return!yc}Nj(Jb){return nb.DOMElementExtensions.mi(this.Ce,Jb)}Ik(Jb){this.LG=Jb;const yc=this.taskPaneManager;if(this.isVisible=Jb)this.$.frame.ii.Pm("LineagePane"),this.LBd=!1;if(ib.a.gg())Jb?yc.Wga("LineageTaskPane",this.DG):yc.hideTaskPane("LineageTaskPane");else{this.taskPaneManager.IO();const Id=!!this.taskPaneManager.Hl&&
15===this.taskPaneManager.Hl.taskPane.Bl;Jb&&0<yc.HV.length&&(!Id||yc.isCollapsed)&&yc.uV(this,!0)}this.$.Qh()}z7(){var Jb=this.$.Pd;Jb=ib.a.gg()?this.domElement:document.getElementById(Jb+Ub.a.WFd);if(!ib.a.gg()||!x.EwaSettings.isChangeGateEnabled("OfficeVSO:7858326_TaskPaneReactHeader")){var yc=this.yX();Jb.appendChild(yc)}yc=ed.b("div","LineagePaneBodyId","LineageActivityBody");Jb.appendChild(yc);this.QRj();return yc}xbc(){this.$.frame.ii.Pm(this.$.frame.ii.LX||ab.AFrame.K6);this.LBd=!0;this.Ik(!1);
this.raiseEvent("LineageTaskPaneClose")}PRj(Jb){this.VNb=Jb}QRj(){this.$.frame.ii.hq("LineagePane");const Jb=this.$.frame.ii.am("LineagePane");Jb.parent=ab.AFrame.K6;Jb.FU=!0}yX(){const Jb=ed.b("div","LineagePaneHeaderId","LineageActivityPaneHeader"),yc=ed.b("h1","LineagePaneTitleId",be);yc.innerText=this.titleText;this.Jh=Bc.a.od("LineagePaneCloseButtonId",Fc,vc.a.instance.ia(10),"ClosePaneGlyph_16x16x32",!1);this.Jh.classList.add(k.AFrameworkApplication.isRtl?Ub.a.vza:Ub.a.wza);Vc.a.instance.ta(hc.a.click,
this.Jh,this.xp);this.uOe=xc.KeyInputManager.instance.zx(this.Jh,this.xp,Wb.a.xk);Jb.appendChild(yc);Jb.appendChild(this.Jh);return Jb}static la(Jb,yc){const Id=Jb.Pd;let qe=document.getElementById(Id+Ub.a.WFd);qe||(qe=document.createElement("div"),qe.id=Jb.Pd+Ub.a.WFd,qe.classList.add("LineageActivityPane"),ib.a.gg()||document.getElementById(Id+Ub.a.t$).appendChild(qe));return Jb.ga.Da(365)||Jb.ga.Qa(365,new vd(qe,Jb,yc))}}Object(h.a)(vd,"LineageTaskPane",Yc.a,[802,5,394,56]);class lb extends d.a{constructor(Jb){super();
this.Sk=this.qn=null;this.$=Jb;this.je()}get fR(){this.qn||(this.qn=J.TaskExtensions.za(Ta.a(this.$),Jb=>{this.Sk=vd.la(this.$,Jb.result)},this.ka,3));return this.qn}create(){const Jb=E.GetServiceTaskFactory.create(this.$.ga,203,this.ka,this.Ta),yc=x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigrateCommonUiStrings",!1)?Object(ra.d)(ba.a.resolve(na.z,{Ja:this.Ta})):E.GetServiceTaskFactory.create(this.$.ga,155,this.ka,this.Ta);J.TaskExtensions.za(J.TaskExtensions.ts(J.TaskExtensions.Wf([Jb,
yc],this.ka),()=>this.fR,this.ka),()=>{this.Ld(this.Sk)},this.ka,3)}dispose(){this.Sk=this.qn=this.$=null;super.dispose()}static la(Jb){Jb.ga.Qa(364,new lb(Jb))}}Object(h.a)(lb,"LineageTaskPaneFactory",d.a,[]);var Eb=a(929),Hc=a(85);class Bd{constructor(Jb,yc){this.Qi=Jb;this.Mx=yc}d_(Jb,yc,Id,qe){return this.aCh(Jb,void 0===qe?null:qe,Me=>this.Qi.Pwa(Me,2,Id,yc,void 0,void 0,void 0,void 0,void 0,"2"))}aCh(Jb,yc,Id){const qe=!!yc&&""!==yc;let Me=Jb;qe&&(Me=B.a.cda(Jb,"perfTag",yc));const oa=new Date;
return Eb.a.then(Id(Me),vb=>{const Ac=+new Date-+oa;if(!vb||!vb.qh||!vb.qh.data)return vb;qe&&vb.qh.data.request&&this.tNj(vb.qh.data.request.getResolvedUrl(),yc,Ac);return vb})}tNj(Jb,yc,Id){Jb=this.Mx.Afi(Jb);if(Jb.count&&(Jb=Hc.last(Jb))){const qe={Message:"Request durations for activities calls."};qe.PerfTag=yc;qe.CustomDuration=Id;qe.PerformanceDuration=Jb.duration;f.ULS.sendTraceTag(592189641,3012,50,JSON.stringify(qe))}}}Object(h.a)(Bd,"CatchUpNetworkingWrapper",null,[866]);var he=a(256);class je extends he.a{constructor(Jb,
yc){super(Jb,yc)}Wea(){return 6}}Object(h.a)(je,"GetActivityFeedRequest",he.a,[]);class Fd extends he.a{constructor(Jb,yc,Id,qe,Me,oa){super(Jb,yc);this.ItemIds=null;this.ActivityStatesToReset=this.ActivityStatesToSet=0;this.ResetUnseenCount=!1;this.ItemIds=Id;this.ActivityStatesToSet=qe;this.ActivityStatesToReset=Me;this.ResetUnseenCount=oa}Wea(){return 7}}Object(h.a)(Fd,"UpdateActivityFeedStateRequest",he.a,[]);var Oc=a(217),Ad=a(395);class Gb{constructor(Jb,yc,Id){this.lqe=Jb;this.GHa=yc;this.WHa=
Id}getActivityFeed(Jb){return Eb.a.then(this.WHa.execute(new je(this.GHa(),null),(yc,Id,qe)=>this.lqe.d_(yc,Id,qe,"ActivityFeed"),Jb),yc=>{if(!yc)return f.ULS.sendTraceTag(572846937,3012,10,"GetActivityFeed: Response is null"),null;if(!yc.qh)return f.ULS.sendTraceTag(572846938,3012,10,"GetActivityFeed: Response.Args is null"),null;yc=yc.qh.data;if(!yc)return f.ULS.sendTraceTag(572846939,3012,10,"GetActivityFeed: Response.Args.Data is null"),null;if(yc.httpStatus!==Oc.a.PE)return f.ULS.sendTraceTag(508929507,
3012,10,"GetActivityFeed: Response status code {0}",yc.httpStatus),null;if(!yc.Tf)return f.ULS.sendTraceTag(572846940,3012,10,"GetActivityFeed: Response.Args.Data.ResponseData is null"),null;yc=Ad.a.MNa(yc.Tf);return yc?yc:(f.ULS.sendTraceTag(572846941,3012,10,"GetActivityFeed: Deserialized response is null"),null)})}qgk(Jb,yc,Id,qe){return Eb.a.then(this.WHa.execute(new Fd(this.GHa(),null,Jb,yc,Id,qe),(Me,oa,vb)=>this.lqe.d_(Me,oa,vb,"UpdateActivityFeedState"),null),Me=>{try{return Me.succeeded}catch(oa){return f.ULS.sendTraceTag(523121054,
3012,10,"UpdateActivityFeed: Exception {0}",oa.message),!1}})}}Object(h.a)(Gb,"CatchUpRequestHandler",null,[865]);var Wc=a(592);class pd{constructor(Jb){this.yka=Jb;this.Xoe=new Wc.a}HRi(){this.ySi()}ySi(){if(this.yka){var Jb=yc=>{this.Xoe.contains("CatchUpChangesFeedback")||(this.Xoe.add("CatchUpChangesFeedback"),yc.logActivity("CatchUpChangesFeedback",null))};this.yka.execute(yc=>{window.setTimeout(()=>{Jb(yc)},2E4)})}else f.ULS.sendTraceTag(571586199,383,15,"FloodgateEventLogger: IFuture<ISystemInitiatedFeedback> was null")}}
Object(h.a)(pd,"FloodgateEventLogger",null,[]);var fe=a(198);class le{constructor(Jb){this.fOg=Jb}get duration(){return this.fOg.duration}}Object(h.a)(le,"PerformanceResourceTimingWrapper",null,[]);class te{constructor(Jb){this.Mx=Jb}Afi(Jb){const yc=new fe.a;if(!this.Mx)return yc;Jb=this.Mx.getEntriesByName(Jb,"resource");if(!Jb)return yc;for(const Id of Jb)yc.add(new le(Id));return yc}}Object(h.a)(te,"PerformanceWrapper",null,[]);var Ce=a(261);class Xb{constructor(){this.hd=null}get name(){return"Common.App.CatchUpActivity"}Xj(Jb){this.hd=
Jb;this.hd.register(Bd,"Common.App.CatchUpActivity.CatchUpNetworkingWrapper").as("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper").Ee().Le(()=>new Bd(k.AFrameworkApplication.tf,new te(window.performance)));this.hd.register(Gb,"Common.App.CatchUpActivity.CatchUpRequestHandler").as("Common.App.CatchUpActivity.ICatchUpRequestHandler").Ee().Le(()=>new Gb(this.hd.resolve("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper"),()=>k.AFrameworkApplication.Ak,new Ad.a));this.hd.register(pd,"Common.App.CatchUpActivity.FloodgateEventLogger").Ee().Le(()=>
new pd(this.hd.Qd("Common.ISystemInitiatedFeedback")))}init(){this.hd.resolve("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper");this.hd.resolve("Common.App.CatchUpActivity.ICatchUpRequestHandler")}dispose(){}static main(){Ce.a.instance.Tk(new Xb)}}Object(h.a)(Xb,"CatchUpActivityPackage",null,[2,3]);var oc=a(731),Zc=a(484);let yd=class{constructor(Jb,yc){this.$=Jb;this.catchUpActivityManager=yc}Pe(Jb,yc){return this.catchUpActivityManager?-876699925===yc?!this.catchUpActivityManager.Wrf:!1:!0}executeCommand(Jb,
yc,Id){Jb=!1;switch(yc.command){case -876699925:Jb=this.catchUpActivityManager.Ufj();break;case 950288339:return this.catchUpActivityManager.Fbb()?(yc=Id.LineageTaskPaneVisible,void 0!==yc?this.catchUpActivityManager.Fik(yc):this.catchUpActivityManager.showHideInGridHighlights()):this.catchUpActivityManager.showHideInGridHighlights(),X.Task.Wa(!0)}return Jb?X.Task.Wa(!0):I.a(yc.command)}Be(Jb,yc){return x.EwaSettings.Ea(382)?-876699925===yc.command||950288339===yc.command:!1}Ue(){return!1}};yd=Object(oc.a)([Object(ba.d)(na.q),
Object(oc.b)(0,Object(na.W)()),Object(oc.b)(1,Object(Zc.CatchUpActivityManagerService)())],yd);Object(h.a)(yd,"CatchUpActivityCommandHandler",null,[203]);class Od extends G.a{constructor(Jb){super(Jb)}Uf(){this.$.ga.qd(286,Jb=>{this.Lf([new yd(this.$,Jb)])})}static la(Jb){G.a.qg(285,new Od(Jb))}}Object(h.a)(Od,"CatchUpActivityCommandHandlerFactory",G.a,[]);var dc=a(237),gd=a(528),wd=a(96),Ld=a(138),Xd=a(27);class Ie{constructor(Jb){this.nl=Jb}doesContentExist(Jb){if(!Jb)return f.ULS.sendTraceTag(537168066,
3012,10,"Null activity: DoesContentExist. Default to false."),!1;switch(Jb.type){case 2:case 3:case 4:case 6:case 8:case 9:case 7:case 10:if(!Jb.navigationId)return f.ULS.sendTraceTag(537168065,3012,10,"Null activity.NavigationId: DoesContentExist. Default to false."),!1;const yc={};yc.NavigationId=atob(Jb.navigationId);return 32===this.nl.eg(Xd.a.XNa,2,yc);default:return!1}}}Object(h.a)(Ie,"CatchUpActivityContentManager",null,[806]);var We=a(871),jf=a(1192);class tc{constructor(Jb){this.QNb=()=>
{switch(this.hu.model.state){case 1:this.Vkg(!0);break;case 0:this.AVb(!1);break;case 2:case 3:this.AVb(!0);break;default:f.ULS.shipAssertTag(537167968,0,!1,"RangeCatchUpActivityView.OnHighlightStateChanged - Invalid CatchUpActivityHighlightState:"+this.hu.model.state)}};this.pKg=Jb;this.hu.DBe(this.QNb);this.JA=[]}get hu(){return this.pKg}dispose(){this.hu.y6f(this.QNb);this.JA=null}iRj(Jb){this.JA.push(Jb)}yhh(){this.JA.length=0}Vkg(Jb){for(const yc of this.JA){yc.className=We.a.teh;const Id=document.getElementById(`${yc.id}-${Ub.a.aMe}`);
nb.DOMElementExtensions.setVisible(Id,Jb)}}AVb(Jb){for(const yc of this.JA)yc&&(Jb?yc.className=2===this.hu.model.state?We.a.Qsj:We.a.Rsj:this.Vkg(!1))}}Object(h.a)(tc,"RangeCatchUpActivityView",null,[851,5]);var Qc=a(22);class xd extends jf.a{constructor(Jb,yc,Id){super(Jb,yc,Id);this.gridView=Nb.h(Jb);this.xra=yc}dispose(){this.gridView=null;super.dispose()}rBe(Jb){const yc=this.Imb[0];yc?yc.iRj(Jb):f.ULS.shipAssertTag(537168004,0,!1,"RangeCatchUpActivityHighlightController.AddViewElement - RangeCatchUpActivityView is null for activityId"+
this.xra.activityId)}FGj(){const Jb=this.Imb[0];Jb&&Jb.yhh()}cWg(Jb){this.xra.addRange(Jb)}O4h(){if(3!==this.xra.activityType)return null;f.ULS.shipAssertTag(537168003,0,1===this.xra.YVb.length,"RangeCatchUpActivityHighlightController::GetCommentActivityRange Range Information Length should be 1.");return za.E(this.xra.YVb[0])}ZZd(Jb){if(Jb){if(!this.xra)return;this.aKd(this.LHj())}super.ZZd(Jb)}kfd(){const Jb=this.Ked();this.Imb.push(Jb)}Ked(){return new tc(this)}aKd(Jb){Jb?Jb.SheetName?(this.gridView.ha.Va.oK(null),
this.gridView.focus(),this.gridView.Vjf(Jb,3,!1,"RangeCatchUpActivityHighlightController.NavigateToRange")):f.ULS.shipAssertTag(537168E3,0,!1,"RangeCatchUpActivityHighlightController.NavigateToRange: SheetName in the range is null."):f.ULS.shipAssertTag(537168001,0,!1,"RangeCatchUpActivityHighlightController.NavigateToRange: Range is null. Either the location list is empty or sheet is hidden.")}LHj(){if(Va.e(this.xra.YVb))return f.ULS.shipAssertTag(537167971,0,!1,"RangeCatchUpActivityHighlightController.RetrieveRangeInformationForNavigation : SortedRanges is either null or empty."),
null;var Jb=this.$.va.na;f.ULS.shipAssertTag(537167970,0,!!Jb,"RangeCatchUpActivityHighlightController.RetrieveRangeInformationForNavigation : currentSheet is null.");Jb=this.bdk(Jb.sheetName,this.xra.YVb);if(!Jb&&(Jb=this.uki(this.xra.YVb),!Jb))return null;const yc={};yc.SheetName=Jb.SheetName;yc.FirstColumn=Jb.FirstColumn;yc.FirstRow=Jb.FirstRow;yc.LastColumn=Jb.FirstColumn;yc.LastRow=Jb.FirstRow;return yc}uki(Jb){if(Va.e(Jb))return null;let yc=null;for(let qe=0;qe<Jb.length;qe++){var Id=Jb[qe].SheetName;
if(!Qc.a.equals(Id,yc,!1)&&(yc=Id,Id=this.$.va.getItemByName(Id),null===Id||void 0===Id?0:Id.visible))return Jb[qe]}return null}bdk(Jb,yc){if(yc)for(const Id of yc)if(Qc.a.equals(Id.SheetName,Jb,!1))return Id;return null}}Object(h.a)(xd,"RangeCatchUpActivityHighlightController",jf.a,[]);var Gd=a(83);class pe extends Gd.a{constructor(Jb,yc,Id,qe,Me,oa,vb){super();this.$=Jb;this.lee=yc;this.hPc=Id;this.RJ=qe;this.qQc=vb;x.EwaSettings.isChangeGateEnabled("OfficeVSO:7809002_CatchUpActivityHoverStateFix")&&
Me&&oa?this.state=2:this.state=Me?1:0}get type(){return this.RJ}get activityId(){return this.lee}get activityType(){return this.hPc}get w8g(){return this.qQc}dispose(){this.lee=null;super.dispose()}mpc(Jb){return this.qQc.sheetId===Jb.sheetId&&this.qQc.range.bottomLeft.equals(Jb.range.bottomLeft)}}Object(h.a)(pe,"CatchUpActivityHighlightModelBase",Gd.a,[]);class Dc extends pe{constructor(Jb,yc,Id,qe,Me,oa,vb,Ac){super(Jb,yc,Id,qe,oa,vb,Ac);this.ranges=Me;this.Gcb=!1}get YVb(){this.Gcb||(this.ranges.sort(Dc.Qbc),
this.Gcb=!0);return this.ranges}addRange(Jb){for(const yc of Jb)this.ranges.push(yc)}dispose(){this.ranges=null;super.dispose()}static Qbc(Jb,yc){if(!Jb.SheetName||!yc.SheetName)return f.ULS.shipAssertTag(537167969,0,!1,"RangeCatchUpActivityHighlightModel.CompareSharedSheetRange : SheetName is null."),0;const Id=Jb.SheetName.localeCompare(yc.SheetName);return Id?Id:Jb.FirstColumn<yc.FirstColumn||Jb.FirstColumn===yc.FirstColumn&&Jb.FirstRow<yc.FirstRow?-1:Jb.FirstColumn===yc.FirstColumn&&Jb.FirstRow===
yc.FirstRow?0:1}}Object(h.a)(Dc,"RangeCatchUpActivityHighlightModel",pe,[]);var Wa=a(356);class Qb{constructor(){this.DN=!1;this.t6a=[];this.iia={};this.b4c={};this.Apc=x.EwaSettings.isChangeGateEnabled("OfficeVSO:7795308_EnableCatchupHighlightLogging")}dispose(){this.b4c=this.iia=this.t6a=null}F7f(Jb,yc){yc?Nb.h(Jb).Kd.Jt([24]):Nb.h(Jb).Kd.cm([24]);this.Apc&&f.ULS.sendTraceTag(508933385,0,50,`CatchUpHighlightControllersCreator:renderAllCatchUpRangeHighlights with setVisible=${yc}.`)}n5f(Jb){this.qed(Jb,
[new Wa.a(null,null)],this.iia,!1);this.Apc&&f.ULS.sendTraceTag(508933384,0,50,"In CatchUpHighlightControllersCreator:removeAllCatchUpRangeHighlights().")}Cph(Jb,yc,Id,qe){var Me;const oa={};for(const Ac of yc){if(!Ac||Va.e(Ac.LocationList))continue;yc=[];const jd={},Ud=[];for(const ke of Ac.LocationList){if(!ke){f.ULS.shipAssertTag(537168013,0,!1,"CatchUpActivityHighlightManagerHelper.CreateControllersAndHighlights - Location is Null for activityId : "+Ac.Id);break}switch(ke.Type){case 0:var vb=
ke;let Pe;"0"in jd?(Pe=jd["0"],Pe.cWg(vb.RangeList)):(Pe=new xd(Jb,new Dc(Jb,Ac.Id,Ac.Type,0,vb.RangeList,qe,Id.FFi(Ac.Id),null),Id),yc.push(Pe),jd["0"]=Pe);for(const ze of vb.RangeList){vb=new Wa.a(za.E(ze),Na.d(Jb.va.getItemByName(ze.SheetName)));if(this.OUb(vb)in this.iia)this.iia[this.OUb(vb)].push(Pe);else{let Ue=[];Ue.push(Pe);this.iia[this.OUb(vb)]=Ue}Ud.push(vb);this.t6a.push(vb)}break;default:f.ULS.sendTraceTag(537168012,0,10,"CatchUpHighlightControllersCreator.CreateControllersAndHighlights(): Failed.Invalid ActivityLocationType")}}f.ULS.shipAssertTag(537168011,
0,!(Ac.Id in oa),"CatchUpHighlightControllersCreator.CreateAndUpdateControllers - highlightControllers already has activity: "+Ac.Id);this.b4c[Ac.Id]=Ud;oa[Ac.Id]=yc}this.qed(Jb,this.t6a,this.iia,qe);this.Apc&&f.ULS.sendTraceTag(508933383,0,50,`CatchUpHighlightControllersCreator:createControllersAndHighlights, length of completeSheetRangeList is ${null===(Me=this.t6a)||void 0===Me?void 0:Me.length}.`);return oa}zEb(Jb){return this.b4c[Jb]}CSe(Jb,yc,Id,qe){this.DN=!0;const Me={},oa=new Map;for(let jd in yc){var vb=
yc[jd],Ac=[];const Ud=new xd(Jb,new Dc(Jb,vb.blueDotSheetRangeKey,vb.activityType,0,vb.o2d,qe,!1,vb.v8g),Id);Ac.push(Ud);Me[vb.blueDotSheetRangeKey]=Ac;for(const ke of vb.o2d){vb=new Wa.a(za.E(ke),Na.d(Jb.va.getItemByName(ke.SheetName)));Ac=this.OUb(vb);if(Ac in this.iia)this.iia[Ac].push(Ud);else{let Pe=[];Pe.push(Ud);this.iia[Ac]=Pe}oa.set(Ac,vb)}}this.t6a=Array.from(oa.values());this.qed(Jb,this.t6a,this.iia,qe);return Me}rhh(Jb){for(let yc in Jb){const Id=Jb[yc];for(const qe of Id)qe.FGj()}}OUb(Jb){return`${Jb.range}-${Jb.sheetId}`}qed(Jb,
yc,Id,qe){this.rhh(Id);Nb.h(Jb).Kd.QC(yc,[24],qe,(Me,oa)=>{if(null==Me.range){for(var vb of Me.$0)vb.dispose();Me.$0=[]}else{vb=new Wa.a(Me.range,Me.sheetId);var Ac=this.OUb(vb),jd=Id[Ac];if(jd)if(this.DN){Me.metadata=null;for(const Ud of jd)Ud.rBe(oa),Ud.mpc(vb)&&(Me.metadata=Ud)}else for(const Ud of jd)Ud.rBe(oa),Me.metadata=Ud;else f.ULS.shipAssertTag(537168010,0,!1,"CatchUpHighlightControllersCreator.CreateHighlightsAndUpdateControllers(), Missing Controller for SheetRangeKey "+Ac)}})}}Object(h.a)(Qb,
"CatchUpHighlightControllersCreator",null,[]);class Lc{constructor(){this.activityIds=this.container=this.target=null;this.isSticky=!1;this.dirHint=0;this.blueDotSheetRangeKey=this.onHoverLeave=this.onHoverEnter=this.activityNavigationManager=null}}Object(h.a)(Lc,"CreateIndicatorTooltipParameters",null,[]);class Ba{constructor(){this.clearSticky=!1}}Object(h.a)(Ba,"DismissIndicatorTooltipParameters",null,[]);class qa{constructor(){this.target=null;this.isSticky=!1}}Object(h.a)(qa,"UpdateIndicatorTooltipParameters",
null,[]);class gb{constructor(Jb,yc,Id,qe,Me){this.DN=!1;this.$=Jb;this.nl=yc;this.DN=void 0===Id?!1:Id;this.zEb=qe;this.Hsd=Me}navigateToActivity(Jb){var yc,Id;if(Jb.fromSummaryString){var qe=new Y.a(1834994092,W.a.Bd,this.$.se,18,null);this.$.Ha.Ad(qe);return this.mHa(1)}qe=Jb.activity;if(x.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")&&qe&&1===qe.type){var Me=new Y.a(1834994092,W.a.Bd,this.$.se,30,null);let oa;oa=this.DN?{["activityGuid"]:qe.activityId,
["blueDotSheetRangeKey"]:Jb.locationId,["sheetRanges"]:null===(yc=this.Hsd)||void 0===yc?void 0:yc.call(this,Jb.locationId)}:{["activityGuid"]:qe.activityId,["sheetRanges"]:null===(Id=this.zEb)||void 0===Id?void 0:Id.call(this,qe.activityId)};this.$.Ha.Ad(Me,oa);return this.mHa(1)}if(!this.HAi(qe))return this.mHa(4);if(!this.RKi(qe))return this.mHa(7);Jb={};try{Me=window.self.atob(qe.navigationId);if(!Me)return this.mHa(5);Jb.NavigationId=Me}catch(oa){return f.ULS.sendTraceTag(537168023,3012,10,`Exception thrown when trying to decode activity NavigationID: ${oa}`),
this.mHa(5)}if(8===this.nl.eg(Xd.a.XNa,2,Jb))return this.nl.processAction(Xd.a.Qeb,2),this.mHa(2);qe=32===this.nl.eg(Xd.a.p6a,2,Jb)?1:6;return this.mHa(qe)}HAi(Jb){return Jb&&Jb.navigationId?!0:!1}RKi(Jb){switch(Jb.type){case 3:case 4:case 6:case 7:case 9:case 8:case 10:return!0;default:return!1}}mHa(Jb){return Promise.resolve(Jb)}}Object(h.a)(gb,"CatchUpActivityNavigationManager",null,[807]);var Bb=a(36);class ic{constructor(Jb,yc,Id){this.U0b="";this.xke=!1;this.VFg=Jb;this.hPc=yc.Type;this.UFg=
Id;this.mee=[];this.S0c=[];this.cFe(yc)}get o2d(){return this.S0c}get blueDotSheetRangeKey(){return this.VFg}get v8g(){return this.UFg}get activityType(){return this.hPc}get a4c(){return this.mee}get rWh(){return this.U0b}get pqi(){return this.xke}cFe(Jb){this.mee.push(Jb.Id);const yc=[];""===this.U0b?this.U0b=Jb.Person.DisplayName:this.U0b!==Jb.Person.DisplayName&&(this.xke=!0);for(Id of Jb.LocationList)if(0===Id.Type){Jb=Id;for(const qe of Jb.RangeList)this.$Me(qe,yc)||yc.push(qe)}f.ULS.sendTraceTag(508682390,
0,100,`BlueDotActivity.appendActivityAndSheetRange() with rangeListLength = ${yc.length.toString()}`);var Id=this.d7e(this.S0c,yc);this.S0c=Id.concat(this.d7e(yc,Id))}d7e(Jb,yc){const Id=[];for(const qe of Jb)this.$Me(qe,yc)||Id.push(qe);return Id}$Me(Jb,yc){for(const Id of yc)if(Id.SheetName===Jb.SheetName&&Id.FirstColumn<=Jb.FirstColumn&&Id.FirstRow<=Jb.FirstRow&&Id.LastColumn>=Jb.LastColumn&&Id.LastRow>=Jb.LastRow)return!0;return!1}}Object(h.a)(ic,"BlueDotActivity",null,[]);class Cc{constructor(Jb,
yc){this.Bcc=this.hua=null;this.bGd=!1;this.VFd=!0;this.Orf=!1;this.Vnc=this.uXa=null;this.pfa={};this.vIa=null;this.i1a=this.fwd=!1;this.Rdd=0;this.zEb=Id=>this.s1.zEb(Id);this.Hsd=Id=>{let qe=[];Id=this.blueDotManager.TCb(Id);for(const Me of Id.o2d)Id=new Wa.a(za.E(Me),Na.d(this.$.va.getItemByName(Me.SheetName))),qe.push(Id);return qe};this.QNb=(Id,qe)=>{switch(qe.state){case 0:case 1:3===qe.fBc?(this.zri(),this.uXa=null):2===qe.fBc&&(this.Vnc=null);break;case 2:this.Vnc=qe.activityId;break;case 3:this.HWe();
this.uXa=qe.activityId;this.w_j();break;default:f.ULS.shipAssertTag(537168030,0,!1,"CatchUpActivityHighlightManager.OnHighlightStateChanged - Invalid CatchUpActivityHighlightState:"+qe.state)}};this.uo=()=>{this.Kzb()};this.uf=()=>{this.Kzb()};this.Wp=()=>{this.Kzb()};this.kk=()=>{this.Kzb()};this.Zfj=()=>{this.jbc()};this.$fj=()=>{this.JNe();this.B8e=setTimeout(()=>{this.E7a()},200)};this.Rjg=(Id,qe)=>{qe.sCi?(this.jbc(),this.E7a()):(this.Orf&&f.ULS.sendTraceTag(508938368,0,50,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler: Flyout is created while bluedots are updating."),
this.VNe(),this.Omd=setTimeout(()=>{this.jbc();this.E7a();const Me=this.tdk(qe.qfa);if(Me){var oa=this.i1a?this.blueDotManager.TCb(qe.activityId).a4c:[qe.activityId];this.hua.createActivityIndicatorTooltip(Object(M.a)(new Lc,{target:this.tGh(qe.qfa),container:Me,activityIds:oa,isSticky:!1,dirHint:this.gridView.rtl?12:9,activityNavigationManager:x.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")?this.sac:void 0,onHoverEnter:this.Zfj,onHoverLeave:this.$fj,
blueDotSheetRangeKey:qe.blueDotSheetRangeKey}));this.Jnc=qe.qfa;f.ULS.sendTraceTag(51172353,0,50,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler: Activity Indicator Raising Hover/Unhover Event.");this.lqc||(this.gridView.view.Rt(this.WLc),this.gridView.Fu(this.WLc),this.lqc=!0)}else f.ULS.shipAssertTag(537168027,0,!1,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler FlyoutContainer is null.")},150))};this.GOf=()=>{this.jbc();this.B8e=setTimeout(()=>{this.E7a()},200)};this.WLc=
()=>{this.hua?(this.jab&&this.hua.updateActivityIndicatorTooltip(Object(M.a)(new qa,{target:this.jab,isSticky:!0})),this.Jnc&&this.hua.updateActivityIndicatorTooltip(Object(M.a)(new qa,{target:this.jab,isSticky:!1}))):f.ULS.shipAssertTag(537168024,0,!1,"CatchUpActivityHighlightManager::UpdateActivityFlyouts ActivityIndicatorTooltipManager is null.")};this.$=Jb;this.gridView=Nb.h(this.$);this.ha=this.gridView.ha;this.Ie=this.gridView.he;this.ha.K7b(this.uo);this.ha.kr(this.uf);this.gridView.iH(this.Wp);
this.Ie.Gp(this.kk);this.jab=this.Jnc=null;this.lqc=!1;this.Imd={};this.i1a=!!yc&&yc.DN();this.sac=new gb(this.$,k.AFrameworkApplication.Dd,this.i1a,this.zEb,this.Hsd);this.blueDotManager=yc;this.vnc=!!yc&&yc.Fbb();this.pSe=this.$.Sd.fi("UserAction","CreateBlueDotMapIntervalStopwatch");this.BSe=this.$.Sd.fi("UserAction","CreateControllerIntervalStopwatch")}get kze(){return this.hua}set kze(Jb){this.hua=Jb}get excelCommentManager(){this.vIa||(this.vIa=this.$.ga.Da(65));return this.vIa}get s1(){this.Bcc||
(this.Bcc=new Qb);return this.Bcc}set s1(Jb){this.Bcc=Jb}dispose(){this.ha.bDc(this.uo);this.ha.Fr(this.uf);this.gridView.NI(this.Wp);this.Ie.zp(this.kk);this.QWe();this.Imd=this.jab=this.Jnc=this.Vnc=this.uXa=this.Ie=this.ha=this.gridView=null}DN(){return this.i1a}c0d(Jb){var yc,Id;const qe=this.n9b();this.QWe();if(Va.e(Jb))this.s1.n5f(this.$),null===(yc=this.blueDotManager)||void 0===yc?void 0:yc.Y6i(),this.s1.Apc&&f.ULS.sendTraceTag(508933386,0,50,"CatchUpActivityHighlightManager:setActivityPayloadForHighlights - userActivities is NULL or empty.");
else{f.ULS.sendTraceTag(537168035,0,50,"In CatchUpActivityHighlightManager:setActivityPayloadForHighlights().");if(this.i1a)if(this.Rdd<Cc.x8g){this.pSe.start();var Me=this.oSe(this.$,Jb);this.pSe.stop();null===(Id=this.blueDotManager)||void 0===Id?void 0:Id.zeg(Me);this.BSe.start();this.pfa=this.s1.CSe(this.$,Me,this,qe);this.BSe.stop();this.Rdd+=1}else Id=this.oSe(this.$,Jb),null===(Me=this.blueDotManager)||void 0===Me?void 0:Me.zeg(Id),this.pfa=this.s1.CSe(this.$,Id,this,qe);else this.pfa=this.s1.Cph(this.$,
Jb,this,qe);if(this.pfa){Id=this.pfa;for(let oa in Id){Me=Id[oa];for(const vb of Me)this.J5g(vb)}}this.s1.F7f(this.$,qe)}}blueDotSheetRangeKey(Jb){return this.blueDotManager?this.blueDotManager.blueDotSheetRangeKey(Jb):null}yVb(){const Jb=this.n9b();Jb&&this.fwd?f.ULS.shipAssertTag(537168034,0,!1,"CatchUpActivityHighlightManager.ShowOrHideAllHighlights - Trying to show all highlights when marked as read"):(Jb||this.Kzb(),this.s1.F7f(this.$,Jb))}Hya(Jb){this.blueDotManager&&(this.i1a?this.blueDotManager.Hya(this.blueDotManager.TCb(Jb).a4c,
0):this.blueDotManager.Hya([Jb],0),x.EwaSettings.isChangeGateEnabled("OfficeVSO:7809018_dismissFlyoutOnBlueDotDismissal")&&this.E7a())}qUb(Jb,yc){if(!this.vnc||!(0===yc&&this.bGd===Jb||1===yc&&this.VFd===Jb)){var Id=this.n9b();this.vnc&&0!==yc?this.vnc&&1===yc?this.VFd=Jb:f.ULS.shipAssertTag(508908755,0,!1,"CatchUpActivityHighlightManager.SetForceHighlightsOff - Unknown reason for setting force highlights off"):this.bGd=Jb;Id!==this.n9b()&&this.yVb()}}jGc(Jb){this.Orf=Jb}FFi(Jb){return this.Vnc===
Jb}oSe(Jb,yc){let Id={};for(const qe of yc)for(const Me of qe.LocationList)if(0!==Me.Type)f.ULS.sendTraceTag(508700376,0,10,"CatchUpActivityHighlightManager.createBlueDotActivityMap: invalid ActivityLocationType");else{yc=Me;for(const oa of yc.RangeList){yc=new Wa.a(za.E(oa),Na.d(Jb.va.getItemByName(oa.SheetName)));const vb=this.blueDotSheetRangeKey(yc);vb in Id?Id[vb].cFe(qe):Id[vb]=new ic(vb,qe,yc)}}return Id}QWe(){if(this.pfa){const Jb=this.pfa;for(let yc in Jb){const Id=Jb[yc];for(const qe of Id)this.pzj(qe)}}this.s1.n5f(this.$);
this.pfa={};this.s1.dispose();this.s1=null}w_j(){if(this.excelCommentManager){var Jb=this.pfa[this.uXa];Jb&&0<Jb.length&&3===Jb[0].model.activityType&&((Jb=Jb[0])?this.excelCommentManager.a0j(Jb.O4h()):f.ULS.shipAssertTag(537168029,0,!1,"RangeCatchUpActivityHighlightController::ShowCommentFlyoutOnSelectedActivity RangeController is Null."))}}zri(){this.excelCommentManager&&this.excelCommentManager.VAb()}HWe(){if(this.uXa){const Jb=this.pfa[this.uXa];if(Jb){for(const yc of Jb)yc.ZZd(!1);this.uXa=null}else f.ULS.sendTraceTag(537168028,
0,50,"CatchUpActivityHighlightManager.DeselectCurrentlySelected - Controllers not found for deselection")}}Kzb(){this.HWe();this.E7a()}tdk(Jb){if(!Jb)return f.ULS.shipAssertTag(537168026,0,!1,"CatchUpActivityHighlightManager::TryGetFlyoutContainer HighlightDot is null."),null;Jb=`${Jb.id}-${Ub.a.reh}`;let yc=this.Imd[Jb];if(!yc){if(!this.gridView.domElement)return f.ULS.shipAssertTag(537168025,0,!1,"CatchUpActivityHighlightManager::TryGetFlyoutContainer gridView.DOMElement is null."),null;yc=document.createElement("Div");
yc.className=We.a.seh;yc.id=Jb;this.gridView.domElement.appendChild(yc);this.Imd[Jb]=yc}return yc}E7a(){if(this.hua&&(this.hua.dismissActivityIndicatorTooltips(Object(M.a)(new Ba,{clearSticky:!0})),this.jab=this.Jnc=null,this.lqc&&!this.jab&&(this.gridView.view.Cs(this.WLc),this.gridView.Ax(this.WLc),this.lqc=!1),this.flyoutAnchorTarget)){const Jb=this.flyoutAnchorTarget.parentElement;null===Jb||void 0===Jb?void 0:Jb.removeChild(this.flyoutAnchorTarget);this.flyoutAnchorTarget=null}}J5g(Jb){Jb.DBe(this.QNb);
Jb.AYg(this.Rjg);Jb.zYg(this.GOf)}pzj(Jb){Jb.y6f(this.QNb);Jb.BAj(this.Rjg);Jb.AAj(this.GOf)}VNe(){this.Omd&&clearTimeout(this.Omd)}JNe(){this.Omd&&clearTimeout(this.B8e)}jbc(){this.VNe();this.JNe()}n9b(){return this.blueDotManager&&this.blueDotManager.areInGridHighlightsEnabled()&&!this.bGd&&(!this.vnc||!this.VFd)}tGh(Jb){if(this.flyoutAnchorTarget){var yc=this.flyoutAnchorTarget.parentElement;null===yc||void 0===yc?void 0:yc.removeChild(this.flyoutAnchorTarget);this.flyoutAnchorTarget=null}var Id=
Jb.getBoundingClientRect();this.flyoutAnchorTarget=document.createElement("div");this.flyoutAnchorTarget.className=We.a.weh;this.$.zH.appendChild(this.flyoutAnchorTarget);Jb=Bb.a(this.$).Mj(Id.left);yc=Bb.a(this.$).Mj(Id.top);const qe=Bb.a(this.$).Mj(Id.width);Id=Bb.a(this.$).Mj(Id.height);this.flyoutAnchorTarget.style.left=`${Jb}px`;this.flyoutAnchorTarget.style.top=`${yc}px`;this.flyoutAnchorTarget.style.width=`${qe}px`;this.flyoutAnchorTarget.style.height=`${Id}px`;return this.flyoutAnchorTarget}}
Cc.x8g=10;Object(h.a)(Cc,"CatchUpActivityHighlightManager",null,[815,5]);var hd=a(443);class Pd{constructor(){this.collectionId=this.type=this.id=null;this.activityState=0;this.timestamp=this.activityFeedItemPayload=null}}Object(h.a)(Pd,"ActivityFeedEntry",null,[]);const ue=(Jb,yc)=>yc.isUserProfilePictureResolutionEnabled?Hc.toArray(Hc.select(Hc.asEnumerable(Jb),Id=>{if(!Id||!Id.activityFeedItemPayload)return Id;const qe=JSON.parse(Id.activityFeedItemPayload);var Me=qe.actor;if(!Me||Me.pictureUrl)return Id;
const oa=Me.userPrincipalName||Me.email;if(!oa)return Id;Me=yc.zma(oa,Me.provider,k.AFrameworkApplication.Ak,0);if(!Me)return Id;qe.actor.pictureUrl=Me;return Object.assign(new Pd,{id:Id.id,type:Id.type,collectionId:Id.collectionId,activityState:Id.activityState,activityFeedItemPayload:JSON.stringify(qe),timestamp:Id.timestamp})})):Jb,Ee=(Jb,yc)=>{const Id=new Map,qe=new Map;for(const Me of Jb){if(!Me||!Me.activityFeedItemPayload)continue;Jb=JSON.parse(Me.activityFeedItemPayload).actor;if(!Jb)continue;
const oa=Jb.email||Jb.userPrincipalName;oa&&!qe.has(oa)&&qe.set(oa,new hd.a(oa,null,Jb.name))}qe.forEach(Me=>{const oa=yc.Zlc(Me,6);Id.set(Me.UserId,oa)});return Id};class Se{}Object(h.a)(Se,"UserActivityPerson",null,[]);class cf{}Object(h.a)(cf,"GetRelevantActivitiesDataRequest",null,[]);class mf{constructor(){this.activityFeedItemId=this.activityId=null;this.type=0;this.collectionId=this.state=this.navigationId=this.relevancy=this.displayTimestamp=this.location=this.actors=null}}Object(h.a)(mf,
"Activity",null,[]);class ac{constructor(){this.collectionId=this.type=this.id=null;this.activityState=0;this.timestamp=this.activityFeedItemPayload=null}}Object(h.a)(ac,"ActivityFeedItem",null,[]);class bd{constructor(){this.personaColorMap=this.activityFeedItems=null}}Object(h.a)(bd,"ActivityFeedPayload",null,[]);class nd{constructor(){this.lowWaterline=this.highWaterline=this.wywaWaterline=this.actors=this.activities=null;this.hasMore=!1;this.isFirstDocumentOpen=null}}Object(h.a)(nd,"ActivityRequestPayload",
null,[]);class se{constructor(){this.color=this.imageUrl=this.email=this.givenName=this.displayName=this.provider=this.id=null}}Object(h.a)(se,"Person",null,[]);class Ge extends mf{constructor(){super();this.relationship=0}}Object(h.a)(Ge,"TaskActivity",mf,[]);const Ve=(Jb,yc,Id,qe,Me,oa)=>{oa=Jb.Pa(1,void 0===oa?null:oa);return v.g(Jb,"GetLineageWywaAuthors",oa,yc,Id,qe,Me,4)},df=(Jb,yc,Id,qe,Me,oa,vb)=>{vb=Jb.Pa(1,void 0===vb?null:vb);vb.getRelevantActivitiesDataRequest=yc;return v.g(Jb,"GetRelevantActivitiesData",
vb,Id,qe,Me,oa,0)};class pf{constructor(Jb,yc,Id,qe){Id=void 0===Id?!1:Id;qe=void 0===qe?null:qe;this.Eae=null;this.$=Jb;this.tac=yc;this.ygb=bc.a.instance.resolve("Common.App.People.IPeopleColorUtils");this.eaa=bc.a.instance.resolve("Common.App.People.IUserProfilePictureUtilsV2");this.Mbb=Id;this.blueDotManager=qe}requestWYWAActivities(){return this.Mbb?new Promise((Jb,yc)=>{Ve(this.$.qa.ua,Id=>{var qe;Id=hb.a(Id)?null:Id.Result;if(x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",
!1)){const Me=null===(qe=null===Id||void 0===Id?void 0:Id.WywaAuthors)||void 0===qe?void 0:qe.length;if(null!=Me&&0<Me){const oa={activities:[],actors:Id?this.ulc(Id.WywaAuthors):null,hasMore:!1,highWaterline:pf.Lma,lowWaterline:pf.Lma,wywaWaterline:pf.Lma};this.E$d(vb=>{oa.activities=vb;Jb(oa)},vb=>{f.ULS.sendTraceTag(509638481,0,10,`updateInGridBlueDots failed: reason: "${vb}"`);Jb(oa)},!0,!1)}else Jb(pf.Czb)}else qe=Object(M.a)(new nd,{activities:[],actors:Id?this.ulc(Id.WywaAuthors):null,hasMore:!1,
highWaterline:pf.Lma,lowWaterline:pf.Lma,wywaWaterline:pf.Lma}),Jb(qe)},()=>{f.ULS.sendTraceTag(537168022,0,10,"CatchUpActivityRequestManager::GetLineageWywaAuthors service call failed.");yc(null)},null,null)}):Promise.resolve(pf.Czb)}requestActivities(){return Promise.resolve(pf.Czb)}requestRelevantActivities(){if(!this.$.ea.oe||this.$.ea.$$a)return f.ULS.sendTraceTag(537168021,3012,15,`CatchUpActivityRequestManager.RequestRelevantActivities: RequestRelevantActivities skipped [IsSessionActive: ${this.$.ea.oe}, HasRaisedSessionEnded: ${this.$.ea.$$a}]`),
Promise.resolve(pf.Czb);const Jb=Object(M.a)(new cf,{SetDaysBack:k.AFrameworkApplication.da.Hf("AppWaterlineOverrideDaysValue",0),SetTimestamp:k.AFrameworkApplication.da.Hf("AppWaterlineOverrideTimestampValue",0)});return new Promise((yc,Id)=>{df(this.$.qa.ua,Jb,qe=>{let Me=pf.Czb;qe?hb.a(qe)?(qe=Ga.a.ue(qe.Errors),f.ULS.sendTraceTag(578353159,3012,10,`CatchUpActivityRequestManager::GetRelevantActivitiesData call returned errors codes: ${qe}`)):Me=this.gfi(qe.Result):f.ULS.sendTraceTag(537168020,
3012,10,"CatchUpActivityRequestManager::GetRelevantActivitiesData call returned Null result.");yc(Me)},qe=>{qe=$a.a.Lg(qe.data);qe=Ga.a.ue(qe);f.ULS.sendTraceTag(537168019,3012,10,`CatchUpActivityRequestManager::GetRelevantActivitiesData call has failed - Errors: [${qe}]`);Id(null)},null,null)})}requestActivityFeed(){return ra.c(this.getActivityFeed()).then(Jb=>{Jb=this.Abk(Jb);return Object(M.a)(new bd,{activityFeedItems:ue(Jb,this.eaa),personaColorMap:Ee(Jb,this.ygb)})})}updateActivityState(Jb){return this.tac?
ra.c(this.tac).then(yc=>{var Id,qe;return ra.c(yc.qgk(Jb.itemIds,null!==(Id=Jb.activityStatesToSet)&&void 0!==Id?Id:0,null!==(qe=Jb.activityStatesToReset)&&void 0!==qe?qe:0,Jb.resetUnseenCount))}):Promise.resolve(!1)}getActivityFeed(){return this.tac?Eb.a.F7d(this.tac,Jb=>Jb.getActivityFeed(null)):X.Task.Wa([])}gfi(Jb){if(!Jb)return f.ULS.sendTraceTag(537168018,3012,10,"CatchUpActivityRequestManager::GetRelevantActivityRequestPayload response is null."),Object(M.a)(new nd,{activities:[]});const yc=
this.Jrg(Jb.NewActivities,2);Jb=this.Jrg(Jb.OutstandingActivities,3);for(const Id of Jb)yc.push(Id);return Object(M.a)(new nd,{activities:yc})}Jrg(Jb,yc){yc=void 0===yc?1:yc;const Id=[];if(!Jb||!Jb.length)return Id;for(const qe of Jb)qe?(Jb=pf.Hbk(qe.Type),6===Jb||7===Jb||9===Jb||8===Jb?Id.push(Object(M.a)(new Ge,{activityId:qe.Id,type:Jb,displayTimestamp:new Date(qe.DisplayTimestamp),navigationId:qe.NavigationId,actors:this.ulc(qe.People),relevancy:yc,relationship:this.Gbk(qe.Relationship)})):Id.push(Object(M.a)(new mf,
{activityId:qe.Id,type:Jb,displayTimestamp:new Date(qe.DisplayTimestamp),navigationId:qe.NavigationId,actors:this.ulc(qe.People),relevancy:yc}))):f.ULS.shipAssertTag(537168017,3012,!1,"CatchUpActivityRequestManager.TranslateRelevantActivitiesToActivities: relevantActivity is null");return Id}Gbk(Jb){switch(Jb){case 1:return 1;case 2:return 2;case 3:return 3}f.ULS.sendTraceTag(537168016,0,10,"Unexpected Relationship.");return 1}Abk(Jb){const yc=[];for(const Id of Jb)Jb=Object(M.a)(new ac,{id:Id.id,
type:Id.type,collectionId:Id.collectionId,activityState:Id.activityState,activityFeedItemPayload:Id.activityFeedItemPayload,timestamp:Id.timestamp}),yc.push(Jb);return yc}ulc(Jb){const yc=[];if(!Jb||!Jb.length)return yc;for(const Id of Jb)Id&&yc.push(this.gEb(Id));return yc}gEb(Jb){return Object(M.a)(new se,{id:Jb.Id,provider:Jb.Provider,displayName:Jb.DisplayName,email:Jb.Email,imageUrl:this.eaa.zma(Jb.Email,Jb.Provider,k.AFrameworkApplication.Ak,0),color:this.ygb.Zlc(new hd.a(null,void 0,Jb.DisplayName),
6)})}static Hbk(Jb){switch(Jb){case 1:return 3;case 2:return 4;case 3:return 6;case 4:return 7;case 6:return 8;case 5:return 9;case 7:return 10;default:return f.ULS.shipAssertTag(537168015,3012,!1,"CatchUpActivityRequestManager.TranslateRelevantActivityTypeToActivityType: unknown RelevantActivityType"),1}}gde(){if(this.blueDotManager){const Jb=this.blueDotManager.e9c;return this.Eae.filter(yc=>!Jb.has(yc.Id))}return this.Eae}epj(Jb,yc){const Id=Jb.map(qe=>({activityId:qe.activityGuid,activityFeedItemId:null,
type:1,actors:[{id:qe.author.id,provider:qe.author.provider,displayName:qe.author.displayName,givenName:null,email:qe.author.email,imageUrl:qe.author.imageUrl,color:null}],location:{type:105,region:null,subregion:null},displayTimestamp:qe.displayTimestamp,relevancy:null,navigationId:null,state:0,collectionId:null}));this.Eae=Jb.map(qe=>{var Me,oa,vb,Ac,jd,Ud;const ke=null!==(oa=null===(Me=qe.rangeHighlightLocation)||void 0===Me?void 0:Me.rangeList.map(Pe=>({Type:0,RangeList:[{SheetName:qe.sheetName,
FirstRow:Pe.firstRow,LastRow:Pe.lastRow,FirstColumn:Pe.firstCol,LastColumn:Pe.lastCol}]})))&&void 0!==oa?oa:[];Me=new Se;Me.DisplayName=null===(vb=qe.author)||void 0===vb?void 0:vb.displayName;Me.Email=null===(Ac=qe.author)||void 0===Ac?void 0:Ac.email;Me.Id=null===(jd=qe.author)||void 0===jd?void 0:jd.id;Me.Provider=null===(Ud=qe.author)||void 0===Ud?void 0:Ud.provider;return{Id:qe.activityGuid,Type:null,Person:Me,DisplayTimestamp:null,LocationList:ke}});yc(Id)}E$d(Jb,yc,Id,qe){this.blueDotManager?
(qe?this.blueDotManager.tQi():this.blueDotManager.sQi()).then(Me=>{this.epj(Me,Jb);this.blueDotManager.xSa()&&Id&&this.blueDotManager.dQi()},Me=>{yc&&yc(Me)}):f.ULS.shipAssertTag(509703879,3012,!1,"CatchUpActivityRequestManager.updateInGridBlueDots: Missing blue dot manager in blue dot method")}}pf.Lma="<WywaWaterline>DefaultWaterline</WywaWaterline>";pf.Czb=Object(M.a)(new nd,{activities:[],actors:[],hasMore:!1,highWaterline:pf.Lma,lowWaterline:pf.Lma,wywaWaterline:pf.Lma});Object(h.a)(pf,"CatchUpActivityRequestManager",
null,[808]);class kf{constructor(Jb){this.$=Jb}shouldShowEmptyExperienceButton(){return this.$.ea.Ddb?!0:!1}onButtonClick(){const Jb={["InputMethod"]:W.a.Bd};this.$.Ha.Ad(new Y.a(1834994092,W.a.Bd,this.$.se,16,null),Jb)}onInviteOthersButtonClick(){const Jb={["InputMethod"]:W.a.Bd};this.$.Ha.Ad(new Y.a(869186573,W.a.Bd,this.$.se,16,null),Jb)}getExplanationText(){const Jb=this.$.ga.Da(365);return vc.a.instance.Ia(Jb&&Jb.isVisible?657:656)}getCommandName(){return vc.a.instance.ia(443)}}Object(h.a)(kf,
"CatchUpEmptyExperienceBehaviorManager",null,[809]);const Af=Jb=>{window.performance&&"function"===typeof window.performance.mark&&window.performance.mark("CatchUpInit."+Jb)};class eb{constructor(Jb,yc){this.$=Jb;this.flyoutRibbonButton=void 0===yc?null:yc;Ua.a(this.$).vk(this);this.hasFocus=!1}dispose(){Ua.a(this.$).gB(this)}get Ce(){return document.getElementById("catchUpFlyoutContainer")}get zi(){return this.flyoutRibbonButton.Rtf&&!this.hasFocus}get jg(){return ka.a.O$c}Pi(Jb,yc){if(yc)return!1;
Jb=document.getElementById("flyoutItem0");if(!Jb)return f.ULS.sendTraceTag(537168009,3012,10,"Could not find firstItem in flyout when setting up focus"),!1;Jb.focus();this.KAh(Jb);return!0}Nj(Jb){return this.Ce?nb.DOMElementExtensions.mi(this.Ce,Jb):!1}Ll(){this.hasFocus=!0}lm(){this.hasFocus=!1}KAh(Jb){if(Sys.Browser.agent===Sys.Browser.Firefox){var yc=document.createEvent("KeyboardEvent");yc.initKeyEvent(hc.a.me,!0,!0,window.self,!1,!1,!1,!1,Wb.a.zYb,0);Jb.dispatchEvent(yc)}else yc=document.createEvent("Events"),
yc.initEvent(hc.a.me,!0,!0),yc.keyCode=Wb.a.zYb,yc.which=Wb.a.zYb,Jb.dispatchEvent(yc)}}Object(h.a)(eb,"FlyoutFocus",null,[56,5]);var bb=a(430);class Rb{constructor(Jb){this.buttonClickedCallback=null;this.Upb=this.WHb=!1;this.AXh=new Date;this.r8e=Jb}dispose(){this.Upb=this.WHb=!1}registerButtonClickedEvent(Jb){this.buttonClickedCallback&&f.ULS.sendTraceTag(537168008,3012,15,"RegisterButtonClickedEvent: Button clicked callback should only be registered once.");this.buttonClickedCallback=Jb.buttonClickedCallback}onFlyoutInitialized(){this.WHb&&
f.ULS.sendTraceTag(537168007,3012,15,"OnFlyoutInitialized: Flyout should only be initialized once.");const Jb=(new Date).getTime()-this.AXh.getTime();f.ULS.sendTraceTag(593601546,3012,50,`Time from retrieve activities to initialize Flyout: ${Jb}`);r.c(Xd.a.xeh,!0,r.e,0,0,Jb);this.WHb=!0;bb.a.GB&&bb.a.GB.updateCommandUI(!0)}logFlightTriggers(){}toggleCatchUpFlyout(){this.WHb?this.buttonClickedCallback?this.buttonClickedCallback():f.ULS.sendTraceTag(537168005,3012,10,"ToggleCatchUpFlyout: User clicked the button before the buttonClickedCallback was registered."):
f.ULS.sendTraceTag(537168006,3012,10,"ToggleCatchUpFlyout: User clicked the button before the flyout was initialized.")}get Rtf(){return this.Upb}onFlyoutVisibilityChanged(Jb){this.Upb!==Jb.flyoutIsVisible&&(this.Upb=Jb.flyoutIsVisible,bb.a.GB&&bb.a.GB.updateCommandUI(!0),this.Upb||this.r8e&&this.r8e.HRi())}}Object(h.a)(Rb,"FlyoutRibbonButton",null,[814]);var Q=a(535);class Ia{constructor(){this.flyoutAnchorTarget=this.useCompactSummaryString=this.disableDismissOnClick=this.customDynamicEntryPointEnabled=
this.dynamicEntryPointEnabled=this.activityFeedDataEnabled=this.includeRelevantAuthorsInSummaryString=this.summaryStringEnabled=this.flyoutEnabled=this.featuredActivityGroupsEnabled=null}}Object(h.a)(Ia,"CatchUpConfiguration",null,[]);class ub{constructor(){this.recentChangesManager=this.emptyCatchUpBehaviorManager=this.ulsLogger=this.uiCulture=this.flyoutRibbonButton=this.flyoutFocus=this.dataCulture=this.changeSummariesDataProvider=this.appColorUpdateIsEnabled=this.activityRequestManager=this.activityNavigationManager=
this.activityContentManager=null}}Object(h.a)(ub,"SharedControllerFactoryParameters",null,[]);class Yb{constructor(Jb,yc,Id,qe,Me){Id=void 0===Id?null:Id;qe=void 0===qe?null:qe;Me=void 0===Me?null:Me;var oa;this.AMa=null;this.Mlf=!1;this.Idb=this.Rpa=0;this.SBa=this.abb=this.jrf=this.r4a=this.xSa=!1;this.bHb=x.EwaSettings.isChangeGateEnabled("OfficeVSO:8027695_AsyncLoadBlueDots");this.ssc=!1;this.KLf=(vb,Ac)=>{this.i$d(Ac.f0i)};this.Nh=()=>{const vb=this.$.ea.pp.LineageVersion;this.Rpa!==vb&&(f.ULS.sendTraceTag(509645837,
0,50,`CatchUpActivityManager.onWorkbookMetadataChanged: lineageVersion: ${vb}, this.lineageVersion: ${this.Rpa}`),this.Rpa=vb,this.bHb?void this.LQb(!1):this.KQb(!1))};this.yp=()=>{f.ULS.sendTraceTag(509109976,0,100,"CatchUpActivityManager.onLoadOnDemandOccured");this.bHb?void this.LQb(!0):this.KQb(!0)};this.ff=(vb,Ac)=>{vb=x.EwaSettings.isChangeGateEnabled("OfficeVSO:7788930_BlueDotReloadAfterBecomingActive");Ac.nI&&this.blueDotManager&&(f.ULS.sendTraceTag(509109975,0,100,"CatchUpActivityManager.onSessionIdChanged"),
vb&&(this.bHb?void this.LQb(!0):this.KQb(!0)));vb||(this.bHb?void this.LQb(!0):this.KQb(!0))};this.aWf=vb=>{var Ac,jd,Ud;x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)&&!dc.a.ij(vb.wywaActivities)&&2!==vb.wywaActivities[0].type&&this.c1d()&&(this.showHideInGridHighlights(),this.$.ea.Mw(this.Nh),null===(Ac=this.blueDotManager)||void 0===Ac?void 0:Ac.YYg(this.onBlueDotDismissed),null===(jd=this.blueDotManager)||void 0===jd?void 0:jd.tYg(this.JLf),null===(Ud=this.blueDotManager)||
void 0===Ud?void 0:Ud.uYg(this.KLf),this.xSa&&(this.$.ea.BM(this.yp),this.$.ea.Zl(this.ff),this.ssc&&this.$.gk(this.De)))};this.onBlueDotDismissed=()=>{this.c1d()};this.JLf=()=>{this.r4a=!0;this.RUd()};this.De=(vb,Ac)=>{Ac.Xpc&&(this.GM.c0d([]),this.r4a=!0,this.RUd())};this.$=Jb;this.blueDotManager=Me;this.jrf=x.EwaSettings.isChangeGateEnabled("OfficeVSO:7805176_CatchUpReadoutEnabled");this.GM=new Cc(this.$,this.blueDotManager);this.bge=new Ie(k.AFrameworkApplication.Dd,x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CatchUpMockDataEnabled",
!1));Jb=gd.a.Q$j(bc.a.instance.Qd("Common.App.CatchUpActivity.ICatchUpRequestHandler"));this.mBf=qe;this.K5a=new pf(this.$,Jb,this.Mbb(),this.blueDotManager);this.sac=new gb(this.$,k.AFrameworkApplication.Dd,!!Me&&Me.DN());this.emptyCatchUpBehaviorManager=new kf(this.$);this.ssc=x.EwaSettings.isChangeGateEnabled("OfficeVSO:8101290_isStopBlueDotsOnSessionModeChangeEnabled");this.gQi(vb=>{this.m4i(vb)},yc);this.rSi();yc=null;Id||(yc=bc.a.instance.resolve("Common.App.CatchUpActivity.FloodgateEventLogger"));
this.flyoutRibbonButton=Id||new Rb(yc);this.flyoutFocus=new eb(this.$,this.flyoutRibbonButton);this.j$b=this.$.Sd.fi("UserAction","BlueDotLiveUpdateIntervalStopwatch");this.xSa=null===(oa=this.blueDotManager)||void 0===oa?void 0:oa.xSa();this.blueDotManager&&this.blueDotManager.Fbb()&&this.i$d(!1)}get Wrf(){const Jb=this.flyoutRibbonButton.WHb;Jb&&!this.Mlf&&(f.ULS.sendTraceTag(588129368,3012,50,"Catch Up Flyout is ready and button is enabled."),this.Mlf=!0);return Jb}get XBi(){return this.flyoutRibbonButton.Rtf}dispose(){this.AMa&&
this.AMa.getWywaEvent().removeListener(this.aWf);this.AMa=this.$=null;wd.a.Ma(this.GM);this.flyoutRibbonButton=this.flyoutFocus=this.bge=this.sac=this.K5a=this.GM=null;this.r4a||this.RUd()}Ufj(){this.flyoutRibbonButton.toggleCatchUpFlyout();return!0}Fik(Jb){this.GM.qUb(!Jb,1);this.i$d(Jb)}showHideInGridHighlights(){this.GM.yVb()}Fbb(){return!!this.blueDotManager&&this.blueDotManager.Fbb()}j2h(Jb,yc){var Id;if(!this.jrf||null===(Id=this.blueDotManager)||void 0===Id||!Id.DN||yc.top!==yc.bottom||yc.left!==
yc.right)return null;Jb=this.blueDotManager.blueDotSheetRangeKey(new Wa.a(yc,Jb));Jb=this.blueDotManager.TCb(Jb);if(!Jb)return null;yc=Jb.rWh;return Jb.pqi?[yc,yc]:[yc]}i$d(Jb){x.EwaSettings.isChangeGateEnabled("OfficeVSO:7808898_EnableBlueDotsRefreshSuspension")&&(Jb&&this.abb?this.JHj():Jb||this.abb||this.w7j())}w7j(){this.abb=!0}JHj(){this.abb=!1;const Jb=this.SBa;this.SBa=!1;this.r4a||(this.bHb?void this.LQb(Jb):this.KQb(Jb))}RUd(){var Jb,yc,Id;this.$.ea.ny(this.Nh);null===(Jb=this.blueDotManager)||
void 0===Jb?void 0:Jb.YAj(this.onBlueDotDismissed);null===(yc=this.blueDotManager)||void 0===yc?void 0:yc.vAj(this.JLf);null===(Id=this.blueDotManager)||void 0===Id?void 0:Id.wAj(this.KLf);this.xSa&&(this.$.ea.rR(this.yp),this.$.ea.gm(this.ff),this.ssc&&this.$.Hn(this.De))}rSi(){f.ULS.sendTraceTag(589608192,3012,50,"Catch Up script is loaded and Flyout is enabled.");this.prf()&&f.ULS.sendTraceTag(526718752,3012,50,"ActivityFeedData is enabled")}LQb(Jb){const yc=this;return Io(function*(){if(yc.blueDotManager)if(yc.abb)yc.SBa=
yc.SBa||Jb,f.ULS.sendTraceTag(508696778,0,50,`BlueDots refresh is suspended, skip refresh, should do server reload when resuming: ${yc.SBa}`);else{var Id=x.EwaSettings.isChangeGateEnabled("OfficeVSO:7643204_BlueDotLiveUpdatePerfTelemetry")&&!Jb&&yc.Idb<Yb.zBf,qe=x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDotsHideSuppression",!1);qe?yc.GM.jGc(!0):yc.GM.qUb(!0,0);Id&&yc.j$b.start();yc.K5a.E$d(()=>{setTimeout(()=>{yc.GM.c0d(yc.K5a.gde());qe?yc.GM.jGc(!1):yc.GM.qUb(!1,0);Id&&(yc.j$b.stop(),
yc.Idb+=1);Jb&&(yc.Rpa=0)},0)},null,Jb&&yc.blueDotManager.ijg(),Jb)}else f.ULS.sendTraceTag(508953163,0,50,"blueDotManager is null when refreshBlueDotsAsync is called")})}KQb(Jb){if(this.blueDotManager)if(this.abb||this.r4a)this.SBa=this.SBa||Jb,f.ULS.sendTraceTag(508616974,0,50,`BlueDots refresh is suspended or all dots dismissed, skip refresh, should do server reload when resuming: ${this.SBa}`);else{var yc=x.EwaSettings.isChangeGateEnabled("OfficeVSO:7643204_BlueDotLiveUpdatePerfTelemetry")&&!Jb&&
this.Idb<Yb.zBf,Id=x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDotsHideSuppression",!1);Id?this.GM.jGc(!0):this.GM.qUb(!0,0);yc&&this.j$b.start();this.K5a.E$d(()=>{this.c1d()&&(Id?this.GM.jGc(!1):this.GM.qUb(!1,0),yc&&(this.j$b.stop(),this.Idb+=1),Jb&&(this.Rpa=0))},null,Jb&&this.blueDotManager.ijg(),Jb)}else f.ULS.sendTraceTag(508616975,0,50,"blueDotManager is null when refreshBlueDots is called")}gQi(Jb,yc){Af("ScriptDownload");void ba.a.resolve(na.S,{Ja:yc}).then(Id=>Io(function*(){Jb(ra.d(Id("catchUpActivity")))}))}Mbb(){return!!this.mBf&&
this.mBf.Mbb()&&this.$.ea.Ddb}prf(){return x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ActivityFeedIsEnabled",!1)}m4i(Jb){J.TaskExtensions.za(Jb,()=>{Za.a(()=>{this.AMa=catchUpActivity.FactoryGlobal.getExcelCatchUpAppInstance(Object(M.a)(new ub,{activityContentManager:Object(Ld.a)(806,this.bge),activityNavigationManager:Object(Ld.a)(807,this.sac),activityRequestManager:Object(Ld.a)(808,this.K5a),dataCulture:this.$.xa.DataCultureTag,flyoutFocus:null,flyoutRibbonButton:Object(Ld.a)(Rb,
this.flyoutRibbonButton),uiCulture:this.$.xa.UICultureTag,ulsLogger:new S.a,emptyCatchUpBehaviorManager:Object(Ld.a)(809,this.emptyCatchUpBehaviorManager)}))});this.GM.kze=this.AMa.getActivityIndicatorTooltipManager();Q.a(this.$);this.AMa.getWywaEvent().addListener(this.aWf);Af("InitializeCatchUpApp");this.AMa.initialize(Object(M.a)(new Ia,{featuredActivityGroupsEnabled:!1,summaryStringEnabled:this.Mbb(),includeRelevantAuthorsInSummaryString:!1,useCompactSummaryString:!0,activityFeedDataEnabled:this.prf()}))},
this.$.ka,3)}c1d(){if(this.ssc&&this.r4a)return!1;this.GM.c0d(this.K5a.gde());return!0}}Yb.zBf=10;Object(h.a)(Yb,"CatchUpActivityManager",null,[810,5]);class Ca extends d.a{constructor(Jb){super();this.$=Jb;this.je()}create(){let Jb=x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)?E.GetServiceTaskFactory.ud(this.$.ga,501,500,1):X.Task.Wa(null),yc=E.GetServiceTaskFactory.ud(this.$.ga,458,459,this.Ta);J.TaskExtensions.za(J.TaskExtensions.Wf([Jb,yc],this.$.ka),()=>{const Id=yc.result,
qe=Jb.result,Me=Object(Sb.a)(this.$.ga,286,()=>new Yb(this.$,this.Ta,null,Id,qe));this.Ld(Me)},this.$.ka,3)}static la(Jb){Jb.ga.Qa(287,new Ca(Jb))}}Object(h.a)(Ca,"CatchUpActivityManagerFactory",d.a,[]);var tb=a(243),$b=a(179),cd=a(324),sd=a(39);class re{}Object(h.a)(re,"LineageBlueDotsInfo",null,[]);class De extends Sys.EventArgs{constructor(Jb){super();this.f0i=Jb}}Object(h.a)(De,"BlueDotVisibilityChangeEventArgs",Sys.EventArgs,[]);class Ye extends Error{constructor(Jb,yc){super(`${Ye.y8g}: ${Jb}. With errors: ${Ga.a.ue(yc)}`)}}
Ye.y8g="BlueDotError";Object(h.a)(Ye,"BlueDotError",Error,[]);class $e extends sd.a{constructor(Jb,yc){super();this.blueDotSettings=0;this.i$b=this.b1=this.xzc=null;this.emf=this.mmf=!1;this.areInGridHighlightsAvailable=()=>!0;this.areInGridHighlightsEnabled=()=>0===(this.blueDotSettings&1);this.sRj=Id=>{f.ULS.sendTraceTag(509732679,0,50,"User toggled in grid highlights, new value {0}.",Id);this.blueDotSettings=Id?0:1;this.raiseEvent("cubdvcek",new De(Id));this.Kdg({});this.kpk()};this.Faj=Id=>{this.Kdg({LineageTaskPaneVisible:Id})};
this.$=Jb;this.blueDotSettings=yc;this.eaa=bc.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.Z4a=new Set;this.e9c=new Set}dispose(){this.i$b=this.b1=this.xzc=this.e9c=this.Z4a=this.eaa=this.$=null}YYg(Jb){this.addHandler("cubddek",Jb)}YAj(Jb){this.removeHandler("cubddek",Jb)}V0g(Jb){this.addHandler("cubduek",Jb)}pDj(Jb){this.removeHandler("cubduek",Jb)}uYg(Jb){this.addHandler("cubdvcek",Jb)}wAj(Jb){this.removeHandler("cubdvcek",Jb)}Hya(Jb,yc){x.EwaSettings.isChangeGateEnabled("OfficeVSO:7633322_BlueDotDismissTelemetry")&&
f.ULS.sendTraceTag(509167327,0,50,"BlueDotManager::dismissBlueDot: Blue dot dismissed by "+yc);Jb.forEach(Id=>this.e9c.add(Id));x.EwaSettings.isChangeGateEnabled("OfficeVSO:7525040_BlueDotDismissal")&&this.raiseEvent("cubddek")}shouldShowBlueDot(Jb){return this.Z4a.has(Jb)}xSa(){return x.EwaSettings.isChangeGateEnabled("OfficeVSO:6633490_BlueDotsServerReload")}blueDotSheetRangeKey(Jb){return Jb&&Jb.range&&Jb.sheetId?`${Jb.range.bottom}-${Jb.range.left}-${Jb.sheetId}`:null}zeg(Jb){this.i$b=Jb}TCb(Jb){return this.i$b?
this.i$b[Jb]:null}hasAnyActiveInGridHighlight(){return x.EwaSettings.isChangeGateEnabled("OfficeVSO:7665355_DisableToggleForEmptyInGridHighlights")?!this.mmf&&0<this.Z4a.size:!0}tYg(Jb){this.addHandler("cubdadek",Jb)}vAj(Jb){this.removeHandler("cubdadek",Jb)}Y6i(){this.mmf=!0;x.EwaSettings.isChangeGateEnabled("OfficeVSO:7773856_BlueDotsAllDismissedEvent")&&this.raiseEvent("cubdadek");this.emf||(this.h1f(),this.emf=!0)}sQi(){const Jb=this;return Io(function*(){return new Promise((yc,Id)=>{f.ULS.sendTraceTag(512234945,
0,50,"BlueDotManager::loadInGridBlueDots");yb.b(Jb.$).nf(U.a.lineageLoadInGridBlueDots,{});const qe=oa=>{oa=$a.a.Lg(oa.data);f.ULS.sendTraceTag(512234944,0,50,`BlueDotManager::LineageLoadInGridBlueDots service call failed. Errors: [${Ga.a.ue(oa)}]`);Id(new Ye("loadInGridBlueDots failed",oa))},Me=oa=>{if(oa=hb.a(oa)?null:oa.Result){var vb={["CountOfActivities"]:oa.ActivityList.length};yb.b(Jb.$).nf(U.a.OPi,vb);var Ac=Md(oa.ActivityList,Jb.eaa);Jb.xSa()?(Jb.gcc(Ac),Jb.b1&&x.EwaSettings.isChangeGateEnabled("OfficeVSO:7833821_BlueDotsReapplyFlattenedUids")&&
Jb.l9b(Jb.b1.FlattenedUids),yc(Ac)):null==Jb.xzc?Jb.dAi().then(jd=>{Jb.xzc=jd;Jb.gcc(Ac);Jb.l9b(jd);yc(Ac)},jd=>{Id(jd)}):(Jb.gcc(Ac),Jb.l9b(Jb.xzc),yc(Ac))}else f.ULS.shipAssertTag(512234914,0,!!oa,"BlueDotManager LineageLoadInGridBlueDots returned null response.")};Jb.$.userOperationManager.enqueueOperation(new ua.a(1024,0,(oa,vb,Ac)=>{var jd=Jb.$.qa.ua;oa=qb.b(oa,Me);vb=qb.a(vb,qe);const Ud=jd.Pa(1,null);return v.g(jd,"LineageLoadInGridBlueDots",Ud,oa,vb,Ac,null,0)},80),null)})})}tQi(){const Jb=
this;return Io(function*(){return new Promise((yc,Id)=>{var qe,Me,oa,vb,Ac,jd;f.ULS.sendTraceTag(509109974,0,50,"BlueDotManager::loadInGridBlueDotsWithReloadHint");yb.b(Jb.$).nf(U.a.lineageLoadInGridBlueDotsWithReloadHint,{});const Ud=ze=>{ze=$a.a.Lg(ze.data);f.ULS.sendTraceTag(509109973,0,50,`BlueDotManager::LineageLoadInGridBlueDotsWithReloadHint service call failed. Errors: [${Ga.a.ue(ze)}]`);Id(new Ye("loadInGridBlueDotsWithReloadHint failed",ze))},ke=ze=>{if(ze=hb.a(ze)?null:ze.Result){var Ue=
{["CountOfActivities"]:ze.ActivityList.length};yb.b(Jb.$).nf(U.a.PPi,Ue);ze=Md(ze.ActivityList,Jb.eaa);Jb.gcc(ze);yc(ze)}else f.ULS.shipAssertTag(509109971,0,!1,"BlueDotManager LineageLoadInGridBlueDotsWithReloadHint returned null response.")},Pe=Object(M.a)(new re,{FlattenedUids:null,ToplevelUids:null===(qe=Jb.b1)||void 0===qe?void 0:qe.ToplevelUids,XrevidFirst:null===(Me=Jb.b1)||void 0===Me?void 0:Me.XrevidFirst,XrevidLast:null===(oa=Jb.b1)||void 0===oa?void 0:oa.XrevidLast,XrevidLastAccepted:null===
(vb=Jb.b1)||void 0===vb?void 0:vb.XrevidLastAccepted,ApplyToplevelAllowList:null===(Ac=Jb.b1)||void 0===Ac?void 0:Ac.ApplyToplevelAllowList,DocId:null===(jd=Jb.b1)||void 0===jd?void 0:jd.DocId});Jb.$.userOperationManager.enqueueOperation(new ua.a(1031,0,(ze,Ue,hg)=>{var of=Jb.$.qa.ua;ze=qb.b(ze,ke);Ue=qb.a(Ue,Ud);const Gf=of.Pa(1,null);Gf.blueDotsReloadHint=Pe;return v.g(of,"LineageLoadInGridBlueDotsWithReloadHint",Gf,ze,Ue,hg,null,0)},80),null)})})}dQi(){this.eQi().then(Jb=>{this.b1=Jb;this.l9b(Jb.FlattenedUids);
this.h1f()},()=>{})}eQi(){const Jb=this;return Io(function*(){return new Promise((yc,Id)=>{f.ULS.sendTraceTag(509109970,0,50,"BlueDotManager::loadBlueDotsInformationAsync");const qe=oa=>{oa=$a.a.Lg(oa.data);f.ULS.sendTraceTag(509109969,0,50,`BlueDotManager  loadBlueDotsInformation service call failed. Errors: [${Ga.a.ue(oa)}]`);Id(new Ye("loadBlueDotsInformation load failed",oa))},Me=oa=>{(oa=hb.a(oa)?null:oa.Result)?yc(oa):f.ULS.shipAssertTag(509109967,0,!!oa,"BlueDotManager loadBlueDotsInformation returned null response.")};
Jb.$.userOperationManager.enqueueOperation(new ua.a(1030,0,(oa,vb,Ac)=>{var jd=Jb.$.qa.ua;oa=qb.b(oa,Me);vb=qb.a(vb,qe);const Ud=jd.Pa(1,null);return v.g(jd,"LineageGetBlueDotsInformation",Ud,oa,vb,Ac,null,4)},80),null)})})}l9b(Jb){Jb&&Jb.forEach(yc=>{yc=`{${yc.toUpperCase()}}`;this.Z4a.has(yc)||this.Z4a.add(yc)})}gcc(Jb){this.Z4a=new Set(Jb.map(yc=>yc.activityGuid))}Kdg(Jb){if(ib.a.iHb(this.$)){var yc=new Y.a(950288339,0,2,12,null);this.$.Ha.Ad(yc,Jb)}}Fbb(){return x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.HideBlueDotBehindLineage",
!1)}DN(){return x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDotGrouping",!1)}ijg(){return!this.b1||this.b1.ApplyToplevelAllowList}dAi(){const Jb=this;return Io(function*(){return new Promise((yc,Id)=>{f.ULS.sendTraceTag(509645136,0,50,"BlueDotManager::invokeOriginalBlueDotsUidList");const qe=oa=>{oa=$a.a.Lg(oa.data);f.ULS.sendTraceTag(509645135,0,50,`BlueDotManager  LineageGetOriginalBlueDotsUidList service call failed. Errors: [${Ga.a.ue(oa)}]`);Id("BlueDotUidList load failed")},
Me=oa=>{(oa=hb.a(oa)?null:oa.Result)?yc(oa):f.ULS.shipAssertTag(509645133,0,!!oa,"BlueDotManager LineageGetOriginalBlueDotsUidList returned null response.")};Jb.$.userOperationManager.enqueueOperation(new ua.a(1029,0,(oa,vb,Ac)=>{var jd=Jb.$.qa.ua;oa=qb.b(oa,Me);vb=qb.a(vb,qe);const Ud=jd.Pa(1,null);return v.g(jd,"LineageGetOriginalBlueDotsUidList",Ud,oa,vb,Ac,null,4)},80),null)})})}kpk(){x.EwaSettings.isChangeGateEnabled("OfficeVSO:7146345_bluedotroamingsetting")&&!x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Test.BlueDotSkipRoamingCall",
!1)&&cd.F(this.$.qa.ua,4,this.blueDotSettings.toString(),Jb=>{Ga.a.ph(Jb.Errors)?f.ULS.sendTraceTag(509732678,0,10,`BlueDotManager.writeBlueDotSettingsToRoamingService: encountered an error. Errors: ${Ga.a.ue(Jb.Errors)}`):Jb.Result||f.ULS.sendTraceTag(509732677,0,10,"BlueDotManager.writeBlueDotSettingsToRoamingService failed to write to roaming service.")},(Jb,yc,Id)=>{Jb=$a.a.Lg(Jb.data);f.ULS.sendTraceTag(509732676,0,10,`BlueDotManager.writeBlueDotSettingsToRoamingService: Encountered errors for ${Id}. Errors: ${Ga.a.ue(Jb)}.`)},
null,null)}h1f(){x.EwaSettings.isChangeGateEnabled("OfficeVSO:7501927_SendBlueDotsUpdateEvent")&&this.raiseEvent("cubduek")}}Object(h.a)($e,"BlueDotManager",sd.a,[794,5]);class tf extends d.a{constructor(Jb){super();this.Ljc=null;this.m8i=yc=>{yc=$a.a.Lg(yc.data);f.ULS.sendTraceTag(509732673,0,10,`LineageBlueDotFactory: Encountered errors while reading roaming setting. Errors: ${Ga.a.ue(yc)}.`)};this.$=Jb;this.je()}create(){this.Ljc||(this.Ljc=this.U2h());this.Ljc.continueWith(()=>{this.Ld(Object(Sb.a)(this.$.ga,
501,()=>new $e(this.$,this.Ljc.result)))})}static la(Jb){Jb.ga.Qa(500,new tf(Jb))}U2h(){if(x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Test.BlueDotSkipRoamingCall",!1))return tb.a.Wa(0);let Jb=new $b.a;Object(cd.y)(this.$.qa.ua,4,yc=>{this.n8i(yc,Jb)},yc=>{this.m8i(yc);Jb.setResult(1)},null,null);return Jb.task}n8i(Jb,yc){Ga.a.ph(Jb.Errors)?(f.ULS.sendTraceTag(509732675,0,10,`LineageBlueDotFactory encountered an error while reading roaming setting. Errors: ${Ga.a.ue(Jb.Errors)}`),
yc.setResult(1)):null==Jb.Result?yc.setResult(0):(Jb=parseInt(Jb.Result,10),f.ULS.sendTraceTag(509732674,0,50,`LineageBlueDotFactory read roaming setting. Value: ${Jb}`),yc.setResult(Jb))}}Object(h.a)(tf,"BlueDotManagerFactory",d.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client");Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.Lineage");Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.VersionHistory");Type.registerNamespace("_Ewa");c.a.Ga(rb.la);c.a.Ga(cb.la);
c.a.Ga(y.la);c.a.Ga(n.la);cc.a.Dk('.LineageActivityPane{height:100%;display:flex;flex-direction:column;overflow:hidden;background-color:#edebe9}.LineageActivityPaneHeader{display:flex;flex-direction:row;position:relative;overflow:hidden;padding-right:16px;padding-left:16px;padding-top:16px;padding-bottom:11px;height:auto;background-color:#edebe9}.LineageActivityPaneTitle{max-width:240px;display:inline-flex;font-weight:bold;font-family:"Segoe UI Semi Bold","Segoe UI Web",Arial,Verdana,sans-serif;font-size:16px;line-height:16px;flex-grow:1;align-content:center;height:auto;text-overflow:ellipsis;overflow:hidden;background-color:#edebe9;margin:0}.LineageActivityCloseButton{display:inline-flex;align-self:center}.LineageActivityBody{height:100%;padding-left:16px;overflow:hidden;background-color:#edebe9}');
(()=>{c.a.Ga(Jb=>{lb.la(Jb);Aa.la(Jb);ec.la(Jb)})})();Type.registerNamespace("Common.App.CatchUpActivity");Xb.main();(()=>{c.a.Ga(Jb=>{Af("Begin");Ca.la(Jb);x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigrateServices6",!1)||Od.la(Jb)})})();(()=>{c.a.Ga(Jb=>{tf.la(Jb)})})();String(b);window.___1689695406601_closurehack=b}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.catchup.js.map/805891a1ce604c9112f3c696727241cb/EwaTS.catchup.js.map